import { assertNever, dict, isPresent } from '@glimmer/util';
export var VariableKind;

(function (VariableKind) {
  VariableKind["Local"] = "Local";
  VariableKind["Free"] = "Free";
  VariableKind["Arg"] = "Arg";
  VariableKind["Block"] = "Block";
  VariableKind["This"] = "This";
})(VariableKind || (VariableKind = {}));

export function normalizeStatement(statement) {
  if (Array.isArray(statement)) {
    if (statementIsExpression(statement)) {
      return normalizeAppendExpression(statement);
    } else if (isSugaryArrayStatement(statement)) {
      return normalizeSugaryArrayStatement(statement);
    } else {
      return normalizeVerboseStatement(statement);
    }
  } else if (typeof statement === 'string') {
    return normalizeAppendHead(normalizeDottedPath(statement), false);
  } else {
    throw assertNever(statement);
  }
}
export function normalizeAppendHead(head, trusted) {
  if (head.type === "GetPath"
  /* GetPath */
  ) {
      return {
        kind: "AppendPath"
        /* AppendPath */
        ,
        path: head,
        trusted
      };
    } else {
    return {
      kind: "AppendExpr"
      /* AppendExpr */
      ,
      expr: head,
      trusted
    };
  }
}

function isSugaryArrayStatement(statement) {
  if (Array.isArray(statement) && typeof statement[0] === 'string') {
    switch (statement[0][0]) {
      case '(':
      case '#':
      case '<':
      case '!':
        return true;

      default:
        return false;
    }
  }

  return false;
}

export function normalizeSugaryArrayStatement(statement) {
  let name = statement[0];

  switch (name[0]) {
    case '(':
      {
        let params = null;
        let hash = null;

        if (statement.length === 3) {
          params = normalizeParams(statement[1]);
          hash = normalizeHash(statement[2]);
        } else if (statement.length === 2) {
          if (Array.isArray(statement[1])) {
            params = normalizeParams(statement[1]);
          } else {
            hash = normalizeHash(statement[1]);
          }
        }

        return {
          kind: "Call"
          /* Call */
          ,
          head: normalizeCallHead(name),
          params,
          hash,
          trusted: false
        };
      }

    case '#':
      {
        let {
          head: path,
          params,
          hash,
          blocks,
          blockParams
        } = normalizeBuilderBlockStatement(statement);
        return {
          kind: "Block"
          /* Block */
          ,
          head: path,
          params,
          hash,
          blocks,
          blockParams
        };
      }

    case '!':
      {
        let name = statement[0].slice(1);
        let {
          params,
          hash,
          blocks,
          blockParams
        } = normalizeBuilderBlockStatement(statement);
        return {
          kind: "Keyword"
          /* Keyword */
          ,
          name,
          params,
          hash,
          blocks,
          blockParams
        };
      }

    case '<':
      {
        let attrs = dict();
        let block = [];

        if (statement.length === 3) {
          attrs = normalizeAttrs(statement[1]);
          block = normalizeBlock(statement[2]);
        } else if (statement.length === 2) {
          if (Array.isArray(statement[1])) {
            block = normalizeBlock(statement[1]);
          } else {
            attrs = normalizeAttrs(statement[1]);
          }
        }

        return {
          kind: "Element"
          /* Element */
          ,
          name: extractElement(name),
          attrs,
          block
        };
      }

    default:
      throw new Error(`Unreachable ${JSON.stringify(statement)} in normalizeSugaryArrayStatement`);
  }
}

function normalizeVerboseStatement(statement) {
  switch (statement[0]) {
    case 0
    /* Literal */
    :
      {
        return {
          kind: "Literal"
          /* Literal */
          ,
          value: statement[1]
        };
      }

    case 2
    /* Append */
    :
      {
        return normalizeAppendExpression(statement[1], statement[2]);
      }

    case 3
    /* Modifier */
    :
      {
        return {
          kind: "Modifier"
          /* Modifier */
          ,
          params: normalizeParams(statement[1]),
          hash: normalizeHash(statement[2])
        };
      }

    case 4
    /* DynamicComponent */
    :
      {
        return {
          kind: "DynamicComponent"
          /* DynamicComponent */
          ,
          expr: normalizeExpression(statement[1]),
          hash: normalizeHash(statement[2]),
          block: normalizeBlock(statement[3])
        };
      }

    case 1
    /* Comment */
    :
      {
        return {
          kind: "Comment"
          /* Comment */
          ,
          value: statement[1]
        };
      }
  }
}

function extractBlockHead(name) {
  let result = /^(#|!)(.*)$/.exec(name);

  if (result === null) {
    throw new Error(`Unexpected missing # in block head`);
  }

  return normalizeDottedPath(result[2]);
}

function normalizeCallHead(name) {
  let result = /^\((.*)\)$/.exec(name);

  if (result === null) {
    throw new Error(`Unexpected missing () in call head`);
  }

  return normalizeDottedPath(result[1]);
}

function normalizePath(head, tail = []) {
  let pathHead = normalizePathHead(head);

  if (isPresent(tail)) {
    return {
      type: "GetPath"
      /* GetPath */
      ,
      path: {
        head: pathHead,
        tail
      }
    };
  } else {
    return {
      type: "GetVar"
      /* GetVar */
      ,
      variable: pathHead
    };
  }
}

function normalizeDottedPath(whole) {
  let {
    kind,
    name: rest
  } = normalizePathHead(whole);
  let [name, ...tail] = rest.split('.');
  let variable = {
    kind,
    name,
    mode: 'loose'
  };

  if (isPresent(tail)) {
    return {
      type: "GetPath"
      /* GetPath */
      ,
      path: {
        head: variable,
        tail
      }
    };
  } else {
    return {
      type: "GetVar"
      /* GetVar */
      ,
      variable
    };
  }
}

export function normalizePathHead(whole) {
  let kind;
  let name;

  if (/^this(\.|$)/.exec(whole)) {
    return {
      kind: VariableKind.This,
      name: whole,
      mode: 'loose'
    };
  }

  switch (whole[0]) {
    case '^':
      kind = VariableKind.Free;
      name = whole.slice(1);
      break;

    case '@':
      kind = VariableKind.Arg;
      name = whole.slice(1);
      break;

    case '&':
      kind = VariableKind.Block;
      name = whole.slice(1);
      break;

    default:
      kind = VariableKind.Local;
      name = whole;
  }

  return {
    kind,
    name,
    mode: 'loose'
  };
}
export function normalizeBuilderBlockStatement(statement) {
  let head = statement[0];
  let blocks = dict();
  let params = null;
  let hash = null;
  let blockParams = null;

  if (statement.length === 2) {
    blocks = normalizeBlocks(statement[1]);
  } else if (statement.length === 3) {
    if (Array.isArray(statement[1])) {
      params = normalizeParams(statement[1]);
    } else {
      ({
        hash,
        blockParams
      } = normalizeBlockHash(statement[1]));
    }

    blocks = normalizeBlocks(statement[2]);
  } else if (statement.length === 4) {
    params = normalizeParams(statement[1]);
    ({
      hash,
      blockParams
    } = normalizeBlockHash(statement[2]));
    blocks = normalizeBlocks(statement[3]);
  }

  return {
    head: extractBlockHead(head),
    params,
    hash,
    blockParams,
    blocks
  };
}

function normalizeBlockHash(hash) {
  if (hash === null) {
    return {
      hash: null,
      blockParams: null
    };
  }

  let out = null;
  let blockParams = null;
  entries(hash, (key, value) => {
    if (key === 'as') {
      blockParams = Array.isArray(value) ? value : [value];
    } else {
      out = out || dict();
      out[key] = normalizeExpression(value);
    }
  });
  return {
    hash: out,
    blockParams
  };
}

export function entries(dict, callback) {
  Object.keys(dict).forEach(key => {
    let value = dict[key];
    callback(key, value);
  });
}

function normalizeBlocks(value) {
  if (Array.isArray(value)) {
    return {
      default: normalizeBlock(value)
    };
  } else {
    return mapObject(value, normalizeBlock);
  }
}

function normalizeBlock(block) {
  return block.map(s => normalizeStatement(s));
}

function normalizeAttrs(attrs) {
  return mapObject(attrs, a => normalizeAttr(a).expr);
}

function normalizeAttr(attr) {
  if (attr === 'splat') {
    return {
      expr: "Splat"
      /* Splat */
      ,
      trusted: false
    };
  } else {
    let expr = normalizeExpression(attr);
    return {
      expr,
      trusted: false
    };
  }
}

function mapObject(object, callback) {
  let out = dict();
  Object.keys(object).forEach(k => {
    out[k] = callback(object[k], k);
  });
  return out;
}

export function isElement(input) {
  let match = /^<([a-z0-9\-][a-zA-Z0-9\-]*)>$/.exec(input[0]);
  return !!match && !!match[1];
}
export function extractElement(input) {
  let match = /^<([a-z0-9\-][a-zA-Z0-9\-]*)>$/.exec(input);
  return match ? match[1] : null;
}
export function extractAngleInvocation(input) {
  let match = /^<(@[a-zA-Z0-9]*|[A-Z][a-zA-Z0-9\-]*)>$/.exec(input[0]);
  return match ? match[1] : null;
}
export function isAngleInvocation(input) {
  // TODO Paths
  let match = /^<(@[a-zA-Z0-9]*|[A-Z][a-zA-Z0-9\-]*)>$/.exec(input[0]);
  return !!match && !!match[1];
}
export function isBlock(input) {
  // TODO Paths
  let match = /^#[^]?([a-zA-Z0-9]*|[A-Z][a-zA-Z0-9\-]*)$/.exec(input[0]);
  return !!match && !!match[1];
}
export function normalizeAppendExpression(expression, forceTrusted = false) {
  if (expression === null || expression === undefined) {
    return {
      expr: {
        type: "Literal"
        /* Literal */
        ,
        value: expression
      },
      kind: "AppendExpr"
      /* AppendExpr */
      ,
      trusted: false
    };
  } else if (Array.isArray(expression)) {
    switch (expression[0]) {
      case 0
      /* Literal */
      :
        return {
          expr: {
            type: "Literal"
            /* Literal */
            ,
            value: expression[1]
          },
          kind: "AppendExpr"
          /* AppendExpr */
          ,
          trusted: false
        };

      case 5
      /* Get */
      :
        {
          return normalizeAppendHead(normalizePath(expression[1], expression[2]), forceTrusted);
        }

      case 6
      /* Concat */
      :
        {
          let expr = {
            type: "Concat"
            /* Concat */
            ,
            params: normalizeParams(expression.slice(1))
          };
          return {
            expr,
            kind: "AppendExpr"
            /* AppendExpr */
            ,
            trusted: forceTrusted
          };
        }

      case 7
      /* HasBlock */
      :
        return {
          expr: {
            type: "HasBlock"
            /* HasBlock */
            ,
            name: expression[1]
          },
          kind: "AppendExpr"
          /* AppendExpr */
          ,
          trusted: forceTrusted
        };

      case 8
      /* HasBlockParams */
      :
        return {
          expr: {
            type: "HasBlockParams"
            /* HasBlockParams */
            ,
            name: expression[1]
          },
          kind: "AppendExpr"
          /* AppendExpr */
          ,
          trusted: forceTrusted
        };

      default:
        {
          if (isBuilderCallExpression(expression)) {
            return {
              expr: normalizeCallExpression(expression),
              kind: "AppendExpr"
              /* AppendExpr */
              ,
              trusted: forceTrusted
            };
          } else {
            throw new Error(`Unexpected array in expression position (wasn't a tuple expression and ${expression[0]} isn't wrapped in parens, so it isn't a call): ${JSON.stringify(expression)}`);
          }
        }
      // BuilderCallExpression
    }
  } else if (typeof expression !== 'object') {
    switch (typeof expression) {
      case 'string':
        {
          return normalizeAppendHead(normalizeDottedPath(expression), forceTrusted);
        }

      case 'boolean':
      case 'number':
        return {
          expr: {
            type: "Literal"
            /* Literal */
            ,
            value: expression
          },
          kind: "AppendExpr"
          /* AppendExpr */
          ,
          trusted: true
        };

      default:
        throw assertNever(expression);
    }
  } else {
    throw assertNever(expression);
  }
}
export function normalizeExpression(expression) {
  if (expression === null || expression === undefined) {
    return {
      type: "Literal"
      /* Literal */
      ,
      value: expression
    };
  } else if (Array.isArray(expression)) {
    switch (expression[0]) {
      case 0
      /* Literal */
      :
        return {
          type: "Literal"
          /* Literal */
          ,
          value: expression[1]
        };

      case 5
      /* Get */
      :
        {
          return normalizePath(expression[1], expression[2]);
        }

      case 6
      /* Concat */
      :
        {
          let expr = {
            type: "Concat"
            /* Concat */
            ,
            params: normalizeParams(expression.slice(1))
          };
          return expr;
        }

      case 7
      /* HasBlock */
      :
        return {
          type: "HasBlock"
          /* HasBlock */
          ,
          name: expression[1]
        };

      case 8
      /* HasBlockParams */
      :
        return {
          type: "HasBlockParams"
          /* HasBlockParams */
          ,
          name: expression[1]
        };

      default:
        {
          if (isBuilderCallExpression(expression)) {
            return normalizeCallExpression(expression);
          } else {
            throw new Error(`Unexpected array in expression position (wasn't a tuple expression and ${expression[0]} isn't wrapped in parens, so it isn't a call): ${JSON.stringify(expression)}`);
          }
        }
      // BuilderCallExpression
    }
  } else if (typeof expression !== 'object') {
    switch (typeof expression) {
      case 'string':
        {
          return normalizeDottedPath(expression);
        }

      case 'boolean':
      case 'number':
        return {
          type: "Literal"
          /* Literal */
          ,
          value: expression
        };

      default:
        throw assertNever(expression);
    }
  } else {
    throw assertNever(expression);
  }
}
export function isBuilderExpression(expr) {
  return Array.isArray(expr);
}
export function isLiteral(expr) {
  return Array.isArray(expr) && expr[0] === 'literal';
}
export function statementIsExpression(statement) {
  if (!Array.isArray(statement)) {
    return false;
  }

  let name = statement[0];

  if (typeof name === 'number') {
    switch (name) {
      case 0
      /* Literal */
      :
      case 5
      /* Get */
      :
      case 6
      /* Concat */
      :
      case 7
      /* HasBlock */
      :
      case 8
      /* HasBlockParams */
      :
        return true;

      default:
        return false;
    }
  }

  if (name[0] === '(') {
    return true;
  }

  return false;
}
export function isBuilderCallExpression(value) {
  return typeof value[0] === 'string' && value[0][0] === '(';
}
export function normalizeParams(input) {
  return input.map(normalizeExpression);
}
export function normalizeHash(input) {
  if (input === null) return null;
  return mapObject(input, normalizeExpression);
}
export function normalizeCallExpression(expr) {
  switch (expr.length) {
    case 1:
      return {
        type: "Call"
        /* Call */
        ,
        head: normalizeCallHead(expr[0]),
        params: null,
        hash: null
      };

    case 2:
      {
        if (Array.isArray(expr[1])) {
          return {
            type: "Call"
            /* Call */
            ,
            head: normalizeCallHead(expr[0]),
            params: normalizeParams(expr[1]),
            hash: null
          };
        } else {
          return {
            type: "Call"
            /* Call */
            ,
            head: normalizeCallHead(expr[0]),
            params: null,
            hash: normalizeHash(expr[1])
          };
        }
      }

    case 3:
      return {
        type: "Call"
        /* Call */
        ,
        head: normalizeCallHead(expr[0]),
        params: normalizeParams(expr[1]),
        hash: normalizeHash(expr[2])
      };
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL2NvbXBpbGVyL2xpYi9idWlsZGVyL2J1aWxkZXItaW50ZXJmYWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVMsV0FBVCxFQUFzQixJQUF0QixFQUFvQyxTQUFwQyxRQUFxRCxlQUFyRDtBQXlDQSxPQUFBLElBQVksWUFBWjs7QUFBQSxDQUFBLFVBQVksWUFBWixFQUF3QjtBQUN0QixFQUFBLFlBQUEsQ0FBQSxPQUFBLENBQUEsR0FBQSxPQUFBO0FBQ0EsRUFBQSxZQUFBLENBQUEsTUFBQSxDQUFBLEdBQUEsTUFBQTtBQUNBLEVBQUEsWUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLEtBQUE7QUFDQSxFQUFBLFlBQUEsQ0FBQSxPQUFBLENBQUEsR0FBQSxPQUFBO0FBQ0EsRUFBQSxZQUFBLENBQUEsTUFBQSxDQUFBLEdBQUEsTUFBQTtBQUNELENBTkQsRUFBWSxZQUFZLEtBQVosWUFBWSxHQUFBLEVBQUEsQ0FBeEI7O0FBa0ZBLE9BQU0sU0FBVSxrQkFBVixDQUE2QixTQUE3QixFQUF3RDtBQUM1RCxNQUFJLEtBQUssQ0FBQyxPQUFOLENBQWMsU0FBZCxDQUFKLEVBQThCO0FBQzVCLFFBQUkscUJBQXFCLENBQUMsU0FBRCxDQUF6QixFQUFzQztBQUNwQyxhQUFPLHlCQUF5QixDQUFDLFNBQUQsQ0FBaEM7QUFDRCxLQUZELE1BRU8sSUFBSSxzQkFBc0IsQ0FBQyxTQUFELENBQTFCLEVBQXVDO0FBQzVDLGFBQU8sNkJBQTZCLENBQUMsU0FBRCxDQUFwQztBQUNELEtBRk0sTUFFQTtBQUNMLGFBQU8seUJBQXlCLENBQUMsU0FBRCxDQUFoQztBQUNEO0FBQ0YsR0FSRCxNQVFPLElBQUksT0FBTyxTQUFQLEtBQXFCLFFBQXpCLEVBQW1DO0FBQ3hDLFdBQU8sbUJBQW1CLENBQUMsbUJBQW1CLENBQUMsU0FBRCxDQUFwQixFQUFpQyxLQUFqQyxDQUExQjtBQUNELEdBRk0sTUFFQTtBQUNM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QUFJLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFELENBQUw7QUFKZCxPQUFQO0FBM0JKO0FBa0NEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGljdCwgRGljdFZhbHVlLCBPcHRpb24sIFByZXNlbnRBcnJheSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgYXNzZXJ0TmV2ZXIsIGRpY3QsIGV4cGVjdCwgaXNQcmVzZW50IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJQYXJhbXMgPSBCdWlsZGVyRXhwcmVzc2lvbltdO1xuZXhwb3J0IHR5cGUgQnVpbGRlckhhc2ggPSBPcHRpb248RGljdDxCdWlsZGVyRXhwcmVzc2lvbj4+O1xuZXhwb3J0IHR5cGUgQnVpbGRlckJsb2NrSGFzaCA9IEJ1aWxkZXJIYXNoIHwgeyBhczogc3RyaW5nIHwgc3RyaW5nW10gfTtcbmV4cG9ydCB0eXBlIEJ1aWxkZXJCbG9ja3MgPSBEaWN0PEJ1aWxkZXJCbG9jaz47XG5leHBvcnQgdHlwZSBCdWlsZGVyQXR0cnMgPSBEaWN0PEJ1aWxkZXJBdHRyPjtcblxuZXhwb3J0IHR5cGUgTm9ybWFsaXplZFBhcmFtcyA9IE5vcm1hbGl6ZWRFeHByZXNzaW9uW107XG5leHBvcnQgdHlwZSBOb3JtYWxpemVkSGFzaCA9IERpY3Q8Tm9ybWFsaXplZEV4cHJlc3Npb24+O1xuZXhwb3J0IHR5cGUgTm9ybWFsaXplZEJsb2NrID0gTm9ybWFsaXplZFN0YXRlbWVudFtdO1xuZXhwb3J0IHR5cGUgTm9ybWFsaXplZEJsb2NrcyA9IERpY3Q8Tm9ybWFsaXplZEJsb2NrPjtcbmV4cG9ydCB0eXBlIE5vcm1hbGl6ZWRBdHRycyA9IERpY3Q8Tm9ybWFsaXplZEF0dHI+O1xuZXhwb3J0IHR5cGUgTm9ybWFsaXplZEF0dHIgPSBIZWFkS2luZC5TcGxhdCB8IE5vcm1hbGl6ZWRFeHByZXNzaW9uO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5vcm1hbGl6ZWRFbGVtZW50IHtcbiAgbmFtZTogc3RyaW5nO1xuICBhdHRyczogT3B0aW9uPE5vcm1hbGl6ZWRBdHRycz47XG4gIGJsb2NrOiBPcHRpb248Tm9ybWFsaXplZEJsb2NrPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBOb3JtYWxpemVkQW5nbGVJbnZvY2F0aW9uIHtcbiAgaGVhZDogTm9ybWFsaXplZEV4cHJlc3Npb247XG4gIGF0dHJzOiBPcHRpb248Tm9ybWFsaXplZEF0dHJzPjtcbiAgYmxvY2s6IE9wdGlvbjxOb3JtYWxpemVkQmxvY2s+O1xufVxuXG5leHBvcnQgY29uc3QgZW51bSBIZWFkS2luZCB7XG4gIEJsb2NrID0gJ0Jsb2NrJyxcbiAgQ2FsbCA9ICdDYWxsJyxcbiAgRWxlbWVudCA9ICdFbGVtZW50JyxcbiAgQXBwZW5kUGF0aCA9ICdBcHBlbmRQYXRoJyxcbiAgQXBwZW5kRXhwciA9ICdBcHBlbmRFeHByJyxcbiAgTGl0ZXJhbCA9ICdMaXRlcmFsJyxcbiAgTW9kaWZpZXIgPSAnTW9kaWZpZXInLFxuICBEeW5hbWljQ29tcG9uZW50ID0gJ0R5bmFtaWNDb21wb25lbnQnLFxuICBDb21tZW50ID0gJ0NvbW1lbnQnLFxuICBTcGxhdCA9ICdTcGxhdCcsXG4gIEtleXdvcmQgPSAnS2V5d29yZCcsXG59XG5cbmV4cG9ydCBlbnVtIFZhcmlhYmxlS2luZCB7XG4gIExvY2FsID0gJ0xvY2FsJyxcbiAgRnJlZSA9ICdGcmVlJyxcbiAgQXJnID0gJ0FyZycsXG4gIEJsb2NrID0gJ0Jsb2NrJyxcbiAgVGhpcyA9ICdUaGlzJyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYXJpYWJsZSB7XG4gIGtpbmQ6IFZhcmlhYmxlS2luZDtcbiAgbmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogRGlmZmVyZW5jZXM6XG4gICAqXG4gICAqIC0gc3RyaWN0IG1vZGUgdmFyaWFibGVzIGFsd2F5cyByZWZlciB0byBpbi1zY29wZSB2YXJpYWJsZXNcbiAgICogLSBsb29zZSBtb2RlIHZhcmlhYmxlcyB1c2UgdGhpcyBhbGdvcml0aG06XG4gICAqICAgMS4gb3RoZXJ3aXNlLCBmYWxsIGJhY2sgdG8gYHRoaXMuPG5hbWU+YFxuICAgKi9cbiAgbW9kZTogJ2xvb3NlJyB8ICdzdHJpY3QnO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBhdGgge1xuICBoZWFkOiBWYXJpYWJsZTtcbiAgdGFpbDogUHJlc2VudEFycmF5PHN0cmluZz47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwZW5kRXhwciB7XG4gIGtpbmQ6IEhlYWRLaW5kLkFwcGVuZEV4cHI7XG4gIGV4cHI6IE5vcm1hbGl6ZWRFeHByZXNzaW9uO1xuICB0cnVzdGVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwcGVuZFBhdGgge1xuICBraW5kOiBIZWFkS2luZC5BcHBlbmRQYXRoO1xuICBwYXRoOiBOb3JtYWxpemVkUGF0aDtcbiAgdHJ1c3RlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBOb3JtYWxpemVkS2V5d29yZFN0YXRlbWVudCB7XG4gIGtpbmQ6IEhlYWRLaW5kLktleXdvcmQ7XG4gIG5hbWU6IHN0cmluZztcbiAgcGFyYW1zOiBPcHRpb248Tm9ybWFsaXplZFBhcmFtcz47XG4gIGhhc2g6IE9wdGlvbjxOb3JtYWxpemVkSGFzaD47XG4gIGJsb2NrUGFyYW1zOiBPcHRpb248c3RyaW5nW10+O1xuICBibG9ja3M6IE5vcm1hbGl6ZWRCbG9ja3M7XG59XG5cbmV4cG9ydCB0eXBlIE5vcm1hbGl6ZWRTdGF0ZW1lbnQgPVxuICB8IHtcbiAgICAgIGtpbmQ6IEhlYWRLaW5kLkNhbGw7XG4gICAgICBoZWFkOiBOb3JtYWxpemVkSGVhZDtcbiAgICAgIHBhcmFtczogT3B0aW9uPE5vcm1hbGl6ZWRQYXJhbXM+O1xuICAgICAgaGFzaDogT3B0aW9uPE5vcm1hbGl6ZWRIYXNoPjtcbiAgICAgIHRydXN0ZWQ6IGJvb2xlYW47XG4gICAgfVxuICB8IHtcbiAgICAgIGtpbmQ6IEhlYWRLaW5kLkJsb2NrO1xuICAgICAgaGVhZDogTm9ybWFsaXplZEhlYWQ7XG4gICAgICBwYXJhbXM6IE9wdGlvbjxOb3JtYWxpemVkUGFyYW1zPjtcbiAgICAgIGhhc2g6IE9wdGlvbjxOb3JtYWxpemVkSGFzaD47XG4gICAgICBibG9ja1BhcmFtczogT3B0aW9uPHN0cmluZ1tdPjtcbiAgICAgIGJsb2NrczogTm9ybWFsaXplZEJsb2NrcztcbiAgICB9XG4gIHwgTm9ybWFsaXplZEtleXdvcmRTdGF0ZW1lbnRcbiAgfCB7XG4gICAgICBraW5kOiBIZWFkS2luZC5FbGVtZW50O1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgYXR0cnM6IE5vcm1hbGl6ZWRBdHRycztcbiAgICAgIGJsb2NrOiBOb3JtYWxpemVkQmxvY2s7XG4gICAgfVxuICB8IHsga2luZDogSGVhZEtpbmQuQ29tbWVudDsgdmFsdWU6IHN0cmluZyB9XG4gIHwgeyBraW5kOiBIZWFkS2luZC5MaXRlcmFsOyB2YWx1ZTogc3RyaW5nIH1cbiAgfCBBcHBlbmRQYXRoXG4gIHwgQXBwZW5kRXhwclxuICB8IHsga2luZDogSGVhZEtpbmQuTW9kaWZpZXI7IHBhcmFtczogTm9ybWFsaXplZFBhcmFtczsgaGFzaDogT3B0aW9uPE5vcm1hbGl6ZWRIYXNoPiB9XG4gIHwge1xuICAgICAga2luZDogSGVhZEtpbmQuRHluYW1pY0NvbXBvbmVudDtcbiAgICAgIGV4cHI6IE5vcm1hbGl6ZWRFeHByZXNzaW9uO1xuICAgICAgaGFzaDogT3B0aW9uPE5vcm1hbGl6ZWRIYXNoPjtcbiAgICAgIGJsb2NrOiBOb3JtYWxpemVkQmxvY2s7XG4gICAgfTtcblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVN0YXRlbWVudChzdGF0ZW1lbnQ6IEJ1aWxkZXJTdGF0ZW1lbnQpOiBOb3JtYWxpemVkU3RhdGVtZW50IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoc3RhdGVtZW50KSkge1xuICAgIGlmIChzdGF0ZW1lbnRJc0V4cHJlc3Npb24oc3RhdGVtZW50KSkge1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZUFwcGVuZEV4cHJlc3Npb24oc3RhdGVtZW50KTtcbiAgICB9IGVsc2UgaWYgKGlzU3VnYXJ5QXJyYXlTdGF0ZW1lbnQoc3RhdGVtZW50KSkge1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZVN1Z2FyeUFycmF5U3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBub3JtYWxpemVWZXJib3NlU3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHR5cGVvZiBzdGF0ZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZUFwcGVuZEhlYWQobm9ybWFsaXplRG90dGVkUGF0aChzdGF0ZW1lbnQpLCBmYWxzZSk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgYXNzZXJ0TmV2ZXIoc3RhdGVtZW50KTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplQXBwZW5kSGVhZChcbiAgaGVhZDogTm9ybWFsaXplZEhlYWQsXG4gIHRydXN0ZWQ6IGJvb2xlYW5cbik6IEFwcGVuZEV4cHIgfCBBcHBlbmRQYXRoIHtcbiAgaWYgKGhlYWQudHlwZSA9PT0gRXhwcmVzc2lvbktpbmQuR2V0UGF0aCkge1xuICAgIHJldHVybiB7XG4gICAgICBraW5kOiBIZWFkS2luZC5BcHBlbmRQYXRoLFxuICAgICAgcGF0aDogaGVhZCxcbiAgICAgIHRydXN0ZWQsXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4ge1xuICAgICAga2luZDogSGVhZEtpbmQuQXBwZW5kRXhwcixcbiAgICAgIGV4cHI6IGhlYWQsXG4gICAgICB0cnVzdGVkLFxuICAgIH07XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNTdWdhcnlBcnJheVN0YXRlbWVudChzdGF0ZW1lbnQ6IEJ1aWxkZXJTdGF0ZW1lbnQpOiBzdGF0ZW1lbnQgaXMgU3VnYXJ5QXJyYXlTdGF0ZW1lbnQge1xuICBpZiAoQXJyYXkuaXNBcnJheShzdGF0ZW1lbnQpICYmIHR5cGVvZiBzdGF0ZW1lbnRbMF0gPT09ICdzdHJpbmcnKSB7XG4gICAgc3dpdGNoIChzdGF0ZW1lbnRbMF1bMF0pIHtcbiAgICAgIGNhc2UgJygnOlxuICAgICAgY2FzZSAnIyc6XG4gICAgICBjYXNlICc8JzpcbiAgICAgIGNhc2UgJyEnOlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCB0eXBlIFN1Z2FyeUFycmF5U3RhdGVtZW50ID0gQnVpbGRlckNhbGxFeHByZXNzaW9uIHwgQnVpbGRlckVsZW1lbnQgfCBCdWlsZGVyQmxvY2tTdGF0ZW1lbnQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVTdWdhcnlBcnJheVN0YXRlbWVudChcbiAgc3RhdGVtZW50OiBTdWdhcnlBcnJheVN0YXRlbWVudFxuKTogTm9ybWFsaXplZFN0YXRlbWVudCB7XG4gIGxldCBuYW1lID0gc3RhdGVtZW50WzBdO1xuXG4gIHN3aXRjaCAobmFtZVswXSkge1xuICAgIGNhc2UgJygnOiB7XG4gICAgICBsZXQgcGFyYW1zOiBPcHRpb248Tm9ybWFsaXplZFBhcmFtcz4gPSBudWxsO1xuICAgICAgbGV0IGhhc2g6IE9wdGlvbjxOb3JtYWxpemVkSGFzaD4gPSBudWxsO1xuXG4gICAgICBpZiAoc3RhdGVtZW50Lmxlbmd0aCA9PT0gMykge1xuICAgICAgICBwYXJhbXMgPSBub3JtYWxpemVQYXJhbXMoc3RhdGVtZW50WzFdIGFzIFBhcmFtcyk7XG4gICAgICAgIGhhc2ggPSBub3JtYWxpemVIYXNoKHN0YXRlbWVudFsyXSBhcyBIYXNoKTtcbiAgICAgIH0gZWxzZSBpZiAoc3RhdGVtZW50Lmxlbmd0aCA9PT0gMikge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzdGF0ZW1lbnRbMV0pKSB7XG4gICAgICAgICAgcGFyYW1zID0gbm9ybWFsaXplUGFyYW1zKHN0YXRlbWVudFsxXSBhcyBQYXJhbXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhhc2ggPSBub3JtYWxpemVIYXNoKHN0YXRlbWVudFsxXSBhcyBIYXNoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBraW5kOiBIZWFkS2luZC5DYWxsLFxuICAgICAgICBoZWFkOiBub3JtYWxpemVDYWxsSGVhZChuYW1lKSxcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBoYXNoLFxuICAgICAgICB0cnVzdGVkOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY2FzZSAnIyc6IHtcbiAgICAgIGxldCB7IGhlYWQ6IHBhdGgsIHBhcmFtcywgaGFzaCwgYmxvY2tzLCBibG9ja1BhcmFtcyB9ID0gbm9ybWFsaXplQnVpbGRlckJsb2NrU3RhdGVtZW50KFxuICAgICAgICBzdGF0ZW1lbnQgYXMgQnVpbGRlckJsb2NrU3RhdGVtZW50XG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBraW5kOiBIZWFkS2luZC5CbG9jayxcbiAgICAgICAgaGVhZDogcGF0aCxcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBoYXNoLFxuICAgICAgICBibG9ja3MsXG4gICAgICAgIGJsb2NrUGFyYW1zLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjYXNlICchJzoge1xuICAgICAgbGV0IG5hbWUgPSBzdGF0ZW1lbnRbMF0uc2xpY2UoMSk7XG4gICAgICBsZXQgeyBwYXJhbXMsIGhhc2gsIGJsb2NrcywgYmxvY2tQYXJhbXMgfSA9IG5vcm1hbGl6ZUJ1aWxkZXJCbG9ja1N0YXRlbWVudChcbiAgICAgICAgc3RhdGVtZW50IGFzIEJ1aWxkZXJCbG9ja1N0YXRlbWVudFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2luZDogSGVhZEtpbmQuS2V5d29yZCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBoYXNoLFxuICAgICAgICBibG9ja3MsXG4gICAgICAgIGJsb2NrUGFyYW1zLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjYXNlICc8Jzoge1xuICAgICAgbGV0IGF0dHJzOiBOb3JtYWxpemVkQXR0cnMgPSBkaWN0KCk7XG4gICAgICBsZXQgYmxvY2s6IE5vcm1hbGl6ZWRCbG9jayA9IFtdO1xuXG4gICAgICBpZiAoc3RhdGVtZW50Lmxlbmd0aCA9PT0gMykge1xuICAgICAgICBhdHRycyA9IG5vcm1hbGl6ZUF0dHJzKHN0YXRlbWVudFsxXSBhcyBCdWlsZGVyQXR0cnMpO1xuICAgICAgICBibG9jayA9IG5vcm1hbGl6ZUJsb2NrKHN0YXRlbWVudFsyXSBhcyBCdWlsZGVyQmxvY2spO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZW1lbnQubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHN0YXRlbWVudFsxXSkpIHtcbiAgICAgICAgICBibG9jayA9IG5vcm1hbGl6ZUJsb2NrKHN0YXRlbWVudFsxXSBhcyBCdWlsZGVyQmxvY2spO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGF0dHJzID0gbm9ybWFsaXplQXR0cnMoc3RhdGVtZW50WzFdIGFzIEJ1aWxkZXJBdHRycyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2luZDogSGVhZEtpbmQuRWxlbWVudCxcbiAgICAgICAgbmFtZTogZXhwZWN0KGV4dHJhY3RFbGVtZW50KG5hbWUpLCBgQlVHOiBleHBlY3RlZCAke25hbWV9IHRvIGxvb2sgbGlrZSBhIHRhZyBuYW1lYCksXG4gICAgICAgIGF0dHJzLFxuICAgICAgICBibG9jayxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWFjaGFibGUgJHtKU09OLnN0cmluZ2lmeShzdGF0ZW1lbnQpfSBpbiBub3JtYWxpemVTdWdhcnlBcnJheVN0YXRlbWVudGApO1xuICB9XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVZlcmJvc2VTdGF0ZW1lbnQoc3RhdGVtZW50OiBWZXJib3NlU3RhdGVtZW50KTogTm9ybWFsaXplZFN0YXRlbWVudCB7XG4gIHN3aXRjaCAoc3RhdGVtZW50WzBdKSB7XG4gICAgY2FzZSBCdWlsZGVyLkxpdGVyYWw6IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGtpbmQ6IEhlYWRLaW5kLkxpdGVyYWwsXG4gICAgICAgIHZhbHVlOiBzdGF0ZW1lbnRbMV0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNhc2UgQnVpbGRlci5BcHBlbmQ6IHtcbiAgICAgIHJldHVybiBub3JtYWxpemVBcHBlbmRFeHByZXNzaW9uKHN0YXRlbWVudFsxXSwgc3RhdGVtZW50WzJdKTtcbiAgICB9XG5cbiAgICBjYXNlIEJ1aWxkZXIuTW9kaWZpZXI6IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGtpbmQ6IEhlYWRLaW5kLk1vZGlmaWVyLFxuICAgICAgICBwYXJhbXM6IG5vcm1hbGl6ZVBhcmFtcyhzdGF0ZW1lbnRbMV0pLFxuICAgICAgICBoYXNoOiBub3JtYWxpemVIYXNoKHN0YXRlbWVudFsyXSksXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNhc2UgQnVpbGRlci5EeW5hbWljQ29tcG9uZW50OiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBraW5kOiBIZWFkS2luZC5EeW5hbWljQ29tcG9uZW50LFxuICAgICAgICBleHByOiBub3JtYWxpemVFeHByZXNzaW9uKHN0YXRlbWVudFsxXSksXG4gICAgICAgIGhhc2g6IG5vcm1hbGl6ZUhhc2goc3RhdGVtZW50WzJdKSxcbiAgICAgICAgYmxvY2s6IG5vcm1hbGl6ZUJsb2NrKHN0YXRlbWVudFszXSksXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNhc2UgQnVpbGRlci5Db21tZW50OiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBraW5kOiBIZWFkS2luZC5Db21tZW50LFxuICAgICAgICB2YWx1ZTogc3RhdGVtZW50WzFdLFxuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdEJsb2NrSGVhZChuYW1lOiBzdHJpbmcpOiBOb3JtYWxpemVkSGVhZCB7XG4gIGxldCByZXN1bHQgPSAvXigjfCEpKC4qKSQvLmV4ZWMobmFtZSk7XG5cbiAgaWYgKHJlc3VsdCA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBtaXNzaW5nICMgaW4gYmxvY2sgaGVhZGApO1xuICB9XG5cbiAgcmV0dXJuIG5vcm1hbGl6ZURvdHRlZFBhdGgocmVzdWx0WzJdKTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQ2FsbEhlYWQobmFtZTogc3RyaW5nKTogTm9ybWFsaXplZEhlYWQge1xuICBsZXQgcmVzdWx0ID0gL15cXCgoLiopXFwpJC8uZXhlYyhuYW1lKTtcblxuICBpZiAocmVzdWx0ID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIG1pc3NpbmcgKCkgaW4gY2FsbCBoZWFkYCk7XG4gIH1cblxuICByZXR1cm4gbm9ybWFsaXplRG90dGVkUGF0aChyZXN1bHRbMV0pO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVQYXRoKGhlYWQ6IHN0cmluZywgdGFpbDogc3RyaW5nW10gPSBbXSk6IE5vcm1hbGl6ZWRIZWFkIHtcbiAgbGV0IHBhdGhIZWFkID0gbm9ybWFsaXplUGF0aEhlYWQoaGVhZCk7XG5cbiAgaWYgKGlzUHJlc2VudCh0YWlsKSkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBFeHByZXNzaW9uS2luZC5HZXRQYXRoLFxuICAgICAgcGF0aDoge1xuICAgICAgICBoZWFkOiBwYXRoSGVhZCxcbiAgICAgICAgdGFpbCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuR2V0VmFyLFxuICAgICAgdmFyaWFibGU6IHBhdGhIZWFkLFxuICAgIH07XG4gIH1cbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplRG90dGVkUGF0aCh3aG9sZTogc3RyaW5nKTogTm9ybWFsaXplZEhlYWQge1xuICBsZXQgeyBraW5kLCBuYW1lOiByZXN0IH0gPSBub3JtYWxpemVQYXRoSGVhZCh3aG9sZSk7XG5cbiAgbGV0IFtuYW1lLCAuLi50YWlsXSA9IHJlc3Quc3BsaXQoJy4nKTtcblxuICBsZXQgdmFyaWFibGU6IFZhcmlhYmxlID0geyBraW5kLCBuYW1lLCBtb2RlOiAnbG9vc2UnIH07XG5cbiAgaWYgKGlzUHJlc2VudCh0YWlsKSkge1xuICAgIHJldHVybiB7IHR5cGU6IEV4cHJlc3Npb25LaW5kLkdldFBhdGgsIHBhdGg6IHsgaGVhZDogdmFyaWFibGUsIHRhaWwgfSB9O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB7IHR5cGU6IEV4cHJlc3Npb25LaW5kLkdldFZhciwgdmFyaWFibGUgfTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplUGF0aEhlYWQod2hvbGU6IHN0cmluZyk6IFZhcmlhYmxlIHtcbiAgbGV0IGtpbmQ6IFZhcmlhYmxlS2luZDtcbiAgbGV0IG5hbWU6IHN0cmluZztcblxuICBpZiAoL150aGlzKFxcLnwkKS8uZXhlYyh3aG9sZSkpIHtcbiAgICByZXR1cm4ge1xuICAgICAga2luZDogVmFyaWFibGVLaW5kLlRoaXMsXG4gICAgICBuYW1lOiB3aG9sZSxcbiAgICAgIG1vZGU6ICdsb29zZScsXG4gICAgfTtcbiAgfVxuXG4gIHN3aXRjaCAod2hvbGVbMF0pIHtcbiAgICBjYXNlICdeJzpcbiAgICAgIGtpbmQgPSBWYXJpYWJsZUtpbmQuRnJlZTtcbiAgICAgIG5hbWUgPSB3aG9sZS5zbGljZSgxKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnQCc6XG4gICAgICBraW5kID0gVmFyaWFibGVLaW5kLkFyZztcbiAgICAgIG5hbWUgPSB3aG9sZS5zbGljZSgxKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnJic6XG4gICAgICBraW5kID0gVmFyaWFibGVLaW5kLkJsb2NrO1xuICAgICAgbmFtZSA9IHdob2xlLnNsaWNlKDEpO1xuICAgICAgYnJlYWs7XG5cbiAgICBkZWZhdWx0OlxuICAgICAga2luZCA9IFZhcmlhYmxlS2luZC5Mb2NhbDtcbiAgICAgIG5hbWUgPSB3aG9sZTtcbiAgfVxuXG4gIHJldHVybiB7IGtpbmQsIG5hbWUsIG1vZGU6ICdsb29zZScgfTtcbn1cblxuZXhwb3J0IHR5cGUgQnVpbGRlckJsb2NrU3RhdGVtZW50ID1cbiAgfCBbc3RyaW5nLCBCdWlsZGVyQmxvY2sgfCBCdWlsZGVyQmxvY2tzXVxuICB8IFtzdHJpbmcsIEJ1aWxkZXJQYXJhbXMgfCBCdWlsZGVyQmxvY2tIYXNoLCBCdWlsZGVyQmxvY2sgfCBCdWlsZGVyQmxvY2tzXVxuICB8IFtzdHJpbmcsIEJ1aWxkZXJQYXJhbXMsIEJ1aWxkZXJCbG9ja0hhc2gsIEJ1aWxkZXJCbG9jayB8IEJ1aWxkZXJCbG9ja3NdO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5vcm1hbGl6ZWRCdWlsZGVyQmxvY2tTdGF0ZW1lbnQge1xuICBoZWFkOiBOb3JtYWxpemVkSGVhZDtcbiAgcGFyYW1zOiBPcHRpb248Tm9ybWFsaXplZFBhcmFtcz47XG4gIGhhc2g6IE9wdGlvbjxOb3JtYWxpemVkSGFzaD47XG4gIGJsb2NrUGFyYW1zOiBPcHRpb248c3RyaW5nW10+O1xuICBibG9ja3M6IE5vcm1hbGl6ZWRCbG9ja3M7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVCdWlsZGVyQmxvY2tTdGF0ZW1lbnQoXG4gIHN0YXRlbWVudDogQnVpbGRlckJsb2NrU3RhdGVtZW50XG4pOiBOb3JtYWxpemVkQnVpbGRlckJsb2NrU3RhdGVtZW50IHtcbiAgbGV0IGhlYWQgPSBzdGF0ZW1lbnRbMF07XG4gIGxldCBibG9ja3M6IE5vcm1hbGl6ZWRCbG9ja3MgPSBkaWN0KCk7XG4gIGxldCBwYXJhbXM6IE9wdGlvbjxOb3JtYWxpemVkUGFyYW1zPiA9IG51bGw7XG4gIGxldCBoYXNoOiBPcHRpb248Tm9ybWFsaXplZEhhc2g+ID0gbnVsbDtcbiAgbGV0IGJsb2NrUGFyYW1zOiBPcHRpb248c3RyaW5nW10+ID0gbnVsbDtcblxuICBpZiAoc3RhdGVtZW50Lmxlbmd0aCA9PT0gMikge1xuICAgIGJsb2NrcyA9IG5vcm1hbGl6ZUJsb2NrcyhzdGF0ZW1lbnRbMV0pO1xuICB9IGVsc2UgaWYgKHN0YXRlbWVudC5sZW5ndGggPT09IDMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzdGF0ZW1lbnRbMV0pKSB7XG4gICAgICBwYXJhbXMgPSBub3JtYWxpemVQYXJhbXMoc3RhdGVtZW50WzFdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgKHsgaGFzaCwgYmxvY2tQYXJhbXMgfSA9IG5vcm1hbGl6ZUJsb2NrSGFzaChzdGF0ZW1lbnRbMV0pKTtcbiAgICB9XG5cbiAgICBibG9ja3MgPSBub3JtYWxpemVCbG9ja3Moc3RhdGVtZW50WzJdKTtcbiAgfSBlbHNlIGlmIChzdGF0ZW1lbnQubGVuZ3RoID09PSA0KSB7XG4gICAgcGFyYW1zID0gbm9ybWFsaXplUGFyYW1zKHN0YXRlbWVudFsxXSk7XG4gICAgKHsgaGFzaCwgYmxvY2tQYXJhbXMgfSA9IG5vcm1hbGl6ZUJsb2NrSGFzaChzdGF0ZW1lbnRbMl0pKTtcbiAgICBibG9ja3MgPSBub3JtYWxpemVCbG9ja3Moc3RhdGVtZW50WzNdKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaGVhZDogZXh0cmFjdEJsb2NrSGVhZChoZWFkKSxcbiAgICBwYXJhbXMsXG4gICAgaGFzaCxcbiAgICBibG9ja1BhcmFtcyxcbiAgICBibG9ja3MsXG4gIH07XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUJsb2NrSGFzaChcbiAgaGFzaDogQnVpbGRlckJsb2NrSGFzaFxuKTogeyBoYXNoOiBPcHRpb248Tm9ybWFsaXplZEhhc2g+OyBibG9ja1BhcmFtczogT3B0aW9uPHN0cmluZ1tdPiB9IHtcbiAgaWYgKGhhc2ggPT09IG51bGwpIHtcbiAgICByZXR1cm4geyBoYXNoOiBudWxsLCBibG9ja1BhcmFtczogbnVsbCB9O1xuICB9XG5cbiAgbGV0IG91dDogT3B0aW9uPERpY3Q8Tm9ybWFsaXplZEV4cHJlc3Npb24+PiA9IG51bGw7XG4gIGxldCBibG9ja1BhcmFtczogT3B0aW9uPHN0cmluZ1tdPiA9IG51bGw7XG5cbiAgZW50cmllcyhoYXNoLCAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGlmIChrZXkgPT09ICdhcycpIHtcbiAgICAgIGJsb2NrUGFyYW1zID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dCA9IG91dCB8fCBkaWN0KCk7XG4gICAgICBvdXRba2V5XSA9IG5vcm1hbGl6ZUV4cHJlc3Npb24odmFsdWUgYXMgQnVpbGRlckV4cHJlc3Npb24pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHsgaGFzaDogb3V0LCBibG9ja1BhcmFtcyB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW50cmllczxEIGV4dGVuZHMgRGljdD4oXG4gIGRpY3Q6IEQsXG4gIGNhbGxiYWNrOiA8SyBleHRlbmRzIGtleW9mIEQ+KGtleTogSywgdmFsdWU6IERbS10pID0+IHZvaWRcbik6IHZvaWQge1xuICBPYmplY3Qua2V5cyhkaWN0KS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICBsZXQgdmFsdWUgPSBkaWN0W2tleV07XG4gICAgY2FsbGJhY2soa2V5LCB2YWx1ZSBhcyBEW2tleW9mIERdKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUJsb2Nrcyh2YWx1ZTogQnVpbGRlckJsb2NrIHwgQnVpbGRlckJsb2Nrcyk6IE5vcm1hbGl6ZWRCbG9ja3Mge1xuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4geyBkZWZhdWx0OiBub3JtYWxpemVCbG9jayh2YWx1ZSkgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbWFwT2JqZWN0KHZhbHVlLCBub3JtYWxpemVCbG9jayk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQmxvY2soYmxvY2s6IEJ1aWxkZXJCbG9jayk6IE5vcm1hbGl6ZWRCbG9jayB7XG4gIHJldHVybiBibG9jay5tYXAoKHMpID0+IG5vcm1hbGl6ZVN0YXRlbWVudChzKSk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUF0dHJzKGF0dHJzOiBCdWlsZGVyQXR0cnMpOiBOb3JtYWxpemVkQXR0cnMge1xuICByZXR1cm4gbWFwT2JqZWN0KGF0dHJzLCAoYSkgPT4gbm9ybWFsaXplQXR0cihhKS5leHByKTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQXR0cihhdHRyOiBCdWlsZGVyQXR0cik6IHsgZXhwcjogTm9ybWFsaXplZEF0dHI7IHRydXN0ZWQ6IGJvb2xlYW4gfSB7XG4gIGlmIChhdHRyID09PSAnc3BsYXQnKSB7XG4gICAgcmV0dXJuIHsgZXhwcjogSGVhZEtpbmQuU3BsYXQsIHRydXN0ZWQ6IGZhbHNlIH07XG4gIH0gZWxzZSB7XG4gICAgbGV0IGV4cHIgPSBub3JtYWxpemVFeHByZXNzaW9uKGF0dHIpO1xuICAgIHJldHVybiB7IGV4cHIsIHRydXN0ZWQ6IGZhbHNlIH07XG4gIH1cbn1cblxuZnVuY3Rpb24gbWFwT2JqZWN0PFQgZXh0ZW5kcyBEaWN0PHVua25vd24+LCBPdXQ+KFxuICBvYmplY3Q6IFQsXG4gIGNhbGxiYWNrOiAodmFsdWU6IERpY3RWYWx1ZTxUPiwga2V5OiBrZXlvZiBUKSA9PiBPdXRcbik6IHsgW1AgaW4ga2V5b2YgVF06IE91dCB9IHtcbiAgbGV0IG91dCA9IGRpY3QoKSBhcyB7IFtQIGluIGtleW9mIFRdPzogT3V0IH07XG5cbiAgT2JqZWN0LmtleXMob2JqZWN0KS5mb3JFYWNoKDxLIGV4dGVuZHMga2V5b2YgVD4oazogSykgPT4ge1xuICAgIG91dFtrXSA9IGNhbGxiYWNrKG9iamVjdFtrXSBhcyBEaWN0VmFsdWU8VD4sIGspO1xuICB9KTtcblxuICByZXR1cm4gb3V0IGFzIHsgW1AgaW4ga2V5b2YgVF06IE91dCB9O1xufVxuXG5leHBvcnQgdHlwZSBCdWlsZGVyRWxlbWVudCA9XG4gIHwgW3N0cmluZ11cbiAgfCBbc3RyaW5nLCBCdWlsZGVyQXR0cnMsIEJ1aWxkZXJCbG9ja11cbiAgfCBbc3RyaW5nLCBCdWlsZGVyQmxvY2tdXG4gIHwgW3N0cmluZywgQnVpbGRlckF0dHJzXTtcblxuZXhwb3J0IHR5cGUgQnVpbGRlckNvbW1lbnQgPSBbQnVpbGRlci5Db21tZW50LCBzdHJpbmddO1xuXG5leHBvcnQgdHlwZSBJbnZvY2F0aW9uRWxlbWVudCA9XG4gIHwgW3N0cmluZ11cbiAgfCBbc3RyaW5nLCBCdWlsZGVyQXR0cnMsIEJ1aWxkZXJCbG9ja11cbiAgfCBbc3RyaW5nLCBCdWlsZGVyQmxvY2tdXG4gIHwgW3N0cmluZywgQnVpbGRlckF0dHJzXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzRWxlbWVudChpbnB1dDogW3N0cmluZywgLi4udW5rbm93bltdXSk6IGlucHV0IGlzIEJ1aWxkZXJFbGVtZW50IHtcbiAgbGV0IG1hdGNoID0gL148KFthLXowLTlcXC1dW2EtekEtWjAtOVxcLV0qKT4kLy5leGVjKGlucHV0WzBdKTtcblxuICByZXR1cm4gISFtYXRjaCAmJiAhIW1hdGNoWzFdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdEVsZW1lbnQoaW5wdXQ6IHN0cmluZyk6IE9wdGlvbjxzdHJpbmc+IHtcbiAgbGV0IG1hdGNoID0gL148KFthLXowLTlcXC1dW2EtekEtWjAtOVxcLV0qKT4kLy5leGVjKGlucHV0KTtcblxuICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0QW5nbGVJbnZvY2F0aW9uKGlucHV0OiBzdHJpbmcpOiBPcHRpb248c3RyaW5nPiB7XG4gIGxldCBtYXRjaCA9IC9ePChAW2EtekEtWjAtOV0qfFtBLVpdW2EtekEtWjAtOVxcLV0qKT4kLy5leGVjKGlucHV0WzBdKTtcblxuICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FuZ2xlSW52b2NhdGlvbihpbnB1dDogW3N0cmluZywgLi4udW5rbm93bltdXSk6IGlucHV0IGlzIEludm9jYXRpb25FbGVtZW50IHtcbiAgLy8gVE9ETyBQYXRoc1xuICBsZXQgbWF0Y2ggPSAvXjwoQFthLXpBLVowLTldKnxbQS1aXVthLXpBLVowLTlcXC1dKik+JC8uZXhlYyhpbnB1dFswXSk7XG5cbiAgcmV0dXJuICEhbWF0Y2ggJiYgISFtYXRjaFsxXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQmxvY2soaW5wdXQ6IFtzdHJpbmcsIC4uLnVua25vd25bXV0pOiBpbnB1dCBpcyBCdWlsZGVyQmxvY2tTdGF0ZW1lbnQge1xuICAvLyBUT0RPIFBhdGhzXG4gIGxldCBtYXRjaCA9IC9eI1teXT8oW2EtekEtWjAtOV0qfFtBLVpdW2EtekEtWjAtOVxcLV0qKSQvLmV4ZWMoaW5wdXRbMF0pO1xuXG4gIHJldHVybiAhIW1hdGNoICYmICEhbWF0Y2hbMV07XG59XG5cbmV4cG9ydCBjb25zdCBlbnVtIEJ1aWxkZXIge1xuICBMaXRlcmFsLFxuICBDb21tZW50LFxuICBBcHBlbmQsXG4gIE1vZGlmaWVyLFxuICBEeW5hbWljQ29tcG9uZW50LFxuICBHZXQsXG4gIENvbmNhdCxcbiAgSGFzQmxvY2ssXG4gIEhhc0Jsb2NrUGFyYW1zLFxufVxuXG5leHBvcnQgdHlwZSBWZXJib3NlU3RhdGVtZW50ID1cbiAgfCBbQnVpbGRlci5MaXRlcmFsLCBzdHJpbmddXG4gIHwgW0J1aWxkZXIuQ29tbWVudCwgc3RyaW5nXVxuICB8IFtCdWlsZGVyLkFwcGVuZCwgQnVpbGRlckV4cHJlc3Npb24sIHRydWVdXG4gIHwgW0J1aWxkZXIuQXBwZW5kLCBCdWlsZGVyRXhwcmVzc2lvbl1cbiAgfCBbQnVpbGRlci5Nb2RpZmllciwgUGFyYW1zLCBIYXNoXVxuICB8IFtCdWlsZGVyLkR5bmFtaWNDb21wb25lbnQsIEJ1aWxkZXJFeHByZXNzaW9uLCBIYXNoLCBCdWlsZGVyQmxvY2tdO1xuXG5leHBvcnQgdHlwZSBCdWlsZGVyU3RhdGVtZW50ID1cbiAgfCBWZXJib3NlU3RhdGVtZW50XG4gIHwgU3VnYXJ5QXJyYXlTdGF0ZW1lbnRcbiAgfCBUdXBsZUJ1aWxkZXJFeHByZXNzaW9uXG4gIHwgc3RyaW5nO1xuXG5leHBvcnQgdHlwZSBCdWlsZGVyQXR0ciA9ICdzcGxhdCcgfCBCdWlsZGVyRXhwcmVzc2lvbjtcblxuZXhwb3J0IHR5cGUgVHVwbGVCdWlsZGVyRXhwcmVzc2lvbiA9XG4gIHwgW0J1aWxkZXIuTGl0ZXJhbCwgc3RyaW5nIHwgYm9vbGVhbiB8IG51bGwgfCB1bmRlZmluZWRdXG4gIHwgW0J1aWxkZXIuR2V0LCBzdHJpbmddXG4gIHwgW0J1aWxkZXIuR2V0LCBzdHJpbmcsIHN0cmluZ1tdXVxuICB8IFtCdWlsZGVyLkNvbmNhdCwgLi4uQnVpbGRlckV4cHJlc3Npb25bXV1cbiAgfCBbQnVpbGRlci5IYXNCbG9jaywgc3RyaW5nXVxuICB8IFtCdWlsZGVyLkhhc0Jsb2NrUGFyYW1zLCBzdHJpbmddXG4gIHwgQnVpbGRlckNhbGxFeHByZXNzaW9uO1xuXG50eXBlIFBhcmFtcyA9IEJ1aWxkZXJQYXJhbXM7XG50eXBlIEhhc2ggPSBEaWN0PEJ1aWxkZXJFeHByZXNzaW9uPjtcblxuZXhwb3J0IGNvbnN0IGVudW0gRXhwcmVzc2lvbktpbmQge1xuICBMaXRlcmFsID0gJ0xpdGVyYWwnLFxuICBDYWxsID0gJ0NhbGwnLFxuICBHZXRQYXRoID0gJ0dldFBhdGgnLFxuICBHZXRWYXIgPSAnR2V0VmFyJyxcbiAgQ29uY2F0ID0gJ0NvbmNhdCcsXG4gIEhhc0Jsb2NrID0gJ0hhc0Jsb2NrJyxcbiAgSGFzQmxvY2tQYXJhbXMgPSAnSGFzQmxvY2tQYXJhbXMnLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE5vcm1hbGl6ZWRDYWxsRXhwcmVzc2lvbiB7XG4gIHR5cGU6IEV4cHJlc3Npb25LaW5kLkNhbGw7XG4gIGhlYWQ6IE5vcm1hbGl6ZWRIZWFkO1xuICBwYXJhbXM6IE9wdGlvbjxOb3JtYWxpemVkUGFyYW1zPjtcbiAgaGFzaDogT3B0aW9uPE5vcm1hbGl6ZWRIYXNoPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBOb3JtYWxpemVkUGF0aCB7XG4gIHR5cGU6IEV4cHJlc3Npb25LaW5kLkdldFBhdGg7XG4gIHBhdGg6IFBhdGg7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTm9ybWFsaXplZFZhciB7XG4gIHR5cGU6IEV4cHJlc3Npb25LaW5kLkdldFZhcjtcbiAgdmFyaWFibGU6IFZhcmlhYmxlO1xufVxuXG5leHBvcnQgdHlwZSBOb3JtYWxpemVkSGVhZCA9IE5vcm1hbGl6ZWRQYXRoIHwgTm9ybWFsaXplZFZhcjtcblxuZXhwb3J0IGludGVyZmFjZSBOb3JtYWxpemVkQ29uY2F0IHtcbiAgdHlwZTogRXhwcmVzc2lvbktpbmQuQ29uY2F0O1xuICBwYXJhbXM6IFtOb3JtYWxpemVkRXhwcmVzc2lvbiwgLi4uTm9ybWFsaXplZEV4cHJlc3Npb25bXV07XG59XG5cbmV4cG9ydCB0eXBlIE5vcm1hbGl6ZWRFeHByZXNzaW9uID1cbiAgfCB7XG4gICAgICB0eXBlOiBFeHByZXNzaW9uS2luZC5MaXRlcmFsO1xuICAgICAgdmFsdWU6IG51bGwgfCB1bmRlZmluZWQgfCBib29sZWFuIHwgc3RyaW5nIHwgbnVtYmVyO1xuICAgIH1cbiAgfCBOb3JtYWxpemVkQ2FsbEV4cHJlc3Npb25cbiAgfCBOb3JtYWxpemVkUGF0aFxuICB8IE5vcm1hbGl6ZWRWYXJcbiAgfCBOb3JtYWxpemVkQ29uY2F0XG4gIHwge1xuICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuSGFzQmxvY2s7XG4gICAgICBuYW1lOiBzdHJpbmc7XG4gICAgfVxuICB8IHtcbiAgICAgIHR5cGU6IEV4cHJlc3Npb25LaW5kLkhhc0Jsb2NrUGFyYW1zO1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgIH07XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVBcHBlbmRFeHByZXNzaW9uKFxuICBleHByZXNzaW9uOiBCdWlsZGVyRXhwcmVzc2lvbixcbiAgZm9yY2VUcnVzdGVkID0gZmFsc2Vcbik6IEFwcGVuZEV4cHIgfCBBcHBlbmRQYXRoIHtcbiAgaWYgKGV4cHJlc3Npb24gPT09IG51bGwgfHwgZXhwcmVzc2lvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGV4cHI6IHtcbiAgICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuTGl0ZXJhbCxcbiAgICAgICAgdmFsdWU6IGV4cHJlc3Npb24sXG4gICAgICB9LFxuICAgICAga2luZDogSGVhZEtpbmQuQXBwZW5kRXhwcixcbiAgICAgIHRydXN0ZWQ6IGZhbHNlLFxuICAgIH07XG4gIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShleHByZXNzaW9uKSkge1xuICAgIHN3aXRjaCAoZXhwcmVzc2lvblswXSkge1xuICAgICAgY2FzZSBCdWlsZGVyLkxpdGVyYWw6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZXhwcjogeyB0eXBlOiBFeHByZXNzaW9uS2luZC5MaXRlcmFsLCB2YWx1ZTogZXhwcmVzc2lvblsxXSB9LFxuICAgICAgICAgIGtpbmQ6IEhlYWRLaW5kLkFwcGVuZEV4cHIsXG4gICAgICAgICAgdHJ1c3RlZDogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgIGNhc2UgQnVpbGRlci5HZXQ6IHtcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZUFwcGVuZEhlYWQobm9ybWFsaXplUGF0aChleHByZXNzaW9uWzFdLCBleHByZXNzaW9uWzJdKSwgZm9yY2VUcnVzdGVkKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgQnVpbGRlci5Db25jYXQ6IHtcbiAgICAgICAgbGV0IGV4cHI6IE5vcm1hbGl6ZWRDb25jYXQgPSB7XG4gICAgICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuQ29uY2F0LFxuICAgICAgICAgIHBhcmFtczogbm9ybWFsaXplUGFyYW1zKGV4cHJlc3Npb24uc2xpY2UoMSkpIGFzIFtcbiAgICAgICAgICAgIE5vcm1hbGl6ZWRFeHByZXNzaW9uLFxuICAgICAgICAgICAgLi4uTm9ybWFsaXplZEV4cHJlc3Npb25bXVxuICAgICAgICAgIF0sXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBleHByLFxuICAgICAgICAgIGtpbmQ6IEhlYWRLaW5kLkFwcGVuZEV4cHIsXG4gICAgICAgICAgdHJ1c3RlZDogZm9yY2VUcnVzdGVkLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBjYXNlIEJ1aWxkZXIuSGFzQmxvY2s6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZXhwcjoge1xuICAgICAgICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuSGFzQmxvY2ssXG4gICAgICAgICAgICBuYW1lOiBleHByZXNzaW9uWzFdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAga2luZDogSGVhZEtpbmQuQXBwZW5kRXhwcixcbiAgICAgICAgICB0cnVzdGVkOiBmb3JjZVRydXN0ZWQsXG4gICAgICAgIH07XG5cbiAgICAgIGNhc2UgQnVpbGRlci5IYXNCbG9ja1BhcmFtczpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBleHByOiB7XG4gICAgICAgICAgICB0eXBlOiBFeHByZXNzaW9uS2luZC5IYXNCbG9ja1BhcmFtcyxcbiAgICAgICAgICAgIG5hbWU6IGV4cHJlc3Npb25bMV0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBraW5kOiBIZWFkS2luZC5BcHBlbmRFeHByLFxuICAgICAgICAgIHRydXN0ZWQ6IGZvcmNlVHJ1c3RlZCxcbiAgICAgICAgfTtcblxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBpZiAoaXNCdWlsZGVyQ2FsbEV4cHJlc3Npb24oZXhwcmVzc2lvbikpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZXhwcjogbm9ybWFsaXplQ2FsbEV4cHJlc3Npb24oZXhwcmVzc2lvbiksXG4gICAgICAgICAgICBraW5kOiBIZWFkS2luZC5BcHBlbmRFeHByLFxuICAgICAgICAgICAgdHJ1c3RlZDogZm9yY2VUcnVzdGVkLFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFVuZXhwZWN0ZWQgYXJyYXkgaW4gZXhwcmVzc2lvbiBwb3NpdGlvbiAod2Fzbid0IGEgdHVwbGUgZXhwcmVzc2lvbiBhbmQgJHtcbiAgICAgICAgICAgICAgZXhwcmVzc2lvblswXSBhcyBzdHJpbmdcbiAgICAgICAgICAgIH0gaXNuJ3Qgd3JhcHBlZCBpbiBwYXJlbnMsIHNvIGl0IGlzbid0IGEgY2FsbCk6ICR7SlNPTi5zdHJpbmdpZnkoZXhwcmVzc2lvbil9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEJ1aWxkZXJDYWxsRXhwcmVzc2lvblxuICAgIH1cbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwcmVzc2lvbiAhPT0gJ29iamVjdCcpIHtcbiAgICBzd2l0Y2ggKHR5cGVvZiBleHByZXNzaW9uKSB7XG4gICAgICBjYXNlICdzdHJpbmcnOiB7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVBcHBlbmRIZWFkKG5vcm1hbGl6ZURvdHRlZFBhdGgoZXhwcmVzc2lvbiksIGZvcmNlVHJ1c3RlZCk7XG4gICAgICB9XG4gICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZXhwcjogeyB0eXBlOiBFeHByZXNzaW9uS2luZC5MaXRlcmFsLCB2YWx1ZTogZXhwcmVzc2lvbiB9LFxuICAgICAgICAgIGtpbmQ6IEhlYWRLaW5kLkFwcGVuZEV4cHIsXG4gICAgICAgICAgdHJ1c3RlZDogdHJ1ZSxcbiAgICAgICAgfTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgYXNzZXJ0TmV2ZXIoZXhwcmVzc2lvbik7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRocm93IGFzc2VydE5ldmVyKGV4cHJlc3Npb24pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVFeHByZXNzaW9uKGV4cHJlc3Npb246IEJ1aWxkZXJFeHByZXNzaW9uKTogTm9ybWFsaXplZEV4cHJlc3Npb24ge1xuICBpZiAoZXhwcmVzc2lvbiA9PT0gbnVsbCB8fCBleHByZXNzaW9uID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuTGl0ZXJhbCxcbiAgICAgIHZhbHVlOiBleHByZXNzaW9uLFxuICAgIH07XG4gIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShleHByZXNzaW9uKSkge1xuICAgIHN3aXRjaCAoZXhwcmVzc2lvblswXSkge1xuICAgICAgY2FzZSBCdWlsZGVyLkxpdGVyYWw6XG4gICAgICAgIHJldHVybiB7IHR5cGU6IEV4cHJlc3Npb25LaW5kLkxpdGVyYWwsIHZhbHVlOiBleHByZXNzaW9uWzFdIH07XG5cbiAgICAgIGNhc2UgQnVpbGRlci5HZXQ6IHtcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVBhdGgoZXhwcmVzc2lvblsxXSwgZXhwcmVzc2lvblsyXSk7XG4gICAgICB9XG4gICAgICBjYXNlIEJ1aWxkZXIuQ29uY2F0OiB7XG4gICAgICAgIGxldCBleHByOiBOb3JtYWxpemVkQ29uY2F0ID0ge1xuICAgICAgICAgIHR5cGU6IEV4cHJlc3Npb25LaW5kLkNvbmNhdCxcbiAgICAgICAgICBwYXJhbXM6IG5vcm1hbGl6ZVBhcmFtcyhleHByZXNzaW9uLnNsaWNlKDEpKSBhcyBbXG4gICAgICAgICAgICBOb3JtYWxpemVkRXhwcmVzc2lvbixcbiAgICAgICAgICAgIC4uLk5vcm1hbGl6ZWRFeHByZXNzaW9uW11cbiAgICAgICAgICBdLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBleHByO1xuICAgICAgfVxuXG4gICAgICBjYXNlIEJ1aWxkZXIuSGFzQmxvY2s6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuSGFzQmxvY2ssXG4gICAgICAgICAgbmFtZTogZXhwcmVzc2lvblsxXSxcbiAgICAgICAgfTtcblxuICAgICAgY2FzZSBCdWlsZGVyLkhhc0Jsb2NrUGFyYW1zOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHR5cGU6IEV4cHJlc3Npb25LaW5kLkhhc0Jsb2NrUGFyYW1zLFxuICAgICAgICAgIG5hbWU6IGV4cHJlc3Npb25bMV0sXG4gICAgICAgIH07XG5cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgaWYgKGlzQnVpbGRlckNhbGxFeHByZXNzaW9uKGV4cHJlc3Npb24pKSB7XG4gICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZUNhbGxFeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBVbmV4cGVjdGVkIGFycmF5IGluIGV4cHJlc3Npb24gcG9zaXRpb24gKHdhc24ndCBhIHR1cGxlIGV4cHJlc3Npb24gYW5kICR7XG4gICAgICAgICAgICAgIGV4cHJlc3Npb25bMF0gYXMgc3RyaW5nXG4gICAgICAgICAgICB9IGlzbid0IHdyYXBwZWQgaW4gcGFyZW5zLCBzbyBpdCBpc24ndCBhIGNhbGwpOiAke0pTT04uc3RyaW5naWZ5KGV4cHJlc3Npb24pfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBCdWlsZGVyQ2FsbEV4cHJlc3Npb25cbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cHJlc3Npb24gIT09ICdvYmplY3QnKSB7XG4gICAgc3dpdGNoICh0eXBlb2YgZXhwcmVzc2lvbikge1xuICAgICAgY2FzZSAnc3RyaW5nJzoge1xuICAgICAgICByZXR1cm4gbm9ybWFsaXplRG90dGVkUGF0aChleHByZXNzaW9uKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgcmV0dXJuIHsgdHlwZTogRXhwcmVzc2lvbktpbmQuTGl0ZXJhbCwgdmFsdWU6IGV4cHJlc3Npb24gfTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgYXNzZXJ0TmV2ZXIoZXhwcmVzc2lvbik7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRocm93IGFzc2VydE5ldmVyKGV4cHJlc3Npb24pO1xuICB9XG59XG5cbi8vIHwgW0J1aWxkZXIuR2V0LCBzdHJpbmddXG4vLyB8IFtCdWlsZGVyLkdldCwgc3RyaW5nLCBzdHJpbmdbXV1cbi8vIHwgW0J1aWxkZXIuQ29uY2F0LCBQYXJhbXNdXG4vLyB8IFtCdWlsZGVyLkhhc0Jsb2NrLCBzdHJpbmddXG4vLyB8IFtCdWlsZGVyLkhhc0Jsb2NrUGFyYW1zLCBzdHJpbmddXG5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJFeHByZXNzaW9uID1cbiAgfCBUdXBsZUJ1aWxkZXJFeHByZXNzaW9uXG4gIHwgQnVpbGRlckNhbGxFeHByZXNzaW9uXG4gIHwgbnVsbFxuICB8IHVuZGVmaW5lZFxuICB8IGJvb2xlYW5cbiAgfCBzdHJpbmdcbiAgfCBudW1iZXI7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0J1aWxkZXJFeHByZXNzaW9uKFxuICBleHByOiBCdWlsZGVyRXhwcmVzc2lvbiB8IEJ1aWxkZXJDYWxsRXhwcmVzc2lvblxuKTogZXhwciBpcyBUdXBsZUJ1aWxkZXJFeHByZXNzaW9uIHwgQnVpbGRlckNhbGxFeHByZXNzaW9uIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZXhwcik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0xpdGVyYWwoXG4gIGV4cHI6IEJ1aWxkZXJFeHByZXNzaW9uIHwgQnVpbGRlckNhbGxFeHByZXNzaW9uXG4pOiBleHByIGlzIFtCdWlsZGVyLkxpdGVyYWwsIHN0cmluZyB8IGJvb2xlYW4gfCB1bmRlZmluZWRdIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZXhwcikgJiYgZXhwclswXSA9PT0gJ2xpdGVyYWwnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RhdGVtZW50SXNFeHByZXNzaW9uKFxuICBzdGF0ZW1lbnQ6IEJ1aWxkZXJTdGF0ZW1lbnRcbik6IHN0YXRlbWVudCBpcyBUdXBsZUJ1aWxkZXJFeHByZXNzaW9uIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KHN0YXRlbWVudCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsZXQgbmFtZSA9IHN0YXRlbWVudFswXTtcblxuICBpZiAodHlwZW9mIG5hbWUgPT09ICdudW1iZXInKSB7XG4gICAgc3dpdGNoIChuYW1lKSB7XG4gICAgICBjYXNlIEJ1aWxkZXIuTGl0ZXJhbDpcbiAgICAgIGNhc2UgQnVpbGRlci5HZXQ6XG4gICAgICBjYXNlIEJ1aWxkZXIuQ29uY2F0OlxuICAgICAgY2FzZSBCdWlsZGVyLkhhc0Jsb2NrOlxuICAgICAgY2FzZSBCdWlsZGVyLkhhc0Jsb2NrUGFyYW1zOlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBpZiAobmFtZVswXSA9PT0gJygnKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0J1aWxkZXJDYWxsRXhwcmVzc2lvbihcbiAgdmFsdWU6IFR1cGxlQnVpbGRlckV4cHJlc3Npb24gfCBCdWlsZGVyQ2FsbEV4cHJlc3Npb25cbik6IHZhbHVlIGlzIEJ1aWxkZXJDYWxsRXhwcmVzc2lvbiB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWVbMF0gPT09ICdzdHJpbmcnICYmIHZhbHVlWzBdWzBdID09PSAnKCc7XG59XG5cbmV4cG9ydCB0eXBlIE1pbmlCdWlsZGVyQmxvY2sgPSBCdWlsZGVyU3RhdGVtZW50W107XG5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJCbG9jayA9IE1pbmlCdWlsZGVyQmxvY2s7XG5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJDYWxsRXhwcmVzc2lvbiA9IFtzdHJpbmddIHwgW3N0cmluZywgUGFyYW1zIHwgSGFzaF0gfCBbc3RyaW5nLCBQYXJhbXMsIEhhc2hdO1xuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplUGFyYW1zKGlucHV0OiBQYXJhbXMpOiBOb3JtYWxpemVkUGFyYW1zIHtcbiAgcmV0dXJuIGlucHV0Lm1hcChub3JtYWxpemVFeHByZXNzaW9uKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUhhc2goaW5wdXQ6IE9wdGlvbjxIYXNoPik6IE9wdGlvbjxOb3JtYWxpemVkSGFzaD4ge1xuICBpZiAoaW5wdXQgPT09IG51bGwpIHJldHVybiBudWxsO1xuICByZXR1cm4gbWFwT2JqZWN0KGlucHV0LCBub3JtYWxpemVFeHByZXNzaW9uKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUNhbGxFeHByZXNzaW9uKGV4cHI6IEJ1aWxkZXJDYWxsRXhwcmVzc2lvbik6IE5vcm1hbGl6ZWRDYWxsRXhwcmVzc2lvbiB7XG4gIHN3aXRjaCAoZXhwci5sZW5ndGgpIHtcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBFeHByZXNzaW9uS2luZC5DYWxsLFxuICAgICAgICBoZWFkOiBub3JtYWxpemVDYWxsSGVhZChleHByWzBdKSxcbiAgICAgICAgcGFyYW1zOiBudWxsLFxuICAgICAgICBoYXNoOiBudWxsLFxuICAgICAgfTtcbiAgICBjYXNlIDI6IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4cHJbMV0pKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogRXhwcmVzc2lvbktpbmQuQ2FsbCxcbiAgICAgICAgICBoZWFkOiBub3JtYWxpemVDYWxsSGVhZChleHByWzBdKSxcbiAgICAgICAgICBwYXJhbXM6IG5vcm1hbGl6ZVBhcmFtcyhleHByWzFdKSxcbiAgICAgICAgICBoYXNoOiBudWxsLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBFeHByZXNzaW9uS2luZC5DYWxsLFxuICAgICAgICAgIGhlYWQ6IG5vcm1hbGl6ZUNhbGxIZWFkKGV4cHJbMF0pLFxuICAgICAgICAgIHBhcmFtczogbnVsbCxcbiAgICAgICAgICBoYXNoOiBub3JtYWxpemVIYXNoKGV4cHJbMV0pLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IEV4cHJlc3Npb25LaW5kLkNhbGwsXG4gICAgICAgIGhlYWQ6IG5vcm1hbGl6ZUNhbGxIZWFkKGV4cHJbMF0pLFxuICAgICAgICBwYXJhbXM6IG5vcm1hbGl6ZVBhcmFtcyhleHByWzFdKSxcbiAgICAgICAgaGFzaDogbm9ybWFsaXplSGFzaChleHByWzJdKSxcbiAgICAgIH07XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=