"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EXPRESSIONS = void 0;

var _vm = require("@glimmer/vm");

var _globalContext = require("@glimmer/global-context");

var _expr = require("../opcode-builder/helpers/expr");

var _resolution = require("../opcode-builder/helpers/resolution");

var _shared = require("../opcode-builder/helpers/shared");

var _vm2 = require("../opcode-builder/helpers/vm");

var _compilers = require("./compilers");

function _createForOfIteratorHelperLoose(o, allowArrayLike) {
  var it;

  if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) {
    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
      if (it) o = it;
      var i = 0;
      return function () {
        if (i >= o.length) return {
          done: true
        };
        return {
          done: false,
          value: o[i++]
        };
      };
    }

    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }

  it = o[Symbol.iterator]();
  return it.next.bind(it);
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }

  return arr2;
}

var EXPRESSIONS = new _compilers.Compilers();
exports.EXPRESSIONS = EXPRESSIONS;
EXPRESSIONS.add(29
/* Concat */
, function (op, _ref) {
  var parts = _ref[1];

  for (var _iterator = _createForOfIteratorHelperLoose(parts), _step; !(_step = _iterator()).done;) {
    var part = _step.value;
    (0, _expr.expr)(op, part);
  }

  op(27
  /* Concat */
  , parts.length);
});
EXPRESSIONS.add(28
/* Call */
, function (op, _ref2) {
  var expression = _ref2[1],
      positional = _ref2[2],
      named = _ref2[3];

  if ((0, _resolution.isGetFreeHelper)(expression)) {
    op(1005
    /* ResolveHelper */
    , expression, function (handle) {
      (0, _vm2.Call)(op, handle, positional, named);
    });
  } else {
    (0, _expr.expr)(op, expression);
    (0, _vm2.CallDynamic)(op, positional, named);
  }
});
EXPRESSIONS.add(50
/* Curry */
, function (op, _ref3) {
  var expr = _ref3[1],
      type = _ref3[2],
      positional = _ref3[3],
      named = _ref3[4];
  (0, _vm2.Curry)(op, type, expr, positional, named);
});
EXPRESSIONS.add(30
/* GetSymbol */
, function (op, _ref4) {
  var sym = _ref4[1],
      path = _ref4[2];
  op(21
  /* GetVariable */
  , sym);
  withPath(op, path);
});
EXPRESSIONS.add(32
/* GetTemplateSymbol */
, function (op, _ref5) {
  var sym = _ref5[1],
      path = _ref5[2];
  op(1011
  /* ResolveTemplateLocal */
  , sym, function (handle) {
    op(29
    /* ConstantReference */
    , handle);
    withPath(op, path);
  });
});
EXPRESSIONS.add(31
/* GetStrictFree */
, function (op, _ref6) {
  var sym = _ref6[1],
      _path = _ref6[2];
  op(1009
  /* ResolveFree */
  , sym, function (_handle) {// TODO: Implement in strict mode
  });
});
EXPRESSIONS.add(34
/* GetFreeAsComponentOrHelperHeadOrThisFallback */
, function () {
  // TODO: The logic for this opcode currently exists in STATEMENTS.Append, since
  // we want different wrapping logic depending on if we are invoking a component,
  // helper, or {{this}} fallback. Eventually we fix the opcodes so that we can
  // traverse the subexpression tree like normal in this location.
  throw new Error('unimplemented opcode');
});
EXPRESSIONS.add(36
/* GetFreeAsHelperHeadOrThisFallback */
, function (op, expr) {
  // <div id={{baz}}>
  op(1010
  /* ResolveLocal */
  , expr[1], function (_name) {
    op(1006
    /* ResolveOptionalHelper */
    , expr, {
      ifHelper: function ifHelper(handle) {
        (0, _vm2.Call)(op, handle, null, null);
      }
    });
  });
});
EXPRESSIONS.add(99
/* GetFreeAsDeprecatedHelperHeadOrThisFallback */
, function (op, expr) {
  // <Foo @bar={{baz}}>
  op(1010
  /* ResolveLocal */
  , expr[1], function (_name) {
    op(1006
    /* ResolveOptionalHelper */
    , expr, {
      ifHelper: function ifHelper(handle, name, moduleName) {
        (0, _globalContext.assert)(expr[2] && expr[2].length === 1, '[BUG] Missing argument name');
        var arg = expr[2][0];
        (0, _globalContext.deprecate)("The `" + name + "` helper was used in the `" + moduleName + "` template as `" + arg + "={{" + name + "}}`. " + ("This is ambigious between wanting the `" + arg + "` argument to be the `" + name + "` helper itself, ") + ("or the result of invoking the `" + name + "` helper (current behavior). ") + "This implicit invocation behavior has been deprecated.\n\n" + ("Instead, please explicitly invoke the helper with parenthesis, i.e. `" + arg + "={{(" + name + ")}}`.\n\n") + "Note: the parenthesis are only required in this exact scenario where an ambiguity is present \u2013 where " + ("`" + name + "` referes to a global helper (as opposed to a local variable), AND ") + ("the `" + name + "` helper invocation does not take any arguments, AND ") + "this occurs in a named argument position of a component invocation.\n\n" + "We expect this combination to be quite rare, as most helpers require at least one argument. " + "There is no need to refactor helper invocations in cases where this deprecation was not triggered.", false, {
          id: 'argument-less-helper-paren-less-invocation'
        });
        (0, _vm2.Call)(op, handle, null, null);
      }
    });
  });
});

function withPath(op, path) {
  if (path === undefined || path.length === 0) return;

  for (var i = 0; i < path.length; i++) {
    op(22
    /* GetProperty */
    , path[i]);
  }
}

EXPRESSIONS.add(27
/* Undefined */
, function (op) {
  return (0, _vm2.PushPrimitiveReference)(op, undefined);
});
EXPRESSIONS.add(48
/* HasBlock */
, function (op, _ref7) {
  var block = _ref7[1];
  (0, _expr.expr)(op, block);
  op(25
  /* HasBlock */
  );
});
EXPRESSIONS.add(49
/* HasBlockParams */
, function (op, _ref8) {
  var block = _ref8[1];
  (0, _expr.expr)(op, block);
  op(24
  /* SpreadBlock */
  );
  op(61
  /* CompileBlock */
  );
  op(26
  /* HasBlockParams */
  );
});
EXPRESSIONS.add(52
/* IfInline */
, function (op, _ref9) {
  var condition = _ref9[1],
      truthy = _ref9[2],
      falsy = _ref9[3]; // Push in reverse order

  (0, _expr.expr)(op, falsy);
  (0, _expr.expr)(op, truthy);
  (0, _expr.expr)(op, condition);
  op(109
  /* IfInline */
  );
});
EXPRESSIONS.add(51
/* Not */
, function (op, _ref10) {
  var value = _ref10[1];
  (0, _expr.expr)(op, value);
  op(110
  /* Not */
  );
});
EXPRESSIONS.add(53
/* GetDynamicVar */
, function (op, _ref11) {
  var expression = _ref11[1];
  (0, _expr.expr)(op, expression);
  op(111
  /* GetDynamicVar */
  );
});
EXPRESSIONS.add(54
/* Log */
, function (op, _ref12) {
  var positional = _ref12[1];
  op(0
  /* PushFrame */
  );
  (0, _shared.SimpleArgs)(op, positional, null, false);
  op(112
  /* Log */
  );
  op(1
  /* PopFrame */
  );
  op(36
  /* Fetch */
  , _vm.$v0);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL29wY29kZS1jb21waWxlci9saWIvc3ludGF4L2V4cHJlc3Npb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFPQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVPLElBQU0sV0FBVyxHQUFHLElBQXBCLG9CQUFvQixFQUFwQjs7QUFFUCxXQUFXLENBQVgsR0FBQSxDQUFlO0FBQUE7QUFBZixFQUFvQyxVQUFBLEVBQUEsRUFBQSxJQUFBLEVBQWtCO0FBQUEsTUFBbEIsS0FBa0IsR0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBOztBQUNwRCxPQUFBLElBQUEsU0FBQSxHQUFBLCtCQUFBLENBQUEsS0FBQSxDQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsQ0FBQSxLQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsSUFBQSxHQUF3QjtBQUFBLFFBQXhCLElBQXdCLEdBQUEsS0FBQSxDQUFBLEtBQUE7QUFDdEIsb0JBQUksRUFBSixFQUFBLElBQUE7QUFDRDs7QUFFRCxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBWSxLQUFLLENBQW5CLE1BQUUsQ0FBRjtBQUxGLENBQUE7QUFRQSxXQUFXLENBQVgsR0FBQSxDQUFlO0FBQUE7QUFBZixFQUFrQyxVQUFBLEVBQUEsRUFBQSxLQUFBLEVBQTBDO0FBQUEsTUFBckMsVUFBcUMsR0FBQSxLQUFBLENBQUEsQ0FBQSxDQUFBO0FBQUEsTUFBckMsVUFBcUMsR0FBQSxLQUFBLENBQUEsQ0FBQSxDQUFBO0FBQUEsTUFBMUMsS0FBMEMsR0FBQSxLQUFBLENBQUEsQ0FBQSxDQUFBOztBQUMxRSxNQUFJLGlDQUFKLFVBQUksQ0FBSixFQUFpQztBQUMvQixJQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsTUFBQSxVQUFBLEVBQXVELFVBQUQsTUFBQyxFQUFr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QSxDQUFBLENBQ3pFOztBQUNBLGtCQUFJLEVBQUosRUFBQSxLQUFBO0FBQ0Esa0JBQUksRUFBSixFQUFBLE1BQUE7QUFDQSxrQkFBSSxFQUFKLEVBQUEsU0FBQTtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBTEYsQ0FBQTtBQVFBLFdBQVcsQ0FBWCxHQUFBLENBQWU7QUFBQTtBQUFmLEVBQWlDLFVBQUEsRUFBQSxFQUFBLE1BQUEsRUFBa0I7QUFBQSxNQUFsQixLQUFrQixHQUFBLE1BQUEsQ0FBQSxDQUFBLENBQUE7QUFDakQsa0JBQUksRUFBSixFQUFBLEtBQUE7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUZGLENBQUE7QUFLQSxXQUFXLENBQVgsR0FBQSxDQUFlO0FBQUE7QUFBZixFQUEyQyxVQUFBLEVBQUEsRUFBQSxNQUFBLEVBQXVCO0FBQUEsTUFBdkIsVUFBdUIsR0FBQSxNQUFBLENBQUEsQ0FBQSxDQUFBO0FBQ2hFLGtCQUFJLEVBQUosRUFBQSxVQUFBO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLEdBQUY7QUFGRixDQUFBO0FBS0EsV0FBVyxDQUFYLEdBQUEsQ0FBZTtBQUFBO0FBQWYsRUFBaUMsVUFBQSxFQUFBLEVBQUEsTUFBQSxFQUF1QjtBQUFBLE1BQXZCLFVBQXVCLEdBQUEsTUFBQSxDQUFBLENBQUEsQ0FBQTtBQUN0RCxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNBLDBCQUFVLEVBQVYsRUFBVSxVQUFWLEVBQVUsSUFBVixFQUFBLEtBQUE7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQUYsT0FBRSxDQUFGO0FBTEYsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEV4cHJlc3Npb25TZXhwT3Bjb2RlLFxuICBIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLFxuICBNYWNoaW5lT3AsXG4gIE9wLFxuICBTZXhwT3Bjb2Rlcyxcbn0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyAkdjAgfSBmcm9tICdAZ2xpbW1lci92bSc7XG5pbXBvcnQgeyBhc3NlcnQsIGRlcHJlY2F0ZSB9IGZyb20gJ0BnbGltbWVyL2dsb2JhbC1jb250ZXh0JztcbmltcG9ydCB7IGV4cHIgfSBmcm9tICcuLi9vcGNvZGUtYnVpbGRlci9oZWxwZXJzL2V4cHInO1xuaW1wb3J0IHsgaXNHZXRGcmVlSGVscGVyIH0gZnJvbSAnLi4vb3Bjb2RlLWJ1aWxkZXIvaGVscGVycy9yZXNvbHV0aW9uJztcbmltcG9ydCB7IFNpbXBsZUFyZ3MgfSBmcm9tICcuLi9vcGNvZGUtYnVpbGRlci9oZWxwZXJzL3NoYXJlZCc7XG5pbXBvcnQgeyBDYWxsLCBDYWxsRHluYW1pYywgQ3VycnksIFB1c2hQcmltaXRpdmVSZWZlcmVuY2UgfSBmcm9tICcuLi9vcGNvZGUtYnVpbGRlci9oZWxwZXJzL3ZtJztcbmltcG9ydCB7IENvbXBpbGVycywgUHVzaEV4cHJlc3Npb25PcCB9IGZyb20gJy4vY29tcGlsZXJzJztcblxuZXhwb3J0IGNvbnN0IEVYUFJFU1NJT05TID0gbmV3IENvbXBpbGVyczxQdXNoRXhwcmVzc2lvbk9wLCBFeHByZXNzaW9uU2V4cE9wY29kZT4oKTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkNvbmNhdCwgKG9wLCBbLCBwYXJ0c10pID0+IHtcbiAgZm9yIChsZXQgcGFydCBvZiBwYXJ0cykge1xuICAgIGV4cHIob3AsIHBhcnQpO1xuICB9XG5cbiAgb3AoT3AuQ29uY2F0LCBwYXJ0cy5sZW5ndGgpO1xufSk7XG5cbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5DYWxsLCAob3AsIFssIGV4cHJlc3Npb24sIHBvc2l0aW9uYWwsIG5hbWVkXSkgPT4ge1xuICBpZiAoaXNHZXRGcmVlSGVscGVyKGV4cHJlc3Npb24pKSB7XG4gICAgb3AoSGlnaExldmVsUmVzb2x1dGlvbk9wY29kZS5SZXNvbHZlSGVscGVyLCBleHByZXNzaW9uLCAoaGFuZGxlOiBudW1iZXIpID0+IHtcbiAgICAgIENhbGwob3AsIGhhbmRsZSwgcG9zaXRpb25hbCwgbmFtZWQpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGV4cHIob3AsIGV4cHJlc3Npb24pO1xuICAgIENhbGxEeW5hbWljKG9wLCBwb3NpdGlvbmFsLCBuYW1lZCk7XG4gIH1cbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuQ3VycnksIChvcCwgWywgZXhwciwgdHlwZSwgcG9zaXRpb25hbCwgbmFtZWRdKSA9PiB7XG4gIEN1cnJ5KG9wLCB0eXBlLCBleHByLCBwb3NpdGlvbmFsLCBuYW1lZCk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldFN5bWJvbCwgKG9wLCBbLCBzeW0sIHBhdGhdKSA9PiB7XG4gIG9wKE9wLkdldFZhcmlhYmxlLCBzeW0pO1xuICB3aXRoUGF0aChvcCwgcGF0aCk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldFRlbXBsYXRlU3ltYm9sLCAob3AsIFssIHN5bSwgcGF0aF0pID0+IHtcbiAgb3AoSGlnaExldmVsUmVzb2x1dGlvbk9wY29kZS5SZXNvbHZlVGVtcGxhdGVMb2NhbCwgc3ltLCAoaGFuZGxlOiBudW1iZXIpID0+IHtcbiAgICBvcChPcC5Db25zdGFudFJlZmVyZW5jZSwgaGFuZGxlKTtcbiAgICB3aXRoUGF0aChvcCwgcGF0aCk7XG4gIH0pO1xufSk7XG5cbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5HZXRTdHJpY3RGcmVlLCAob3AsIFssIHN5bSwgX3BhdGhdKSA9PiB7XG4gIG9wKEhpZ2hMZXZlbFJlc29sdXRpb25PcGNvZGUuUmVzb2x2ZUZyZWUsIHN5bSwgKF9oYW5kbGU6IHVua25vd24pID0+IHtcbiAgICAvLyBUT0RPOiBJbXBsZW1lbnQgaW4gc3RyaWN0IG1vZGVcbiAgfSk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldEZyZWVBc0NvbXBvbmVudE9ySGVscGVySGVhZE9yVGhpc0ZhbGxiYWNrLCAoKSA9PiB7XG4gIC8vIFRPRE86IFRoZSBsb2dpYyBmb3IgdGhpcyBvcGNvZGUgY3VycmVudGx5IGV4aXN0cyBpbiBTVEFURU1FTlRTLkFwcGVuZCwgc2luY2VcbiAgLy8gd2Ugd2FudCBkaWZmZXJlbnQgd3JhcHBpbmcgbG9naWMgZGVwZW5kaW5nIG9uIGlmIHdlIGFyZSBpbnZva2luZyBhIGNvbXBvbmVudCxcbiAgLy8gaGVscGVyLCBvciB7e3RoaXN9fSBmYWxsYmFjay4gRXZlbnR1YWxseSB3ZSBmaXggdGhlIG9wY29kZXMgc28gdGhhdCB3ZSBjYW5cbiAgLy8gdHJhdmVyc2UgdGhlIHN1YmV4cHJlc3Npb24gdHJlZSBsaWtlIG5vcm1hbCBpbiB0aGlzIGxvY2F0aW9uLlxuICB0aHJvdyBuZXcgRXJyb3IoJ3VuaW1wbGVtZW50ZWQgb3Bjb2RlJyk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldEZyZWVBc0hlbHBlckhlYWRPclRoaXNGYWxsYmFjaywgKG9wLCBleHByKSA9PiB7XG4gIC8vIDxkaXYgaWQ9e3tiYXp9fT5cblxuICBvcChIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLlJlc29sdmVMb2NhbCwgZXhwclsxXSwgKF9uYW1lOiBzdHJpbmcpID0+IHtcbiAgICBvcChIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLlJlc29sdmVPcHRpb25hbEhlbHBlciwgZXhwciwge1xuICAgICAgaWZIZWxwZXI6IChoYW5kbGU6IG51bWJlcikgPT4ge1xuICAgICAgICBDYWxsKG9wLCBoYW5kbGUsIG51bGwsIG51bGwpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldEZyZWVBc0RlcHJlY2F0ZWRIZWxwZXJIZWFkT3JUaGlzRmFsbGJhY2ssIChvcCwgZXhwcikgPT4ge1xuICAvLyA8Rm9vIEBiYXI9e3tiYXp9fT5cblxuICBvcChIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLlJlc29sdmVMb2NhbCwgZXhwclsxXSwgKF9uYW1lOiBzdHJpbmcpID0+IHtcbiAgICBvcChIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLlJlc29sdmVPcHRpb25hbEhlbHBlciwgZXhwciwge1xuICAgICAgaWZIZWxwZXI6IChoYW5kbGU6IG51bWJlciwgbmFtZTogc3RyaW5nLCBtb2R1bGVOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgYXNzZXJ0KGV4cHJbMl0gJiYgZXhwclsyXS5sZW5ndGggPT09IDEsICdbQlVHXSBNaXNzaW5nIGFyZ3VtZW50IG5hbWUnKTtcblxuICAgICAgICBsZXQgYXJnID0gZXhwclsyXVswXTtcblxuICAgICAgICBkZXByZWNhdGUoXG4gICAgICAgICAgYFRoZSBcXGAke25hbWV9XFxgIGhlbHBlciB3YXMgdXNlZCBpbiB0aGUgXFxgJHttb2R1bGVOYW1lfVxcYCB0ZW1wbGF0ZSBhcyBcXGAke2FyZ309e3ske25hbWV9fX1cXGAuIGAgK1xuICAgICAgICAgICAgYFRoaXMgaXMgYW1iaWdpb3VzIGJldHdlZW4gd2FudGluZyB0aGUgXFxgJHthcmd9XFxgIGFyZ3VtZW50IHRvIGJlIHRoZSBcXGAke25hbWV9XFxgIGhlbHBlciBpdHNlbGYsIGAgK1xuICAgICAgICAgICAgYG9yIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIFxcYCR7bmFtZX1cXGAgaGVscGVyIChjdXJyZW50IGJlaGF2aW9yKS4gYCArXG4gICAgICAgICAgICBgVGhpcyBpbXBsaWNpdCBpbnZvY2F0aW9uIGJlaGF2aW9yIGhhcyBiZWVuIGRlcHJlY2F0ZWQuXFxuXFxuYCArXG4gICAgICAgICAgICBgSW5zdGVhZCwgcGxlYXNlIGV4cGxpY2l0bHkgaW52b2tlIHRoZSBoZWxwZXIgd2l0aCBwYXJlbnRoZXNpcywgaS5lLiBcXGAke2FyZ309e3soJHtuYW1lfSl9fVxcYC5cXG5cXG5gICtcbiAgICAgICAgICAgIGBOb3RlOiB0aGUgcGFyZW50aGVzaXMgYXJlIG9ubHkgcmVxdWlyZWQgaW4gdGhpcyBleGFjdCBzY2VuYXJpbyB3aGVyZSBhbiBhbWJpZ3VpdHkgaXMgcHJlc2VudCDigJMgd2hlcmUgYCArXG4gICAgICAgICAgICBgXFxgJHtuYW1lfVxcYCByZWZlcmVzIHRvIGEgZ2xvYmFsIGhlbHBlciAoYXMgb3Bwb3NlZCB0byBhIGxvY2FsIHZhcmlhYmxlKSwgQU5EIGAgK1xuICAgICAgICAgICAgYHRoZSBcXGAke25hbWV9XFxgIGhlbHBlciBpbnZvY2F0aW9uIGRvZXMgbm90IHRha2UgYW55IGFyZ3VtZW50cywgQU5EIGAgK1xuICAgICAgICAgICAgYHRoaXMgb2NjdXJzIGluIGEgbmFtZWQgYXJndW1lbnQgcG9zaXRpb24gb2YgYSBjb21wb25lbnQgaW52b2NhdGlvbi5cXG5cXG5gICtcbiAgICAgICAgICAgIGBXZSBleHBlY3QgdGhpcyBjb21iaW5hdGlvbiB0byBiZSBxdWl0ZSByYXJlLCBhcyBtb3N0IGhlbHBlcnMgcmVxdWlyZSBhdCBsZWFzdCBvbmUgYXJndW1lbnQuIGAgK1xuICAgICAgICAgICAgYFRoZXJlIGlzIG5vIG5lZWQgdG8gcmVmYWN0b3IgaGVscGVyIGludm9jYXRpb25zIGluIGNhc2VzIHdoZXJlIHRoaXMgZGVwcmVjYXRpb24gd2FzIG5vdCB0cmlnZ2VyZWQuYCxcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ2FyZ3VtZW50LWxlc3MtaGVscGVyLXBhcmVuLWxlc3MtaW52b2NhdGlvbicsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIENhbGwob3AsIGhhbmRsZSwgbnVsbCwgbnVsbCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiB3aXRoUGF0aChvcDogUHVzaEV4cHJlc3Npb25PcCwgcGF0aD86IHN0cmluZ1tdKSB7XG4gIGlmIChwYXRoID09PSB1bmRlZmluZWQgfHwgcGF0aC5sZW5ndGggPT09IDApIHJldHVybjtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICBvcChPcC5HZXRQcm9wZXJ0eSwgcGF0aFtpXSk7XG4gIH1cbn1cblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLlVuZGVmaW5lZCwgKG9wKSA9PiBQdXNoUHJpbWl0aXZlUmVmZXJlbmNlKG9wLCB1bmRlZmluZWQpKTtcbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5IYXNCbG9jaywgKG9wLCBbLCBibG9ja10pID0+IHtcbiAgZXhwcihvcCwgYmxvY2spO1xuICBvcChPcC5IYXNCbG9jayk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkhhc0Jsb2NrUGFyYW1zLCAob3AsIFssIGJsb2NrXSkgPT4ge1xuICBleHByKG9wLCBibG9jayk7XG4gIG9wKE9wLlNwcmVhZEJsb2NrKTtcbiAgb3AoT3AuQ29tcGlsZUJsb2NrKTtcbiAgb3AoT3AuSGFzQmxvY2tQYXJhbXMpO1xufSk7XG5cbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5JZklubGluZSwgKG9wLCBbLCBjb25kaXRpb24sIHRydXRoeSwgZmFsc3ldKSA9PiB7XG4gIC8vIFB1c2ggaW4gcmV2ZXJzZSBvcmRlclxuICBleHByKG9wLCBmYWxzeSk7XG4gIGV4cHIob3AsIHRydXRoeSk7XG4gIGV4cHIob3AsIGNvbmRpdGlvbik7XG4gIG9wKE9wLklmSW5saW5lKTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuTm90LCAob3AsIFssIHZhbHVlXSkgPT4ge1xuICBleHByKG9wLCB2YWx1ZSk7XG4gIG9wKE9wLk5vdCk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldER5bmFtaWNWYXIsIChvcCwgWywgZXhwcmVzc2lvbl0pID0+IHtcbiAgZXhwcihvcCwgZXhwcmVzc2lvbik7XG4gIG9wKE9wLkdldER5bmFtaWNWYXIpO1xufSk7XG5cbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5Mb2csIChvcCwgWywgcG9zaXRpb25hbF0pID0+IHtcbiAgb3AoTWFjaGluZU9wLlB1c2hGcmFtZSk7XG4gIFNpbXBsZUFyZ3Mob3AsIHBvc2l0aW9uYWwsIG51bGwsIGZhbHNlKTtcbiAgb3AoT3AuTG9nKTtcbiAgb3AoTWFjaGluZU9wLlBvcEZyYW1lKTtcbiAgb3AoT3AuRmV0Y2gsICR2MCk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=