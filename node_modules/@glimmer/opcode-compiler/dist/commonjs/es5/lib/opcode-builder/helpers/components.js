"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.InvokeComponent = InvokeComponent;
exports.InvokeDynamicComponent = InvokeDynamicComponent;
exports.InvokeNonStaticComponent = InvokeNonStaticComponent;
exports.WrappedComponent = WrappedComponent;
exports.invokePreparedComponent = invokePreparedComponent;
exports.InvokeBareComponent = InvokeBareComponent;
exports.WithSavedRegister = WithSavedRegister;
exports.ATTRS_BLOCK = void 0;

var _manager = require("@glimmer/manager");

var _vm = require("@glimmer/vm");

var _util = require("@glimmer/util");

var _utils = require("../../utils");

var _operands = require("../operands");

var _blocks2 = require("./blocks");

var _conditional = require("./conditional");

var _expr = require("./expr");

var _shared = require("./shared");

var ATTRS_BLOCK = '&attrs';
exports.ATTRS_BLOCK = ATTRS_BLOCK;

function InvokeComponent(op, component, _elementBlock, positional, named, _blocks) {
  var compilable = component.compilable,
      capabilities = component.capabilities,
      handle = component.handle;
  var elementBlock = _elementBlock ? [_elementBlock, []] : null;
  var blocks = Array.isArray(_blocks) || _blocks === null ? (0, _utils.namedBlocks)(_blocks) : _blocks;

  if (compilable) {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeStaticComponent(op, {
      capabilities: capabilities,
      layout: compilable,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      blocks: blocks
    });
  } else {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeNonStaticComponent(op, {
      capabilities: capabilities,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      atNames: true,
      blocks: blocks
    });
  }
}

function InvokeDynamicComponent(op, definition, _elementBlock, positional, named, _blocks, atNames, curried) {
  var elementBlock = _elementBlock ? [_elementBlock, []] : null;
  var blocks = Array.isArray(_blocks) || _blocks === null ? (0, _utils.namedBlocks)(_blocks) : _blocks;
  (0, _conditional.Replayable)(op, function () {
    (0, _expr.expr)(op, definition);
    op(33
    /* Dup */
    , _vm.$sp, 0);
    return 2;
  }, function () {
    op(66
    /* JumpUnless */
    , (0, _operands.labelOperand)('ELSE'));

    if (curried) {
      op(81
      /* ResolveCurriedComponent */
      );
    } else {
      op(80
      /* ResolveDynamicComponent */
      , (0, _operands.isStrictMode)());
    }

    op(79
    /* PushDynamicComponentInstance */
    );
    InvokeNonStaticComponent(op, {
      capabilities: true,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      atNames: atNames,
      blocks: blocks
    });
    op(1000
    /* Label */
    , 'ELSE');
  });
}

function InvokeStaticComponent(op, _ref) {
  var capabilities = _ref.capabilities,
      layout = _ref.layout,
      elementBlock = _ref.elementBlock,
      positional = _ref.positional,
      named = _ref.named,
      blocks = _ref.blocks;
  var symbolTable = layout.symbolTable;
  var bailOut = symbolTable.hasEval || (0, _manager.hasCapability)(capabilities, 4
  /* PrepareArgs */
  );

  if (bailOut) {
    InvokeNonStaticComponent(op, {
      capabilities: capabilities,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      atNames: true,
      blocks: blocks,
      layout: layout
    });
    return;
  }

  op(36
  /* Fetch */
  , _vm.$s0);
  op(33
  /* Dup */
  , _vm.$sp, 1);
  op(35
  /* Load */
  , _vm.$s0);
  op(0
  /* PushFrame */
  ); // Setup arguments

  var symbols = symbolTable.symbols; // As we push values onto the stack, we store the symbols associated  with them
  // so that we can set them on the scope later on with SetVariable and SetBlock

  var blockSymbols = [];
  var argSymbols = [];
  var argNames = []; // First we push the blocks onto the stack

  var blockNames = blocks.names; // Starting with the attrs block, if it exists and is referenced in the component

  if (elementBlock !== null) {
    var symbol = symbols.indexOf(ATTRS_BLOCK);

    if (symbol !== -1) {
      (0, _blocks2.PushYieldableBlock)(op, elementBlock);
      blockSymbols.push(symbol);
    }
  } // Followed by the other blocks, if they exist and are referenced in the component.
  // Also store the index of the associated symbol.


  for (var i = 0; i < blockNames.length; i++) {
    var name = blockNames[i];

    var _symbol = symbols.indexOf("&" + name);

    if (_symbol !== -1) {
      (0, _blocks2.PushYieldableBlock)(op, blocks.get(name));
      blockSymbols.push(_symbol);
    }
  } // Next up we have arguments. If the component has the `createArgs` capability,
  // then it wants access to the arguments in JavaScript. We can't know whether
  // or not an argument is used, so we have to give access to all of them.


  if ((0, _manager.hasCapability)(capabilities, 8
  /* CreateArgs */
  )) {
    // First we push positional arguments
    var count = (0, _shared.CompilePositional)(op, positional); // setup the flags with the count of positionals, and to indicate that atNames
    // are used

    var flags = count << 4;
    flags |= 8;
    var names = _util.EMPTY_STRING_ARRAY; // Next, if named args exist, push them all. If they have an associated symbol
    // in the invoked component (e.g. they are used within its template), we push
    // that symbol. If not, we still push the expression as it may be used, and
    // we store the symbol as -1 (this is used later).

    if (named !== null) {
      names = named[0];
      var val = named[1];

      for (var _i = 0; _i < val.length; _i++) {
        var _symbol2 = symbols.indexOf(names[_i]);

        (0, _expr.expr)(op, val[_i]);
        argSymbols.push(_symbol2);
      }
    } // Finally, push the VM arguments themselves. These args won't need access
    // to blocks (they aren't accessible from userland anyways), so we push an
    // empty array instead of the actual block names.


    op(82
    /* PushArgs */
    , names, _util.EMPTY_STRING_ARRAY, flags); // And push an extra pop operation to remove the args before we begin setting
    // variables on the local context

    argSymbols.push(-1);
  } else if (named !== null) {
    // If the component does not have the `createArgs` capability, then the only
    // expressions we need to push onto the stack are those that are actually
    // referenced in the template of the invoked component (e.g. have symbols).
    var _names = named[0];
    var _val = named[1];

    for (var _i2 = 0; _i2 < _val.length; _i2++) {
      var _name = _names[_i2];

      var _symbol3 = symbols.indexOf(_name);

      if (_symbol3 !== -1) {
        (0, _expr.expr)(op, _val[_i2]);
        argSymbols.push(_symbol3);
        argNames.push(_name);
      }
    }
  }

  op(97
  /* BeginComponentTransaction */
  , _vm.$s0);

  if ((0, _manager.hasCapability)(capabilities, 64
  /* DynamicScope */
  )) {
    op(59
    /* PushDynamicScope */
    );
  }

  if ((0, _manager.hasCapability)(capabilities, 512
  /* CreateInstance */
  )) {
    op(87
    /* CreateComponent */
    , blocks.has('default') | 0, _vm.$s0);
  }

  op(88
  /* RegisterComponentDestructor */
  , _vm.$s0);

  if ((0, _manager.hasCapability)(capabilities, 8
  /* CreateArgs */
  )) {
    op(90
    /* GetComponentSelf */
    , _vm.$s0);
  } else {
    op(90
    /* GetComponentSelf */
    , _vm.$s0, argNames);
  } // Setup the new root scope for the component


  op(37
  /* RootScope */
  , symbols.length + 1, Object.keys(blocks).length > 0 ? 1 : 0); // Pop the self reference off the stack and set it to the symbol for `this`
  // in the new scope. This is why all subsequent symbols are increased by one.

  op(19
  /* SetVariable */
  , 0); // Going in reverse, now we pop the args/blocks off the stack, starting with
  // arguments, and assign them to their symbols in the new scope.

  for (var _i3 = argSymbols.length - 1; _i3 >= 0; _i3--) {
    var _symbol4 = argSymbols[_i3];

    if (_symbol4 === -1) {
      // The expression was not bound to a local symbol, it was only pushed to be
      // used with VM args in the javascript side
      op(34
      /* Pop */
      , 1);
    } else {
      op(19
      /* SetVariable */
      , _symbol4 + 1);
    }
  } // if any positional params exist, pop them off the stack as well


  if (positional !== null) {
    op(34
    /* Pop */
    , positional.length);
  } // Finish up by popping off and assigning blocks


  for (var _i4 = blockSymbols.length - 1; _i4 >= 0; _i4--) {
    var _symbol5 = blockSymbols[_i4];
    op(20
    /* SetBlock */
    , _symbol5 + 1);
  }

  op(28
  /* Constant */
  , (0, _operands.layoutOperand)(layout));
  op(61
  /* CompileBlock */
  );
  op(2
  /* InvokeVirtual */
  );
  op(100
  /* DidRenderLayout */
  , _vm.$s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );

  if ((0, _manager.hasCapability)(capabilities, 64
  /* DynamicScope */
  )) {
    op(60
    /* PopDynamicScope */
    );
  }

  op(98
  /* CommitComponentTransaction */
  );
  op(35
  /* Load */
  , _vm.$s0);
}

function InvokeNonStaticComponent(op, _ref2) {
  var capabilities = _ref2.capabilities,
      elementBlock = _ref2.elementBlock,
      positional = _ref2.positional,
      named = _ref2.named,
      atNames = _ref2.atNames,
      namedBlocks = _ref2.blocks,
      layout = _ref2.layout;
  var bindableBlocks = !!namedBlocks;
  var bindableAtNames = capabilities === true || (0, _manager.hasCapability)(capabilities, 4
  /* PrepareArgs */
  ) || !!(named && named[0].length !== 0);
  var blocks = namedBlocks["with"]('attrs', elementBlock);
  op(36
  /* Fetch */
  , _vm.$s0);
  op(33
  /* Dup */
  , _vm.$sp, 1);
  op(35
  /* Load */
  , _vm.$s0);
  op(0
  /* PushFrame */
  );
  (0, _shared.CompileArgs)(op, positional, named, blocks, atNames);
  op(85
  /* PrepareArgs */
  , _vm.$s0);
  invokePreparedComponent(op, blocks.has('default'), bindableBlocks, bindableAtNames, function () {
    if (layout) {
      op(63
      /* PushSymbolTable */
      , (0, _operands.symbolTableOperand)(layout.symbolTable));
      op(28
      /* Constant */
      , (0, _operands.layoutOperand)(layout));
      op(61
      /* CompileBlock */
      );
    } else {
      op(92
      /* GetComponentLayout */
      , _vm.$s0);
    }

    op(95
    /* PopulateLayout */
    , _vm.$s0);
  });
  op(35
  /* Load */
  , _vm.$s0);
}

function WrappedComponent(op, layout, attrsBlockNumber) {
  op(1001
  /* StartLabels */
  );
  WithSavedRegister(op, _vm.$s1, function () {
    op(91
    /* GetComponentTagName */
    , _vm.$s0);
    op(31
    /* PrimitiveReference */
    );
    op(33
    /* Dup */
    , _vm.$sp, 0);
  });
  op(66
  /* JumpUnless */
  , (0, _operands.labelOperand)('BODY'));
  op(36
  /* Fetch */
  , _vm.$s1);
  op(89
  /* PutComponentOperations */
  );
  op(49
  /* OpenDynamicElement */
  );
  op(99
  /* DidCreateElement */
  , _vm.$s0);
  (0, _blocks2.YieldBlock)(op, attrsBlockNumber, null);
  op(54
  /* FlushElement */
  );
  op(1000
  /* Label */
  , 'BODY');
  (0, _blocks2.InvokeStaticBlock)(op, [layout.block[0], []]);
  op(36
  /* Fetch */
  , _vm.$s1);
  op(66
  /* JumpUnless */
  , (0, _operands.labelOperand)('END'));
  op(55
  /* CloseElement */
  );
  op(1000
  /* Label */
  , 'END');
  op(35
  /* Load */
  , _vm.$s1);
  op(1002
  /* StopLabels */
  );
}

function invokePreparedComponent(op, hasBlock, bindableBlocks, bindableAtNames, populateLayout) {
  if (populateLayout === void 0) {
    populateLayout = null;
  }

  op(97
  /* BeginComponentTransaction */
  , _vm.$s0);
  op(59
  /* PushDynamicScope */
  );
  op(87
  /* CreateComponent */
  , hasBlock | 0, _vm.$s0); // this has to run after createComponent to allow
  // for late-bound layouts, but a caller is free
  // to populate the layout earlier if it wants to
  // and do nothing here.

  if (populateLayout) {
    populateLayout();
  }

  op(88
  /* RegisterComponentDestructor */
  , _vm.$s0);
  op(90
  /* GetComponentSelf */
  , _vm.$s0);
  op(38
  /* VirtualRootScope */
  , _vm.$s0);
  op(19
  /* SetVariable */
  , 0);
  op(94
  /* SetupForEval */
  , _vm.$s0);
  if (bindableAtNames) op(17
  /* SetNamedVariables */
  , _vm.$s0);
  if (bindableBlocks) op(18
  /* SetBlocks */
  , _vm.$s0);
  op(34
  /* Pop */
  , 1);
  op(96
  /* InvokeComponentLayout */
  , _vm.$s0);
  op(100
  /* DidRenderLayout */
  , _vm.$s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );
  op(60
  /* PopDynamicScope */
  );
  op(98
  /* CommitComponentTransaction */
  );
}

function InvokeBareComponent(op) {
  op(36
  /* Fetch */
  , _vm.$s0);
  op(33
  /* Dup */
  , _vm.$sp, 1);
  op(35
  /* Load */
  , _vm.$s0);
  op(0
  /* PushFrame */
  );
  op(83
  /* PushEmptyArgs */
  );
  op(85
  /* PrepareArgs */
  , _vm.$s0);
  invokePreparedComponent(op, false, false, true, function () {
    op(92
    /* GetComponentLayout */
    , _vm.$s0);
    op(95
    /* PopulateLayout */
    , _vm.$s0);
  });
  op(35
  /* Load */
  , _vm.$s0);
}

function WithSavedRegister(op, register, block) {
  op(36
  /* Fetch */
  , register);
  block();
  op(35
  /* Load */
  , register);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL29wY29kZS1jb21waWxlci9saWIvb3Bjb2RlLWJ1aWxkZXIvaGVscGVycy9jb21wb25lbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRU8sSUFBTSxXQUFXLEdBQWpCLFFBQUE7OztBQW1DRCxTQUFBLGVBQUEsQ0FBQSxFQUFBLEVBQUEsU0FBQSxFQUFBLGFBQUEsRUFBQSxVQUFBLEVBQUEsS0FBQSxFQUFBLE9BQUEsRUFNMkI7QUFBQSxNQUUzQixVQUYyQixHQUUvQixTQUYrQixDQUFBLFVBQUE7QUFBQSxNQUUzQixZQUYyQixHQUUvQixTQUYrQixDQUFBLFlBQUE7QUFBQSxNQUVDLE1BRkQsR0FFL0IsU0FGK0IsQ0FBQSxNQUFBO0FBSS9CLE1BQUksWUFBWSxHQUFHLGFBQWEsR0FDM0IsQ0FBQSxhQUFBLEVBRDJCLEVBQzNCLENBRDJCLEdBQWhDLElBQUE7QUFHQSxNQUFJLE1BQU0sR0FBRyxLQUFLLENBQUwsT0FBQSxDQUFBLE9BQUEsS0FBMEIsT0FBTyxLQUFqQyxJQUFBLEdBQTZDLHdCQUE3QyxPQUE2QyxDQUE3QyxHQUFiLE9BQUE7O0FBRUEsTUFBQSxVQUFBLEVBQWdCO0FBQ2QsSUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLE1BQUYsTUFBRSxDQUFGO0FBQ0EsSUFBQSxxQkFBcUIsQ0FBQSxFQUFBLEVBQUs7QUFDeEIsTUFBQSxZQUFZLEVBRFksWUFBQTtBQUV4QixNQUFBLE1BQU0sRUFGa0IsVUFBQTtBQUd4QixNQUFBLFlBSHdCLEVBQUEsWUFBQTtBQUl4QixNQUFBLFVBSndCLEVBQUEsVUFBQTtBQUt4QixNQUFBLEtBTHdCLEVBQUEsS0FBQTtBQU14QixNQUFBLE1BQUEsRUFBQTtBQU53QixLQUFMLENBQXJCO0FBRkYsR0FBQSxNQVVPO0FBQ0ws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LEdBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0Q7O0FBRUssU0FBQSxtQkFBQSxDQUFBLEVBQUEsRUFBaUQ7QUFDckQsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQUYsT0FBRSxDQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQUEsT0FBQSxFQUFGLENBQUUsQ0FBRjtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLE9BQUUsQ0FBRjtBQUVBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLEdBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixPQUFFLENBQUY7QUFDQSxFQUFBLHVCQUF1QixDQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsS0FBQSxFQUFBLElBQUEsRUFBeUIsWUFBSztBQUNuRCxJQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsTUFBRixPQUFFLENBQUY7QUFDQSxJQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsTUFBRixPQUFFLENBQUY7QUFGRixHQUF1QixDQUF2QjtBQUlBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLE9BQUUsQ0FBRjtBQUNEOztBQUVLLFNBQUEsaUJBQUEsQ0FBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLEtBQUEsRUFHYTtBQUVqQixFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixRQUFFLENBQUY7QUFDQSxFQUFBLEtBQUs7QUFDTCxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixRQUFFLENBQUY7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBpbGFibGVQcm9ncmFtLFxuICBDb21waWxlVGltZUNvbXBvbmVudCxcbiAgSGlnaExldmVsQnVpbGRlck9wY29kZSxcbiAgTGF5b3V0V2l0aENvbnRleHQsXG4gIE1hY2hpbmVPcCxcbiAgTmFtZWRCbG9ja3MsXG4gIFdpcmVGb3JtYXQsXG4gIE9wdGlvbixcbiAgT3AsXG4gIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eSxcbn0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBoYXNDYXBhYmlsaXR5IH0gZnJvbSAnQGdsaW1tZXIvbWFuYWdlcic7XG5pbXBvcnQgeyAkczAsICRzMSwgJHNwLCBTYXZlZFJlZ2lzdGVyIH0gZnJvbSAnQGdsaW1tZXIvdm0nO1xuaW1wb3J0IHsgRU1QVFlfU1RSSU5HX0FSUkFZIH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBQdXNoRXhwcmVzc2lvbk9wLCBQdXNoU3RhdGVtZW50T3AgfSBmcm9tICcuLi8uLi9zeW50YXgvY29tcGlsZXJzJztcbmltcG9ydCB7IG5hbWVkQmxvY2tzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgbGFiZWxPcGVyYW5kLCBsYXlvdXRPcGVyYW5kLCBzeW1ib2xUYWJsZU9wZXJhbmQsIGlzU3RyaWN0TW9kZSB9IGZyb20gJy4uL29wZXJhbmRzJztcbmltcG9ydCB7IEludm9rZVN0YXRpY0Jsb2NrLCBQdXNoWWllbGRhYmxlQmxvY2ssIFlpZWxkQmxvY2sgfSBmcm9tICcuL2Jsb2Nrcyc7XG5pbXBvcnQgeyBSZXBsYXlhYmxlIH0gZnJvbSAnLi9jb25kaXRpb25hbCc7XG5pbXBvcnQgeyBleHByIH0gZnJvbSAnLi9leHByJztcbmltcG9ydCB7IENvbXBpbGVBcmdzLCBDb21waWxlUG9zaXRpb25hbCB9IGZyb20gJy4vc2hhcmVkJztcblxuZXhwb3J0IGNvbnN0IEFUVFJTX0JMT0NLID0gJyZhdHRycyc7XG5cbmludGVyZmFjZSBBbnlDb21wb25lbnQge1xuICBlbGVtZW50QmxvY2s6IE9wdGlvbjxXaXJlRm9ybWF0LlNlcmlhbGl6ZWRJbmxpbmVCbG9jaz47XG4gIHBvc2l0aW9uYWw6IFdpcmVGb3JtYXQuQ29yZS5QYXJhbXM7XG4gIG5hbWVkOiBXaXJlRm9ybWF0LkNvcmUuSGFzaDtcbiAgYmxvY2tzOiBOYW1lZEJsb2Nrcztcbn1cblxuLy8ge3tjb21wb25lbnR9fVxuZXhwb3J0IGludGVyZmFjZSBEeW5hbWljQ29tcG9uZW50IGV4dGVuZHMgQW55Q29tcG9uZW50IHtcbiAgZGVmaW5pdGlvbjogV2lyZUZvcm1hdC5FeHByZXNzaW9uO1xuICBhdE5hbWVzOiBib29sZWFuO1xuICBjdXJyaWVkOiBib29sZWFuO1xufVxuXG4vLyA8Q29tcG9uZW50PlxuZXhwb3J0IGludGVyZmFjZSBTdGF0aWNDb21wb25lbnQgZXh0ZW5kcyBBbnlDb21wb25lbnQge1xuICBjYXBhYmlsaXRpZXM6IEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eTtcbiAgbGF5b3V0OiBDb21waWxhYmxlUHJvZ3JhbTtcbn1cblxuLy8gY2hva2Vwb2ludFxuZXhwb3J0IGludGVyZmFjZSBDb21wb25lbnQgZXh0ZW5kcyBBbnlDb21wb25lbnQge1xuICAvLyBlaXRoZXIgd2Uga25vdyB0aGUgY2FwYWJpbGl0aWVzIHN0YXRpY2FsbHkgb3Igd2UgbmVlZCB0byBiZSBjb25zZXJ2YXRpdmUgYW5kIGFzc3VtZVxuICAvLyB0aGF0IHRoZSBjb21wb25lbnQgcmVxdWlyZXMgYWxsIGNhcGFiaWxpdGllc1xuICBjYXBhYmlsaXRpZXM6IEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eSB8IHRydWU7XG5cbiAgLy8gYXJlIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQgYXMgYXROYW1lcz9cbiAgYXROYW1lczogYm9vbGVhbjtcblxuICAvLyBkbyB3ZSBoYXZlIHRoZSBsYXlvdXQgc3RhdGljYWxseSBvciB3aWxsIHdlIG5lZWQgdG8gbG9vayBpdCB1cCBhdCBydW50aW1lP1xuICBsYXlvdXQ/OiBDb21waWxhYmxlUHJvZ3JhbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEludm9rZUNvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgY29tcG9uZW50OiBDb21waWxlVGltZUNvbXBvbmVudCxcbiAgX2VsZW1lbnRCbG9jazogV2lyZUZvcm1hdC5Db3JlLkVsZW1lbnRQYXJhbWV0ZXJzLFxuICBwb3NpdGlvbmFsOiBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zLFxuICBuYW1lZDogV2lyZUZvcm1hdC5Db3JlLkhhc2gsXG4gIF9ibG9ja3M6IFdpcmVGb3JtYXQuQ29yZS5CbG9ja3Ncbik6IHZvaWQge1xuICBsZXQgeyBjb21waWxhYmxlLCBjYXBhYmlsaXRpZXMsIGhhbmRsZSB9ID0gY29tcG9uZW50O1xuXG4gIGxldCBlbGVtZW50QmxvY2sgPSBfZWxlbWVudEJsb2NrXG4gICAgPyAoW19lbGVtZW50QmxvY2ssIFtdXSBhcyBXaXJlRm9ybWF0LlNlcmlhbGl6ZWRJbmxpbmVCbG9jaylcbiAgICA6IG51bGw7XG4gIGxldCBibG9ja3MgPSBBcnJheS5pc0FycmF5KF9ibG9ja3MpIHx8IF9ibG9ja3MgPT09IG51bGwgPyBuYW1lZEJsb2NrcyhfYmxvY2tzKSA6IF9ibG9ja3M7XG5cbiAgaWYgKGNvbXBpbGFibGUpIHtcbiAgICBvcChPcC5QdXNoQ29tcG9uZW50RGVmaW5pdGlvbiwgaGFuZGxlKTtcbiAgICBJbnZva2VTdGF0aWNDb21wb25lbnQob3AsIHtcbiAgICAgIGNhcGFiaWxpdGllczogY2FwYWJpbGl0aWVzLFxuICAgICAgbGF5b3V0OiBjb21waWxhYmxlLFxuICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgICAgYmxvY2tzLFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIG9wKE9wLlB1c2hDb21wb25lbnREZWZpbml0aW9uLCBoYW5kbGUpO1xuICAgIEludm9rZU5vblN0YXRpY0NvbXBvbmVudChvcCwge1xuICAgICAgY2FwYWJpbGl0aWVzOiBjYXBhYmlsaXRpZXMsXG4gICAgICBlbGVtZW50QmxvY2ssXG4gICAgICBwb3NpdGlvbmFsLFxuICAgICAgbmFtZWQsXG4gICAgICBhdE5hbWVzOiB0cnVlLFxuICAgICAgYmxvY2tzLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBJbnZva2VEeW5hbWljQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBkZWZpbml0aW9uOiBXaXJlRm9ybWF0LkNvcmUuRXhwcmVzc2lvbixcbiAgX2VsZW1lbnRCbG9jazogV2lyZUZvcm1hdC5Db3JlLkVsZW1lbnRQYXJhbWV0ZXJzLFxuICBwb3NpdGlvbmFsOiBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zLFxuICBuYW1lZDogV2lyZUZvcm1hdC5Db3JlLkhhc2gsXG4gIF9ibG9ja3M6IFdpcmVGb3JtYXQuQ29yZS5CbG9ja3MsXG4gIGF0TmFtZXM6IGJvb2xlYW4sXG4gIGN1cnJpZWQ6IGJvb2xlYW5cbik6IHZvaWQge1xuICBsZXQgZWxlbWVudEJsb2NrID0gX2VsZW1lbnRCbG9ja1xuICAgID8gKFtfZWxlbWVudEJsb2NrLCBbXV0gYXMgV2lyZUZvcm1hdC5TZXJpYWxpemVkSW5saW5lQmxvY2spXG4gICAgOiBudWxsO1xuICBsZXQgYmxvY2tzID0gQXJyYXkuaXNBcnJheShfYmxvY2tzKSB8fCBfYmxvY2tzID09PSBudWxsID8gbmFtZWRCbG9ja3MoX2Jsb2NrcykgOiBfYmxvY2tzO1xuXG4gIFJlcGxheWFibGUoXG4gICAgb3AsXG5cbiAgICAoKSA9PiB7XG4gICAgICBleHByKG9wLCBkZWZpbml0aW9uKTtcbiAgICAgIG9wKE9wLkR1cCwgJHNwLCAwKTtcbiAgICAgIHJldHVybiAyO1xuICAgIH0sXG5cbiAgICAoKSA9PiB7XG4gICAgICBvcChPcC5KdW1wVW5sZXNzLCBsYWJlbE9wZXJhbmQoJ0VMU0UnKSk7XG5cbiAgICAgIGlmIChjdXJyaWVkKSB7XG4gICAgICAgIG9wKE9wLlJlc29sdmVDdXJyaWVkQ29tcG9uZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wKE9wLlJlc29sdmVEeW5hbWljQ29tcG9uZW50LCBpc1N0cmljdE1vZGUoKSk7XG4gICAgICB9XG5cbiAgICAgIG9wKE9wLlB1c2hEeW5hbWljQ29tcG9uZW50SW5zdGFuY2UpO1xuICAgICAgSW52b2tlTm9uU3RhdGljQ29tcG9uZW50KG9wLCB7XG4gICAgICAgIGNhcGFiaWxpdGllczogdHJ1ZSxcbiAgICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgICBwb3NpdGlvbmFsLFxuICAgICAgICBuYW1lZCxcbiAgICAgICAgYXROYW1lcyxcbiAgICAgICAgYmxvY2tzLFxuICAgICAgfSk7XG4gICAgICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLkxhYmVsLCAnRUxTRScpO1xuICAgIH1cbiAgKTtcbn1cblxuZnVuY3Rpb24gSW52b2tlU3RhdGljQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICB7IGNhcGFiaWxpdGllcywgbGF5b3V0LCBlbGVtZW50QmxvY2ssIHBvc2l0aW9uYWwsIG5hbWVkLCBibG9ja3MgfTogU3RhdGljQ29tcG9uZW50XG4pOiB2b2lkIHtcbiAgbGV0IHsgc3ltYm9sVGFibGUgfSA9IGxheW91dDtcblxuICBsZXQgYmFpbE91dCA9XG4gICAgc3ltYm9sVGFibGUuaGFzRXZhbCB8fCBoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LlByZXBhcmVBcmdzKTtcblxuICBpZiAoYmFpbE91dCkge1xuICAgIEludm9rZU5vblN0YXRpY0NvbXBvbmVudChvcCwge1xuICAgICAgY2FwYWJpbGl0aWVzLFxuICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgICAgYXROYW1lczogdHJ1ZSxcbiAgICAgIGJsb2NrcyxcbiAgICAgIGxheW91dCxcbiAgICB9KTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIG9wKE9wLkZldGNoLCAkczApO1xuICBvcChPcC5EdXAsICRzcCwgMSk7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG4gIG9wKE1hY2hpbmVPcC5QdXNoRnJhbWUpO1xuXG4gIC8vIFNldHVwIGFyZ3VtZW50c1xuICBsZXQgeyBzeW1ib2xzIH0gPSBzeW1ib2xUYWJsZTtcblxuICAvLyBBcyB3ZSBwdXNoIHZhbHVlcyBvbnRvIHRoZSBzdGFjaywgd2Ugc3RvcmUgdGhlIHN5bWJvbHMgYXNzb2NpYXRlZCAgd2l0aCB0aGVtXG4gIC8vIHNvIHRoYXQgd2UgY2FuIHNldCB0aGVtIG9uIHRoZSBzY29wZSBsYXRlciBvbiB3aXRoIFNldFZhcmlhYmxlIGFuZCBTZXRCbG9ja1xuICBsZXQgYmxvY2tTeW1ib2xzOiBudW1iZXJbXSA9IFtdO1xuICBsZXQgYXJnU3ltYm9sczogbnVtYmVyW10gPSBbXTtcbiAgbGV0IGFyZ05hbWVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8vIEZpcnN0IHdlIHB1c2ggdGhlIGJsb2NrcyBvbnRvIHRoZSBzdGFja1xuICBsZXQgYmxvY2tOYW1lcyA9IGJsb2Nrcy5uYW1lcztcblxuICAvLyBTdGFydGluZyB3aXRoIHRoZSBhdHRycyBibG9jaywgaWYgaXQgZXhpc3RzIGFuZCBpcyByZWZlcmVuY2VkIGluIHRoZSBjb21wb25lbnRcbiAgaWYgKGVsZW1lbnRCbG9jayAhPT0gbnVsbCkge1xuICAgIGxldCBzeW1ib2wgPSBzeW1ib2xzLmluZGV4T2YoQVRUUlNfQkxPQ0spO1xuXG4gICAgaWYgKHN5bWJvbCAhPT0gLTEpIHtcbiAgICAgIFB1c2hZaWVsZGFibGVCbG9jayhvcCwgZWxlbWVudEJsb2NrKTtcbiAgICAgIGJsb2NrU3ltYm9scy5wdXNoKHN5bWJvbCk7XG4gICAgfVxuICB9XG5cbiAgLy8gRm9sbG93ZWQgYnkgdGhlIG90aGVyIGJsb2NrcywgaWYgdGhleSBleGlzdCBhbmQgYXJlIHJlZmVyZW5jZWQgaW4gdGhlIGNvbXBvbmVudC5cbiAgLy8gQWxzbyBzdG9yZSB0aGUgaW5kZXggb2YgdGhlIGFzc29jaWF0ZWQgc3ltYm9sLlxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrTmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgbmFtZSA9IGJsb2NrTmFtZXNbaV07XG4gICAgbGV0IHN5bWJvbCA9IHN5bWJvbHMuaW5kZXhPZihgJiR7bmFtZX1gKTtcblxuICAgIGlmIChzeW1ib2wgIT09IC0xKSB7XG4gICAgICBQdXNoWWllbGRhYmxlQmxvY2sob3AsIGJsb2Nrcy5nZXQobmFtZSkpO1xuICAgICAgYmxvY2tTeW1ib2xzLnB1c2goc3ltYm9sKTtcbiAgICB9XG4gIH1cblxuICAvLyBOZXh0IHVwIHdlIGhhdmUgYXJndW1lbnRzLiBJZiB0aGUgY29tcG9uZW50IGhhcyB0aGUgYGNyZWF0ZUFyZ3NgIGNhcGFiaWxpdHksXG4gIC8vIHRoZW4gaXQgd2FudHMgYWNjZXNzIHRvIHRoZSBhcmd1bWVudHMgaW4gSmF2YVNjcmlwdC4gV2UgY2FuJ3Qga25vdyB3aGV0aGVyXG4gIC8vIG9yIG5vdCBhbiBhcmd1bWVudCBpcyB1c2VkLCBzbyB3ZSBoYXZlIHRvIGdpdmUgYWNjZXNzIHRvIGFsbCBvZiB0aGVtLlxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5DcmVhdGVBcmdzKSkge1xuICAgIC8vIEZpcnN0IHdlIHB1c2ggcG9zaXRpb25hbCBhcmd1bWVudHNcbiAgICBsZXQgY291bnQgPSBDb21waWxlUG9zaXRpb25hbChvcCwgcG9zaXRpb25hbCk7XG5cbiAgICAvLyBzZXR1cCB0aGUgZmxhZ3Mgd2l0aCB0aGUgY291bnQgb2YgcG9zaXRpb25hbHMsIGFuZCB0byBpbmRpY2F0ZSB0aGF0IGF0TmFtZXNcbiAgICAvLyBhcmUgdXNlZFxuICAgIGxldCBmbGFncyA9IGNvdW50IDw8IDQ7XG4gICAgZmxhZ3MgfD0gMGIxMDAwO1xuXG4gICAgbGV0IG5hbWVzOiBzdHJpbmdbXSA9IEVNUFRZX1NUUklOR19BUlJBWSBhcyBzdHJpbmdbXTtcblxuICAgIC8vIE5leHQsIGlmIG5hbWVkIGFyZ3MgZXhpc3QsIHB1c2ggdGhlbSBhbGwuIElmIHRoZXkgaGF2ZSBhbiBhc3NvY2lhdGVkIHN5bWJvbFxuICAgIC8vIGluIHRoZSBpbnZva2VkIGNvbXBvbmVudCAoZS5nLiB0aGV5IGFyZSB1c2VkIHdpdGhpbiBpdHMgdGVtcGxhdGUpLCB3ZSBwdXNoXG4gICAgLy8gdGhhdCBzeW1ib2wuIElmIG5vdCwgd2Ugc3RpbGwgcHVzaCB0aGUgZXhwcmVzc2lvbiBhcyBpdCBtYXkgYmUgdXNlZCwgYW5kXG4gICAgLy8gd2Ugc3RvcmUgdGhlIHN5bWJvbCBhcyAtMSAodGhpcyBpcyB1c2VkIGxhdGVyKS5cbiAgICBpZiAobmFtZWQgIT09IG51bGwpIHtcbiAgICAgIG5hbWVzID0gbmFtZWRbMF07XG4gICAgICBsZXQgdmFsID0gbmFtZWRbMV07XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBzeW1ib2wgPSBzeW1ib2xzLmluZGV4T2YobmFtZXNbaV0pO1xuXG4gICAgICAgIGV4cHIob3AsIHZhbFtpXSk7XG4gICAgICAgIGFyZ1N5bWJvbHMucHVzaChzeW1ib2wpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZpbmFsbHksIHB1c2ggdGhlIFZNIGFyZ3VtZW50cyB0aGVtc2VsdmVzLiBUaGVzZSBhcmdzIHdvbid0IG5lZWQgYWNjZXNzXG4gICAgLy8gdG8gYmxvY2tzICh0aGV5IGFyZW4ndCBhY2Nlc3NpYmxlIGZyb20gdXNlcmxhbmQgYW55d2F5cyksIHNvIHdlIHB1c2ggYW5cbiAgICAvLyBlbXB0eSBhcnJheSBpbnN0ZWFkIG9mIHRoZSBhY3R1YWwgYmxvY2sgbmFtZXMuXG4gICAgb3AoT3AuUHVzaEFyZ3MsIG5hbWVzLCBFTVBUWV9TVFJJTkdfQVJSQVksIGZsYWdzKTtcblxuICAgIC8vIEFuZCBwdXNoIGFuIGV4dHJhIHBvcCBvcGVyYXRpb24gdG8gcmVtb3ZlIHRoZSBhcmdzIGJlZm9yZSB3ZSBiZWdpbiBzZXR0aW5nXG4gICAgLy8gdmFyaWFibGVzIG9uIHRoZSBsb2NhbCBjb250ZXh0XG4gICAgYXJnU3ltYm9scy5wdXNoKC0xKTtcbiAgfSBlbHNlIGlmIChuYW1lZCAhPT0gbnVsbCkge1xuICAgIC8vIElmIHRoZSBjb21wb25lbnQgZG9lcyBub3QgaGF2ZSB0aGUgYGNyZWF0ZUFyZ3NgIGNhcGFiaWxpdHksIHRoZW4gdGhlIG9ubHlcbiAgICAvLyBleHByZXNzaW9ucyB3ZSBuZWVkIHRvIHB1c2ggb250byB0aGUgc3RhY2sgYXJlIHRob3NlIHRoYXQgYXJlIGFjdHVhbGx5XG4gICAgLy8gcmVmZXJlbmNlZCBpbiB0aGUgdGVtcGxhdGUgb2YgdGhlIGludm9rZWQgY29tcG9uZW50IChlLmcuIGhhdmUgc3ltYm9scykuXG4gICAgbGV0IG5hbWVzID0gbmFtZWRbMF07XG4gICAgbGV0IHZhbCA9IG5hbWVkWzFdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWwubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBuYW1lID0gbmFtZXNbaV07XG4gICAgICBsZXQgc3ltYm9sID0gc3ltYm9scy5pbmRleE9mKG5hbWUpO1xuXG4gICAgICBpZiAoc3ltYm9sICE9PSAtMSkge1xuICAgICAgICBleHByKG9wLCB2YWxbaV0pO1xuICAgICAgICBhcmdTeW1ib2xzLnB1c2goc3ltYm9sKTtcbiAgICAgICAgYXJnTmFtZXMucHVzaChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvcChPcC5CZWdpbkNvbXBvbmVudFRyYW5zYWN0aW9uLCAkczApO1xuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkR5bmFtaWNTY29wZSkpIHtcbiAgICBvcChPcC5QdXNoRHluYW1pY1Njb3BlKTtcbiAgfVxuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkNyZWF0ZUluc3RhbmNlKSkge1xuICAgIG9wKE9wLkNyZWF0ZUNvbXBvbmVudCwgKGJsb2Nrcy5oYXMoJ2RlZmF1bHQnKSBhcyBhbnkpIHwgMCwgJHMwKTtcbiAgfVxuXG4gIG9wKE9wLlJlZ2lzdGVyQ29tcG9uZW50RGVzdHJ1Y3RvciwgJHMwKTtcblxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5DcmVhdGVBcmdzKSkge1xuICAgIG9wKE9wLkdldENvbXBvbmVudFNlbGYsICRzMCk7XG4gIH0gZWxzZSB7XG4gICAgb3AoT3AuR2V0Q29tcG9uZW50U2VsZiwgJHMwLCBhcmdOYW1lcyk7XG4gIH1cblxuICAvLyBTZXR1cCB0aGUgbmV3IHJvb3Qgc2NvcGUgZm9yIHRoZSBjb21wb25lbnRcbiAgb3AoT3AuUm9vdFNjb3BlLCBzeW1ib2xzLmxlbmd0aCArIDEsIE9iamVjdC5rZXlzKGJsb2NrcykubGVuZ3RoID4gMCA/IDEgOiAwKTtcblxuICAvLyBQb3AgdGhlIHNlbGYgcmVmZXJlbmNlIG9mZiB0aGUgc3RhY2sgYW5kIHNldCBpdCB0byB0aGUgc3ltYm9sIGZvciBgdGhpc2BcbiAgLy8gaW4gdGhlIG5ldyBzY29wZS4gVGhpcyBpcyB3aHkgYWxsIHN1YnNlcXVlbnQgc3ltYm9scyBhcmUgaW5jcmVhc2VkIGJ5IG9uZS5cbiAgb3AoT3AuU2V0VmFyaWFibGUsIDApO1xuXG4gIC8vIEdvaW5nIGluIHJldmVyc2UsIG5vdyB3ZSBwb3AgdGhlIGFyZ3MvYmxvY2tzIG9mZiB0aGUgc3RhY2ssIHN0YXJ0aW5nIHdpdGhcbiAgLy8gYXJndW1lbnRzLCBhbmQgYXNzaWduIHRoZW0gdG8gdGhlaXIgc3ltYm9scyBpbiB0aGUgbmV3IHNjb3BlLlxuICBmb3IgKGxldCBpID0gYXJnU3ltYm9scy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGxldCBzeW1ib2wgPSBhcmdTeW1ib2xzW2ldO1xuXG4gICAgaWYgKHN5bWJvbCA9PT0gLTEpIHtcbiAgICAgIC8vIFRoZSBleHByZXNzaW9uIHdhcyBub3QgYm91bmQgdG8gYSBsb2NhbCBzeW1ib2wsIGl0IHdhcyBvbmx5IHB1c2hlZCB0byBiZVxuICAgICAgLy8gdXNlZCB3aXRoIFZNIGFyZ3MgaW4gdGhlIGphdmFzY3JpcHQgc2lkZVxuICAgICAgb3AoT3AuUG9wLCAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3AoT3AuU2V0VmFyaWFibGUsIHN5bWJvbCArIDEpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlmIGFueSBwb3NpdGlvbmFsIHBhcmFtcyBleGlzdCwgcG9wIHRoZW0gb2ZmIHRoZSBzdGFjayBhcyB3ZWxsXG4gIGlmIChwb3NpdGlvbmFsICE9PSBudWxsKSB7XG4gICAgb3AoT3AuUG9wLCBwb3NpdGlvbmFsLmxlbmd0aCk7XG4gIH1cblxuICAvLyBGaW5pc2ggdXAgYnkgcG9wcGluZyBvZmYgYW5kIGFzc2lnbmluZyBibG9ja3NcbiAgZm9yIChsZXQgaSA9IGJsb2NrU3ltYm9scy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGxldCBzeW1ib2wgPSBibG9ja1N5bWJvbHNbaV07XG5cbiAgICBvcChPcC5TZXRCbG9jaywgc3ltYm9sICsgMSk7XG4gIH1cblxuICBvcChPcC5Db25zdGFudCwgbGF5b3V0T3BlcmFuZChsYXlvdXQpKTtcbiAgb3AoT3AuQ29tcGlsZUJsb2NrKTtcbiAgb3AoTWFjaGluZU9wLkludm9rZVZpcnR1YWwpO1xuICBvcChPcC5EaWRSZW5kZXJMYXlvdXQsICRzMCk7XG5cbiAgb3AoTWFjaGluZU9wLlBvcEZyYW1lKTtcbiAgb3AoT3AuUG9wU2NvcGUpO1xuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkR5bmFtaWNTY29wZSkpIHtcbiAgICBvcChPcC5Qb3BEeW5hbWljU2NvcGUpO1xuICB9XG5cbiAgb3AoT3AuQ29tbWl0Q29tcG9uZW50VHJhbnNhY3Rpb24pO1xuICBvcChPcC5Mb2FkLCAkczApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gSW52b2tlTm9uU3RhdGljQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICB7IGNhcGFiaWxpdGllcywgZWxlbWVudEJsb2NrLCBwb3NpdGlvbmFsLCBuYW1lZCwgYXROYW1lcywgYmxvY2tzOiBuYW1lZEJsb2NrcywgbGF5b3V0IH06IENvbXBvbmVudFxuKTogdm9pZCB7XG4gIGxldCBiaW5kYWJsZUJsb2NrcyA9ICEhbmFtZWRCbG9ja3M7XG4gIGxldCBiaW5kYWJsZUF0TmFtZXMgPVxuICAgIGNhcGFiaWxpdGllcyA9PT0gdHJ1ZSB8fFxuICAgIGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuUHJlcGFyZUFyZ3MpIHx8XG4gICAgISEobmFtZWQgJiYgbmFtZWRbMF0ubGVuZ3RoICE9PSAwKTtcblxuICBsZXQgYmxvY2tzID0gbmFtZWRCbG9ja3Mud2l0aCgnYXR0cnMnLCBlbGVtZW50QmxvY2spO1xuXG4gIG9wKE9wLkZldGNoLCAkczApO1xuICBvcChPcC5EdXAsICRzcCwgMSk7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG5cbiAgb3AoTWFjaGluZU9wLlB1c2hGcmFtZSk7XG4gIENvbXBpbGVBcmdzKG9wLCBwb3NpdGlvbmFsLCBuYW1lZCwgYmxvY2tzLCBhdE5hbWVzKTtcbiAgb3AoT3AuUHJlcGFyZUFyZ3MsICRzMCk7XG5cbiAgaW52b2tlUHJlcGFyZWRDb21wb25lbnQob3AsIGJsb2Nrcy5oYXMoJ2RlZmF1bHQnKSwgYmluZGFibGVCbG9ja3MsIGJpbmRhYmxlQXROYW1lcywgKCkgPT4ge1xuICAgIGlmIChsYXlvdXQpIHtcbiAgICAgIG9wKE9wLlB1c2hTeW1ib2xUYWJsZSwgc3ltYm9sVGFibGVPcGVyYW5kKGxheW91dC5zeW1ib2xUYWJsZSkpO1xuICAgICAgb3AoT3AuQ29uc3RhbnQsIGxheW91dE9wZXJhbmQobGF5b3V0KSk7XG4gICAgICBvcChPcC5Db21waWxlQmxvY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBvcChPcC5HZXRDb21wb25lbnRMYXlvdXQsICRzMCk7XG4gICAgfVxuXG4gICAgb3AoT3AuUG9wdWxhdGVMYXlvdXQsICRzMCk7XG4gIH0pO1xuXG4gIG9wKE9wLkxvYWQsICRzMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBXcmFwcGVkQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBsYXlvdXQ6IExheW91dFdpdGhDb250ZXh0LFxuICBhdHRyc0Jsb2NrTnVtYmVyOiBudW1iZXJcbik6IHZvaWQge1xuICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLlN0YXJ0TGFiZWxzKTtcbiAgV2l0aFNhdmVkUmVnaXN0ZXIob3AsICRzMSwgKCkgPT4ge1xuICAgIG9wKE9wLkdldENvbXBvbmVudFRhZ05hbWUsICRzMCk7XG4gICAgb3AoT3AuUHJpbWl0aXZlUmVmZXJlbmNlKTtcbiAgICBvcChPcC5EdXAsICRzcCwgMCk7XG4gIH0pO1xuICBvcChPcC5KdW1wVW5sZXNzLCBsYWJlbE9wZXJhbmQoJ0JPRFknKSk7XG4gIG9wKE9wLkZldGNoLCAkczEpO1xuICBvcChPcC5QdXRDb21wb25lbnRPcGVyYXRpb25zKTtcbiAgb3AoT3AuT3BlbkR5bmFtaWNFbGVtZW50KTtcbiAgb3AoT3AuRGlkQ3JlYXRlRWxlbWVudCwgJHMwKTtcbiAgWWllbGRCbG9jayhvcCwgYXR0cnNCbG9ja051bWJlciwgbnVsbCk7XG4gIG9wKE9wLkZsdXNoRWxlbWVudCk7XG4gIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuTGFiZWwsICdCT0RZJyk7XG4gIEludm9rZVN0YXRpY0Jsb2NrKG9wLCBbbGF5b3V0LmJsb2NrWzBdLCBbXV0pO1xuICBvcChPcC5GZXRjaCwgJHMxKTtcbiAgb3AoT3AuSnVtcFVubGVzcywgbGFiZWxPcGVyYW5kKCdFTkQnKSk7XG4gIG9wKE9wLkNsb3NlRWxlbWVudCk7XG4gIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuTGFiZWwsICdFTkQnKTtcbiAgb3AoT3AuTG9hZCwgJHMxKTtcbiAgb3AoSGlnaExldmVsQnVpbGRlck9wY29kZS5TdG9wTGFiZWxzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludm9rZVByZXBhcmVkQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBoYXNCbG9jazogYm9vbGVhbixcbiAgYmluZGFibGVCbG9ja3M6IGJvb2xlYW4sXG4gIGJpbmRhYmxlQXROYW1lczogYm9vbGVhbixcbiAgcG9wdWxhdGVMYXlvdXQ6IE9wdGlvbjwoKSA9PiB2b2lkPiA9IG51bGxcbik6IHZvaWQge1xuICBvcChPcC5CZWdpbkNvbXBvbmVudFRyYW5zYWN0aW9uLCAkczApO1xuICBvcChPcC5QdXNoRHluYW1pY1Njb3BlKTtcblxuICBvcChPcC5DcmVhdGVDb21wb25lbnQsIChoYXNCbG9jayBhcyBhbnkpIHwgMCwgJHMwKTtcblxuICAvLyB0aGlzIGhhcyB0byBydW4gYWZ0ZXIgY3JlYXRlQ29tcG9uZW50IHRvIGFsbG93XG4gIC8vIGZvciBsYXRlLWJvdW5kIGxheW91dHMsIGJ1dCBhIGNhbGxlciBpcyBmcmVlXG4gIC8vIHRvIHBvcHVsYXRlIHRoZSBsYXlvdXQgZWFybGllciBpZiBpdCB3YW50cyB0b1xuICAvLyBhbmQgZG8gbm90aGluZyBoZXJlLlxuICBpZiAocG9wdWxhdGVMYXlvdXQpIHtcbiAgICBwb3B1bGF0ZUxheW91dCgpO1xuICB9XG5cbiAgb3AoT3AuUmVnaXN0ZXJDb21wb25lbnREZXN0cnVjdG9yLCAkczApO1xuICBvcChPcC5HZXRDb21wb25lbnRTZWxmLCAkczApO1xuXG4gIG9wKE9wLlZpcnR1YWxSb290U2NvcGUsICRzMCk7XG4gIG9wKE9wLlNldFZhcmlhYmxlLCAwKTtcbiAgb3AoT3AuU2V0dXBGb3JFdmFsLCAkczApO1xuXG4gIGlmIChiaW5kYWJsZUF0TmFtZXMpIG9wKE9wLlNldE5hbWVkVmFyaWFibGVzLCAkczApO1xuICBpZiAoYmluZGFibGVCbG9ja3MpIG9wKE9wLlNldEJsb2NrcywgJHMwKTtcblxuICBvcChPcC5Qb3AsIDEpO1xuICBvcChPcC5JbnZva2VDb21wb25lbnRMYXlvdXQsICRzMCk7XG4gIG9wKE9wLkRpZFJlbmRlckxheW91dCwgJHMwKTtcbiAgb3AoTWFjaGluZU9wLlBvcEZyYW1lKTtcblxuICBvcChPcC5Qb3BTY29wZSk7XG4gIG9wKE9wLlBvcER5bmFtaWNTY29wZSk7XG4gIG9wKE9wLkNvbW1pdENvbXBvbmVudFRyYW5zYWN0aW9uKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEludm9rZUJhcmVDb21wb25lbnQob3A6IFB1c2hTdGF0ZW1lbnRPcCk6IHZvaWQge1xuICBvcChPcC5GZXRjaCwgJHMwKTtcbiAgb3AoT3AuRHVwLCAkc3AsIDEpO1xuICBvcChPcC5Mb2FkLCAkczApO1xuXG4gIG9wKE1hY2hpbmVPcC5QdXNoRnJhbWUpO1xuICBvcChPcC5QdXNoRW1wdHlBcmdzKTtcbiAgb3AoT3AuUHJlcGFyZUFyZ3MsICRzMCk7XG4gIGludm9rZVByZXBhcmVkQ29tcG9uZW50KG9wLCBmYWxzZSwgZmFsc2UsIHRydWUsICgpID0+IHtcbiAgICBvcChPcC5HZXRDb21wb25lbnRMYXlvdXQsICRzMCk7XG4gICAgb3AoT3AuUG9wdWxhdGVMYXlvdXQsICRzMCk7XG4gIH0pO1xuICBvcChPcC5Mb2FkLCAkczApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gV2l0aFNhdmVkUmVnaXN0ZXIoXG4gIG9wOiBQdXNoRXhwcmVzc2lvbk9wLFxuICByZWdpc3RlcjogU2F2ZWRSZWdpc3RlcixcbiAgYmxvY2s6ICgpID0+IHZvaWRcbik6IHZvaWQge1xuICBvcChPcC5GZXRjaCwgcmVnaXN0ZXIpO1xuICBibG9jaygpO1xuICBvcChPcC5Mb2FkLCByZWdpc3Rlcik7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9