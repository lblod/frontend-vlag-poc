"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EXPRESSIONS = void 0;

var _vm = require("@glimmer/vm");

var _globalContext = require("@glimmer/global-context");

var _expr = require("../opcode-builder/helpers/expr");

var _resolution = require("../opcode-builder/helpers/resolution");

var _shared = require("../opcode-builder/helpers/shared");

var _vm2 = require("../opcode-builder/helpers/vm");

var _compilers = require("./compilers");

const EXPRESSIONS = new _compilers.Compilers();
exports.EXPRESSIONS = EXPRESSIONS;
EXPRESSIONS.add(29
/* Concat */
, (op, [, parts]) => {
  for (let part of parts) {
    (0, _expr.expr)(op, part);
  }

  op(27
  /* Concat */
  , parts.length);
});
EXPRESSIONS.add(28
/* Call */
, (op, [, expression, positional, named]) => {
  if ((0, _resolution.isGetFreeHelper)(expression)) {
    op(1005
    /* ResolveHelper */
    , expression, handle => {
      (0, _vm2.Call)(op, handle, positional, named);
    });
  } else {
    (0, _expr.expr)(op, expression);
    (0, _vm2.CallDynamic)(op, positional, named);
  }
});
EXPRESSIONS.add(50
/* Curry */
, (op, [, expr, type, positional, named]) => {
  (0, _vm2.Curry)(op, type, expr, positional, named);
});
EXPRESSIONS.add(30
/* GetSymbol */
, (op, [, sym, path]) => {
  op(21
  /* GetVariable */
  , sym);
  withPath(op, path);
});
EXPRESSIONS.add(32
/* GetTemplateSymbol */
, (op, [, sym, path]) => {
  op(1011
  /* ResolveTemplateLocal */
  , sym, handle => {
    op(29
    /* ConstantReference */
    , handle);
    withPath(op, path);
  });
});
EXPRESSIONS.add(31
/* GetStrictFree */
, (op, [, sym, _path]) => {
  op(1009
  /* ResolveFree */
  , sym, _handle => {// TODO: Implement in strict mode
  });
});
EXPRESSIONS.add(34
/* GetFreeAsComponentOrHelperHeadOrThisFallback */
, () => {
  // TODO: The logic for this opcode currently exists in STATEMENTS.Append, since
  // we want different wrapping logic depending on if we are invoking a component,
  // helper, or {{this}} fallback. Eventually we fix the opcodes so that we can
  // traverse the subexpression tree like normal in this location.
  throw new Error('unimplemented opcode');
});
EXPRESSIONS.add(36
/* GetFreeAsHelperHeadOrThisFallback */
, (op, expr) => {
  // <div id={{baz}}>
  op(1010
  /* ResolveLocal */
  , expr[1], _name => {
    op(1006
    /* ResolveOptionalHelper */
    , expr, {
      ifHelper: handle => {
        (0, _vm2.Call)(op, handle, null, null);
      }
    });
  });
});
EXPRESSIONS.add(99
/* GetFreeAsDeprecatedHelperHeadOrThisFallback */
, (op, expr) => {
  // <Foo @bar={{baz}}>
  op(1010
  /* ResolveLocal */
  , expr[1], _name => {
    op(1006
    /* ResolveOptionalHelper */
    , expr, {
      ifHelper: (handle, name, moduleName) => {
        (0, _globalContext.assert)(expr[2] && expr[2].length === 1, '[BUG] Missing argument name');
        let arg = expr[2][0];
        (0, _globalContext.deprecate)(`The \`${name}\` helper was used in the \`${moduleName}\` template as \`${arg}={{${name}}}\`. ` + `This is ambigious between wanting the \`${arg}\` argument to be the \`${name}\` helper itself, ` + `or the result of invoking the \`${name}\` helper (current behavior). ` + `This implicit invocation behavior has been deprecated.\n\n` + `Instead, please explicitly invoke the helper with parenthesis, i.e. \`${arg}={{(${name})}}\`.\n\n` + `Note: the parenthesis are only required in this exact scenario where an ambiguity is present â€“ where ` + `\`${name}\` referes to a global helper (as opposed to a local variable), AND ` + `the \`${name}\` helper invocation does not take any arguments, AND ` + `this occurs in a named argument position of a component invocation.\n\n` + `We expect this combination to be quite rare, as most helpers require at least one argument. ` + `There is no need to refactor helper invocations in cases where this deprecation was not triggered.`, false, {
          id: 'argument-less-helper-paren-less-invocation'
        });
        (0, _vm2.Call)(op, handle, null, null);
      }
    });
  });
});

function withPath(op, path) {
  if (path === undefined || path.length === 0) return;

  for (let i = 0; i < path.length; i++) {
    op(22
    /* GetProperty */
    , path[i]);
  }
}

EXPRESSIONS.add(27
/* Undefined */
, op => (0, _vm2.PushPrimitiveReference)(op, undefined));
EXPRESSIONS.add(48
/* HasBlock */
, (op, [, block]) => {
  (0, _expr.expr)(op, block);
  op(25
  /* HasBlock */
  );
});
EXPRESSIONS.add(49
/* HasBlockParams */
, (op, [, block]) => {
  (0, _expr.expr)(op, block);
  op(24
  /* SpreadBlock */
  );
  op(61
  /* CompileBlock */
  );
  op(26
  /* HasBlockParams */
  );
});
EXPRESSIONS.add(52
/* IfInline */
, (op, [, condition, truthy, falsy]) => {
  // Push in reverse order
  (0, _expr.expr)(op, falsy);
  (0, _expr.expr)(op, truthy);
  (0, _expr.expr)(op, condition);
  op(109
  /* IfInline */
  );
});
EXPRESSIONS.add(51
/* Not */
, (op, [, value]) => {
  (0, _expr.expr)(op, value);
  op(110
  /* Not */
  );
});
EXPRESSIONS.add(53
/* GetDynamicVar */
, (op, [, expression]) => {
  (0, _expr.expr)(op, expression);
  op(111
  /* GetDynamicVar */
  );
});
EXPRESSIONS.add(54
/* Log */
, (op, [, positional]) => {
  op(0
  /* PushFrame */
  );
  (0, _shared.SimpleArgs)(op, positional, null, false);
  op(112
  /* Log */
  );
  op(1
  /* PopFrame */
  );
  op(36
  /* Fetch */
  , _vm.$v0);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL29wY29kZS1jb21waWxlci9saWIvc3ludGF4L2V4cHJlc3Npb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFPQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFTyxNQUFNLFdBQVcsR0FBRyxJQUFwQixvQkFBb0IsRUFBcEI7O0FBRVAsV0FBVyxDQUFYLEdBQUEsQ0FBZTtBQUFBO0FBQWYsRUFBb0MsQ0FBQSxFQUFBLEVBQUssR0FBTCxLQUFLLENBQUwsS0FBa0I7QUFDcEQsT0FBSyxJQUFMLElBQUEsSUFBQSxLQUFBLEVBQXdCO0FBQ3RCLG9CQUFJLEVBQUosRUFBQSxJQUFBO0FBQ0Q7O0FBRUQsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQVksS0FBSyxDQUFuQixNQUFFLENBQUY7QUFMRixDQUFBO0FBUUEsV0FBVyxDQUFYLEdBQUEsQ0FBZTtBQUFBO0FBQWYsRUFBa0MsQ0FBQSxFQUFBLEVBQUssR0FBQSxVQUFBLEVBQUEsVUFBQSxFQUFMLEtBQUssQ0FBTCxLQUEwQztBQUMxRSxNQUFJLGlDQUFKLFVBQUksQ0FBSixFQUFpQztBQUMvQixJQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsTUFBQSxVQUFBLEVBQXVELE1BQUQsSUFBbUI7QUFDekUscUJBQUksRUFBSixFQUFJLE1BQUosRUFBSSxVQUFKLEVBQUEsS0FBQTtBQURGLEtBQUUsQ0FBRjtBQURGLEdBQUEsTUFJTztBQUNMLG9CQUFJLEVBQUosRUFBQSxVQUFBO0FBQ0EsMEJBQVcsRUFBWCxFQUFXLFVBQVgsRUFBQSxLQUFBO0FBQ0Q7QUFSSCxDQUFBO0FBV0EsV0FBVyxDQUFYLEdBQUEsQ0FBZTtBQUFBO0FBQWYsRUFBbUMsQ0FBQSxFQUFBLEVBQUssR0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLFVBQUEsRUFBTCxLQUFLLENBQUwsS0FBMEM7QUFDM0Usa0JBQUssRUFBTCxFQUFLLElB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O0FBQ0Esa0JBQUksRUFBSixFQUFBLEtBQUE7QUFDQSxrQkFBSSxFQUFKLEVBQUEsTUFBQTtBQUNBLGtCQUFJLEVBQUosRUFBQSxTQUFBO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLEdBQUY7QUFMRixDQUFBO0FBUUEsV0FBVyxDQUFYLEdBQUEsQ0FBZTtBQUFBO0FBQWYsRUFBaUMsQ0FBQSxFQUFBLEVBQUssR0FBTCxLQUFLLENBQUwsS0FBa0I7QUFDakQsa0JBQUksRUFBSixFQUFBLEtBQUE7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUZGLENBQUE7QUFLQSxXQUFXLENBQVgsR0FBQSxDQUFlO0FBQUE7QUFBZixFQUEyQyxDQUFBLEVBQUEsRUFBSyxHQUFMLFVBQUssQ0FBTCxLQUF1QjtBQUNoRSxrQkFBSSxFQUFKLEVBQUEsVUFBQTtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBRkYsQ0FBQTtBQUtBLFdBQVcsQ0FBWCxHQUFBLENBQWU7QUFBQTtBQUFmLEVBQWlDLENBQUEsRUFBQSxFQUFLLEdBQUwsVUFBSyxDQUFMLEtBQXVCO0FBQ3RELEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0EsMEJBQVUsRUFBVixFQUFVLFVBQVYsRUFBVSxJQUFWLEVBQUEsS0FBQTtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLEdBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixPQUFFLENBQUY7QUFMRixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRXhwcmVzc2lvblNleHBPcGNvZGUsXG4gIEhpZ2hMZXZlbFJlc29sdXRpb25PcGNvZGUsXG4gIE1hY2hpbmVPcCxcbiAgT3AsXG4gIFNleHBPcGNvZGVzLFxufSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7ICR2MCB9IGZyb20gJ0BnbGltbWVyL3ZtJztcbmltcG9ydCB7IGFzc2VydCwgZGVwcmVjYXRlIH0gZnJvbSAnQGdsaW1tZXIvZ2xvYmFsLWNvbnRleHQnO1xuaW1wb3J0IHsgZXhwciB9IGZyb20gJy4uL29wY29kZS1idWlsZGVyL2hlbHBlcnMvZXhwcic7XG5pbXBvcnQgeyBpc0dldEZyZWVIZWxwZXIgfSBmcm9tICcuLi9vcGNvZGUtYnVpbGRlci9oZWxwZXJzL3Jlc29sdXRpb24nO1xuaW1wb3J0IHsgU2ltcGxlQXJncyB9IGZyb20gJy4uL29wY29kZS1idWlsZGVyL2hlbHBlcnMvc2hhcmVkJztcbmltcG9ydCB7IENhbGwsIENhbGxEeW5hbWljLCBDdXJyeSwgUHVzaFByaW1pdGl2ZVJlZmVyZW5jZSB9IGZyb20gJy4uL29wY29kZS1idWlsZGVyL2hlbHBlcnMvdm0nO1xuaW1wb3J0IHsgQ29tcGlsZXJzLCBQdXNoRXhwcmVzc2lvbk9wIH0gZnJvbSAnLi9jb21waWxlcnMnO1xuXG5leHBvcnQgY29uc3QgRVhQUkVTU0lPTlMgPSBuZXcgQ29tcGlsZXJzPFB1c2hFeHByZXNzaW9uT3AsIEV4cHJlc3Npb25TZXhwT3Bjb2RlPigpO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuQ29uY2F0LCAob3AsIFssIHBhcnRzXSkgPT4ge1xuICBmb3IgKGxldCBwYXJ0IG9mIHBhcnRzKSB7XG4gICAgZXhwcihvcCwgcGFydCk7XG4gIH1cblxuICBvcChPcC5Db25jYXQsIHBhcnRzLmxlbmd0aCk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkNhbGwsIChvcCwgWywgZXhwcmVzc2lvbiwgcG9zaXRpb25hbCwgbmFtZWRdKSA9PiB7XG4gIGlmIChpc0dldEZyZWVIZWxwZXIoZXhwcmVzc2lvbikpIHtcbiAgICBvcChIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLlJlc29sdmVIZWxwZXIsIGV4cHJlc3Npb24sIChoYW5kbGU6IG51bWJlcikgPT4ge1xuICAgICAgQ2FsbChvcCwgaGFuZGxlLCBwb3NpdGlvbmFsLCBuYW1lZCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZXhwcihvcCwgZXhwcmVzc2lvbik7XG4gICAgQ2FsbER5bmFtaWMob3AsIHBvc2l0aW9uYWwsIG5hbWVkKTtcbiAgfVxufSk7XG5cbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5DdXJyeSwgKG9wLCBbLCBleHByLCB0eXBlLCBwb3NpdGlvbmFsLCBuYW1lZF0pID0+IHtcbiAgQ3Vycnkob3AsIHR5cGUsIGV4cHIsIHBvc2l0aW9uYWwsIG5hbWVkKTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuR2V0U3ltYm9sLCAob3AsIFssIHN5bSwgcGF0aF0pID0+IHtcbiAgb3AoT3AuR2V0VmFyaWFibGUsIHN5bSk7XG4gIHdpdGhQYXRoKG9wLCBwYXRoKTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuR2V0VGVtcGxhdGVTeW1ib2wsIChvcCwgWywgc3ltLCBwYXRoXSkgPT4ge1xuICBvcChIaWdoTGV2ZWxSZXNvbHV0aW9uT3Bjb2RlLlJlc29sdmVUZW1wbGF0ZUxvY2FsLCBzeW0sIChoYW5kbGU6IG51bWJlcikgPT4ge1xuICAgIG9wKE9wLkNvbnN0YW50UmVmZXJlbmNlLCBoYW5kbGUpO1xuICAgIHdpdGhQYXRoKG9wLCBwYXRoKTtcbiAgfSk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkdldFN0cmljdEZyZWUsIChvcCwgWywgc3ltLCBfcGF0aF0pID0+IHtcbiAgb3AoSGlnaExldmVsUmVzb2x1dGlvbk9wY29kZS5SZXNvbHZlRnJlZSwgc3ltLCAoX2hhbmRsZTogdW5rbm93bikgPT4ge1xuICAgIC8vIFRPRE86IEltcGxlbWVudCBpbiBzdHJpY3QgbW9kZVxuICB9KTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuR2V0RnJlZUFzQ29tcG9uZW50T3JIZWxwZXJIZWFkT3JUaGlzRmFsbGJhY2ssICgpID0+IHtcbiAgLy8gVE9ETzogVGhlIGxvZ2ljIGZvciB0aGlzIG9wY29kZSBjdXJyZW50bHkgZXhpc3RzIGluIFNUQVRFTUVOVFMuQXBwZW5kLCBzaW5jZVxuICAvLyB3ZSB3YW50IGRpZmZlcmVudCB3cmFwcGluZyBsb2dpYyBkZXBlbmRpbmcgb24gaWYgd2UgYXJlIGludm9raW5nIGEgY29tcG9uZW50LFxuICAvLyBoZWxwZXIsIG9yIHt7dGhpc319IGZhbGxiYWNrLiBFdmVudHVhbGx5IHdlIGZpeCB0aGUgb3Bjb2RlcyBzbyB0aGF0IHdlIGNhblxuICAvLyB0cmF2ZXJzZSB0aGUgc3ViZXhwcmVzc2lvbiB0cmVlIGxpa2Ugbm9ybWFsIGluIHRoaXMgbG9jYXRpb24uXG4gIHRocm93IG5ldyBFcnJvcigndW5pbXBsZW1lbnRlZCBvcGNvZGUnKTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuR2V0RnJlZUFzSGVscGVySGVhZE9yVGhpc0ZhbGxiYWNrLCAob3AsIGV4cHIpID0+IHtcbiAgLy8gPGRpdiBpZD17e2Jhen19PlxuXG4gIG9wKEhpZ2hMZXZlbFJlc29sdXRpb25PcGNvZGUuUmVzb2x2ZUxvY2FsLCBleHByWzFdLCAoX25hbWU6IHN0cmluZykgPT4ge1xuICAgIG9wKEhpZ2hMZXZlbFJlc29sdXRpb25PcGNvZGUuUmVzb2x2ZU9wdGlvbmFsSGVscGVyLCBleHByLCB7XG4gICAgICBpZkhlbHBlcjogKGhhbmRsZTogbnVtYmVyKSA9PiB7XG4gICAgICAgIENhbGwob3AsIGhhbmRsZSwgbnVsbCwgbnVsbCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuR2V0RnJlZUFzRGVwcmVjYXRlZEhlbHBlckhlYWRPclRoaXNGYWxsYmFjaywgKG9wLCBleHByKSA9PiB7XG4gIC8vIDxGb28gQGJhcj17e2Jhen19PlxuXG4gIG9wKEhpZ2hMZXZlbFJlc29sdXRpb25PcGNvZGUuUmVzb2x2ZUxvY2FsLCBleHByWzFdLCAoX25hbWU6IHN0cmluZykgPT4ge1xuICAgIG9wKEhpZ2hMZXZlbFJlc29sdXRpb25PcGNvZGUuUmVzb2x2ZU9wdGlvbmFsSGVscGVyLCBleHByLCB7XG4gICAgICBpZkhlbHBlcjogKGhhbmRsZTogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIG1vZHVsZU5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICBhc3NlcnQoZXhwclsyXSAmJiBleHByWzJdLmxlbmd0aCA9PT0gMSwgJ1tCVUddIE1pc3NpbmcgYXJndW1lbnQgbmFtZScpO1xuXG4gICAgICAgIGxldCBhcmcgPSBleHByWzJdWzBdO1xuXG4gICAgICAgIGRlcHJlY2F0ZShcbiAgICAgICAgICBgVGhlIFxcYCR7bmFtZX1cXGAgaGVscGVyIHdhcyB1c2VkIGluIHRoZSBcXGAke21vZHVsZU5hbWV9XFxgIHRlbXBsYXRlIGFzIFxcYCR7YXJnfT17eyR7bmFtZX19fVxcYC4gYCArXG4gICAgICAgICAgICBgVGhpcyBpcyBhbWJpZ2lvdXMgYmV0d2VlbiB3YW50aW5nIHRoZSBcXGAke2FyZ31cXGAgYXJndW1lbnQgdG8gYmUgdGhlIFxcYCR7bmFtZX1cXGAgaGVscGVyIGl0c2VsZiwgYCArXG4gICAgICAgICAgICBgb3IgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgXFxgJHtuYW1lfVxcYCBoZWxwZXIgKGN1cnJlbnQgYmVoYXZpb3IpLiBgICtcbiAgICAgICAgICAgIGBUaGlzIGltcGxpY2l0IGludm9jYXRpb24gYmVoYXZpb3IgaGFzIGJlZW4gZGVwcmVjYXRlZC5cXG5cXG5gICtcbiAgICAgICAgICAgIGBJbnN0ZWFkLCBwbGVhc2UgZXhwbGljaXRseSBpbnZva2UgdGhlIGhlbHBlciB3aXRoIHBhcmVudGhlc2lzLCBpLmUuIFxcYCR7YXJnfT17eygke25hbWV9KX19XFxgLlxcblxcbmAgK1xuICAgICAgICAgICAgYE5vdGU6IHRoZSBwYXJlbnRoZXNpcyBhcmUgb25seSByZXF1aXJlZCBpbiB0aGlzIGV4YWN0IHNjZW5hcmlvIHdoZXJlIGFuIGFtYmlndWl0eSBpcyBwcmVzZW50IOKAkyB3aGVyZSBgICtcbiAgICAgICAgICAgIGBcXGAke25hbWV9XFxgIHJlZmVyZXMgdG8gYSBnbG9iYWwgaGVscGVyIChhcyBvcHBvc2VkIHRvIGEgbG9jYWwgdmFyaWFibGUpLCBBTkQgYCArXG4gICAgICAgICAgICBgdGhlIFxcYCR7bmFtZX1cXGAgaGVscGVyIGludm9jYXRpb24gZG9lcyBub3QgdGFrZSBhbnkgYXJndW1lbnRzLCBBTkQgYCArXG4gICAgICAgICAgICBgdGhpcyBvY2N1cnMgaW4gYSBuYW1lZCBhcmd1bWVudCBwb3NpdGlvbiBvZiBhIGNvbXBvbmVudCBpbnZvY2F0aW9uLlxcblxcbmAgK1xuICAgICAgICAgICAgYFdlIGV4cGVjdCB0aGlzIGNvbWJpbmF0aW9uIHRvIGJlIHF1aXRlIHJhcmUsIGFzIG1vc3QgaGVscGVycyByZXF1aXJlIGF0IGxlYXN0IG9uZSBhcmd1bWVudC4gYCArXG4gICAgICAgICAgICBgVGhlcmUgaXMgbm8gbmVlZCB0byByZWZhY3RvciBoZWxwZXIgaW52b2NhdGlvbnMgaW4gY2FzZXMgd2hlcmUgdGhpcyBkZXByZWNhdGlvbiB3YXMgbm90IHRyaWdnZXJlZC5gLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnYXJndW1lbnQtbGVzcy1oZWxwZXItcGFyZW4tbGVzcy1pbnZvY2F0aW9uJyxcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgQ2FsbChvcCwgaGFuZGxlLCBudWxsLCBudWxsKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIHdpdGhQYXRoKG9wOiBQdXNoRXhwcmVzc2lvbk9wLCBwYXRoPzogc3RyaW5nW10pIHtcbiAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCB8fCBwYXRoLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgIG9wKE9wLkdldFByb3BlcnR5LCBwYXRoW2ldKTtcbiAgfVxufVxuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuVW5kZWZpbmVkLCAob3ApID0+IFB1c2hQcmltaXRpdmVSZWZlcmVuY2Uob3AsIHVuZGVmaW5lZCkpO1xuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkhhc0Jsb2NrLCAob3AsIFssIGJsb2NrXSkgPT4ge1xuICBleHByKG9wLCBibG9jayk7XG4gIG9wKE9wLkhhc0Jsb2NrKTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuSGFzQmxvY2tQYXJhbXMsIChvcCwgWywgYmxvY2tdKSA9PiB7XG4gIGV4cHIob3AsIGJsb2NrKTtcbiAgb3AoT3AuU3ByZWFkQmxvY2spO1xuICBvcChPcC5Db21waWxlQmxvY2spO1xuICBvcChPcC5IYXNCbG9ja1BhcmFtcyk7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLklmSW5saW5lLCAob3AsIFssIGNvbmRpdGlvbiwgdHJ1dGh5LCBmYWxzeV0pID0+IHtcbiAgLy8gUHVzaCBpbiByZXZlcnNlIG9yZGVyXG4gIGV4cHIob3AsIGZhbHN5KTtcbiAgZXhwcihvcCwgdHJ1dGh5KTtcbiAgZXhwcihvcCwgY29uZGl0aW9uKTtcbiAgb3AoT3AuSWZJbmxpbmUpO1xufSk7XG5cbkVYUFJFU1NJT05TLmFkZChTZXhwT3Bjb2Rlcy5Ob3QsIChvcCwgWywgdmFsdWVdKSA9PiB7XG4gIGV4cHIob3AsIHZhbHVlKTtcbiAgb3AoT3AuTm90KTtcbn0pO1xuXG5FWFBSRVNTSU9OUy5hZGQoU2V4cE9wY29kZXMuR2V0RHluYW1pY1ZhciwgKG9wLCBbLCBleHByZXNzaW9uXSkgPT4ge1xuICBleHByKG9wLCBleHByZXNzaW9uKTtcbiAgb3AoT3AuR2V0RHluYW1pY1Zhcik7XG59KTtcblxuRVhQUkVTU0lPTlMuYWRkKFNleHBPcGNvZGVzLkxvZywgKG9wLCBbLCBwb3NpdGlvbmFsXSkgPT4ge1xuICBvcChNYWNoaW5lT3AuUHVzaEZyYW1lKTtcbiAgU2ltcGxlQXJncyhvcCwgcG9zaXRpb25hbCwgbnVsbCwgZmFsc2UpO1xuICBvcChPcC5Mb2cpO1xuICBvcChNYWNoaW5lT3AuUG9wRnJhbWUpO1xuICBvcChPcC5GZXRjaCwgJHYwKTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==