"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.InvokeComponent = InvokeComponent;
exports.InvokeDynamicComponent = InvokeDynamicComponent;
exports.InvokeNonStaticComponent = InvokeNonStaticComponent;
exports.WrappedComponent = WrappedComponent;
exports.invokePreparedComponent = invokePreparedComponent;
exports.InvokeBareComponent = InvokeBareComponent;
exports.WithSavedRegister = WithSavedRegister;
exports.ATTRS_BLOCK = void 0;

var _manager = require("@glimmer/manager");

var _vm = require("@glimmer/vm");

var _util = require("@glimmer/util");

var _utils = require("../../utils");

var _operands = require("../operands");

var _blocks2 = require("./blocks");

var _conditional = require("./conditional");

var _expr = require("./expr");

var _shared = require("./shared");

const ATTRS_BLOCK = '&attrs';
exports.ATTRS_BLOCK = ATTRS_BLOCK;

function InvokeComponent(op, component, _elementBlock, positional, named, _blocks) {
  let {
    compilable,
    capabilities,
    handle
  } = component;
  let elementBlock = _elementBlock ? [_elementBlock, []] : null;
  let blocks = Array.isArray(_blocks) || _blocks === null ? (0, _utils.namedBlocks)(_blocks) : _blocks;

  if (compilable) {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeStaticComponent(op, {
      capabilities: capabilities,
      layout: compilable,
      elementBlock,
      positional,
      named,
      blocks
    });
  } else {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeNonStaticComponent(op, {
      capabilities: capabilities,
      elementBlock,
      positional,
      named,
      atNames: true,
      blocks
    });
  }
}

function InvokeDynamicComponent(op, definition, _elementBlock, positional, named, _blocks, atNames, curried) {
  let elementBlock = _elementBlock ? [_elementBlock, []] : null;
  let blocks = Array.isArray(_blocks) || _blocks === null ? (0, _utils.namedBlocks)(_blocks) : _blocks;
  (0, _conditional.Replayable)(op, () => {
    (0, _expr.expr)(op, definition);
    op(33
    /* Dup */
    , _vm.$sp, 0);
    return 2;
  }, () => {
    op(66
    /* JumpUnless */
    , (0, _operands.labelOperand)('ELSE'));

    if (curried) {
      op(81
      /* ResolveCurriedComponent */
      );
    } else {
      op(80
      /* ResolveDynamicComponent */
      , (0, _operands.isStrictMode)());
    }

    op(79
    /* PushDynamicComponentInstance */
    );
    InvokeNonStaticComponent(op, {
      capabilities: true,
      elementBlock,
      positional,
      named,
      atNames,
      blocks
    });
    op(1000
    /* Label */
    , 'ELSE');
  });
}

function InvokeStaticComponent(op, {
  capabilities,
  layout,
  elementBlock,
  positional,
  named,
  blocks
}) {
  let {
    symbolTable
  } = layout;
  let bailOut = symbolTable.hasEval || (0, _manager.hasCapability)(capabilities, 4
  /* PrepareArgs */
  );

  if (bailOut) {
    InvokeNonStaticComponent(op, {
      capabilities,
      elementBlock,
      positional,
      named,
      atNames: true,
      blocks,
      layout
    });
    return;
  }

  op(36
  /* Fetch */
  , _vm.$s0);
  op(33
  /* Dup */
  , _vm.$sp, 1);
  op(35
  /* Load */
  , _vm.$s0);
  op(0
  /* PushFrame */
  ); // Setup arguments

  let {
    symbols
  } = symbolTable; // As we push values onto the stack, we store the symbols associated  with them
  // so that we can set them on the scope later on with SetVariable and SetBlock

  let blockSymbols = [];
  let argSymbols = [];
  let argNames = []; // First we push the blocks onto the stack

  let blockNames = blocks.names; // Starting with the attrs block, if it exists and is referenced in the component

  if (elementBlock !== null) {
    let symbol = symbols.indexOf(ATTRS_BLOCK);

    if (symbol !== -1) {
      (0, _blocks2.PushYieldableBlock)(op, elementBlock);
      blockSymbols.push(symbol);
    }
  } // Followed by the other blocks, if they exist and are referenced in the component.
  // Also store the index of the associated symbol.


  for (let i = 0; i < blockNames.length; i++) {
    let name = blockNames[i];
    let symbol = symbols.indexOf(`&${name}`);

    if (symbol !== -1) {
      (0, _blocks2.PushYieldableBlock)(op, blocks.get(name));
      blockSymbols.push(symbol);
    }
  } // Next up we have arguments. If the component has the `createArgs` capability,
  // then it wants access to the arguments in JavaScript. We can't know whether
  // or not an argument is used, so we have to give access to all of them.


  if ((0, _manager.hasCapability)(capabilities, 8
  /* CreateArgs */
  )) {
    // First we push positional arguments
    let count = (0, _shared.CompilePositional)(op, positional); // setup the flags with the count of positionals, and to indicate that atNames
    // are used

    let flags = count << 4;
    flags |= 0b1000;
    let names = _util.EMPTY_STRING_ARRAY; // Next, if named args exist, push them all. If they have an associated symbol
    // in the invoked component (e.g. they are used within its template), we push
    // that symbol. If not, we still push the expression as it may be used, and
    // we store the symbol as -1 (this is used later).

    if (named !== null) {
      names = named[0];
      let val = named[1];

      for (let i = 0; i < val.length; i++) {
        let symbol = symbols.indexOf(names[i]);
        (0, _expr.expr)(op, val[i]);
        argSymbols.push(symbol);
      }
    } // Finally, push the VM arguments themselves. These args won't need access
    // to blocks (they aren't accessible from userland anyways), so we push an
    // empty array instead of the actual block names.


    op(82
    /* PushArgs */
    , names, _util.EMPTY_STRING_ARRAY, flags); // And push an extra pop operation to remove the args before we begin setting
    // variables on the local context

    argSymbols.push(-1);
  } else if (named !== null) {
    // If the component does not have the `createArgs` capability, then the only
    // expressions we need to push onto the stack are those that are actually
    // referenced in the template of the invoked component (e.g. have symbols).
    let names = named[0];
    let val = named[1];

    for (let i = 0; i < val.length; i++) {
      let name = names[i];
      let symbol = symbols.indexOf(name);

      if (symbol !== -1) {
        (0, _expr.expr)(op, val[i]);
        argSymbols.push(symbol);
        argNames.push(name);
      }
    }
  }

  op(97
  /* BeginComponentTransaction */
  , _vm.$s0);

  if ((0, _manager.hasCapability)(capabilities, 64
  /* DynamicScope */
  )) {
    op(59
    /* PushDynamicScope */
    );
  }

  if ((0, _manager.hasCapability)(capabilities, 512
  /* CreateInstance */
  )) {
    op(87
    /* CreateComponent */
    , blocks.has('default') | 0, _vm.$s0);
  }

  op(88
  /* RegisterComponentDestructor */
  , _vm.$s0);

  if ((0, _manager.hasCapability)(capabilities, 8
  /* CreateArgs */
  )) {
    op(90
    /* GetComponentSelf */
    , _vm.$s0);
  } else {
    op(90
    /* GetComponentSelf */
    , _vm.$s0, argNames);
  } // Setup the new root scope for the component


  op(37
  /* RootScope */
  , symbols.length + 1, Object.keys(blocks).length > 0 ? 1 : 0); // Pop the self reference off the stack and set it to the symbol for `this`
  // in the new scope. This is why all subsequent symbols are increased by one.

  op(19
  /* SetVariable */
  , 0); // Going in reverse, now we pop the args/blocks off the stack, starting with
  // arguments, and assign them to their symbols in the new scope.

  for (let i = argSymbols.length - 1; i >= 0; i--) {
    let symbol = argSymbols[i];

    if (symbol === -1) {
      // The expression was not bound to a local symbol, it was only pushed to be
      // used with VM args in the javascript side
      op(34
      /* Pop */
      , 1);
    } else {
      op(19
      /* SetVariable */
      , symbol + 1);
    }
  } // if any positional params exist, pop them off the stack as well


  if (positional !== null) {
    op(34
    /* Pop */
    , positional.length);
  } // Finish up by popping off and assigning blocks


  for (let i = blockSymbols.length - 1; i >= 0; i--) {
    let symbol = blockSymbols[i];
    op(20
    /* SetBlock */
    , symbol + 1);
  }

  op(28
  /* Constant */
  , (0, _operands.layoutOperand)(layout));
  op(61
  /* CompileBlock */
  );
  op(2
  /* InvokeVirtual */
  );
  op(100
  /* DidRenderLayout */
  , _vm.$s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );

  if ((0, _manager.hasCapability)(capabilities, 64
  /* DynamicScope */
  )) {
    op(60
    /* PopDynamicScope */
    );
  }

  op(98
  /* CommitComponentTransaction */
  );
  op(35
  /* Load */
  , _vm.$s0);
}

function InvokeNonStaticComponent(op, {
  capabilities,
  elementBlock,
  positional,
  named,
  atNames,
  blocks: namedBlocks,
  layout
}) {
  let bindableBlocks = !!namedBlocks;
  let bindableAtNames = capabilities === true || (0, _manager.hasCapability)(capabilities, 4
  /* PrepareArgs */
  ) || !!(named && named[0].length !== 0);
  let blocks = namedBlocks.with('attrs', elementBlock);
  op(36
  /* Fetch */
  , _vm.$s0);
  op(33
  /* Dup */
  , _vm.$sp, 1);
  op(35
  /* Load */
  , _vm.$s0);
  op(0
  /* PushFrame */
  );
  (0, _shared.CompileArgs)(op, positional, named, blocks, atNames);
  op(85
  /* PrepareArgs */
  , _vm.$s0);
  invokePreparedComponent(op, blocks.has('default'), bindableBlocks, bindableAtNames, () => {
    if (layout) {
      op(63
      /* PushSymbolTable */
      , (0, _operands.symbolTableOperand)(layout.symbolTable));
      op(28
      /* Constant */
      , (0, _operands.layoutOperand)(layout));
      op(61
      /* CompileBlock */
      );
    } else {
      op(92
      /* GetComponentLayout */
      , _vm.$s0);
    }

    op(95
    /* PopulateLayout */
    , _vm.$s0);
  });
  op(35
  /* Load */
  , _vm.$s0);
}

function WrappedComponent(op, layout, attrsBlockNumber) {
  op(1001
  /* StartLabels */
  );
  WithSavedRegister(op, _vm.$s1, () => {
    op(91
    /* GetComponentTagName */
    , _vm.$s0);
    op(31
    /* PrimitiveReference */
    );
    op(33
    /* Dup */
    , _vm.$sp, 0);
  });
  op(66
  /* JumpUnless */
  , (0, _operands.labelOperand)('BODY'));
  op(36
  /* Fetch */
  , _vm.$s1);
  op(89
  /* PutComponentOperations */
  );
  op(49
  /* OpenDynamicElement */
  );
  op(99
  /* DidCreateElement */
  , _vm.$s0);
  (0, _blocks2.YieldBlock)(op, attrsBlockNumber, null);
  op(54
  /* FlushElement */
  );
  op(1000
  /* Label */
  , 'BODY');
  (0, _blocks2.InvokeStaticBlock)(op, [layout.block[0], []]);
  op(36
  /* Fetch */
  , _vm.$s1);
  op(66
  /* JumpUnless */
  , (0, _operands.labelOperand)('END'));
  op(55
  /* CloseElement */
  );
  op(1000
  /* Label */
  , 'END');
  op(35
  /* Load */
  , _vm.$s1);
  op(1002
  /* StopLabels */
  );
}

function invokePreparedComponent(op, hasBlock, bindableBlocks, bindableAtNames, populateLayout = null) {
  op(97
  /* BeginComponentTransaction */
  , _vm.$s0);
  op(59
  /* PushDynamicScope */
  );
  op(87
  /* CreateComponent */
  , hasBlock | 0, _vm.$s0); // this has to run after createComponent to allow
  // for late-bound layouts, but a caller is free
  // to populate the layout earlier if it wants to
  // and do nothing here.

  if (populateLayout) {
    populateLayout();
  }

  op(88
  /* RegisterComponentDestructor */
  , _vm.$s0);
  op(90
  /* GetComponentSelf */
  , _vm.$s0);
  op(38
  /* VirtualRootScope */
  , _vm.$s0);
  op(19
  /* SetVariable */
  , 0);
  op(94
  /* SetupForEval */
  , _vm.$s0);
  if (bindableAtNames) op(17
  /* SetNamedVariables */
  , _vm.$s0);
  if (bindableBlocks) op(18
  /* SetBlocks */
  , _vm.$s0);
  op(34
  /* Pop */
  , 1);
  op(96
  /* InvokeComponentLayout */
  , _vm.$s0);
  op(100
  /* DidRenderLayout */
  , _vm.$s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );
  op(60
  /* PopDynamicScope */
  );
  op(98
  /* CommitComponentTransaction */
  );
}

function InvokeBareComponent(op) {
  op(36
  /* Fetch */
  , _vm.$s0);
  op(33
  /* Dup */
  , _vm.$sp, 1);
  op(35
  /* Load */
  , _vm.$s0);
  op(0
  /* PushFrame */
  );
  op(83
  /* PushEmptyArgs */
  );
  op(85
  /* PrepareArgs */
  , _vm.$s0);
  invokePreparedComponent(op, false, false, true, () => {
    op(92
    /* GetComponentLayout */
    , _vm.$s0);
    op(95
    /* PopulateLayout */
    , _vm.$s0);
  });
  op(35
  /* Load */
  , _vm.$s0);
}

function WithSavedRegister(op, register, block) {
  op(36
  /* Fetch */
  , register);
  block();
  op(35
  /* Load */
  , register);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL29wY29kZS1jb21waWxlci9saWIvb3Bjb2RlLWJ1aWxkZXIvaGVscGVycy9jb21wb25lbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRU8sTUFBTSxXQUFXLEdBQWpCLFFBQUE7OztBQW1DRCxTQUFBLGVBQUEsQ0FBQSxFQUFBLEVBQUEsU0FBQSxFQUFBLGFBQUEsRUFBQSxVQUFBLEVBQUEsS0FBQSxFQUFBLE9BQUEsRUFNMkI7QUFFL0IsTUFBSTtBQUFBLElBQUEsVUFBQTtBQUFBLElBQUEsWUFBQTtBQUE0QixJQUFBO0FBQTVCLE1BQUosU0FBQTtBQUVBLE1BQUksWUFBWSxHQUFHLGFBQWEsR0FDM0IsQ0FBQSxhQUFBLEVBRDJCLEVBQzNCLENBRDJCLEdBQWhDLElBQUE7QUFHQSxNQUFJLE1BQU0sR0FBRyxLQUFLLENBQUwsT0FBQSxDQUFBLE9BQUEsS0FBMEIsT0FBTyxLQUFqQyxJQUFBLEdBQTZDLHdCQUE3QyxPQUE2QyxDQUE3QyxHQUFiLE9BQUE7O0FBRUEsTUFBQSxVQUFBLEVBQWdCO0FBQ2QsSUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLE1BQUYsTUFBRSxDQUFGO0FBQ0EsSUFBQSxxQkFBcUIsQ0FBQSxFQUFBLEVBQUs7QUFDeEIsTUFBQSxZQUFZLEVBRFksWUFBQTtBQUV4QixNQUFBLE1BQU0sRUFGa0IsVUFBQTtBQUFBLE1BQUEsWUFBQTtBQUFBLE1BQUEsVUFBQTtBQUFBLE1BQUEsS0FBQTtBQU14QixNQUFBO0FBTndCLEtBQUwsQ0FBckI7QUFGRixHQUFBLE1BVU87QUFDTCxJQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsTUFBRixNQUFFLENBQUY7QUFDQSxJQUFBLHdCQUF3QixDQUFBLEVBQUEsRUFBSztBQUMzQixNQUFBLFlBQVksRUFEZSxZ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QSxRQUFBLEVBQUEsS0FBQSxFQUdhO0FBRWpCLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLFFBQUUsQ0FBRjtBQUNBLEVBQUEsS0FBSztBQUNMLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLFFBQUUsQ0FBRjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcGlsYWJsZVByb2dyYW0sXG4gIENvbXBpbGVUaW1lQ29tcG9uZW50LFxuICBIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLFxuICBMYXlvdXRXaXRoQ29udGV4dCxcbiAgTWFjaGluZU9wLFxuICBOYW1lZEJsb2NrcyxcbiAgV2lyZUZvcm1hdCxcbiAgT3B0aW9uLFxuICBPcCxcbiAgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LFxufSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IGhhc0NhcGFiaWxpdHkgfSBmcm9tICdAZ2xpbW1lci9tYW5hZ2VyJztcbmltcG9ydCB7ICRzMCwgJHMxLCAkc3AsIFNhdmVkUmVnaXN0ZXIgfSBmcm9tICdAZ2xpbW1lci92bSc7XG5pbXBvcnQgeyBFTVBUWV9TVFJJTkdfQVJSQVkgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IFB1c2hFeHByZXNzaW9uT3AsIFB1c2hTdGF0ZW1lbnRPcCB9IGZyb20gJy4uLy4uL3N5bnRheC9jb21waWxlcnMnO1xuaW1wb3J0IHsgbmFtZWRCbG9ja3MgfSBmcm9tICcuLi8uLi91dGlscyc7XG5pbXBvcnQgeyBsYWJlbE9wZXJhbmQsIGxheW91dE9wZXJhbmQsIHN5bWJvbFRhYmxlT3BlcmFuZCwgaXNTdHJpY3RNb2RlIH0gZnJvbSAnLi4vb3BlcmFuZHMnO1xuaW1wb3J0IHsgSW52b2tlU3RhdGljQmxvY2ssIFB1c2hZaWVsZGFibGVCbG9jaywgWWllbGRCbG9jayB9IGZyb20gJy4vYmxvY2tzJztcbmltcG9ydCB7IFJlcGxheWFibGUgfSBmcm9tICcuL2NvbmRpdGlvbmFsJztcbmltcG9ydCB7IGV4cHIgfSBmcm9tICcuL2V4cHInO1xuaW1wb3J0IHsgQ29tcGlsZUFyZ3MsIENvbXBpbGVQb3NpdGlvbmFsIH0gZnJvbSAnLi9zaGFyZWQnO1xuXG5leHBvcnQgY29uc3QgQVRUUlNfQkxPQ0sgPSAnJmF0dHJzJztcblxuaW50ZXJmYWNlIEFueUNvbXBvbmVudCB7XG4gIGVsZW1lbnRCbG9jazogT3B0aW9uPFdpcmVGb3JtYXQuU2VyaWFsaXplZElubGluZUJsb2NrPjtcbiAgcG9zaXRpb25hbDogV2lyZUZvcm1hdC5Db3JlLlBhcmFtcztcbiAgbmFtZWQ6IFdpcmVGb3JtYXQuQ29yZS5IYXNoO1xuICBibG9ja3M6IE5hbWVkQmxvY2tzO1xufVxuXG4vLyB7e2NvbXBvbmVudH19XG5leHBvcnQgaW50ZXJmYWNlIER5bmFtaWNDb21wb25lbnQgZXh0ZW5kcyBBbnlDb21wb25lbnQge1xuICBkZWZpbml0aW9uOiBXaXJlRm9ybWF0LkV4cHJlc3Npb247XG4gIGF0TmFtZXM6IGJvb2xlYW47XG4gIGN1cnJpZWQ6IGJvb2xlYW47XG59XG5cbi8vIDxDb21wb25lbnQ+XG5leHBvcnQgaW50ZXJmYWNlIFN0YXRpY0NvbXBvbmVudCBleHRlbmRzIEFueUNvbXBvbmVudCB7XG4gIGNhcGFiaWxpdGllczogSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5O1xuICBsYXlvdXQ6IENvbXBpbGFibGVQcm9ncmFtO1xufVxuXG4vLyBjaG9rZXBvaW50XG5leHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudCBleHRlbmRzIEFueUNvbXBvbmVudCB7XG4gIC8vIGVpdGhlciB3ZSBrbm93IHRoZSBjYXBhYmlsaXRpZXMgc3RhdGljYWxseSBvciB3ZSBuZWVkIHRvIGJlIGNvbnNlcnZhdGl2ZSBhbmQgYXNzdW1lXG4gIC8vIHRoYXQgdGhlIGNvbXBvbmVudCByZXF1aXJlcyBhbGwgY2FwYWJpbGl0aWVzXG4gIGNhcGFiaWxpdGllczogSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5IHwgdHJ1ZTtcblxuICAvLyBhcmUgdGhlIGFyZ3VtZW50cyBzdXBwbGllZCBhcyBhdE5hbWVzP1xuICBhdE5hbWVzOiBib29sZWFuO1xuXG4gIC8vIGRvIHdlIGhhdmUgdGhlIGxheW91dCBzdGF0aWNhbGx5IG9yIHdpbGwgd2UgbmVlZCB0byBsb29rIGl0IHVwIGF0IHJ1bnRpbWU/XG4gIGxheW91dD86IENvbXBpbGFibGVQcm9ncmFtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gSW52b2tlQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBjb21wb25lbnQ6IENvbXBpbGVUaW1lQ29tcG9uZW50LFxuICBfZWxlbWVudEJsb2NrOiBXaXJlRm9ybWF0LkNvcmUuRWxlbWVudFBhcmFtZXRlcnMsXG4gIHBvc2l0aW9uYWw6IFdpcmVGb3JtYXQuQ29yZS5QYXJhbXMsXG4gIG5hbWVkOiBXaXJlRm9ybWF0LkNvcmUuSGFzaCxcbiAgX2Jsb2NrczogV2lyZUZvcm1hdC5Db3JlLkJsb2Nrc1xuKTogdm9pZCB7XG4gIGxldCB7IGNvbXBpbGFibGUsIGNhcGFiaWxpdGllcywgaGFuZGxlIH0gPSBjb21wb25lbnQ7XG5cbiAgbGV0IGVsZW1lbnRCbG9jayA9IF9lbGVtZW50QmxvY2tcbiAgICA/IChbX2VsZW1lbnRCbG9jaywgW11dIGFzIFdpcmVGb3JtYXQuU2VyaWFsaXplZElubGluZUJsb2NrKVxuICAgIDogbnVsbDtcbiAgbGV0IGJsb2NrcyA9IEFycmF5LmlzQXJyYXkoX2Jsb2NrcykgfHwgX2Jsb2NrcyA9PT0gbnVsbCA/IG5hbWVkQmxvY2tzKF9ibG9ja3MpIDogX2Jsb2NrcztcblxuICBpZiAoY29tcGlsYWJsZSkge1xuICAgIG9wKE9wLlB1c2hDb21wb25lbnREZWZpbml0aW9uLCBoYW5kbGUpO1xuICAgIEludm9rZVN0YXRpY0NvbXBvbmVudChvcCwge1xuICAgICAgY2FwYWJpbGl0aWVzOiBjYXBhYmlsaXRpZXMsXG4gICAgICBsYXlvdXQ6IGNvbXBpbGFibGUsXG4gICAgICBlbGVtZW50QmxvY2ssXG4gICAgICBwb3NpdGlvbmFsLFxuICAgICAgbmFtZWQsXG4gICAgICBibG9ja3MsXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgb3AoT3AuUHVzaENvbXBvbmVudERlZmluaXRpb24sIGhhbmRsZSk7XG4gICAgSW52b2tlTm9uU3RhdGljQ29tcG9uZW50KG9wLCB7XG4gICAgICBjYXBhYmlsaXRpZXM6IGNhcGFiaWxpdGllcyxcbiAgICAgIGVsZW1lbnRCbG9jayxcbiAgICAgIHBvc2l0aW9uYWwsXG4gICAgICBuYW1lZCxcbiAgICAgIGF0TmFtZXM6IHRydWUsXG4gICAgICBibG9ja3MsXG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEludm9rZUR5bmFtaWNDb21wb25lbnQoXG4gIG9wOiBQdXNoU3RhdGVtZW50T3AsXG4gIGRlZmluaXRpb246IFdpcmVGb3JtYXQuQ29yZS5FeHByZXNzaW9uLFxuICBfZWxlbWVudEJsb2NrOiBXaXJlRm9ybWF0LkNvcmUuRWxlbWVudFBhcmFtZXRlcnMsXG4gIHBvc2l0aW9uYWw6IFdpcmVGb3JtYXQuQ29yZS5QYXJhbXMsXG4gIG5hbWVkOiBXaXJlRm9ybWF0LkNvcmUuSGFzaCxcbiAgX2Jsb2NrczogV2lyZUZvcm1hdC5Db3JlLkJsb2NrcyxcbiAgYXROYW1lczogYm9vbGVhbixcbiAgY3VycmllZDogYm9vbGVhblxuKTogdm9pZCB7XG4gIGxldCBlbGVtZW50QmxvY2sgPSBfZWxlbWVudEJsb2NrXG4gICAgPyAoW19lbGVtZW50QmxvY2ssIFtdXSBhcyBXaXJlRm9ybWF0LlNlcmlhbGl6ZWRJbmxpbmVCbG9jaylcbiAgICA6IG51bGw7XG4gIGxldCBibG9ja3MgPSBBcnJheS5pc0FycmF5KF9ibG9ja3MpIHx8IF9ibG9ja3MgPT09IG51bGwgPyBuYW1lZEJsb2NrcyhfYmxvY2tzKSA6IF9ibG9ja3M7XG5cbiAgUmVwbGF5YWJsZShcbiAgICBvcCxcblxuICAgICgpID0+IHtcbiAgICAgIGV4cHIob3AsIGRlZmluaXRpb24pO1xuICAgICAgb3AoT3AuRHVwLCAkc3AsIDApO1xuICAgICAgcmV0dXJuIDI7XG4gICAgfSxcblxuICAgICgpID0+IHtcbiAgICAgIG9wKE9wLkp1bXBVbmxlc3MsIGxhYmVsT3BlcmFuZCgnRUxTRScpKTtcblxuICAgICAgaWYgKGN1cnJpZWQpIHtcbiAgICAgICAgb3AoT3AuUmVzb2x2ZUN1cnJpZWRDb21wb25lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3AoT3AuUmVzb2x2ZUR5bmFtaWNDb21wb25lbnQsIGlzU3RyaWN0TW9kZSgpKTtcbiAgICAgIH1cblxuICAgICAgb3AoT3AuUHVzaER5bmFtaWNDb21wb25lbnRJbnN0YW5jZSk7XG4gICAgICBJbnZva2VOb25TdGF0aWNDb21wb25lbnQob3AsIHtcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB0cnVlLFxuICAgICAgICBlbGVtZW50QmxvY2ssXG4gICAgICAgIHBvc2l0aW9uYWwsXG4gICAgICAgIG5hbWVkLFxuICAgICAgICBhdE5hbWVzLFxuICAgICAgICBibG9ja3MsXG4gICAgICB9KTtcbiAgICAgIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuTGFiZWwsICdFTFNFJyk7XG4gICAgfVxuICApO1xufVxuXG5mdW5jdGlvbiBJbnZva2VTdGF0aWNDb21wb25lbnQoXG4gIG9wOiBQdXNoU3RhdGVtZW50T3AsXG4gIHsgY2FwYWJpbGl0aWVzLCBsYXlvdXQsIGVsZW1lbnRCbG9jaywgcG9zaXRpb25hbCwgbmFtZWQsIGJsb2NrcyB9OiBTdGF0aWNDb21wb25lbnRcbik6IHZvaWQge1xuICBsZXQgeyBzeW1ib2xUYWJsZSB9ID0gbGF5b3V0O1xuXG4gIGxldCBiYWlsT3V0ID1cbiAgICBzeW1ib2xUYWJsZS5oYXNFdmFsIHx8IGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuUHJlcGFyZUFyZ3MpO1xuXG4gIGlmIChiYWlsT3V0KSB7XG4gICAgSW52b2tlTm9uU3RhdGljQ29tcG9uZW50KG9wLCB7XG4gICAgICBjYXBhYmlsaXRpZXMsXG4gICAgICBlbGVtZW50QmxvY2ssXG4gICAgICBwb3NpdGlvbmFsLFxuICAgICAgbmFtZWQsXG4gICAgICBhdE5hbWVzOiB0cnVlLFxuICAgICAgYmxvY2tzLFxuICAgICAgbGF5b3V0LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgb3AoT3AuRmV0Y2gsICRzMCk7XG4gIG9wKE9wLkR1cCwgJHNwLCAxKTtcbiAgb3AoT3AuTG9hZCwgJHMwKTtcbiAgb3AoTWFjaGluZU9wLlB1c2hGcmFtZSk7XG5cbiAgLy8gU2V0dXAgYXJndW1lbnRzXG4gIGxldCB7IHN5bWJvbHMgfSA9IHN5bWJvbFRhYmxlO1xuXG4gIC8vIEFzIHdlIHB1c2ggdmFsdWVzIG9udG8gdGhlIHN0YWNrLCB3ZSBzdG9yZSB0aGUgc3ltYm9scyBhc3NvY2lhdGVkICB3aXRoIHRoZW1cbiAgLy8gc28gdGhhdCB3ZSBjYW4gc2V0IHRoZW0gb24gdGhlIHNjb3BlIGxhdGVyIG9uIHdpdGggU2V0VmFyaWFibGUgYW5kIFNldEJsb2NrXG4gIGxldCBibG9ja1N5bWJvbHM6IG51bWJlcltdID0gW107XG4gIGxldCBhcmdTeW1ib2xzOiBudW1iZXJbXSA9IFtdO1xuICBsZXQgYXJnTmFtZXM6IHN0cmluZ1tdID0gW107XG5cbiAgLy8gRmlyc3Qgd2UgcHVzaCB0aGUgYmxvY2tzIG9udG8gdGhlIHN0YWNrXG4gIGxldCBibG9ja05hbWVzID0gYmxvY2tzLm5hbWVzO1xuXG4gIC8vIFN0YXJ0aW5nIHdpdGggdGhlIGF0dHJzIGJsb2NrLCBpZiBpdCBleGlzdHMgYW5kIGlzIHJlZmVyZW5jZWQgaW4gdGhlIGNvbXBvbmVudFxuICBpZiAoZWxlbWVudEJsb2NrICE9PSBudWxsKSB7XG4gICAgbGV0IHN5bWJvbCA9IHN5bWJvbHMuaW5kZXhPZihBVFRSU19CTE9DSyk7XG5cbiAgICBpZiAoc3ltYm9sICE9PSAtMSkge1xuICAgICAgUHVzaFlpZWxkYWJsZUJsb2NrKG9wLCBlbGVtZW50QmxvY2spO1xuICAgICAgYmxvY2tTeW1ib2xzLnB1c2goc3ltYm9sKTtcbiAgICB9XG4gIH1cblxuICAvLyBGb2xsb3dlZCBieSB0aGUgb3RoZXIgYmxvY2tzLCBpZiB0aGV5IGV4aXN0IGFuZCBhcmUgcmVmZXJlbmNlZCBpbiB0aGUgY29tcG9uZW50LlxuICAvLyBBbHNvIHN0b3JlIHRoZSBpbmRleCBvZiB0aGUgYXNzb2NpYXRlZCBzeW1ib2wuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tOYW1lcy5sZW5ndGg7IGkrKykge1xuICAgIGxldCBuYW1lID0gYmxvY2tOYW1lc1tpXTtcbiAgICBsZXQgc3ltYm9sID0gc3ltYm9scy5pbmRleE9mKGAmJHtuYW1lfWApO1xuXG4gICAgaWYgKHN5bWJvbCAhPT0gLTEpIHtcbiAgICAgIFB1c2hZaWVsZGFibGVCbG9jayhvcCwgYmxvY2tzLmdldChuYW1lKSk7XG4gICAgICBibG9ja1N5bWJvbHMucHVzaChzeW1ib2wpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE5leHQgdXAgd2UgaGF2ZSBhcmd1bWVudHMuIElmIHRoZSBjb21wb25lbnQgaGFzIHRoZSBgY3JlYXRlQXJnc2AgY2FwYWJpbGl0eSxcbiAgLy8gdGhlbiBpdCB3YW50cyBhY2Nlc3MgdG8gdGhlIGFyZ3VtZW50cyBpbiBKYXZhU2NyaXB0LiBXZSBjYW4ndCBrbm93IHdoZXRoZXJcbiAgLy8gb3Igbm90IGFuIGFyZ3VtZW50IGlzIHVzZWQsIHNvIHdlIGhhdmUgdG8gZ2l2ZSBhY2Nlc3MgdG8gYWxsIG9mIHRoZW0uXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkNyZWF0ZUFyZ3MpKSB7XG4gICAgLy8gRmlyc3Qgd2UgcHVzaCBwb3NpdGlvbmFsIGFyZ3VtZW50c1xuICAgIGxldCBjb3VudCA9IENvbXBpbGVQb3NpdGlvbmFsKG9wLCBwb3NpdGlvbmFsKTtcblxuICAgIC8vIHNldHVwIHRoZSBmbGFncyB3aXRoIHRoZSBjb3VudCBvZiBwb3NpdGlvbmFscywgYW5kIHRvIGluZGljYXRlIHRoYXQgYXROYW1lc1xuICAgIC8vIGFyZSB1c2VkXG4gICAgbGV0IGZsYWdzID0gY291bnQgPDwgNDtcbiAgICBmbGFncyB8PSAwYjEwMDA7XG5cbiAgICBsZXQgbmFtZXM6IHN0cmluZ1tdID0gRU1QVFlfU1RSSU5HX0FSUkFZIGFzIHN0cmluZ1tdO1xuXG4gICAgLy8gTmV4dCwgaWYgbmFtZWQgYXJncyBleGlzdCwgcHVzaCB0aGVtIGFsbC4gSWYgdGhleSBoYXZlIGFuIGFzc29jaWF0ZWQgc3ltYm9sXG4gICAgLy8gaW4gdGhlIGludm9rZWQgY29tcG9uZW50IChlLmcuIHRoZXkgYXJlIHVzZWQgd2l0aGluIGl0cyB0ZW1wbGF0ZSksIHdlIHB1c2hcbiAgICAvLyB0aGF0IHN5bWJvbC4gSWYgbm90LCB3ZSBzdGlsbCBwdXNoIHRoZSBleHByZXNzaW9uIGFzIGl0IG1heSBiZSB1c2VkLCBhbmRcbiAgICAvLyB3ZSBzdG9yZSB0aGUgc3ltYm9sIGFzIC0xICh0aGlzIGlzIHVzZWQgbGF0ZXIpLlxuICAgIGlmIChuYW1lZCAhPT0gbnVsbCkge1xuICAgICAgbmFtZXMgPSBuYW1lZFswXTtcbiAgICAgIGxldCB2YWwgPSBuYW1lZFsxXTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWwubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHN5bWJvbCA9IHN5bWJvbHMuaW5kZXhPZihuYW1lc1tpXSk7XG5cbiAgICAgICAgZXhwcihvcCwgdmFsW2ldKTtcbiAgICAgICAgYXJnU3ltYm9scy5wdXNoKHN5bWJvbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRmluYWxseSwgcHVzaCB0aGUgVk0gYXJndW1lbnRzIHRoZW1zZWx2ZXMuIFRoZXNlIGFyZ3Mgd29uJ3QgbmVlZCBhY2Nlc3NcbiAgICAvLyB0byBibG9ja3MgKHRoZXkgYXJlbid0IGFjY2Vzc2libGUgZnJvbSB1c2VybGFuZCBhbnl3YXlzKSwgc28gd2UgcHVzaCBhblxuICAgIC8vIGVtcHR5IGFycmF5IGluc3RlYWQgb2YgdGhlIGFjdHVhbCBibG9jayBuYW1lcy5cbiAgICBvcChPcC5QdXNoQXJncywgbmFtZXMsIEVNUFRZX1NUUklOR19BUlJBWSwgZmxhZ3MpO1xuXG4gICAgLy8gQW5kIHB1c2ggYW4gZXh0cmEgcG9wIG9wZXJhdGlvbiB0byByZW1vdmUgdGhlIGFyZ3MgYmVmb3JlIHdlIGJlZ2luIHNldHRpbmdcbiAgICAvLyB2YXJpYWJsZXMgb24gdGhlIGxvY2FsIGNvbnRleHRcbiAgICBhcmdTeW1ib2xzLnB1c2goLTEpO1xuICB9IGVsc2UgaWYgKG5hbWVkICE9PSBudWxsKSB7XG4gICAgLy8gSWYgdGhlIGNvbXBvbmVudCBkb2VzIG5vdCBoYXZlIHRoZSBgY3JlYXRlQXJnc2AgY2FwYWJpbGl0eSwgdGhlbiB0aGUgb25seVxuICAgIC8vIGV4cHJlc3Npb25zIHdlIG5lZWQgdG8gcHVzaCBvbnRvIHRoZSBzdGFjayBhcmUgdGhvc2UgdGhhdCBhcmUgYWN0dWFsbHlcbiAgICAvLyByZWZlcmVuY2VkIGluIHRoZSB0ZW1wbGF0ZSBvZiB0aGUgaW52b2tlZCBjb21wb25lbnQgKGUuZy4gaGF2ZSBzeW1ib2xzKS5cbiAgICBsZXQgbmFtZXMgPSBuYW1lZFswXTtcbiAgICBsZXQgdmFsID0gbmFtZWRbMV07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbC5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IG5hbWUgPSBuYW1lc1tpXTtcbiAgICAgIGxldCBzeW1ib2wgPSBzeW1ib2xzLmluZGV4T2YobmFtZSk7XG5cbiAgICAgIGlmIChzeW1ib2wgIT09IC0xKSB7XG4gICAgICAgIGV4cHIob3AsIHZhbFtpXSk7XG4gICAgICAgIGFyZ1N5bWJvbHMucHVzaChzeW1ib2wpO1xuICAgICAgICBhcmdOYW1lcy5wdXNoKG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9wKE9wLkJlZ2luQ29tcG9uZW50VHJhbnNhY3Rpb24sICRzMCk7XG5cbiAgaWYgKGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuRHluYW1pY1Njb3BlKSkge1xuICAgIG9wKE9wLlB1c2hEeW5hbWljU2NvcGUpO1xuICB9XG5cbiAgaWYgKGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuQ3JlYXRlSW5zdGFuY2UpKSB7XG4gICAgb3AoT3AuQ3JlYXRlQ29tcG9uZW50LCAoYmxvY2tzLmhhcygnZGVmYXVsdCcpIGFzIGFueSkgfCAwLCAkczApO1xuICB9XG5cbiAgb3AoT3AuUmVnaXN0ZXJDb21wb25lbnREZXN0cnVjdG9yLCAkczApO1xuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkNyZWF0ZUFyZ3MpKSB7XG4gICAgb3AoT3AuR2V0Q29tcG9uZW50U2VsZiwgJHMwKTtcbiAgfSBlbHNlIHtcbiAgICBvcChPcC5HZXRDb21wb25lbnRTZWxmLCAkczAsIGFyZ05hbWVzKTtcbiAgfVxuXG4gIC8vIFNldHVwIHRoZSBuZXcgcm9vdCBzY29wZSBmb3IgdGhlIGNvbXBvbmVudFxuICBvcChPcC5Sb290U2NvcGUsIHN5bWJvbHMubGVuZ3RoICsgMSwgT2JqZWN0LmtleXMoYmxvY2tzKS5sZW5ndGggPiAwID8gMSA6IDApO1xuXG4gIC8vIFBvcCB0aGUgc2VsZiByZWZlcmVuY2Ugb2ZmIHRoZSBzdGFjayBhbmQgc2V0IGl0IHRvIHRoZSBzeW1ib2wgZm9yIGB0aGlzYFxuICAvLyBpbiB0aGUgbmV3IHNjb3BlLiBUaGlzIGlzIHdoeSBhbGwgc3Vic2VxdWVudCBzeW1ib2xzIGFyZSBpbmNyZWFzZWQgYnkgb25lLlxuICBvcChPcC5TZXRWYXJpYWJsZSwgMCk7XG5cbiAgLy8gR29pbmcgaW4gcmV2ZXJzZSwgbm93IHdlIHBvcCB0aGUgYXJncy9ibG9ja3Mgb2ZmIHRoZSBzdGFjaywgc3RhcnRpbmcgd2l0aFxuICAvLyBhcmd1bWVudHMsIGFuZCBhc3NpZ24gdGhlbSB0byB0aGVpciBzeW1ib2xzIGluIHRoZSBuZXcgc2NvcGUuXG4gIGZvciAobGV0IGkgPSBhcmdTeW1ib2xzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgbGV0IHN5bWJvbCA9IGFyZ1N5bWJvbHNbaV07XG5cbiAgICBpZiAoc3ltYm9sID09PSAtMSkge1xuICAgICAgLy8gVGhlIGV4cHJlc3Npb24gd2FzIG5vdCBib3VuZCB0byBhIGxvY2FsIHN5bWJvbCwgaXQgd2FzIG9ubHkgcHVzaGVkIHRvIGJlXG4gICAgICAvLyB1c2VkIHdpdGggVk0gYXJncyBpbiB0aGUgamF2YXNjcmlwdCBzaWRlXG4gICAgICBvcChPcC5Qb3AsIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvcChPcC5TZXRWYXJpYWJsZSwgc3ltYm9sICsgMSk7XG4gICAgfVxuICB9XG5cbiAgLy8gaWYgYW55IHBvc2l0aW9uYWwgcGFyYW1zIGV4aXN0LCBwb3AgdGhlbSBvZmYgdGhlIHN0YWNrIGFzIHdlbGxcbiAgaWYgKHBvc2l0aW9uYWwgIT09IG51bGwpIHtcbiAgICBvcChPcC5Qb3AsIHBvc2l0aW9uYWwubGVuZ3RoKTtcbiAgfVxuXG4gIC8vIEZpbmlzaCB1cCBieSBwb3BwaW5nIG9mZiBhbmQgYXNzaWduaW5nIGJsb2Nrc1xuICBmb3IgKGxldCBpID0gYmxvY2tTeW1ib2xzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgbGV0IHN5bWJvbCA9IGJsb2NrU3ltYm9sc1tpXTtcblxuICAgIG9wKE9wLlNldEJsb2NrLCBzeW1ib2wgKyAxKTtcbiAgfVxuXG4gIG9wKE9wLkNvbnN0YW50LCBsYXlvdXRPcGVyYW5kKGxheW91dCkpO1xuICBvcChPcC5Db21waWxlQmxvY2spO1xuICBvcChNYWNoaW5lT3AuSW52b2tlVmlydHVhbCk7XG4gIG9wKE9wLkRpZFJlbmRlckxheW91dCwgJHMwKTtcblxuICBvcChNYWNoaW5lT3AuUG9wRnJhbWUpO1xuICBvcChPcC5Qb3BTY29wZSk7XG5cbiAgaWYgKGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuRHluYW1pY1Njb3BlKSkge1xuICAgIG9wKE9wLlBvcER5bmFtaWNTY29wZSk7XG4gIH1cblxuICBvcChPcC5Db21taXRDb21wb25lbnRUcmFuc2FjdGlvbik7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBJbnZva2VOb25TdGF0aWNDb21wb25lbnQoXG4gIG9wOiBQdXNoU3RhdGVtZW50T3AsXG4gIHsgY2FwYWJpbGl0aWVzLCBlbGVtZW50QmxvY2ssIHBvc2l0aW9uYWwsIG5hbWVkLCBhdE5hbWVzLCBibG9ja3M6IG5hbWVkQmxvY2tzLCBsYXlvdXQgfTogQ29tcG9uZW50XG4pOiB2b2lkIHtcbiAgbGV0IGJpbmRhYmxlQmxvY2tzID0gISFuYW1lZEJsb2NrcztcbiAgbGV0IGJpbmRhYmxlQXROYW1lcyA9XG4gICAgY2FwYWJpbGl0aWVzID09PSB0cnVlIHx8XG4gICAgaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5QcmVwYXJlQXJncykgfHxcbiAgICAhIShuYW1lZCAmJiBuYW1lZFswXS5sZW5ndGggIT09IDApO1xuXG4gIGxldCBibG9ja3MgPSBuYW1lZEJsb2Nrcy53aXRoKCdhdHRycycsIGVsZW1lbnRCbG9jayk7XG5cbiAgb3AoT3AuRmV0Y2gsICRzMCk7XG4gIG9wKE9wLkR1cCwgJHNwLCAxKTtcbiAgb3AoT3AuTG9hZCwgJHMwKTtcblxuICBvcChNYWNoaW5lT3AuUHVzaEZyYW1lKTtcbiAgQ29tcGlsZUFyZ3Mob3AsIHBvc2l0aW9uYWwsIG5hbWVkLCBibG9ja3MsIGF0TmFtZXMpO1xuICBvcChPcC5QcmVwYXJlQXJncywgJHMwKTtcblxuICBpbnZva2VQcmVwYXJlZENvbXBvbmVudChvcCwgYmxvY2tzLmhhcygnZGVmYXVsdCcpLCBiaW5kYWJsZUJsb2NrcywgYmluZGFibGVBdE5hbWVzLCAoKSA9PiB7XG4gICAgaWYgKGxheW91dCkge1xuICAgICAgb3AoT3AuUHVzaFN5bWJvbFRhYmxlLCBzeW1ib2xUYWJsZU9wZXJhbmQobGF5b3V0LnN5bWJvbFRhYmxlKSk7XG4gICAgICBvcChPcC5Db25zdGFudCwgbGF5b3V0T3BlcmFuZChsYXlvdXQpKTtcbiAgICAgIG9wKE9wLkNvbXBpbGVCbG9jayk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wKE9wLkdldENvbXBvbmVudExheW91dCwgJHMwKTtcbiAgICB9XG5cbiAgICBvcChPcC5Qb3B1bGF0ZUxheW91dCwgJHMwKTtcbiAgfSk7XG5cbiAgb3AoT3AuTG9hZCwgJHMwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFdyYXBwZWRDb21wb25lbnQoXG4gIG9wOiBQdXNoU3RhdGVtZW50T3AsXG4gIGxheW91dDogTGF5b3V0V2l0aENvbnRleHQsXG4gIGF0dHJzQmxvY2tOdW1iZXI6IG51bWJlclxuKTogdm9pZCB7XG4gIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuU3RhcnRMYWJlbHMpO1xuICBXaXRoU2F2ZWRSZWdpc3RlcihvcCwgJHMxLCAoKSA9PiB7XG4gICAgb3AoT3AuR2V0Q29tcG9uZW50VGFnTmFtZSwgJHMwKTtcbiAgICBvcChPcC5QcmltaXRpdmVSZWZlcmVuY2UpO1xuICAgIG9wKE9wLkR1cCwgJHNwLCAwKTtcbiAgfSk7XG4gIG9wKE9wLkp1bXBVbmxlc3MsIGxhYmVsT3BlcmFuZCgnQk9EWScpKTtcbiAgb3AoT3AuRmV0Y2gsICRzMSk7XG4gIG9wKE9wLlB1dENvbXBvbmVudE9wZXJhdGlvbnMpO1xuICBvcChPcC5PcGVuRHluYW1pY0VsZW1lbnQpO1xuICBvcChPcC5EaWRDcmVhdGVFbGVtZW50LCAkczApO1xuICBZaWVsZEJsb2NrKG9wLCBhdHRyc0Jsb2NrTnVtYmVyLCBudWxsKTtcbiAgb3AoT3AuRmx1c2hFbGVtZW50KTtcbiAgb3AoSGlnaExldmVsQnVpbGRlck9wY29kZS5MYWJlbCwgJ0JPRFknKTtcbiAgSW52b2tlU3RhdGljQmxvY2sob3AsIFtsYXlvdXQuYmxvY2tbMF0sIFtdXSk7XG4gIG9wKE9wLkZldGNoLCAkczEpO1xuICBvcChPcC5KdW1wVW5sZXNzLCBsYWJlbE9wZXJhbmQoJ0VORCcpKTtcbiAgb3AoT3AuQ2xvc2VFbGVtZW50KTtcbiAgb3AoSGlnaExldmVsQnVpbGRlck9wY29kZS5MYWJlbCwgJ0VORCcpO1xuICBvcChPcC5Mb2FkLCAkczEpO1xuICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLlN0b3BMYWJlbHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW52b2tlUHJlcGFyZWRDb21wb25lbnQoXG4gIG9wOiBQdXNoU3RhdGVtZW50T3AsXG4gIGhhc0Jsb2NrOiBib29sZWFuLFxuICBiaW5kYWJsZUJsb2NrczogYm9vbGVhbixcbiAgYmluZGFibGVBdE5hbWVzOiBib29sZWFuLFxuICBwb3B1bGF0ZUxheW91dDogT3B0aW9uPCgpID0+IHZvaWQ+ID0gbnVsbFxuKTogdm9pZCB7XG4gIG9wKE9wLkJlZ2luQ29tcG9uZW50VHJhbnNhY3Rpb24sICRzMCk7XG4gIG9wKE9wLlB1c2hEeW5hbWljU2NvcGUpO1xuXG4gIG9wKE9wLkNyZWF0ZUNvbXBvbmVudCwgKGhhc0Jsb2NrIGFzIGFueSkgfCAwLCAkczApO1xuXG4gIC8vIHRoaXMgaGFzIHRvIHJ1biBhZnRlciBjcmVhdGVDb21wb25lbnQgdG8gYWxsb3dcbiAgLy8gZm9yIGxhdGUtYm91bmQgbGF5b3V0cywgYnV0IGEgY2FsbGVyIGlzIGZyZWVcbiAgLy8gdG8gcG9wdWxhdGUgdGhlIGxheW91dCBlYXJsaWVyIGlmIGl0IHdhbnRzIHRvXG4gIC8vIGFuZCBkbyBub3RoaW5nIGhlcmUuXG4gIGlmIChwb3B1bGF0ZUxheW91dCkge1xuICAgIHBvcHVsYXRlTGF5b3V0KCk7XG4gIH1cblxuICBvcChPcC5SZWdpc3RlckNvbXBvbmVudERlc3RydWN0b3IsICRzMCk7XG4gIG9wKE9wLkdldENvbXBvbmVudFNlbGYsICRzMCk7XG5cbiAgb3AoT3AuVmlydHVhbFJvb3RTY29wZSwgJHMwKTtcbiAgb3AoT3AuU2V0VmFyaWFibGUsIDApO1xuICBvcChPcC5TZXR1cEZvckV2YWwsICRzMCk7XG5cbiAgaWYgKGJpbmRhYmxlQXROYW1lcykgb3AoT3AuU2V0TmFtZWRWYXJpYWJsZXMsICRzMCk7XG4gIGlmIChiaW5kYWJsZUJsb2Nrcykgb3AoT3AuU2V0QmxvY2tzLCAkczApO1xuXG4gIG9wKE9wLlBvcCwgMSk7XG4gIG9wKE9wLkludm9rZUNvbXBvbmVudExheW91dCwgJHMwKTtcbiAgb3AoT3AuRGlkUmVuZGVyTGF5b3V0LCAkczApO1xuICBvcChNYWNoaW5lT3AuUG9wRnJhbWUpO1xuXG4gIG9wKE9wLlBvcFNjb3BlKTtcbiAgb3AoT3AuUG9wRHluYW1pY1Njb3BlKTtcbiAgb3AoT3AuQ29tbWl0Q29tcG9uZW50VHJhbnNhY3Rpb24pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gSW52b2tlQmFyZUNvbXBvbmVudChvcDogUHVzaFN0YXRlbWVudE9wKTogdm9pZCB7XG4gIG9wKE9wLkZldGNoLCAkczApO1xuICBvcChPcC5EdXAsICRzcCwgMSk7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG5cbiAgb3AoTWFjaGluZU9wLlB1c2hGcmFtZSk7XG4gIG9wKE9wLlB1c2hFbXB0eUFyZ3MpO1xuICBvcChPcC5QcmVwYXJlQXJncywgJHMwKTtcbiAgaW52b2tlUHJlcGFyZWRDb21wb25lbnQob3AsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgKCkgPT4ge1xuICAgIG9wKE9wLkdldENvbXBvbmVudExheW91dCwgJHMwKTtcbiAgICBvcChPcC5Qb3B1bGF0ZUxheW91dCwgJHMwKTtcbiAgfSk7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBXaXRoU2F2ZWRSZWdpc3RlcihcbiAgb3A6IFB1c2hFeHByZXNzaW9uT3AsXG4gIHJlZ2lzdGVyOiBTYXZlZFJlZ2lzdGVyLFxuICBibG9jazogKCkgPT4gdm9pZFxuKTogdm9pZCB7XG4gIG9wKE9wLkZldGNoLCByZWdpc3Rlcik7XG4gIGJsb2NrKCk7XG4gIG9wKE9wLkxvYWQsIHJlZ2lzdGVyKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=