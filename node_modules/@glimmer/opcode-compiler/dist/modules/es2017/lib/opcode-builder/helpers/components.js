import { hasCapability } from '@glimmer/manager';
import { $s0, $s1, $sp } from '@glimmer/vm';
import { EMPTY_STRING_ARRAY } from '@glimmer/util';
import { namedBlocks } from '../../utils';
import { labelOperand, layoutOperand, symbolTableOperand, isStrictMode } from '../operands';
import { InvokeStaticBlock, PushYieldableBlock, YieldBlock } from './blocks';
import { Replayable } from './conditional';
import { expr } from './expr';
import { CompileArgs, CompilePositional } from './shared';
export const ATTRS_BLOCK = '&attrs';
export function InvokeComponent(op, component, _elementBlock, positional, named, _blocks) {
  let {
    compilable,
    capabilities,
    handle
  } = component;
  let elementBlock = _elementBlock ? [_elementBlock, []] : null;
  let blocks = Array.isArray(_blocks) || _blocks === null ? namedBlocks(_blocks) : _blocks;

  if (compilable) {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeStaticComponent(op, {
      capabilities: capabilities,
      layout: compilable,
      elementBlock,
      positional,
      named,
      blocks
    });
  } else {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeNonStaticComponent(op, {
      capabilities: capabilities,
      elementBlock,
      positional,
      named,
      atNames: true,
      blocks
    });
  }
}
export function InvokeDynamicComponent(op, definition, _elementBlock, positional, named, _blocks, atNames, curried) {
  let elementBlock = _elementBlock ? [_elementBlock, []] : null;
  let blocks = Array.isArray(_blocks) || _blocks === null ? namedBlocks(_blocks) : _blocks;
  Replayable(op, () => {
    expr(op, definition);
    op(33
    /* Dup */
    , $sp, 0);
    return 2;
  }, () => {
    op(66
    /* JumpUnless */
    , labelOperand('ELSE'));

    if (curried) {
      op(81
      /* ResolveCurriedComponent */
      );
    } else {
      op(80
      /* ResolveDynamicComponent */
      , isStrictMode());
    }

    op(79
    /* PushDynamicComponentInstance */
    );
    InvokeNonStaticComponent(op, {
      capabilities: true,
      elementBlock,
      positional,
      named,
      atNames,
      blocks
    });
    op(1000
    /* Label */
    , 'ELSE');
  });
}

function InvokeStaticComponent(op, {
  capabilities,
  layout,
  elementBlock,
  positional,
  named,
  blocks
}) {
  let {
    symbolTable
  } = layout;
  let bailOut = symbolTable.hasEval || hasCapability(capabilities, 4
  /* PrepareArgs */
  );

  if (bailOut) {
    InvokeNonStaticComponent(op, {
      capabilities,
      elementBlock,
      positional,
      named,
      atNames: true,
      blocks,
      layout
    });
    return;
  }

  op(36
  /* Fetch */
  , $s0);
  op(33
  /* Dup */
  , $sp, 1);
  op(35
  /* Load */
  , $s0);
  op(0
  /* PushFrame */
  ); // Setup arguments

  let {
    symbols
  } = symbolTable; // As we push values onto the stack, we store the symbols associated  with them
  // so that we can set them on the scope later on with SetVariable and SetBlock

  let blockSymbols = [];
  let argSymbols = [];
  let argNames = []; // First we push the blocks onto the stack

  let blockNames = blocks.names; // Starting with the attrs block, if it exists and is referenced in the component

  if (elementBlock !== null) {
    let symbol = symbols.indexOf(ATTRS_BLOCK);

    if (symbol !== -1) {
      PushYieldableBlock(op, elementBlock);
      blockSymbols.push(symbol);
    }
  } // Followed by the other blocks, if they exist and are referenced in the component.
  // Also store the index of the associated symbol.


  for (let i = 0; i < blockNames.length; i++) {
    let name = blockNames[i];
    let symbol = symbols.indexOf(`&${name}`);

    if (symbol !== -1) {
      PushYieldableBlock(op, blocks.get(name));
      blockSymbols.push(symbol);
    }
  } // Next up we have arguments. If the component has the `createArgs` capability,
  // then it wants access to the arguments in JavaScript. We can't know whether
  // or not an argument is used, so we have to give access to all of them.


  if (hasCapability(capabilities, 8
  /* CreateArgs */
  )) {
    // First we push positional arguments
    let count = CompilePositional(op, positional); // setup the flags with the count of positionals, and to indicate that atNames
    // are used

    let flags = count << 4;
    flags |= 0b1000;
    let names = EMPTY_STRING_ARRAY; // Next, if named args exist, push them all. If they have an associated symbol
    // in the invoked component (e.g. they are used within its template), we push
    // that symbol. If not, we still push the expression as it may be used, and
    // we store the symbol as -1 (this is used later).

    if (named !== null) {
      names = named[0];
      let val = named[1];

      for (let i = 0; i < val.length; i++) {
        let symbol = symbols.indexOf(names[i]);
        expr(op, val[i]);
        argSymbols.push(symbol);
      }
    } // Finally, push the VM arguments themselves. These args won't need access
    // to blocks (they aren't accessible from userland anyways), so we push an
    // empty array instead of the actual block names.


    op(82
    /* PushArgs */
    , names, EMPTY_STRING_ARRAY, flags); // And push an extra pop operation to remove the args before we begin setting
    // variables on the local context

    argSymbols.push(-1);
  } else if (named !== null) {
    // If the component does not have the `createArgs` capability, then the only
    // expressions we need to push onto the stack are those that are actually
    // referenced in the template of the invoked component (e.g. have symbols).
    let names = named[0];
    let val = named[1];

    for (let i = 0; i < val.length; i++) {
      let name = names[i];
      let symbol = symbols.indexOf(name);

      if (symbol !== -1) {
        expr(op, val[i]);
        argSymbols.push(symbol);
        argNames.push(name);
      }
    }
  }

  op(97
  /* BeginComponentTransaction */
  , $s0);

  if (hasCapability(capabilities, 64
  /* DynamicScope */
  )) {
    op(59
    /* PushDynamicScope */
    );
  }

  if (hasCapability(capabilities, 512
  /* CreateInstance */
  )) {
    op(87
    /* CreateComponent */
    , blocks.has('default') | 0, $s0);
  }

  op(88
  /* RegisterComponentDestructor */
  , $s0);

  if (hasCapability(capabilities, 8
  /* CreateArgs */
  )) {
    op(90
    /* GetComponentSelf */
    , $s0);
  } else {
    op(90
    /* GetComponentSelf */
    , $s0, argNames);
  } // Setup the new root scope for the component


  op(37
  /* RootScope */
  , symbols.length + 1, Object.keys(blocks).length > 0 ? 1 : 0); // Pop the self reference off the stack and set it to the symbol for `this`
  // in the new scope. This is why all subsequent symbols are increased by one.

  op(19
  /* SetVariable */
  , 0); // Going in reverse, now we pop the args/blocks off the stack, starting with
  // arguments, and assign them to their symbols in the new scope.

  for (let i = argSymbols.length - 1; i >= 0; i--) {
    let symbol = argSymbols[i];

    if (symbol === -1) {
      // The expression was not bound to a local symbol, it was only pushed to be
      // used with VM args in the javascript side
      op(34
      /* Pop */
      , 1);
    } else {
      op(19
      /* SetVariable */
      , symbol + 1);
    }
  } // if any positional params exist, pop them off the stack as well


  if (positional !== null) {
    op(34
    /* Pop */
    , positional.length);
  } // Finish up by popping off and assigning blocks


  for (let i = blockSymbols.length - 1; i >= 0; i--) {
    let symbol = blockSymbols[i];
    op(20
    /* SetBlock */
    , symbol + 1);
  }

  op(28
  /* Constant */
  , layoutOperand(layout));
  op(61
  /* CompileBlock */
  );
  op(2
  /* InvokeVirtual */
  );
  op(100
  /* DidRenderLayout */
  , $s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );

  if (hasCapability(capabilities, 64
  /* DynamicScope */
  )) {
    op(60
    /* PopDynamicScope */
    );
  }

  op(98
  /* CommitComponentTransaction */
  );
  op(35
  /* Load */
  , $s0);
}

export function InvokeNonStaticComponent(op, {
  capabilities,
  elementBlock,
  positional,
  named,
  atNames,
  blocks: namedBlocks,
  layout
}) {
  let bindableBlocks = !!namedBlocks;
  let bindableAtNames = capabilities === true || hasCapability(capabilities, 4
  /* PrepareArgs */
  ) || !!(named && named[0].length !== 0);
  let blocks = namedBlocks.with('attrs', elementBlock);
  op(36
  /* Fetch */
  , $s0);
  op(33
  /* Dup */
  , $sp, 1);
  op(35
  /* Load */
  , $s0);
  op(0
  /* PushFrame */
  );
  CompileArgs(op, positional, named, blocks, atNames);
  op(85
  /* PrepareArgs */
  , $s0);
  invokePreparedComponent(op, blocks.has('default'), bindableBlocks, bindableAtNames, () => {
    if (layout) {
      op(63
      /* PushSymbolTable */
      , symbolTableOperand(layout.symbolTable));
      op(28
      /* Constant */
      , layoutOperand(layout));
      op(61
      /* CompileBlock */
      );
    } else {
      op(92
      /* GetComponentLayout */
      , $s0);
    }

    op(95
    /* PopulateLayout */
    , $s0);
  });
  op(35
  /* Load */
  , $s0);
}
export function WrappedComponent(op, layout, attrsBlockNumber) {
  op(1001
  /* StartLabels */
  );
  WithSavedRegister(op, $s1, () => {
    op(91
    /* GetComponentTagName */
    , $s0);
    op(31
    /* PrimitiveReference */
    );
    op(33
    /* Dup */
    , $sp, 0);
  });
  op(66
  /* JumpUnless */
  , labelOperand('BODY'));
  op(36
  /* Fetch */
  , $s1);
  op(89
  /* PutComponentOperations */
  );
  op(49
  /* OpenDynamicElement */
  );
  op(99
  /* DidCreateElement */
  , $s0);
  YieldBlock(op, attrsBlockNumber, null);
  op(54
  /* FlushElement */
  );
  op(1000
  /* Label */
  , 'BODY');
  InvokeStaticBlock(op, [layout.block[0], []]);
  op(36
  /* Fetch */
  , $s1);
  op(66
  /* JumpUnless */
  , labelOperand('END'));
  op(55
  /* CloseElement */
  );
  op(1000
  /* Label */
  , 'END');
  op(35
  /* Load */
  , $s1);
  op(1002
  /* StopLabels */
  );
}
export function invokePreparedComponent(op, hasBlock, bindableBlocks, bindableAtNames, populateLayout = null) {
  op(97
  /* BeginComponentTransaction */
  , $s0);
  op(59
  /* PushDynamicScope */
  );
  op(87
  /* CreateComponent */
  , hasBlock | 0, $s0); // this has to run after createComponent to allow
  // for late-bound layouts, but a caller is free
  // to populate the layout earlier if it wants to
  // and do nothing here.

  if (populateLayout) {
    populateLayout();
  }

  op(88
  /* RegisterComponentDestructor */
  , $s0);
  op(90
  /* GetComponentSelf */
  , $s0);
  op(38
  /* VirtualRootScope */
  , $s0);
  op(19
  /* SetVariable */
  , 0);
  op(94
  /* SetupForEval */
  , $s0);
  if (bindableAtNames) op(17
  /* SetNamedVariables */
  , $s0);
  if (bindableBlocks) op(18
  /* SetBlocks */
  , $s0);
  op(34
  /* Pop */
  , 1);
  op(96
  /* InvokeComponentLayout */
  , $s0);
  op(100
  /* DidRenderLayout */
  , $s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );
  op(60
  /* PopDynamicScope */
  );
  op(98
  /* CommitComponentTransaction */
  );
}
export function InvokeBareComponent(op) {
  op(36
  /* Fetch */
  , $s0);
  op(33
  /* Dup */
  , $sp, 1);
  op(35
  /* Load */
  , $s0);
  op(0
  /* PushFrame */
  );
  op(83
  /* PushEmptyArgs */
  );
  op(85
  /* PrepareArgs */
  , $s0);
  invokePreparedComponent(op, false, false, true, () => {
    op(92
    /* GetComponentLayout */
    , $s0);
    op(95
    /* PopulateLayout */
    , $s0);
  });
  op(35
  /* Load */
  , $s0);
}
export function WithSavedRegister(op, register, block) {
  op(36
  /* Fetch */
  , register);
  block();
  op(35
  /* Load */
  , register);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL29wY29kZS1jb21waWxlci9saWIvb3Bjb2RlLWJ1aWxkZXIvaGVscGVycy9jb21wb25lbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVlBLFNBQVMsYUFBVCxRQUE4QixrQkFBOUI7QUFDQSxTQUFTLEdBQVQsRUFBYyxHQUFkLEVBQW1CLEdBQW5CLFFBQTZDLGFBQTdDO0FBQ0EsU0FBUyxrQkFBVCxRQUFtQyxlQUFuQztBQUVBLFNBQVMsV0FBVCxRQUE0QixhQUE1QjtBQUNBLFNBQVMsWUFBVCxFQUF1QixhQUF2QixFQUFzQyxrQkFBdEMsRUFBMEQsWUFBMUQsUUFBOEUsYUFBOUU7QUFDQSxTQUFTLGlCQUFULEVBQTRCLGtCQUE1QixFQUFnRCxVQUFoRCxRQUFrRSxVQUFsRTtBQUNBLFNBQVMsVUFBVCxRQUEyQixlQUEzQjtBQUNBLFNBQVMsSUFBVCxRQUFxQixRQUFyQjtBQUNBLFNBQVMsV0FBVCxFQUFzQixpQkFBdEIsUUFBK0MsVUFBL0M7QUFFQSxPQUFPLE1BQU0sV0FBVyxHQUFHLFFBQXBCO0FBbUNQLE9BQU0sU0FBVSxlQUFWLENBQ0osRUFESSxFQUVKLFNBRkksRUFHSixhQUhJLEVBSUosVUFKSSxFQUtKLEtBTEksRUFNSixPQU5JLEVBTTJCO0FBRS9CLE1BQUk7QUFBRSxJQUFBLFVBQUY7QUFBYyxJQUFBLFlBQWQ7QUFBNEIsSUFBQTtBQUE1QixNQUF1QyxTQUEzQztBQUVBLE1BQUksWUFBWSxHQUFHLGFBQWEsR0FDM0IsQ0FBQyxhQUFELEVBQWdCLEVBQWhCLENBRDJCLEdBRTVCLElBRko7QUFHQSxNQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsT0FBTixDQUFjLE9BQWQsS0FBMEIsT0FBTyxLQUFLLElBQXRDLEdBQTZDLFdBQVcsQ0FBQyxPQUFELENBQXhELEdBQW9FLE9BQWpGOztBQUVBLE1BQUksVUFBSixFQUFnQjtBQUNkLElBQUEsRUFBRSxDQUFBO0FBQUE7QUFB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QTtBQUFBLEdBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNEO0FBRUQsT0FBTSxTQUFVLG1CQUFWLENBQThCLEVBQTlCLEVBQWlEO0FBQ3JELEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFXLEdBQVgsQ0FBRjtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFTLEdBQVQsRUFBYyxDQUFkLENBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBVSxHQUFWLENBQUY7QUFFQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQWlCLEdBQWpCLENBQUY7QUFDQSxFQUFBLHVCQUF1QixDQUFDLEVBQUQsRUFBSyxLQUFMLEVBQVksS0FBWixFQUFtQixJQUFuQixFQUF5QixNQUFLO0FBQ25ELElBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxNQUF3QixHQUF4QixDQUFGO0FBQ0EsSUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLE1BQW9CLEdBQXBCLENBQUY7QUFDRCxHQUhzQixDQUF2QjtBQUlBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFVLEdBQVYsQ0FBRjtBQUNEO0FBRUQsT0FBTSxTQUFVLGlCQUFWLENBQ0osRUFESSxFQUVKLFFBRkksRUFHSixLQUhJLEVBR2E7QUFFakIsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQVcsUUFBWCxDQUFGO0FBQ0EsRUFBQSxLQUFLO0FBQ0wsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQVUsUUFBVixDQUFGO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21waWxhYmxlUHJvZ3JhbSxcbiAgQ29tcGlsZVRpbWVDb21wb25lbnQsXG4gIEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUsXG4gIExheW91dFdpdGhDb250ZXh0LFxuICBNYWNoaW5lT3AsXG4gIE5hbWVkQmxvY2tzLFxuICBXaXJlRm9ybWF0LFxuICBPcHRpb24sXG4gIE9wLFxuICBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHksXG59IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgaGFzQ2FwYWJpbGl0eSB9IGZyb20gJ0BnbGltbWVyL21hbmFnZXInO1xuaW1wb3J0IHsgJHMwLCAkczEsICRzcCwgU2F2ZWRSZWdpc3RlciB9IGZyb20gJ0BnbGltbWVyL3ZtJztcbmltcG9ydCB7IEVNUFRZX1NUUklOR19BUlJBWSB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgUHVzaEV4cHJlc3Npb25PcCwgUHVzaFN0YXRlbWVudE9wIH0gZnJvbSAnLi4vLi4vc3ludGF4L2NvbXBpbGVycyc7XG5pbXBvcnQgeyBuYW1lZEJsb2NrcyB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7IGxhYmVsT3BlcmFuZCwgbGF5b3V0T3BlcmFuZCwgc3ltYm9sVGFibGVPcGVyYW5kLCBpc1N0cmljdE1vZGUgfSBmcm9tICcuLi9vcGVyYW5kcyc7XG5pbXBvcnQgeyBJbnZva2VTdGF0aWNCbG9jaywgUHVzaFlpZWxkYWJsZUJsb2NrLCBZaWVsZEJsb2NrIH0gZnJvbSAnLi9ibG9ja3MnO1xuaW1wb3J0IHsgUmVwbGF5YWJsZSB9IGZyb20gJy4vY29uZGl0aW9uYWwnO1xuaW1wb3J0IHsgZXhwciB9IGZyb20gJy4vZXhwcic7XG5pbXBvcnQgeyBDb21waWxlQXJncywgQ29tcGlsZVBvc2l0aW9uYWwgfSBmcm9tICcuL3NoYXJlZCc7XG5cbmV4cG9ydCBjb25zdCBBVFRSU19CTE9DSyA9ICcmYXR0cnMnO1xuXG5pbnRlcmZhY2UgQW55Q29tcG9uZW50IHtcbiAgZWxlbWVudEJsb2NrOiBPcHRpb248V2lyZUZvcm1hdC5TZXJpYWxpemVkSW5saW5lQmxvY2s+O1xuICBwb3NpdGlvbmFsOiBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zO1xuICBuYW1lZDogV2lyZUZvcm1hdC5Db3JlLkhhc2g7XG4gIGJsb2NrczogTmFtZWRCbG9ja3M7XG59XG5cbi8vIHt7Y29tcG9uZW50fX1cbmV4cG9ydCBpbnRlcmZhY2UgRHluYW1pY0NvbXBvbmVudCBleHRlbmRzIEFueUNvbXBvbmVudCB7XG4gIGRlZmluaXRpb246IFdpcmVGb3JtYXQuRXhwcmVzc2lvbjtcbiAgYXROYW1lczogYm9vbGVhbjtcbiAgY3VycmllZDogYm9vbGVhbjtcbn1cblxuLy8gPENvbXBvbmVudD5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGljQ29tcG9uZW50IGV4dGVuZHMgQW55Q29tcG9uZW50IHtcbiAgY2FwYWJpbGl0aWVzOiBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHk7XG4gIGxheW91dDogQ29tcGlsYWJsZVByb2dyYW07XG59XG5cbi8vIGNob2tlcG9pbnRcbmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50IGV4dGVuZHMgQW55Q29tcG9uZW50IHtcbiAgLy8gZWl0aGVyIHdlIGtub3cgdGhlIGNhcGFiaWxpdGllcyBzdGF0aWNhbGx5IG9yIHdlIG5lZWQgdG8gYmUgY29uc2VydmF0aXZlIGFuZCBhc3N1bWVcbiAgLy8gdGhhdCB0aGUgY29tcG9uZW50IHJlcXVpcmVzIGFsbCBjYXBhYmlsaXRpZXNcbiAgY2FwYWJpbGl0aWVzOiBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkgfCB0cnVlO1xuXG4gIC8vIGFyZSB0aGUgYXJndW1lbnRzIHN1cHBsaWVkIGFzIGF0TmFtZXM/XG4gIGF0TmFtZXM6IGJvb2xlYW47XG5cbiAgLy8gZG8gd2UgaGF2ZSB0aGUgbGF5b3V0IHN0YXRpY2FsbHkgb3Igd2lsbCB3ZSBuZWVkIHRvIGxvb2sgaXQgdXAgYXQgcnVudGltZT9cbiAgbGF5b3V0PzogQ29tcGlsYWJsZVByb2dyYW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBJbnZva2VDb21wb25lbnQoXG4gIG9wOiBQdXNoU3RhdGVtZW50T3AsXG4gIGNvbXBvbmVudDogQ29tcGlsZVRpbWVDb21wb25lbnQsXG4gIF9lbGVtZW50QmxvY2s6IFdpcmVGb3JtYXQuQ29yZS5FbGVtZW50UGFyYW1ldGVycyxcbiAgcG9zaXRpb25hbDogV2lyZUZvcm1hdC5Db3JlLlBhcmFtcyxcbiAgbmFtZWQ6IFdpcmVGb3JtYXQuQ29yZS5IYXNoLFxuICBfYmxvY2tzOiBXaXJlRm9ybWF0LkNvcmUuQmxvY2tzXG4pOiB2b2lkIHtcbiAgbGV0IHsgY29tcGlsYWJsZSwgY2FwYWJpbGl0aWVzLCBoYW5kbGUgfSA9IGNvbXBvbmVudDtcblxuICBsZXQgZWxlbWVudEJsb2NrID0gX2VsZW1lbnRCbG9ja1xuICAgID8gKFtfZWxlbWVudEJsb2NrLCBbXV0gYXMgV2lyZUZvcm1hdC5TZXJpYWxpemVkSW5saW5lQmxvY2spXG4gICAgOiBudWxsO1xuICBsZXQgYmxvY2tzID0gQXJyYXkuaXNBcnJheShfYmxvY2tzKSB8fCBfYmxvY2tzID09PSBudWxsID8gbmFtZWRCbG9ja3MoX2Jsb2NrcykgOiBfYmxvY2tzO1xuXG4gIGlmIChjb21waWxhYmxlKSB7XG4gICAgb3AoT3AuUHVzaENvbXBvbmVudERlZmluaXRpb24sIGhhbmRsZSk7XG4gICAgSW52b2tlU3RhdGljQ29tcG9uZW50KG9wLCB7XG4gICAgICBjYXBhYmlsaXRpZXM6IGNhcGFiaWxpdGllcyxcbiAgICAgIGxheW91dDogY29tcGlsYWJsZSxcbiAgICAgIGVsZW1lbnRCbG9jayxcbiAgICAgIHBvc2l0aW9uYWwsXG4gICAgICBuYW1lZCxcbiAgICAgIGJsb2NrcyxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBvcChPcC5QdXNoQ29tcG9uZW50RGVmaW5pdGlvbiwgaGFuZGxlKTtcbiAgICBJbnZva2VOb25TdGF0aWNDb21wb25lbnQob3AsIHtcbiAgICAgIGNhcGFiaWxpdGllczogY2FwYWJpbGl0aWVzLFxuICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgICAgYXROYW1lczogdHJ1ZSxcbiAgICAgIGJsb2NrcyxcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gSW52b2tlRHluYW1pY0NvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgZGVmaW5pdGlvbjogV2lyZUZvcm1hdC5Db3JlLkV4cHJlc3Npb24sXG4gIF9lbGVtZW50QmxvY2s6IFdpcmVGb3JtYXQuQ29yZS5FbGVtZW50UGFyYW1ldGVycyxcbiAgcG9zaXRpb25hbDogV2lyZUZvcm1hdC5Db3JlLlBhcmFtcyxcbiAgbmFtZWQ6IFdpcmVGb3JtYXQuQ29yZS5IYXNoLFxuICBfYmxvY2tzOiBXaXJlRm9ybWF0LkNvcmUuQmxvY2tzLFxuICBhdE5hbWVzOiBib29sZWFuLFxuICBjdXJyaWVkOiBib29sZWFuXG4pOiB2b2lkIHtcbiAgbGV0IGVsZW1lbnRCbG9jayA9IF9lbGVtZW50QmxvY2tcbiAgICA/IChbX2VsZW1lbnRCbG9jaywgW11dIGFzIFdpcmVGb3JtYXQuU2VyaWFsaXplZElubGluZUJsb2NrKVxuICAgIDogbnVsbDtcbiAgbGV0IGJsb2NrcyA9IEFycmF5LmlzQXJyYXkoX2Jsb2NrcykgfHwgX2Jsb2NrcyA9PT0gbnVsbCA/IG5hbWVkQmxvY2tzKF9ibG9ja3MpIDogX2Jsb2NrcztcblxuICBSZXBsYXlhYmxlKFxuICAgIG9wLFxuXG4gICAgKCkgPT4ge1xuICAgICAgZXhwcihvcCwgZGVmaW5pdGlvbik7XG4gICAgICBvcChPcC5EdXAsICRzcCwgMCk7XG4gICAgICByZXR1cm4gMjtcbiAgICB9LFxuXG4gICAgKCkgPT4ge1xuICAgICAgb3AoT3AuSnVtcFVubGVzcywgbGFiZWxPcGVyYW5kKCdFTFNFJykpO1xuXG4gICAgICBpZiAoY3VycmllZCkge1xuICAgICAgICBvcChPcC5SZXNvbHZlQ3VycmllZENvbXBvbmVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcChPcC5SZXNvbHZlRHluYW1pY0NvbXBvbmVudCwgaXNTdHJpY3RNb2RlKCkpO1xuICAgICAgfVxuXG4gICAgICBvcChPcC5QdXNoRHluYW1pY0NvbXBvbmVudEluc3RhbmNlKTtcbiAgICAgIEludm9rZU5vblN0YXRpY0NvbXBvbmVudChvcCwge1xuICAgICAgICBjYXBhYmlsaXRpZXM6IHRydWUsXG4gICAgICAgIGVsZW1lbnRCbG9jayxcbiAgICAgICAgcG9zaXRpb25hbCxcbiAgICAgICAgbmFtZWQsXG4gICAgICAgIGF0TmFtZXMsXG4gICAgICAgIGJsb2NrcyxcbiAgICAgIH0pO1xuICAgICAgb3AoSGlnaExldmVsQnVpbGRlck9wY29kZS5MYWJlbCwgJ0VMU0UnKTtcbiAgICB9XG4gICk7XG59XG5cbmZ1bmN0aW9uIEludm9rZVN0YXRpY0NvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgeyBjYXBhYmlsaXRpZXMsIGxheW91dCwgZWxlbWVudEJsb2NrLCBwb3NpdGlvbmFsLCBuYW1lZCwgYmxvY2tzIH06IFN0YXRpY0NvbXBvbmVudFxuKTogdm9pZCB7XG4gIGxldCB7IHN5bWJvbFRhYmxlIH0gPSBsYXlvdXQ7XG5cbiAgbGV0IGJhaWxPdXQgPVxuICAgIHN5bWJvbFRhYmxlLmhhc0V2YWwgfHwgaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5QcmVwYXJlQXJncyk7XG5cbiAgaWYgKGJhaWxPdXQpIHtcbiAgICBJbnZva2VOb25TdGF0aWNDb21wb25lbnQob3AsIHtcbiAgICAgIGNhcGFiaWxpdGllcyxcbiAgICAgIGVsZW1lbnRCbG9jayxcbiAgICAgIHBvc2l0aW9uYWwsXG4gICAgICBuYW1lZCxcbiAgICAgIGF0TmFtZXM6IHRydWUsXG4gICAgICBibG9ja3MsXG4gICAgICBsYXlvdXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBvcChPcC5GZXRjaCwgJHMwKTtcbiAgb3AoT3AuRHVwLCAkc3AsIDEpO1xuICBvcChPcC5Mb2FkLCAkczApO1xuICBvcChNYWNoaW5lT3AuUHVzaEZyYW1lKTtcblxuICAvLyBTZXR1cCBhcmd1bWVudHNcbiAgbGV0IHsgc3ltYm9scyB9ID0gc3ltYm9sVGFibGU7XG5cbiAgLy8gQXMgd2UgcHVzaCB2YWx1ZXMgb250byB0aGUgc3RhY2ssIHdlIHN0b3JlIHRoZSBzeW1ib2xzIGFzc29jaWF0ZWQgIHdpdGggdGhlbVxuICAvLyBzbyB0aGF0IHdlIGNhbiBzZXQgdGhlbSBvbiB0aGUgc2NvcGUgbGF0ZXIgb24gd2l0aCBTZXRWYXJpYWJsZSBhbmQgU2V0QmxvY2tcbiAgbGV0IGJsb2NrU3ltYm9sczogbnVtYmVyW10gPSBbXTtcbiAgbGV0IGFyZ1N5bWJvbHM6IG51bWJlcltdID0gW107XG4gIGxldCBhcmdOYW1lczogc3RyaW5nW10gPSBbXTtcblxuICAvLyBGaXJzdCB3ZSBwdXNoIHRoZSBibG9ja3Mgb250byB0aGUgc3RhY2tcbiAgbGV0IGJsb2NrTmFtZXMgPSBibG9ja3MubmFtZXM7XG5cbiAgLy8gU3RhcnRpbmcgd2l0aCB0aGUgYXR0cnMgYmxvY2ssIGlmIGl0IGV4aXN0cyBhbmQgaXMgcmVmZXJlbmNlZCBpbiB0aGUgY29tcG9uZW50XG4gIGlmIChlbGVtZW50QmxvY2sgIT09IG51bGwpIHtcbiAgICBsZXQgc3ltYm9sID0gc3ltYm9scy5pbmRleE9mKEFUVFJTX0JMT0NLKTtcblxuICAgIGlmIChzeW1ib2wgIT09IC0xKSB7XG4gICAgICBQdXNoWWllbGRhYmxlQmxvY2sob3AsIGVsZW1lbnRCbG9jayk7XG4gICAgICBibG9ja1N5bWJvbHMucHVzaChzeW1ib2wpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZvbGxvd2VkIGJ5IHRoZSBvdGhlciBibG9ja3MsIGlmIHRoZXkgZXhpc3QgYW5kIGFyZSByZWZlcmVuY2VkIGluIHRoZSBjb21wb25lbnQuXG4gIC8vIEFsc28gc3RvcmUgdGhlIGluZGV4IG9mIHRoZSBhc3NvY2lhdGVkIHN5bWJvbC5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja05hbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IG5hbWUgPSBibG9ja05hbWVzW2ldO1xuICAgIGxldCBzeW1ib2wgPSBzeW1ib2xzLmluZGV4T2YoYCYke25hbWV9YCk7XG5cbiAgICBpZiAoc3ltYm9sICE9PSAtMSkge1xuICAgICAgUHVzaFlpZWxkYWJsZUJsb2NrKG9wLCBibG9ja3MuZ2V0KG5hbWUpKTtcbiAgICAgIGJsb2NrU3ltYm9scy5wdXNoKHN5bWJvbCk7XG4gICAgfVxuICB9XG5cbiAgLy8gTmV4dCB1cCB3ZSBoYXZlIGFyZ3VtZW50cy4gSWYgdGhlIGNvbXBvbmVudCBoYXMgdGhlIGBjcmVhdGVBcmdzYCBjYXBhYmlsaXR5LFxuICAvLyB0aGVuIGl0IHdhbnRzIGFjY2VzcyB0byB0aGUgYXJndW1lbnRzIGluIEphdmFTY3JpcHQuIFdlIGNhbid0IGtub3cgd2hldGhlclxuICAvLyBvciBub3QgYW4gYXJndW1lbnQgaXMgdXNlZCwgc28gd2UgaGF2ZSB0byBnaXZlIGFjY2VzcyB0byBhbGwgb2YgdGhlbS5cbiAgaWYgKGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuQ3JlYXRlQXJncykpIHtcbiAgICAvLyBGaXJzdCB3ZSBwdXNoIHBvc2l0aW9uYWwgYXJndW1lbnRzXG4gICAgbGV0IGNvdW50ID0gQ29tcGlsZVBvc2l0aW9uYWwob3AsIHBvc2l0aW9uYWwpO1xuXG4gICAgLy8gc2V0dXAgdGhlIGZsYWdzIHdpdGggdGhlIGNvdW50IG9mIHBvc2l0aW9uYWxzLCBhbmQgdG8gaW5kaWNhdGUgdGhhdCBhdE5hbWVzXG4gICAgLy8gYXJlIHVzZWRcbiAgICBsZXQgZmxhZ3MgPSBjb3VudCA8PCA0O1xuICAgIGZsYWdzIHw9IDBiMTAwMDtcblxuICAgIGxldCBuYW1lczogc3RyaW5nW10gPSBFTVBUWV9TVFJJTkdfQVJSQVkgYXMgc3RyaW5nW107XG5cbiAgICAvLyBOZXh0LCBpZiBuYW1lZCBhcmdzIGV4aXN0LCBwdXNoIHRoZW0gYWxsLiBJZiB0aGV5IGhhdmUgYW4gYXNzb2NpYXRlZCBzeW1ib2xcbiAgICAvLyBpbiB0aGUgaW52b2tlZCBjb21wb25lbnQgKGUuZy4gdGhleSBhcmUgdXNlZCB3aXRoaW4gaXRzIHRlbXBsYXRlKSwgd2UgcHVzaFxuICAgIC8vIHRoYXQgc3ltYm9sLiBJZiBub3QsIHdlIHN0aWxsIHB1c2ggdGhlIGV4cHJlc3Npb24gYXMgaXQgbWF5IGJlIHVzZWQsIGFuZFxuICAgIC8vIHdlIHN0b3JlIHRoZSBzeW1ib2wgYXMgLTEgKHRoaXMgaXMgdXNlZCBsYXRlcikuXG4gICAgaWYgKG5hbWVkICE9PSBudWxsKSB7XG4gICAgICBuYW1lcyA9IG5hbWVkWzBdO1xuICAgICAgbGV0IHZhbCA9IG5hbWVkWzFdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbC5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgc3ltYm9sID0gc3ltYm9scy5pbmRleE9mKG5hbWVzW2ldKTtcblxuICAgICAgICBleHByKG9wLCB2YWxbaV0pO1xuICAgICAgICBhcmdTeW1ib2xzLnB1c2goc3ltYm9sKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaW5hbGx5LCBwdXNoIHRoZSBWTSBhcmd1bWVudHMgdGhlbXNlbHZlcy4gVGhlc2UgYXJncyB3b24ndCBuZWVkIGFjY2Vzc1xuICAgIC8vIHRvIGJsb2NrcyAodGhleSBhcmVuJ3QgYWNjZXNzaWJsZSBmcm9tIHVzZXJsYW5kIGFueXdheXMpLCBzbyB3ZSBwdXNoIGFuXG4gICAgLy8gZW1wdHkgYXJyYXkgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIGJsb2NrIG5hbWVzLlxuICAgIG9wKE9wLlB1c2hBcmdzLCBuYW1lcywgRU1QVFlfU1RSSU5HX0FSUkFZLCBmbGFncyk7XG5cbiAgICAvLyBBbmQgcHVzaCBhbiBleHRyYSBwb3Agb3BlcmF0aW9uIHRvIHJlbW92ZSB0aGUgYXJncyBiZWZvcmUgd2UgYmVnaW4gc2V0dGluZ1xuICAgIC8vIHZhcmlhYmxlcyBvbiB0aGUgbG9jYWwgY29udGV4dFxuICAgIGFyZ1N5bWJvbHMucHVzaCgtMSk7XG4gIH0gZWxzZSBpZiAobmFtZWQgIT09IG51bGwpIHtcbiAgICAvLyBJZiB0aGUgY29tcG9uZW50IGRvZXMgbm90IGhhdmUgdGhlIGBjcmVhdGVBcmdzYCBjYXBhYmlsaXR5LCB0aGVuIHRoZSBvbmx5XG4gICAgLy8gZXhwcmVzc2lvbnMgd2UgbmVlZCB0byBwdXNoIG9udG8gdGhlIHN0YWNrIGFyZSB0aG9zZSB0aGF0IGFyZSBhY3R1YWxseVxuICAgIC8vIHJlZmVyZW5jZWQgaW4gdGhlIHRlbXBsYXRlIG9mIHRoZSBpbnZva2VkIGNvbXBvbmVudCAoZS5nLiBoYXZlIHN5bWJvbHMpLlxuICAgIGxldCBuYW1lcyA9IG5hbWVkWzBdO1xuICAgIGxldCB2YWwgPSBuYW1lZFsxXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgbmFtZSA9IG5hbWVzW2ldO1xuICAgICAgbGV0IHN5bWJvbCA9IHN5bWJvbHMuaW5kZXhPZihuYW1lKTtcblxuICAgICAgaWYgKHN5bWJvbCAhPT0gLTEpIHtcbiAgICAgICAgZXhwcihvcCwgdmFsW2ldKTtcbiAgICAgICAgYXJnU3ltYm9scy5wdXNoKHN5bWJvbCk7XG4gICAgICAgIGFyZ05hbWVzLnB1c2gobmFtZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb3AoT3AuQmVnaW5Db21wb25lbnRUcmFuc2FjdGlvbiwgJHMwKTtcblxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5EeW5hbWljU2NvcGUpKSB7XG4gICAgb3AoT3AuUHVzaER5bmFtaWNTY29wZSk7XG4gIH1cblxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5DcmVhdGVJbnN0YW5jZSkpIHtcbiAgICBvcChPcC5DcmVhdGVDb21wb25lbnQsIChibG9ja3MuaGFzKCdkZWZhdWx0JykgYXMgYW55KSB8IDAsICRzMCk7XG4gIH1cblxuICBvcChPcC5SZWdpc3RlckNvbXBvbmVudERlc3RydWN0b3IsICRzMCk7XG5cbiAgaWYgKGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuQ3JlYXRlQXJncykpIHtcbiAgICBvcChPcC5HZXRDb21wb25lbnRTZWxmLCAkczApO1xuICB9IGVsc2Uge1xuICAgIG9wKE9wLkdldENvbXBvbmVudFNlbGYsICRzMCwgYXJnTmFtZXMpO1xuICB9XG5cbiAgLy8gU2V0dXAgdGhlIG5ldyByb290IHNjb3BlIGZvciB0aGUgY29tcG9uZW50XG4gIG9wKE9wLlJvb3RTY29wZSwgc3ltYm9scy5sZW5ndGggKyAxLCBPYmplY3Qua2V5cyhibG9ja3MpLmxlbmd0aCA+IDAgPyAxIDogMCk7XG5cbiAgLy8gUG9wIHRoZSBzZWxmIHJlZmVyZW5jZSBvZmYgdGhlIHN0YWNrIGFuZCBzZXQgaXQgdG8gdGhlIHN5bWJvbCBmb3IgYHRoaXNgXG4gIC8vIGluIHRoZSBuZXcgc2NvcGUuIFRoaXMgaXMgd2h5IGFsbCBzdWJzZXF1ZW50IHN5bWJvbHMgYXJlIGluY3JlYXNlZCBieSBvbmUuXG4gIG9wKE9wLlNldFZhcmlhYmxlLCAwKTtcblxuICAvLyBHb2luZyBpbiByZXZlcnNlLCBub3cgd2UgcG9wIHRoZSBhcmdzL2Jsb2NrcyBvZmYgdGhlIHN0YWNrLCBzdGFydGluZyB3aXRoXG4gIC8vIGFyZ3VtZW50cywgYW5kIGFzc2lnbiB0aGVtIHRvIHRoZWlyIHN5bWJvbHMgaW4gdGhlIG5ldyBzY29wZS5cbiAgZm9yIChsZXQgaSA9IGFyZ1N5bWJvbHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBsZXQgc3ltYm9sID0gYXJnU3ltYm9sc1tpXTtcblxuICAgIGlmIChzeW1ib2wgPT09IC0xKSB7XG4gICAgICAvLyBUaGUgZXhwcmVzc2lvbiB3YXMgbm90IGJvdW5kIHRvIGEgbG9jYWwgc3ltYm9sLCBpdCB3YXMgb25seSBwdXNoZWQgdG8gYmVcbiAgICAgIC8vIHVzZWQgd2l0aCBWTSBhcmdzIGluIHRoZSBqYXZhc2NyaXB0IHNpZGVcbiAgICAgIG9wKE9wLlBvcCwgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wKE9wLlNldFZhcmlhYmxlLCBzeW1ib2wgKyAxKTtcbiAgICB9XG4gIH1cblxuICAvLyBpZiBhbnkgcG9zaXRpb25hbCBwYXJhbXMgZXhpc3QsIHBvcCB0aGVtIG9mZiB0aGUgc3RhY2sgYXMgd2VsbFxuICBpZiAocG9zaXRpb25hbCAhPT0gbnVsbCkge1xuICAgIG9wKE9wLlBvcCwgcG9zaXRpb25hbC5sZW5ndGgpO1xuICB9XG5cbiAgLy8gRmluaXNoIHVwIGJ5IHBvcHBpbmcgb2ZmIGFuZCBhc3NpZ25pbmcgYmxvY2tzXG4gIGZvciAobGV0IGkgPSBibG9ja1N5bWJvbHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBsZXQgc3ltYm9sID0gYmxvY2tTeW1ib2xzW2ldO1xuXG4gICAgb3AoT3AuU2V0QmxvY2ssIHN5bWJvbCArIDEpO1xuICB9XG5cbiAgb3AoT3AuQ29uc3RhbnQsIGxheW91dE9wZXJhbmQobGF5b3V0KSk7XG4gIG9wKE9wLkNvbXBpbGVCbG9jayk7XG4gIG9wKE1hY2hpbmVPcC5JbnZva2VWaXJ0dWFsKTtcbiAgb3AoT3AuRGlkUmVuZGVyTGF5b3V0LCAkczApO1xuXG4gIG9wKE1hY2hpbmVPcC5Qb3BGcmFtZSk7XG4gIG9wKE9wLlBvcFNjb3BlKTtcblxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5EeW5hbWljU2NvcGUpKSB7XG4gICAgb3AoT3AuUG9wRHluYW1pY1Njb3BlKTtcbiAgfVxuXG4gIG9wKE9wLkNvbW1pdENvbXBvbmVudFRyYW5zYWN0aW9uKTtcbiAgb3AoT3AuTG9hZCwgJHMwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEludm9rZU5vblN0YXRpY0NvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgeyBjYXBhYmlsaXRpZXMsIGVsZW1lbnRCbG9jaywgcG9zaXRpb25hbCwgbmFtZWQsIGF0TmFtZXMsIGJsb2NrczogbmFtZWRCbG9ja3MsIGxheW91dCB9OiBDb21wb25lbnRcbik6IHZvaWQge1xuICBsZXQgYmluZGFibGVCbG9ja3MgPSAhIW5hbWVkQmxvY2tzO1xuICBsZXQgYmluZGFibGVBdE5hbWVzID1cbiAgICBjYXBhYmlsaXRpZXMgPT09IHRydWUgfHxcbiAgICBoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LlByZXBhcmVBcmdzKSB8fFxuICAgICEhKG5hbWVkICYmIG5hbWVkWzBdLmxlbmd0aCAhPT0gMCk7XG5cbiAgbGV0IGJsb2NrcyA9IG5hbWVkQmxvY2tzLndpdGgoJ2F0dHJzJywgZWxlbWVudEJsb2NrKTtcblxuICBvcChPcC5GZXRjaCwgJHMwKTtcbiAgb3AoT3AuRHVwLCAkc3AsIDEpO1xuICBvcChPcC5Mb2FkLCAkczApO1xuXG4gIG9wKE1hY2hpbmVPcC5QdXNoRnJhbWUpO1xuICBDb21waWxlQXJncyhvcCwgcG9zaXRpb25hbCwgbmFtZWQsIGJsb2NrcywgYXROYW1lcyk7XG4gIG9wKE9wLlByZXBhcmVBcmdzLCAkczApO1xuXG4gIGludm9rZVByZXBhcmVkQ29tcG9uZW50KG9wLCBibG9ja3MuaGFzKCdkZWZhdWx0JyksIGJpbmRhYmxlQmxvY2tzLCBiaW5kYWJsZUF0TmFtZXMsICgpID0+IHtcbiAgICBpZiAobGF5b3V0KSB7XG4gICAgICBvcChPcC5QdXNoU3ltYm9sVGFibGUsIHN5bWJvbFRhYmxlT3BlcmFuZChsYXlvdXQuc3ltYm9sVGFibGUpKTtcbiAgICAgIG9wKE9wLkNvbnN0YW50LCBsYXlvdXRPcGVyYW5kKGxheW91dCkpO1xuICAgICAgb3AoT3AuQ29tcGlsZUJsb2NrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3AoT3AuR2V0Q29tcG9uZW50TGF5b3V0LCAkczApO1xuICAgIH1cblxuICAgIG9wKE9wLlBvcHVsYXRlTGF5b3V0LCAkczApO1xuICB9KTtcblxuICBvcChPcC5Mb2FkLCAkczApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gV3JhcHBlZENvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgbGF5b3V0OiBMYXlvdXRXaXRoQ29udGV4dCxcbiAgYXR0cnNCbG9ja051bWJlcjogbnVtYmVyXG4pOiB2b2lkIHtcbiAgb3AoSGlnaExldmVsQnVpbGRlck9wY29kZS5TdGFydExhYmVscyk7XG4gIFdpdGhTYXZlZFJlZ2lzdGVyKG9wLCAkczEsICgpID0+IHtcbiAgICBvcChPcC5HZXRDb21wb25lbnRUYWdOYW1lLCAkczApO1xuICAgIG9wKE9wLlByaW1pdGl2ZVJlZmVyZW5jZSk7XG4gICAgb3AoT3AuRHVwLCAkc3AsIDApO1xuICB9KTtcbiAgb3AoT3AuSnVtcFVubGVzcywgbGFiZWxPcGVyYW5kKCdCT0RZJykpO1xuICBvcChPcC5GZXRjaCwgJHMxKTtcbiAgb3AoT3AuUHV0Q29tcG9uZW50T3BlcmF0aW9ucyk7XG4gIG9wKE9wLk9wZW5EeW5hbWljRWxlbWVudCk7XG4gIG9wKE9wLkRpZENyZWF0ZUVsZW1lbnQsICRzMCk7XG4gIFlpZWxkQmxvY2sob3AsIGF0dHJzQmxvY2tOdW1iZXIsIG51bGwpO1xuICBvcChPcC5GbHVzaEVsZW1lbnQpO1xuICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLkxhYmVsLCAnQk9EWScpO1xuICBJbnZva2VTdGF0aWNCbG9jayhvcCwgW2xheW91dC5ibG9ja1swXSwgW11dKTtcbiAgb3AoT3AuRmV0Y2gsICRzMSk7XG4gIG9wKE9wLkp1bXBVbmxlc3MsIGxhYmVsT3BlcmFuZCgnRU5EJykpO1xuICBvcChPcC5DbG9zZUVsZW1lbnQpO1xuICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLkxhYmVsLCAnRU5EJyk7XG4gIG9wKE9wLkxvYWQsICRzMSk7XG4gIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuU3RvcExhYmVscyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnZva2VQcmVwYXJlZENvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgaGFzQmxvY2s6IGJvb2xlYW4sXG4gIGJpbmRhYmxlQmxvY2tzOiBib29sZWFuLFxuICBiaW5kYWJsZUF0TmFtZXM6IGJvb2xlYW4sXG4gIHBvcHVsYXRlTGF5b3V0OiBPcHRpb248KCkgPT4gdm9pZD4gPSBudWxsXG4pOiB2b2lkIHtcbiAgb3AoT3AuQmVnaW5Db21wb25lbnRUcmFuc2FjdGlvbiwgJHMwKTtcbiAgb3AoT3AuUHVzaER5bmFtaWNTY29wZSk7XG5cbiAgb3AoT3AuQ3JlYXRlQ29tcG9uZW50LCAoaGFzQmxvY2sgYXMgYW55KSB8IDAsICRzMCk7XG5cbiAgLy8gdGhpcyBoYXMgdG8gcnVuIGFmdGVyIGNyZWF0ZUNvbXBvbmVudCB0byBhbGxvd1xuICAvLyBmb3IgbGF0ZS1ib3VuZCBsYXlvdXRzLCBidXQgYSBjYWxsZXIgaXMgZnJlZVxuICAvLyB0byBwb3B1bGF0ZSB0aGUgbGF5b3V0IGVhcmxpZXIgaWYgaXQgd2FudHMgdG9cbiAgLy8gYW5kIGRvIG5vdGhpbmcgaGVyZS5cbiAgaWYgKHBvcHVsYXRlTGF5b3V0KSB7XG4gICAgcG9wdWxhdGVMYXlvdXQoKTtcbiAgfVxuXG4gIG9wKE9wLlJlZ2lzdGVyQ29tcG9uZW50RGVzdHJ1Y3RvciwgJHMwKTtcbiAgb3AoT3AuR2V0Q29tcG9uZW50U2VsZiwgJHMwKTtcblxuICBvcChPcC5WaXJ0dWFsUm9vdFNjb3BlLCAkczApO1xuICBvcChPcC5TZXRWYXJpYWJsZSwgMCk7XG4gIG9wKE9wLlNldHVwRm9yRXZhbCwgJHMwKTtcblxuICBpZiAoYmluZGFibGVBdE5hbWVzKSBvcChPcC5TZXROYW1lZFZhcmlhYmxlcywgJHMwKTtcbiAgaWYgKGJpbmRhYmxlQmxvY2tzKSBvcChPcC5TZXRCbG9ja3MsICRzMCk7XG5cbiAgb3AoT3AuUG9wLCAxKTtcbiAgb3AoT3AuSW52b2tlQ29tcG9uZW50TGF5b3V0LCAkczApO1xuICBvcChPcC5EaWRSZW5kZXJMYXlvdXQsICRzMCk7XG4gIG9wKE1hY2hpbmVPcC5Qb3BGcmFtZSk7XG5cbiAgb3AoT3AuUG9wU2NvcGUpO1xuICBvcChPcC5Qb3BEeW5hbWljU2NvcGUpO1xuICBvcChPcC5Db21taXRDb21wb25lbnRUcmFuc2FjdGlvbik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBJbnZva2VCYXJlQ29tcG9uZW50KG9wOiBQdXNoU3RhdGVtZW50T3ApOiB2b2lkIHtcbiAgb3AoT3AuRmV0Y2gsICRzMCk7XG4gIG9wKE9wLkR1cCwgJHNwLCAxKTtcbiAgb3AoT3AuTG9hZCwgJHMwKTtcblxuICBvcChNYWNoaW5lT3AuUHVzaEZyYW1lKTtcbiAgb3AoT3AuUHVzaEVtcHR5QXJncyk7XG4gIG9wKE9wLlByZXBhcmVBcmdzLCAkczApO1xuICBpbnZva2VQcmVwYXJlZENvbXBvbmVudChvcCwgZmFsc2UsIGZhbHNlLCB0cnVlLCAoKSA9PiB7XG4gICAgb3AoT3AuR2V0Q29tcG9uZW50TGF5b3V0LCAkczApO1xuICAgIG9wKE9wLlBvcHVsYXRlTGF5b3V0LCAkczApO1xuICB9KTtcbiAgb3AoT3AuTG9hZCwgJHMwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFdpdGhTYXZlZFJlZ2lzdGVyKFxuICBvcDogUHVzaEV4cHJlc3Npb25PcCxcbiAgcmVnaXN0ZXI6IFNhdmVkUmVnaXN0ZXIsXG4gIGJsb2NrOiAoKSA9PiB2b2lkXG4pOiB2b2lkIHtcbiAgb3AoT3AuRmV0Y2gsIHJlZ2lzdGVyKTtcbiAgYmxvY2soKTtcbiAgb3AoT3AuTG9hZCwgcmVnaXN0ZXIpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==