import { hasCapability } from '@glimmer/manager';
import { $s0, $s1, $sp } from '@glimmer/vm';
import { EMPTY_STRING_ARRAY } from '@glimmer/util';
import { namedBlocks } from '../../utils';
import { labelOperand, layoutOperand, symbolTableOperand, isStrictMode } from '../operands';
import { InvokeStaticBlock, PushYieldableBlock, YieldBlock } from './blocks';
import { Replayable } from './conditional';
import { expr } from './expr';
import { CompileArgs, CompilePositional } from './shared';
export var ATTRS_BLOCK = '&attrs';
export function InvokeComponent(op, component, _elementBlock, positional, named, _blocks) {
  var compilable = component.compilable,
      capabilities = component.capabilities,
      handle = component.handle;
  var elementBlock = _elementBlock ? [_elementBlock, []] : null;
  var blocks = Array.isArray(_blocks) || _blocks === null ? namedBlocks(_blocks) : _blocks;

  if (compilable) {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeStaticComponent(op, {
      capabilities: capabilities,
      layout: compilable,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      blocks: blocks
    });
  } else {
    op(78
    /* PushComponentDefinition */
    , handle);
    InvokeNonStaticComponent(op, {
      capabilities: capabilities,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      atNames: true,
      blocks: blocks
    });
  }
}
export function InvokeDynamicComponent(op, definition, _elementBlock, positional, named, _blocks, atNames, curried) {
  var elementBlock = _elementBlock ? [_elementBlock, []] : null;
  var blocks = Array.isArray(_blocks) || _blocks === null ? namedBlocks(_blocks) : _blocks;
  Replayable(op, function () {
    expr(op, definition);
    op(33
    /* Dup */
    , $sp, 0);
    return 2;
  }, function () {
    op(66
    /* JumpUnless */
    , labelOperand('ELSE'));

    if (curried) {
      op(81
      /* ResolveCurriedComponent */
      );
    } else {
      op(80
      /* ResolveDynamicComponent */
      , isStrictMode());
    }

    op(79
    /* PushDynamicComponentInstance */
    );
    InvokeNonStaticComponent(op, {
      capabilities: true,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      atNames: atNames,
      blocks: blocks
    });
    op(1000
    /* Label */
    , 'ELSE');
  });
}

function InvokeStaticComponent(op, _ref) {
  var capabilities = _ref.capabilities,
      layout = _ref.layout,
      elementBlock = _ref.elementBlock,
      positional = _ref.positional,
      named = _ref.named,
      blocks = _ref.blocks;
  var symbolTable = layout.symbolTable;
  var bailOut = symbolTable.hasEval || hasCapability(capabilities, 4
  /* PrepareArgs */
  );

  if (bailOut) {
    InvokeNonStaticComponent(op, {
      capabilities: capabilities,
      elementBlock: elementBlock,
      positional: positional,
      named: named,
      atNames: true,
      blocks: blocks,
      layout: layout
    });
    return;
  }

  op(36
  /* Fetch */
  , $s0);
  op(33
  /* Dup */
  , $sp, 1);
  op(35
  /* Load */
  , $s0);
  op(0
  /* PushFrame */
  ); // Setup arguments

  var symbols = symbolTable.symbols; // As we push values onto the stack, we store the symbols associated  with them
  // so that we can set them on the scope later on with SetVariable and SetBlock

  var blockSymbols = [];
  var argSymbols = [];
  var argNames = []; // First we push the blocks onto the stack

  var blockNames = blocks.names; // Starting with the attrs block, if it exists and is referenced in the component

  if (elementBlock !== null) {
    var symbol = symbols.indexOf(ATTRS_BLOCK);

    if (symbol !== -1) {
      PushYieldableBlock(op, elementBlock);
      blockSymbols.push(symbol);
    }
  } // Followed by the other blocks, if they exist and are referenced in the component.
  // Also store the index of the associated symbol.


  for (var i = 0; i < blockNames.length; i++) {
    var name = blockNames[i];

    var _symbol = symbols.indexOf("&" + name);

    if (_symbol !== -1) {
      PushYieldableBlock(op, blocks.get(name));
      blockSymbols.push(_symbol);
    }
  } // Next up we have arguments. If the component has the `createArgs` capability,
  // then it wants access to the arguments in JavaScript. We can't know whether
  // or not an argument is used, so we have to give access to all of them.


  if (hasCapability(capabilities, 8
  /* CreateArgs */
  )) {
    // First we push positional arguments
    var count = CompilePositional(op, positional); // setup the flags with the count of positionals, and to indicate that atNames
    // are used

    var flags = count << 4;
    flags |= 8;
    var names = EMPTY_STRING_ARRAY; // Next, if named args exist, push them all. If they have an associated symbol
    // in the invoked component (e.g. they are used within its template), we push
    // that symbol. If not, we still push the expression as it may be used, and
    // we store the symbol as -1 (this is used later).

    if (named !== null) {
      names = named[0];
      var val = named[1];

      for (var _i = 0; _i < val.length; _i++) {
        var _symbol2 = symbols.indexOf(names[_i]);

        expr(op, val[_i]);
        argSymbols.push(_symbol2);
      }
    } // Finally, push the VM arguments themselves. These args won't need access
    // to blocks (they aren't accessible from userland anyways), so we push an
    // empty array instead of the actual block names.


    op(82
    /* PushArgs */
    , names, EMPTY_STRING_ARRAY, flags); // And push an extra pop operation to remove the args before we begin setting
    // variables on the local context

    argSymbols.push(-1);
  } else if (named !== null) {
    // If the component does not have the `createArgs` capability, then the only
    // expressions we need to push onto the stack are those that are actually
    // referenced in the template of the invoked component (e.g. have symbols).
    var _names = named[0];
    var _val = named[1];

    for (var _i2 = 0; _i2 < _val.length; _i2++) {
      var _name = _names[_i2];

      var _symbol3 = symbols.indexOf(_name);

      if (_symbol3 !== -1) {
        expr(op, _val[_i2]);
        argSymbols.push(_symbol3);
        argNames.push(_name);
      }
    }
  }

  op(97
  /* BeginComponentTransaction */
  , $s0);

  if (hasCapability(capabilities, 64
  /* DynamicScope */
  )) {
    op(59
    /* PushDynamicScope */
    );
  }

  if (hasCapability(capabilities, 512
  /* CreateInstance */
  )) {
    op(87
    /* CreateComponent */
    , blocks.has('default') | 0, $s0);
  }

  op(88
  /* RegisterComponentDestructor */
  , $s0);

  if (hasCapability(capabilities, 8
  /* CreateArgs */
  )) {
    op(90
    /* GetComponentSelf */
    , $s0);
  } else {
    op(90
    /* GetComponentSelf */
    , $s0, argNames);
  } // Setup the new root scope for the component


  op(37
  /* RootScope */
  , symbols.length + 1, Object.keys(blocks).length > 0 ? 1 : 0); // Pop the self reference off the stack and set it to the symbol for `this`
  // in the new scope. This is why all subsequent symbols are increased by one.

  op(19
  /* SetVariable */
  , 0); // Going in reverse, now we pop the args/blocks off the stack, starting with
  // arguments, and assign them to their symbols in the new scope.

  for (var _i3 = argSymbols.length - 1; _i3 >= 0; _i3--) {
    var _symbol4 = argSymbols[_i3];

    if (_symbol4 === -1) {
      // The expression was not bound to a local symbol, it was only pushed to be
      // used with VM args in the javascript side
      op(34
      /* Pop */
      , 1);
    } else {
      op(19
      /* SetVariable */
      , _symbol4 + 1);
    }
  } // if any positional params exist, pop them off the stack as well


  if (positional !== null) {
    op(34
    /* Pop */
    , positional.length);
  } // Finish up by popping off and assigning blocks


  for (var _i4 = blockSymbols.length - 1; _i4 >= 0; _i4--) {
    var _symbol5 = blockSymbols[_i4];
    op(20
    /* SetBlock */
    , _symbol5 + 1);
  }

  op(28
  /* Constant */
  , layoutOperand(layout));
  op(61
  /* CompileBlock */
  );
  op(2
  /* InvokeVirtual */
  );
  op(100
  /* DidRenderLayout */
  , $s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );

  if (hasCapability(capabilities, 64
  /* DynamicScope */
  )) {
    op(60
    /* PopDynamicScope */
    );
  }

  op(98
  /* CommitComponentTransaction */
  );
  op(35
  /* Load */
  , $s0);
}

export function InvokeNonStaticComponent(op, _ref2) {
  var capabilities = _ref2.capabilities,
      elementBlock = _ref2.elementBlock,
      positional = _ref2.positional,
      named = _ref2.named,
      atNames = _ref2.atNames,
      namedBlocks = _ref2.blocks,
      layout = _ref2.layout;
  var bindableBlocks = !!namedBlocks;
  var bindableAtNames = capabilities === true || hasCapability(capabilities, 4
  /* PrepareArgs */
  ) || !!(named && named[0].length !== 0);
  var blocks = namedBlocks["with"]('attrs', elementBlock);
  op(36
  /* Fetch */
  , $s0);
  op(33
  /* Dup */
  , $sp, 1);
  op(35
  /* Load */
  , $s0);
  op(0
  /* PushFrame */
  );
  CompileArgs(op, positional, named, blocks, atNames);
  op(85
  /* PrepareArgs */
  , $s0);
  invokePreparedComponent(op, blocks.has('default'), bindableBlocks, bindableAtNames, function () {
    if (layout) {
      op(63
      /* PushSymbolTable */
      , symbolTableOperand(layout.symbolTable));
      op(28
      /* Constant */
      , layoutOperand(layout));
      op(61
      /* CompileBlock */
      );
    } else {
      op(92
      /* GetComponentLayout */
      , $s0);
    }

    op(95
    /* PopulateLayout */
    , $s0);
  });
  op(35
  /* Load */
  , $s0);
}
export function WrappedComponent(op, layout, attrsBlockNumber) {
  op(1001
  /* StartLabels */
  );
  WithSavedRegister(op, $s1, function () {
    op(91
    /* GetComponentTagName */
    , $s0);
    op(31
    /* PrimitiveReference */
    );
    op(33
    /* Dup */
    , $sp, 0);
  });
  op(66
  /* JumpUnless */
  , labelOperand('BODY'));
  op(36
  /* Fetch */
  , $s1);
  op(89
  /* PutComponentOperations */
  );
  op(49
  /* OpenDynamicElement */
  );
  op(99
  /* DidCreateElement */
  , $s0);
  YieldBlock(op, attrsBlockNumber, null);
  op(54
  /* FlushElement */
  );
  op(1000
  /* Label */
  , 'BODY');
  InvokeStaticBlock(op, [layout.block[0], []]);
  op(36
  /* Fetch */
  , $s1);
  op(66
  /* JumpUnless */
  , labelOperand('END'));
  op(55
  /* CloseElement */
  );
  op(1000
  /* Label */
  , 'END');
  op(35
  /* Load */
  , $s1);
  op(1002
  /* StopLabels */
  );
}
export function invokePreparedComponent(op, hasBlock, bindableBlocks, bindableAtNames, populateLayout) {
  if (populateLayout === void 0) {
    populateLayout = null;
  }

  op(97
  /* BeginComponentTransaction */
  , $s0);
  op(59
  /* PushDynamicScope */
  );
  op(87
  /* CreateComponent */
  , hasBlock | 0, $s0); // this has to run after createComponent to allow
  // for late-bound layouts, but a caller is free
  // to populate the layout earlier if it wants to
  // and do nothing here.

  if (populateLayout) {
    populateLayout();
  }

  op(88
  /* RegisterComponentDestructor */
  , $s0);
  op(90
  /* GetComponentSelf */
  , $s0);
  op(38
  /* VirtualRootScope */
  , $s0);
  op(19
  /* SetVariable */
  , 0);
  op(94
  /* SetupForEval */
  , $s0);
  if (bindableAtNames) op(17
  /* SetNamedVariables */
  , $s0);
  if (bindableBlocks) op(18
  /* SetBlocks */
  , $s0);
  op(34
  /* Pop */
  , 1);
  op(96
  /* InvokeComponentLayout */
  , $s0);
  op(100
  /* DidRenderLayout */
  , $s0);
  op(1
  /* PopFrame */
  );
  op(40
  /* PopScope */
  );
  op(60
  /* PopDynamicScope */
  );
  op(98
  /* CommitComponentTransaction */
  );
}
export function InvokeBareComponent(op) {
  op(36
  /* Fetch */
  , $s0);
  op(33
  /* Dup */
  , $sp, 1);
  op(35
  /* Load */
  , $s0);
  op(0
  /* PushFrame */
  );
  op(83
  /* PushEmptyArgs */
  );
  op(85
  /* PrepareArgs */
  , $s0);
  invokePreparedComponent(op, false, false, true, function () {
    op(92
    /* GetComponentLayout */
    , $s0);
    op(95
    /* PopulateLayout */
    , $s0);
  });
  op(35
  /* Load */
  , $s0);
}
export function WithSavedRegister(op, register, block) {
  op(36
  /* Fetch */
  , register);
  block();
  op(35
  /* Load */
  , register);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL29wY29kZS1jb21waWxlci9saWIvb3Bjb2RlLWJ1aWxkZXIvaGVscGVycy9jb21wb25lbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVlBLFNBQUEsYUFBQSxRQUFBLGtCQUFBO0FBQ0EsU0FBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsUUFBQSxhQUFBO0FBQ0EsU0FBQSxrQkFBQSxRQUFBLGVBQUE7QUFFQSxTQUFBLFdBQUEsUUFBQSxhQUFBO0FBQ0EsU0FBQSxZQUFBLEVBQUEsYUFBQSxFQUFBLGtCQUFBLEVBQUEsWUFBQSxRQUFBLGFBQUE7QUFDQSxTQUFBLGlCQUFBLEVBQUEsa0JBQUEsRUFBQSxVQUFBLFFBQUEsVUFBQTtBQUNBLFNBQUEsVUFBQSxRQUFBLGVBQUE7QUFDQSxTQUFBLElBQUEsUUFBQSxRQUFBO0FBQ0EsU0FBQSxXQUFBLEVBQUEsaUJBQUEsUUFBQSxVQUFBO0FBRUEsT0FBTyxJQUFNLFdBQVcsR0FBakIsUUFBQTtBQW1DUCxPQUFNLFNBQUEsZUFBQSxDQUFBLEVBQUEsRUFBQSxTQUFBLEVBQUEsYUFBQSxFQUFBLFVBQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQU0yQjtBQUFBLE1BRTNCLFVBRjJCLEdBRS9CLFNBRitCLENBRTNCLFVBRjJCO0FBQUEsTUFFM0IsWUFGMkIsR0FFL0IsU0FGK0IsQ0FFM0IsWUFGMkI7QUFBQSxNQUVDLE1BRkQsR0FFL0IsU0FGK0IsQ0FFQyxNQUZEO0FBSS9CLE1BQUksWUFBWSxHQUFHLGFBQWEsR0FDM0IsQ0FBQSxhQUFBLEVBRDJCLEVBQzNCLENBRDJCLEdBQWhDLElBQUE7QUFHQSxNQUFJLE1BQU0sR0FBRyxLQUFLLENBQUwsT0FBQSxDQUFBLE9BQUEsS0FBMEIsT0FBTyxLQUFqQyxJQUFBLEdBQTZDLFdBQVcsQ0FBeEQsT0FBd0QsQ0FBeEQsR0FBYixPQUFBOztBQUVBLE1BQUEsVUFBQSxFQUFnQjtBQUNkLElBQUEs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QSxNQUFBLGVBQUEsRUFBcUIsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLEdBQUUsQ0FBRjtBQUNyQixNQUFBLGNBQUEsRUFBb0IsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLEdBQUUsQ0FBRjtBQUVwQixFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixDQUFFLENBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixHQUFFLENBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixHQUFFLENBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUVBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxHQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLEdBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNEO0FBRUQsT0FBTSxTQUFBLG1CQUFBLENBQUEsRUFBQSxFQUFpRDtBQUNyRCxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixHQUFFLENBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBQSxHQUFBLEVBQUYsQ0FBRSxDQUFGO0FBQ0EsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQUYsR0FBRSxDQUFGO0FBRUEsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLEdBQUY7QUFDQSxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsR0FBRjtBQUNBLEVBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxJQUFGLEdBQUUsQ0FBRjtBQUNBLEVBQUEsdUJBQXVCLENBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxLQUFBLEVBQUEsSUFBQSxFQUF5QixZQUFLO0FBQ25ELElBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxNQUFGLEdBQUUsQ0FBRjtBQUNBLElBQUEsRUFBRSxDQUFBO0FBQUE7QUFBQSxNQUFGLEdBQUUsQ0FBRjtBQUZGLEdBQXVCLENBQXZCO0FBSUEsRUFBQSxFQUFFLENBQUE7QUFBQTtBQUFBLElBQUYsR0FBRSxDQUFGO0FBQ0Q7QUFFRCxPQUFNLFNBQUEsaUJBQUEsQ0FBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLEtBQUEsRUFHYTtBQUVqQixFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixRQUFFLENBQUY7QUFDQSxFQUFBLEtBQUs7QUFDTCxFQUFBLEVBQUUsQ0FBQTtBQUFBO0FBQUEsSUFBRixRQUFFLENBQUY7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBpbGFibGVQcm9ncmFtLFxuICBDb21waWxlVGltZUNvbXBvbmVudCxcbiAgSGlnaExldmVsQnVpbGRlck9wY29kZSxcbiAgTGF5b3V0V2l0aENvbnRleHQsXG4gIE1hY2hpbmVPcCxcbiAgTmFtZWRCbG9ja3MsXG4gIFdpcmVGb3JtYXQsXG4gIE9wdGlvbixcbiAgT3AsXG4gIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eSxcbn0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBoYXNDYXBhYmlsaXR5IH0gZnJvbSAnQGdsaW1tZXIvbWFuYWdlcic7XG5pbXBvcnQgeyAkczAsICRzMSwgJHNwLCBTYXZlZFJlZ2lzdGVyIH0gZnJvbSAnQGdsaW1tZXIvdm0nO1xuaW1wb3J0IHsgRU1QVFlfU1RSSU5HX0FSUkFZIH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBQdXNoRXhwcmVzc2lvbk9wLCBQdXNoU3RhdGVtZW50T3AgfSBmcm9tICcuLi8uLi9zeW50YXgvY29tcGlsZXJzJztcbmltcG9ydCB7IG5hbWVkQmxvY2tzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgbGFiZWxPcGVyYW5kLCBsYXlvdXRPcGVyYW5kLCBzeW1ib2xUYWJsZU9wZXJhbmQsIGlzU3RyaWN0TW9kZSB9IGZyb20gJy4uL29wZXJhbmRzJztcbmltcG9ydCB7IEludm9rZVN0YXRpY0Jsb2NrLCBQdXNoWWllbGRhYmxlQmxvY2ssIFlpZWxkQmxvY2sgfSBmcm9tICcuL2Jsb2Nrcyc7XG5pbXBvcnQgeyBSZXBsYXlhYmxlIH0gZnJvbSAnLi9jb25kaXRpb25hbCc7XG5pbXBvcnQgeyBleHByIH0gZnJvbSAnLi9leHByJztcbmltcG9ydCB7IENvbXBpbGVBcmdzLCBDb21waWxlUG9zaXRpb25hbCB9IGZyb20gJy4vc2hhcmVkJztcblxuZXhwb3J0IGNvbnN0IEFUVFJTX0JMT0NLID0gJyZhdHRycyc7XG5cbmludGVyZmFjZSBBbnlDb21wb25lbnQge1xuICBlbGVtZW50QmxvY2s6IE9wdGlvbjxXaXJlRm9ybWF0LlNlcmlhbGl6ZWRJbmxpbmVCbG9jaz47XG4gIHBvc2l0aW9uYWw6IFdpcmVGb3JtYXQuQ29yZS5QYXJhbXM7XG4gIG5hbWVkOiBXaXJlRm9ybWF0LkNvcmUuSGFzaDtcbiAgYmxvY2tzOiBOYW1lZEJsb2Nrcztcbn1cblxuLy8ge3tjb21wb25lbnR9fVxuZXhwb3J0IGludGVyZmFjZSBEeW5hbWljQ29tcG9uZW50IGV4dGVuZHMgQW55Q29tcG9uZW50IHtcbiAgZGVmaW5pdGlvbjogV2lyZUZvcm1hdC5FeHByZXNzaW9uO1xuICBhdE5hbWVzOiBib29sZWFuO1xuICBjdXJyaWVkOiBib29sZWFuO1xufVxuXG4vLyA8Q29tcG9uZW50PlxuZXhwb3J0IGludGVyZmFjZSBTdGF0aWNDb21wb25lbnQgZXh0ZW5kcyBBbnlDb21wb25lbnQge1xuICBjYXBhYmlsaXRpZXM6IEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eTtcbiAgbGF5b3V0OiBDb21waWxhYmxlUHJvZ3JhbTtcbn1cblxuLy8gY2hva2Vwb2ludFxuZXhwb3J0IGludGVyZmFjZSBDb21wb25lbnQgZXh0ZW5kcyBBbnlDb21wb25lbnQge1xuICAvLyBlaXRoZXIgd2Uga25vdyB0aGUgY2FwYWJpbGl0aWVzIHN0YXRpY2FsbHkgb3Igd2UgbmVlZCB0byBiZSBjb25zZXJ2YXRpdmUgYW5kIGFzc3VtZVxuICAvLyB0aGF0IHRoZSBjb21wb25lbnQgcmVxdWlyZXMgYWxsIGNhcGFiaWxpdGllc1xuICBjYXBhYmlsaXRpZXM6IEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eSB8IHRydWU7XG5cbiAgLy8gYXJlIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQgYXMgYXROYW1lcz9cbiAgYXROYW1lczogYm9vbGVhbjtcblxuICAvLyBkbyB3ZSBoYXZlIHRoZSBsYXlvdXQgc3RhdGljYWxseSBvciB3aWxsIHdlIG5lZWQgdG8gbG9vayBpdCB1cCBhdCBydW50aW1lP1xuICBsYXlvdXQ/OiBDb21waWxhYmxlUHJvZ3JhbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEludm9rZUNvbXBvbmVudChcbiAgb3A6IFB1c2hTdGF0ZW1lbnRPcCxcbiAgY29tcG9uZW50OiBDb21waWxlVGltZUNvbXBvbmVudCxcbiAgX2VsZW1lbnRCbG9jazogV2lyZUZvcm1hdC5Db3JlLkVsZW1lbnRQYXJhbWV0ZXJzLFxuICBwb3NpdGlvbmFsOiBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zLFxuICBuYW1lZDogV2lyZUZvcm1hdC5Db3JlLkhhc2gsXG4gIF9ibG9ja3M6IFdpcmVGb3JtYXQuQ29yZS5CbG9ja3Ncbik6IHZvaWQge1xuICBsZXQgeyBjb21waWxhYmxlLCBjYXBhYmlsaXRpZXMsIGhhbmRsZSB9ID0gY29tcG9uZW50O1xuXG4gIGxldCBlbGVtZW50QmxvY2sgPSBfZWxlbWVudEJsb2NrXG4gICAgPyAoW19lbGVtZW50QmxvY2ssIFtdXSBhcyBXaXJlRm9ybWF0LlNlcmlhbGl6ZWRJbmxpbmVCbG9jaylcbiAgICA6IG51bGw7XG4gIGxldCBibG9ja3MgPSBBcnJheS5pc0FycmF5KF9ibG9ja3MpIHx8IF9ibG9ja3MgPT09IG51bGwgPyBuYW1lZEJsb2NrcyhfYmxvY2tzKSA6IF9ibG9ja3M7XG5cbiAgaWYgKGNvbXBpbGFibGUpIHtcbiAgICBvcChPcC5QdXNoQ29tcG9uZW50RGVmaW5pdGlvbiwgaGFuZGxlKTtcbiAgICBJbnZva2VTdGF0aWNDb21wb25lbnQob3AsIHtcbiAgICAgIGNhcGFiaWxpdGllczogY2FwYWJpbGl0aWVzLFxuICAgICAgbGF5b3V0OiBjb21waWxhYmxlLFxuICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgICAgYmxvY2tzLFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIG9wKE9wLlB1c2hDb21wb25lbnREZWZpbml0aW9uLCBoYW5kbGUpO1xuICAgIEludm9rZU5vblN0YXRpY0NvbXBvbmVudChvcCwge1xuICAgICAgY2FwYWJpbGl0aWVzOiBjYXBhYmlsaXRpZXMsXG4gICAgICBlbGVtZW50QmxvY2ssXG4gICAgICBwb3NpdGlvbmFsLFxuICAgICAgbmFtZWQsXG4gICAgICBhdE5hbWVzOiB0cnVlLFxuICAgICAgYmxvY2tzLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBJbnZva2VEeW5hbWljQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBkZWZpbml0aW9uOiBXaXJlRm9ybWF0LkNvcmUuRXhwcmVzc2lvbixcbiAgX2VsZW1lbnRCbG9jazogV2lyZUZvcm1hdC5Db3JlLkVsZW1lbnRQYXJhbWV0ZXJzLFxuICBwb3NpdGlvbmFsOiBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zLFxuICBuYW1lZDogV2lyZUZvcm1hdC5Db3JlLkhhc2gsXG4gIF9ibG9ja3M6IFdpcmVGb3JtYXQuQ29yZS5CbG9ja3MsXG4gIGF0TmFtZXM6IGJvb2xlYW4sXG4gIGN1cnJpZWQ6IGJvb2xlYW5cbik6IHZvaWQge1xuICBsZXQgZWxlbWVudEJsb2NrID0gX2VsZW1lbnRCbG9ja1xuICAgID8gKFtfZWxlbWVudEJsb2NrLCBbXV0gYXMgV2lyZUZvcm1hdC5TZXJpYWxpemVkSW5saW5lQmxvY2spXG4gICAgOiBudWxsO1xuICBsZXQgYmxvY2tzID0gQXJyYXkuaXNBcnJheShfYmxvY2tzKSB8fCBfYmxvY2tzID09PSBudWxsID8gbmFtZWRCbG9ja3MoX2Jsb2NrcykgOiBfYmxvY2tzO1xuXG4gIFJlcGxheWFibGUoXG4gICAgb3AsXG5cbiAgICAoKSA9PiB7XG4gICAgICBleHByKG9wLCBkZWZpbml0aW9uKTtcbiAgICAgIG9wKE9wLkR1cCwgJHNwLCAwKTtcbiAgICAgIHJldHVybiAyO1xuICAgIH0sXG5cbiAgICAoKSA9PiB7XG4gICAgICBvcChPcC5KdW1wVW5sZXNzLCBsYWJlbE9wZXJhbmQoJ0VMU0UnKSk7XG5cbiAgICAgIGlmIChjdXJyaWVkKSB7XG4gICAgICAgIG9wKE9wLlJlc29sdmVDdXJyaWVkQ29tcG9uZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wKE9wLlJlc29sdmVEeW5hbWljQ29tcG9uZW50LCBpc1N0cmljdE1vZGUoKSk7XG4gICAgICB9XG5cbiAgICAgIG9wKE9wLlB1c2hEeW5hbWljQ29tcG9uZW50SW5zdGFuY2UpO1xuICAgICAgSW52b2tlTm9uU3RhdGljQ29tcG9uZW50KG9wLCB7XG4gICAgICAgIGNhcGFiaWxpdGllczogdHJ1ZSxcbiAgICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgICBwb3NpdGlvbmFsLFxuICAgICAgICBuYW1lZCxcbiAgICAgICAgYXROYW1lcyxcbiAgICAgICAgYmxvY2tzLFxuICAgICAgfSk7XG4gICAgICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLkxhYmVsLCAnRUxTRScpO1xuICAgIH1cbiAgKTtcbn1cblxuZnVuY3Rpb24gSW52b2tlU3RhdGljQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICB7IGNhcGFiaWxpdGllcywgbGF5b3V0LCBlbGVtZW50QmxvY2ssIHBvc2l0aW9uYWwsIG5hbWVkLCBibG9ja3MgfTogU3RhdGljQ29tcG9uZW50XG4pOiB2b2lkIHtcbiAgbGV0IHsgc3ltYm9sVGFibGUgfSA9IGxheW91dDtcblxuICBsZXQgYmFpbE91dCA9XG4gICAgc3ltYm9sVGFibGUuaGFzRXZhbCB8fCBoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LlByZXBhcmVBcmdzKTtcblxuICBpZiAoYmFpbE91dCkge1xuICAgIEludm9rZU5vblN0YXRpY0NvbXBvbmVudChvcCwge1xuICAgICAgY2FwYWJpbGl0aWVzLFxuICAgICAgZWxlbWVudEJsb2NrLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgICAgYXROYW1lczogdHJ1ZSxcbiAgICAgIGJsb2NrcyxcbiAgICAgIGxheW91dCxcbiAgICB9KTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIG9wKE9wLkZldGNoLCAkczApO1xuICBvcChPcC5EdXAsICRzcCwgMSk7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG4gIG9wKE1hY2hpbmVPcC5QdXNoRnJhbWUpO1xuXG4gIC8vIFNldHVwIGFyZ3VtZW50c1xuICBsZXQgeyBzeW1ib2xzIH0gPSBzeW1ib2xUYWJsZTtcblxuICAvLyBBcyB3ZSBwdXNoIHZhbHVlcyBvbnRvIHRoZSBzdGFjaywgd2Ugc3RvcmUgdGhlIHN5bWJvbHMgYXNzb2NpYXRlZCAgd2l0aCB0aGVtXG4gIC8vIHNvIHRoYXQgd2UgY2FuIHNldCB0aGVtIG9uIHRoZSBzY29wZSBsYXRlciBvbiB3aXRoIFNldFZhcmlhYmxlIGFuZCBTZXRCbG9ja1xuICBsZXQgYmxvY2tTeW1ib2xzOiBudW1iZXJbXSA9IFtdO1xuICBsZXQgYXJnU3ltYm9sczogbnVtYmVyW10gPSBbXTtcbiAgbGV0IGFyZ05hbWVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8vIEZpcnN0IHdlIHB1c2ggdGhlIGJsb2NrcyBvbnRvIHRoZSBzdGFja1xuICBsZXQgYmxvY2tOYW1lcyA9IGJsb2Nrcy5uYW1lcztcblxuICAvLyBTdGFydGluZyB3aXRoIHRoZSBhdHRycyBibG9jaywgaWYgaXQgZXhpc3RzIGFuZCBpcyByZWZlcmVuY2VkIGluIHRoZSBjb21wb25lbnRcbiAgaWYgKGVsZW1lbnRCbG9jayAhPT0gbnVsbCkge1xuICAgIGxldCBzeW1ib2wgPSBzeW1ib2xzLmluZGV4T2YoQVRUUlNfQkxPQ0spO1xuXG4gICAgaWYgKHN5bWJvbCAhPT0gLTEpIHtcbiAgICAgIFB1c2hZaWVsZGFibGVCbG9jayhvcCwgZWxlbWVudEJsb2NrKTtcbiAgICAgIGJsb2NrU3ltYm9scy5wdXNoKHN5bWJvbCk7XG4gICAgfVxuICB9XG5cbiAgLy8gRm9sbG93ZWQgYnkgdGhlIG90aGVyIGJsb2NrcywgaWYgdGhleSBleGlzdCBhbmQgYXJlIHJlZmVyZW5jZWQgaW4gdGhlIGNvbXBvbmVudC5cbiAgLy8gQWxzbyBzdG9yZSB0aGUgaW5kZXggb2YgdGhlIGFzc29jaWF0ZWQgc3ltYm9sLlxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrTmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgbmFtZSA9IGJsb2NrTmFtZXNbaV07XG4gICAgbGV0IHN5bWJvbCA9IHN5bWJvbHMuaW5kZXhPZihgJiR7bmFtZX1gKTtcblxuICAgIGlmIChzeW1ib2wgIT09IC0xKSB7XG4gICAgICBQdXNoWWllbGRhYmxlQmxvY2sob3AsIGJsb2Nrcy5nZXQobmFtZSkpO1xuICAgICAgYmxvY2tTeW1ib2xzLnB1c2goc3ltYm9sKTtcbiAgICB9XG4gIH1cblxuICAvLyBOZXh0IHVwIHdlIGhhdmUgYXJndW1lbnRzLiBJZiB0aGUgY29tcG9uZW50IGhhcyB0aGUgYGNyZWF0ZUFyZ3NgIGNhcGFiaWxpdHksXG4gIC8vIHRoZW4gaXQgd2FudHMgYWNjZXNzIHRvIHRoZSBhcmd1bWVudHMgaW4gSmF2YVNjcmlwdC4gV2UgY2FuJ3Qga25vdyB3aGV0aGVyXG4gIC8vIG9yIG5vdCBhbiBhcmd1bWVudCBpcyB1c2VkLCBzbyB3ZSBoYXZlIHRvIGdpdmUgYWNjZXNzIHRvIGFsbCBvZiB0aGVtLlxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5DcmVhdGVBcmdzKSkge1xuICAgIC8vIEZpcnN0IHdlIHB1c2ggcG9zaXRpb25hbCBhcmd1bWVudHNcbiAgICBsZXQgY291bnQgPSBDb21waWxlUG9zaXRpb25hbChvcCwgcG9zaXRpb25hbCk7XG5cbiAgICAvLyBzZXR1cCB0aGUgZmxhZ3Mgd2l0aCB0aGUgY291bnQgb2YgcG9zaXRpb25hbHMsIGFuZCB0byBpbmRpY2F0ZSB0aGF0IGF0TmFtZXNcbiAgICAvLyBhcmUgdXNlZFxuICAgIGxldCBmbGFncyA9IGNvdW50IDw8IDQ7XG4gICAgZmxhZ3MgfD0gMGIxMDAwO1xuXG4gICAgbGV0IG5hbWVzOiBzdHJpbmdbXSA9IEVNUFRZX1NUUklOR19BUlJBWSBhcyBzdHJpbmdbXTtcblxuICAgIC8vIE5leHQsIGlmIG5hbWVkIGFyZ3MgZXhpc3QsIHB1c2ggdGhlbSBhbGwuIElmIHRoZXkgaGF2ZSBhbiBhc3NvY2lhdGVkIHN5bWJvbFxuICAgIC8vIGluIHRoZSBpbnZva2VkIGNvbXBvbmVudCAoZS5nLiB0aGV5IGFyZSB1c2VkIHdpdGhpbiBpdHMgdGVtcGxhdGUpLCB3ZSBwdXNoXG4gICAgLy8gdGhhdCBzeW1ib2wuIElmIG5vdCwgd2Ugc3RpbGwgcHVzaCB0aGUgZXhwcmVzc2lvbiBhcyBpdCBtYXkgYmUgdXNlZCwgYW5kXG4gICAgLy8gd2Ugc3RvcmUgdGhlIHN5bWJvbCBhcyAtMSAodGhpcyBpcyB1c2VkIGxhdGVyKS5cbiAgICBpZiAobmFtZWQgIT09IG51bGwpIHtcbiAgICAgIG5hbWVzID0gbmFtZWRbMF07XG4gICAgICBsZXQgdmFsID0gbmFtZWRbMV07XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBzeW1ib2wgPSBzeW1ib2xzLmluZGV4T2YobmFtZXNbaV0pO1xuXG4gICAgICAgIGV4cHIob3AsIHZhbFtpXSk7XG4gICAgICAgIGFyZ1N5bWJvbHMucHVzaChzeW1ib2wpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZpbmFsbHksIHB1c2ggdGhlIFZNIGFyZ3VtZW50cyB0aGVtc2VsdmVzLiBUaGVzZSBhcmdzIHdvbid0IG5lZWQgYWNjZXNzXG4gICAgLy8gdG8gYmxvY2tzICh0aGV5IGFyZW4ndCBhY2Nlc3NpYmxlIGZyb20gdXNlcmxhbmQgYW55d2F5cyksIHNvIHdlIHB1c2ggYW5cbiAgICAvLyBlbXB0eSBhcnJheSBpbnN0ZWFkIG9mIHRoZSBhY3R1YWwgYmxvY2sgbmFtZXMuXG4gICAgb3AoT3AuUHVzaEFyZ3MsIG5hbWVzLCBFTVBUWV9TVFJJTkdfQVJSQVksIGZsYWdzKTtcblxuICAgIC8vIEFuZCBwdXNoIGFuIGV4dHJhIHBvcCBvcGVyYXRpb24gdG8gcmVtb3ZlIHRoZSBhcmdzIGJlZm9yZSB3ZSBiZWdpbiBzZXR0aW5nXG4gICAgLy8gdmFyaWFibGVzIG9uIHRoZSBsb2NhbCBjb250ZXh0XG4gICAgYXJnU3ltYm9scy5wdXNoKC0xKTtcbiAgfSBlbHNlIGlmIChuYW1lZCAhPT0gbnVsbCkge1xuICAgIC8vIElmIHRoZSBjb21wb25lbnQgZG9lcyBub3QgaGF2ZSB0aGUgYGNyZWF0ZUFyZ3NgIGNhcGFiaWxpdHksIHRoZW4gdGhlIG9ubHlcbiAgICAvLyBleHByZXNzaW9ucyB3ZSBuZWVkIHRvIHB1c2ggb250byB0aGUgc3RhY2sgYXJlIHRob3NlIHRoYXQgYXJlIGFjdHVhbGx5XG4gICAgLy8gcmVmZXJlbmNlZCBpbiB0aGUgdGVtcGxhdGUgb2YgdGhlIGludm9rZWQgY29tcG9uZW50IChlLmcuIGhhdmUgc3ltYm9scykuXG4gICAgbGV0IG5hbWVzID0gbmFtZWRbMF07XG4gICAgbGV0IHZhbCA9IG5hbWVkWzFdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWwubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBuYW1lID0gbmFtZXNbaV07XG4gICAgICBsZXQgc3ltYm9sID0gc3ltYm9scy5pbmRleE9mKG5hbWUpO1xuXG4gICAgICBpZiAoc3ltYm9sICE9PSAtMSkge1xuICAgICAgICBleHByKG9wLCB2YWxbaV0pO1xuICAgICAgICBhcmdTeW1ib2xzLnB1c2goc3ltYm9sKTtcbiAgICAgICAgYXJnTmFtZXMucHVzaChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvcChPcC5CZWdpbkNvbXBvbmVudFRyYW5zYWN0aW9uLCAkczApO1xuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkR5bmFtaWNTY29wZSkpIHtcbiAgICBvcChPcC5QdXNoRHluYW1pY1Njb3BlKTtcbiAgfVxuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkNyZWF0ZUluc3RhbmNlKSkge1xuICAgIG9wKE9wLkNyZWF0ZUNvbXBvbmVudCwgKGJsb2Nrcy5oYXMoJ2RlZmF1bHQnKSBhcyBhbnkpIHwgMCwgJHMwKTtcbiAgfVxuXG4gIG9wKE9wLlJlZ2lzdGVyQ29tcG9uZW50RGVzdHJ1Y3RvciwgJHMwKTtcblxuICBpZiAoaGFzQ2FwYWJpbGl0eShjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5DcmVhdGVBcmdzKSkge1xuICAgIG9wKE9wLkdldENvbXBvbmVudFNlbGYsICRzMCk7XG4gIH0gZWxzZSB7XG4gICAgb3AoT3AuR2V0Q29tcG9uZW50U2VsZiwgJHMwLCBhcmdOYW1lcyk7XG4gIH1cblxuICAvLyBTZXR1cCB0aGUgbmV3IHJvb3Qgc2NvcGUgZm9yIHRoZSBjb21wb25lbnRcbiAgb3AoT3AuUm9vdFNjb3BlLCBzeW1ib2xzLmxlbmd0aCArIDEsIE9iamVjdC5rZXlzKGJsb2NrcykubGVuZ3RoID4gMCA/IDEgOiAwKTtcblxuICAvLyBQb3AgdGhlIHNlbGYgcmVmZXJlbmNlIG9mZiB0aGUgc3RhY2sgYW5kIHNldCBpdCB0byB0aGUgc3ltYm9sIGZvciBgdGhpc2BcbiAgLy8gaW4gdGhlIG5ldyBzY29wZS4gVGhpcyBpcyB3aHkgYWxsIHN1YnNlcXVlbnQgc3ltYm9scyBhcmUgaW5jcmVhc2VkIGJ5IG9uZS5cbiAgb3AoT3AuU2V0VmFyaWFibGUsIDApO1xuXG4gIC8vIEdvaW5nIGluIHJldmVyc2UsIG5vdyB3ZSBwb3AgdGhlIGFyZ3MvYmxvY2tzIG9mZiB0aGUgc3RhY2ssIHN0YXJ0aW5nIHdpdGhcbiAgLy8gYXJndW1lbnRzLCBhbmQgYXNzaWduIHRoZW0gdG8gdGhlaXIgc3ltYm9scyBpbiB0aGUgbmV3IHNjb3BlLlxuICBmb3IgKGxldCBpID0gYXJnU3ltYm9scy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGxldCBzeW1ib2wgPSBhcmdTeW1ib2xzW2ldO1xuXG4gICAgaWYgKHN5bWJvbCA9PT0gLTEpIHtcbiAgICAgIC8vIFRoZSBleHByZXNzaW9uIHdhcyBub3QgYm91bmQgdG8gYSBsb2NhbCBzeW1ib2wsIGl0IHdhcyBvbmx5IHB1c2hlZCB0byBiZVxuICAgICAgLy8gdXNlZCB3aXRoIFZNIGFyZ3MgaW4gdGhlIGphdmFzY3JpcHQgc2lkZVxuICAgICAgb3AoT3AuUG9wLCAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3AoT3AuU2V0VmFyaWFibGUsIHN5bWJvbCArIDEpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlmIGFueSBwb3NpdGlvbmFsIHBhcmFtcyBleGlzdCwgcG9wIHRoZW0gb2ZmIHRoZSBzdGFjayBhcyB3ZWxsXG4gIGlmIChwb3NpdGlvbmFsICE9PSBudWxsKSB7XG4gICAgb3AoT3AuUG9wLCBwb3NpdGlvbmFsLmxlbmd0aCk7XG4gIH1cblxuICAvLyBGaW5pc2ggdXAgYnkgcG9wcGluZyBvZmYgYW5kIGFzc2lnbmluZyBibG9ja3NcbiAgZm9yIChsZXQgaSA9IGJsb2NrU3ltYm9scy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGxldCBzeW1ib2wgPSBibG9ja1N5bWJvbHNbaV07XG5cbiAgICBvcChPcC5TZXRCbG9jaywgc3ltYm9sICsgMSk7XG4gIH1cblxuICBvcChPcC5Db25zdGFudCwgbGF5b3V0T3BlcmFuZChsYXlvdXQpKTtcbiAgb3AoT3AuQ29tcGlsZUJsb2NrKTtcbiAgb3AoTWFjaGluZU9wLkludm9rZVZpcnR1YWwpO1xuICBvcChPcC5EaWRSZW5kZXJMYXlvdXQsICRzMCk7XG5cbiAgb3AoTWFjaGluZU9wLlBvcEZyYW1lKTtcbiAgb3AoT3AuUG9wU2NvcGUpO1xuXG4gIGlmIChoYXNDYXBhYmlsaXR5KGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkR5bmFtaWNTY29wZSkpIHtcbiAgICBvcChPcC5Qb3BEeW5hbWljU2NvcGUpO1xuICB9XG5cbiAgb3AoT3AuQ29tbWl0Q29tcG9uZW50VHJhbnNhY3Rpb24pO1xuICBvcChPcC5Mb2FkLCAkczApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gSW52b2tlTm9uU3RhdGljQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICB7IGNhcGFiaWxpdGllcywgZWxlbWVudEJsb2NrLCBwb3NpdGlvbmFsLCBuYW1lZCwgYXROYW1lcywgYmxvY2tzOiBuYW1lZEJsb2NrcywgbGF5b3V0IH06IENvbXBvbmVudFxuKTogdm9pZCB7XG4gIGxldCBiaW5kYWJsZUJsb2NrcyA9ICEhbmFtZWRCbG9ja3M7XG4gIGxldCBiaW5kYWJsZUF0TmFtZXMgPVxuICAgIGNhcGFiaWxpdGllcyA9PT0gdHJ1ZSB8fFxuICAgIGhhc0NhcGFiaWxpdHkoY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuUHJlcGFyZUFyZ3MpIHx8XG4gICAgISEobmFtZWQgJiYgbmFtZWRbMF0ubGVuZ3RoICE9PSAwKTtcblxuICBsZXQgYmxvY2tzID0gbmFtZWRCbG9ja3Mud2l0aCgnYXR0cnMnLCBlbGVtZW50QmxvY2spO1xuXG4gIG9wKE9wLkZldGNoLCAkczApO1xuICBvcChPcC5EdXAsICRzcCwgMSk7XG4gIG9wKE9wLkxvYWQsICRzMCk7XG5cbiAgb3AoTWFjaGluZU9wLlB1c2hGcmFtZSk7XG4gIENvbXBpbGVBcmdzKG9wLCBwb3NpdGlvbmFsLCBuYW1lZCwgYmxvY2tzLCBhdE5hbWVzKTtcbiAgb3AoT3AuUHJlcGFyZUFyZ3MsICRzMCk7XG5cbiAgaW52b2tlUHJlcGFyZWRDb21wb25lbnQob3AsIGJsb2Nrcy5oYXMoJ2RlZmF1bHQnKSwgYmluZGFibGVCbG9ja3MsIGJpbmRhYmxlQXROYW1lcywgKCkgPT4ge1xuICAgIGlmIChsYXlvdXQpIHtcbiAgICAgIG9wKE9wLlB1c2hTeW1ib2xUYWJsZSwgc3ltYm9sVGFibGVPcGVyYW5kKGxheW91dC5zeW1ib2xUYWJsZSkpO1xuICAgICAgb3AoT3AuQ29uc3RhbnQsIGxheW91dE9wZXJhbmQobGF5b3V0KSk7XG4gICAgICBvcChPcC5Db21waWxlQmxvY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBvcChPcC5HZXRDb21wb25lbnRMYXlvdXQsICRzMCk7XG4gICAgfVxuXG4gICAgb3AoT3AuUG9wdWxhdGVMYXlvdXQsICRzMCk7XG4gIH0pO1xuXG4gIG9wKE9wLkxvYWQsICRzMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBXcmFwcGVkQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBsYXlvdXQ6IExheW91dFdpdGhDb250ZXh0LFxuICBhdHRyc0Jsb2NrTnVtYmVyOiBudW1iZXJcbik6IHZvaWQge1xuICBvcChIaWdoTGV2ZWxCdWlsZGVyT3Bjb2RlLlN0YXJ0TGFiZWxzKTtcbiAgV2l0aFNhdmVkUmVnaXN0ZXIob3AsICRzMSwgKCkgPT4ge1xuICAgIG9wKE9wLkdldENvbXBvbmVudFRhZ05hbWUsICRzMCk7XG4gICAgb3AoT3AuUHJpbWl0aXZlUmVmZXJlbmNlKTtcbiAgICBvcChPcC5EdXAsICRzcCwgMCk7XG4gIH0pO1xuICBvcChPcC5KdW1wVW5sZXNzLCBsYWJlbE9wZXJhbmQoJ0JPRFknKSk7XG4gIG9wKE9wLkZldGNoLCAkczEpO1xuICBvcChPcC5QdXRDb21wb25lbnRPcGVyYXRpb25zKTtcbiAgb3AoT3AuT3BlbkR5bmFtaWNFbGVtZW50KTtcbiAgb3AoT3AuRGlkQ3JlYXRlRWxlbWVudCwgJHMwKTtcbiAgWWllbGRCbG9jayhvcCwgYXR0cnNCbG9ja051bWJlciwgbnVsbCk7XG4gIG9wKE9wLkZsdXNoRWxlbWVudCk7XG4gIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuTGFiZWwsICdCT0RZJyk7XG4gIEludm9rZVN0YXRpY0Jsb2NrKG9wLCBbbGF5b3V0LmJsb2NrWzBdLCBbXV0pO1xuICBvcChPcC5GZXRjaCwgJHMxKTtcbiAgb3AoT3AuSnVtcFVubGVzcywgbGFiZWxPcGVyYW5kKCdFTkQnKSk7XG4gIG9wKE9wLkNsb3NlRWxlbWVudCk7XG4gIG9wKEhpZ2hMZXZlbEJ1aWxkZXJPcGNvZGUuTGFiZWwsICdFTkQnKTtcbiAgb3AoT3AuTG9hZCwgJHMxKTtcbiAgb3AoSGlnaExldmVsQnVpbGRlck9wY29kZS5TdG9wTGFiZWxzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludm9rZVByZXBhcmVkQ29tcG9uZW50KFxuICBvcDogUHVzaFN0YXRlbWVudE9wLFxuICBoYXNCbG9jazogYm9vbGVhbixcbiAgYmluZGFibGVCbG9ja3M6IGJvb2xlYW4sXG4gIGJpbmRhYmxlQXROYW1lczogYm9vbGVhbixcbiAgcG9wdWxhdGVMYXlvdXQ6IE9wdGlvbjwoKSA9PiB2b2lkPiA9IG51bGxcbik6IHZvaWQge1xuICBvcChPcC5CZWdpbkNvbXBvbmVudFRyYW5zYWN0aW9uLCAkczApO1xuICBvcChPcC5QdXNoRHluYW1pY1Njb3BlKTtcblxuICBvcChPcC5DcmVhdGVDb21wb25lbnQsIChoYXNCbG9jayBhcyBhbnkpIHwgMCwgJHMwKTtcblxuICAvLyB0aGlzIGhhcyB0byBydW4gYWZ0ZXIgY3JlYXRlQ29tcG9uZW50IHRvIGFsbG93XG4gIC8vIGZvciBsYXRlLWJvdW5kIGxheW91dHMsIGJ1dCBhIGNhbGxlciBpcyBmcmVlXG4gIC8vIHRvIHBvcHVsYXRlIHRoZSBsYXlvdXQgZWFybGllciBpZiBpdCB3YW50cyB0b1xuICAvLyBhbmQgZG8gbm90aGluZyBoZXJlLlxuICBpZiAocG9wdWxhdGVMYXlvdXQpIHtcbiAgICBwb3B1bGF0ZUxheW91dCgpO1xuICB9XG5cbiAgb3AoT3AuUmVnaXN0ZXJDb21wb25lbnREZXN0cnVjdG9yLCAkczApO1xuICBvcChPcC5HZXRDb21wb25lbnRTZWxmLCAkczApO1xuXG4gIG9wKE9wLlZpcnR1YWxSb290U2NvcGUsICRzMCk7XG4gIG9wKE9wLlNldFZhcmlhYmxlLCAwKTtcbiAgb3AoT3AuU2V0dXBGb3JFdmFsLCAkczApO1xuXG4gIGlmIChiaW5kYWJsZUF0TmFtZXMpIG9wKE9wLlNldE5hbWVkVmFyaWFibGVzLCAkczApO1xuICBpZiAoYmluZGFibGVCbG9ja3MpIG9wKE9wLlNldEJsb2NrcywgJHMwKTtcblxuICBvcChPcC5Qb3AsIDEpO1xuICBvcChPcC5JbnZva2VDb21wb25lbnRMYXlvdXQsICRzMCk7XG4gIG9wKE9wLkRpZFJlbmRlckxheW91dCwgJHMwKTtcbiAgb3AoTWFjaGluZU9wLlBvcEZyYW1lKTtcblxuICBvcChPcC5Qb3BTY29wZSk7XG4gIG9wKE9wLlBvcER5bmFtaWNTY29wZSk7XG4gIG9wKE9wLkNvbW1pdENvbXBvbmVudFRyYW5zYWN0aW9uKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEludm9rZUJhcmVDb21wb25lbnQob3A6IFB1c2hTdGF0ZW1lbnRPcCk6IHZvaWQge1xuICBvcChPcC5GZXRjaCwgJHMwKTtcbiAgb3AoT3AuRHVwLCAkc3AsIDEpO1xuICBvcChPcC5Mb2FkLCAkczApO1xuXG4gIG9wKE1hY2hpbmVPcC5QdXNoRnJhbWUpO1xuICBvcChPcC5QdXNoRW1wdHlBcmdzKTtcbiAgb3AoT3AuUHJlcGFyZUFyZ3MsICRzMCk7XG4gIGludm9rZVByZXBhcmVkQ29tcG9uZW50KG9wLCBmYWxzZSwgZmFsc2UsIHRydWUsICgpID0+IHtcbiAgICBvcChPcC5HZXRDb21wb25lbnRMYXlvdXQsICRzMCk7XG4gICAgb3AoT3AuUG9wdWxhdGVMYXlvdXQsICRzMCk7XG4gIH0pO1xuICBvcChPcC5Mb2FkLCAkczApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gV2l0aFNhdmVkUmVnaXN0ZXIoXG4gIG9wOiBQdXNoRXhwcmVzc2lvbk9wLFxuICByZWdpc3RlcjogU2F2ZWRSZWdpc3RlcixcbiAgYmxvY2s6ICgpID0+IHZvaWRcbik6IHZvaWQge1xuICBvcChPcC5GZXRjaCwgcmVnaXN0ZXIpO1xuICBibG9jaygpO1xuICBvcChPcC5Mb2FkLCByZWdpc3Rlcik7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9