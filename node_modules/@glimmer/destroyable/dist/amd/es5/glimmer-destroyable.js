define('@glimmer/destroyable', ['exports', '@glimmer/env', '@glimmer/util', '@glimmer/global-context'], function (exports, env, util, globalContext) { 'use strict';

  var DESTROYABLE_META = new WeakMap();

  function push(collection, newItem) {
    if (collection === null) {
      return newItem;
    } else if (Array.isArray(collection)) {
      collection.push(newItem);
      return collection;
    } else {
      return [collection, newItem];
    }
  }

  function iterate(collection, fn) {
    if (Array.isArray(collection)) {
      for (var i = 0; i < collection.length; i++) {
        fn(collection[i]);
      }
    } else if (collection !== null) {
      fn(collection);
    }
  }

  function remove(collection, item, message) {
    if (env.DEBUG) {
      var collectionIsItem = collection === item;
      var collectionContainsItem = Array.isArray(collection) && collection.indexOf(item) !== -1;

      if (!collectionIsItem && !collectionContainsItem) {
        throw new Error(String(message));
      }
    }

    if (Array.isArray(collection) && collection.length > 1) {
      var index = collection.indexOf(item);
      collection.splice(index, 1);
      return collection;
    } else {
      return null;
    }
  }

  function getDestroyableMeta(destroyable) {
    var meta = DESTROYABLE_META.get(destroyable);

    if (meta === undefined) {
      meta = {
        parents: null,
        children: null,
        eagerDestructors: null,
        destructors: null,
        state: 0
        /* Live */

      };

      if (env.DEBUG) {
        meta.source = destroyable;
      }

      DESTROYABLE_META.set(destroyable, meta);
    }

    return meta;
  }

  function associateDestroyableChild(parent, child) {
    if (env.DEBUG && isDestroying(parent)) {
      throw new Error('Attempted to associate a destroyable child with an object that is already destroying or destroyed');
    }

    var parentMeta = getDestroyableMeta(parent);
    var childMeta = getDestroyableMeta(child);
    parentMeta.children = push(parentMeta.children, child);
    childMeta.parents = push(childMeta.parents, parent);
    return child;
  }
  function registerDestructor(destroyable, destructor, eager) {
    if (eager === void 0) {
      eager = false;
    }

    if (env.DEBUG && isDestroying(destroyable)) {
      throw new Error('Attempted to register a destructor with an object that is already destroying or destroyed');
    }

    var meta = getDestroyableMeta(destroyable);
    var destructorsKey = eager === true ? 'eagerDestructors' : 'destructors';
    meta[destructorsKey] = push(meta[destructorsKey], destructor);
    return destructor;
  }
  function unregisterDestructor(destroyable, destructor, eager) {
    if (eager === void 0) {
      eager = false;
    }

    if (env.DEBUG && isDestroying(destroyable)) {
      throw new Error('Attempted to unregister a destructor with an object that is already destroying or destroyed');
    }

    var meta = getDestroyableMeta(destroyable);
    var destructorsKey = eager === true ? 'eagerDestructors' : 'destructors';
    meta[destructorsKey] = remove(meta[destructorsKey], destructor, env.DEBUG && 'attempted to remove a destructor that was not registered with the destroyable');
  } ////////////

  function destroy(destroyable) {
    var meta = getDestroyableMeta(destroyable);
    if (meta.state >= 1
    /* Destroying */
    ) return;
    var parents = meta.parents,
        children = meta.children,
        eagerDestructors = meta.eagerDestructors,
        destructors = meta.destructors;
    meta.state = 1
    /* Destroying */
    ;
    iterate(children, destroy);
    iterate(eagerDestructors, function (destructor) {
      return destructor(destroyable);
    });
    iterate(destructors, function (destructor) {
      return globalContext.scheduleDestroy(destroyable, destructor);
    });
    globalContext.scheduleDestroyed(function () {
      iterate(parents, function (parent) {
        return removeChildFromParent(destroyable, parent);
      });
      meta.state = 2
      /* Destroyed */
      ;
    });
  }

  function removeChildFromParent(child, parent) {
    var parentMeta = getDestroyableMeta(parent);

    if (parentMeta.state === 0
    /* Live */
    ) {
        parentMeta.children = remove(parentMeta.children, child, env.DEBUG && "attempted to remove child from parent, but the parent's children did not contain the child. This is likely a bug with destructors.");
      }
  }

  function destroyChildren(destroyable) {
    var _getDestroyableMeta = getDestroyableMeta(destroyable),
        children = _getDestroyableMeta.children;

    iterate(children, destroy);
  }
  function _hasDestroyableChildren(destroyable) {
    var meta = DESTROYABLE_META.get(destroyable);
    return meta === undefined ? false : meta.children !== null;
  }
  function isDestroying(destroyable) {
    var meta = DESTROYABLE_META.get(destroyable);
    return meta === undefined ? false : meta.state >= 1
    /* Destroying */
    ;
  }
  function isDestroyed(destroyable) {
    var meta = DESTROYABLE_META.get(destroyable);
    return meta === undefined ? false : meta.state >= 2
    /* Destroyed */
    ;
  } ////////////

  if (env.DEBUG) {
    var isTesting = false;

    exports.enableDestroyableTracking = function enableDestroyableTracking() {
      if (isTesting) {
        // Reset destroyable meta just in case, before throwing the error
        DESTROYABLE_META = new WeakMap();
        throw new Error('Attempted to start destroyable testing, but you did not end the previous destroyable test. Did you forget to call `assertDestroyablesDestroyed()`');
      }

      isTesting = true;
      DESTROYABLE_META = new Map();
    };

    exports.assertDestroyablesDestroyed = function assertDestroyablesDestroyed() {
      if (!isTesting) {
        throw new Error('Attempted to assert destroyables destroyed, but you did not start a destroyable test. Did you forget to call `enableDestroyableTracking()`');
      }

      isTesting = false;
      var map = DESTROYABLE_META;
      DESTROYABLE_META = new WeakMap();
      var undestroyed = [];
      map.forEach(function (meta) {
        if (meta.state !== 2
        /* Destroyed */
        ) {
            undestroyed.push(meta.source);
          }
      });

      if (undestroyed.length > 0) {
        var objectsToString = undestroyed.map(util.debugToString).join('\n    ');
        var error = new Error("Some destroyables were not destroyed during this test:\n    " + objectsToString);
        error.destroyables = undestroyed;
        throw error;
      }
    };
  }

  exports._hasDestroyableChildren = _hasDestroyableChildren;
  exports.associateDestroyableChild = associateDestroyableChild;
  exports.destroy = destroy;
  exports.destroyChildren = destroyChildren;
  exports.isDestroyed = isDestroyed;
  exports.isDestroying = isDestroying;
  exports.registerDestructor = registerDestructor;
  exports.unregisterDestructor = unregisterDestructor;

  Object.defineProperty(exports, '__esModule', { value: true });

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xpbW1lci1kZXN0cm95YWJsZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvQGdsaW1tZXIvZGVzdHJveWFibGUvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREVCVUcgfSBmcm9tICdAZ2xpbW1lci9lbnYnO1xuaW1wb3J0IHsgRGVzdHJveWFibGUsIERlc3RydWN0b3IgfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IGRlYnVnVG9TdHJpbmcgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IHNjaGVkdWxlRGVzdHJveSwgc2NoZWR1bGVEZXN0cm95ZWQgfSBmcm9tICdAZ2xpbW1lci9nbG9iYWwtY29udGV4dCc7XG5cbmNvbnN0IGVudW0gRGVzdHJveWluZ1N0YXRlIHtcbiAgTGl2ZSA9IDAsXG4gIERlc3Ryb3lpbmcgPSAxLFxuICBEZXN0cm95ZWQgPSAyLFxufVxuXG50eXBlIE9uZU9yTWFueTxUPiA9IG51bGwgfCBUIHwgVFtdO1xuXG5pbnRlcmZhY2UgRGVzdHJveWFibGVNZXRhPFQgZXh0ZW5kcyBEZXN0cm95YWJsZT4ge1xuICBzb3VyY2U/OiBUO1xuICBwYXJlbnRzOiBPbmVPck1hbnk8RGVzdHJveWFibGU+O1xuICBjaGlsZHJlbjogT25lT3JNYW55PERlc3Ryb3lhYmxlPjtcbiAgZWFnZXJEZXN0cnVjdG9yczogT25lT3JNYW55PERlc3RydWN0b3I8VD4+O1xuICBkZXN0cnVjdG9yczogT25lT3JNYW55PERlc3RydWN0b3I8VD4+O1xuICBzdGF0ZTogRGVzdHJveWluZ1N0YXRlO1xufVxuXG5pbnRlcmZhY2UgVW5kZXN0cm95ZWREZXN0cm95YWJsZXNFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgZGVzdHJveWFibGVzOiBvYmplY3RbXTtcbn1cblxubGV0IERFU1RST1lBQkxFX01FVEE6XG4gIHwgTWFwPERlc3Ryb3lhYmxlLCBEZXN0cm95YWJsZU1ldGE8RGVzdHJveWFibGU+PlxuICB8IFdlYWtNYXA8RGVzdHJveWFibGUsIERlc3Ryb3lhYmxlTWV0YTxEZXN0cm95YWJsZT4+ID0gbmV3IFdlYWtNYXAoKTtcblxuZnVuY3Rpb24gcHVzaDxUIGV4dGVuZHMgb2JqZWN0Pihjb2xsZWN0aW9uOiBPbmVPck1hbnk8VD4sIG5ld0l0ZW06IFQpOiBPbmVPck1hbnk8VD4ge1xuICBpZiAoY29sbGVjdGlvbiA9PT0gbnVsbCkge1xuICAgIHJldHVybiBuZXdJdGVtO1xuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29sbGVjdGlvbikpIHtcbiAgICBjb2xsZWN0aW9uLnB1c2gobmV3SXRlbSk7XG4gICAgcmV0dXJuIGNvbGxlY3Rpb247XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFtjb2xsZWN0aW9uLCBuZXdJdGVtXTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpdGVyYXRlPFQgZXh0ZW5kcyBvYmplY3Q+KGNvbGxlY3Rpb246IE9uZU9yTWFueTxUPiwgZm46IChpdGVtOiBUKSA9PiB2b2lkKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGNvbGxlY3Rpb24pKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xsZWN0aW9uLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmbihjb2xsZWN0aW9uW2ldKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoY29sbGVjdGlvbiAhPT0gbnVsbCkge1xuICAgIGZuKGNvbGxlY3Rpb24pO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZTxUIGV4dGVuZHMgb2JqZWN0Pihjb2xsZWN0aW9uOiBPbmVPck1hbnk8VD4sIGl0ZW06IFQsIG1lc3NhZ2U6IHN0cmluZyB8IGZhbHNlKSB7XG4gIGlmIChERUJVRykge1xuICAgIGxldCBjb2xsZWN0aW9uSXNJdGVtID0gY29sbGVjdGlvbiA9PT0gaXRlbTtcbiAgICBsZXQgY29sbGVjdGlvbkNvbnRhaW5zSXRlbSA9IEFycmF5LmlzQXJyYXkoY29sbGVjdGlvbikgJiYgY29sbGVjdGlvbi5pbmRleE9mKGl0ZW0pICE9PSAtMTtcblxuICAgIGlmICghY29sbGVjdGlvbklzSXRlbSAmJiAhY29sbGVjdGlvbkNvbnRhaW5zSXRlbSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFN0cmluZyhtZXNzYWdlKSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoY29sbGVjdGlvbikgJiYgY29sbGVjdGlvbi5sZW5ndGggPiAxKSB7XG4gICAgbGV0IGluZGV4ID0gY29sbGVjdGlvbiEuaW5kZXhPZihpdGVtKTtcbiAgICBjb2xsZWN0aW9uIS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldERlc3Ryb3lhYmxlTWV0YTxUIGV4dGVuZHMgRGVzdHJveWFibGU+KGRlc3Ryb3lhYmxlOiBUKTogRGVzdHJveWFibGVNZXRhPFQ+IHtcbiAgbGV0IG1ldGEgPSBERVNUUk9ZQUJMRV9NRVRBLmdldChkZXN0cm95YWJsZSk7XG5cbiAgaWYgKG1ldGEgPT09IHVuZGVmaW5lZCkge1xuICAgIG1ldGEgPSB7XG4gICAgICBwYXJlbnRzOiBudWxsLFxuICAgICAgY2hpbGRyZW46IG51bGwsXG4gICAgICBlYWdlckRlc3RydWN0b3JzOiBudWxsLFxuICAgICAgZGVzdHJ1Y3RvcnM6IG51bGwsXG4gICAgICBzdGF0ZTogRGVzdHJveWluZ1N0YXRlLkxpdmUsXG4gICAgfTtcblxuICAgIGlmIChERUJVRykge1xuICAgICAgbWV0YS5zb3VyY2UgPSBkZXN0cm95YWJsZSBhcyBvYmplY3Q7XG4gICAgfVxuXG4gICAgREVTVFJPWUFCTEVfTUVUQS5zZXQoZGVzdHJveWFibGUsIG1ldGEpO1xuICB9XG5cbiAgcmV0dXJuIChtZXRhIGFzIHVua25vd24pIGFzIERlc3Ryb3lhYmxlTWV0YTxUPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc29jaWF0ZURlc3Ryb3lhYmxlQ2hpbGQ8VCBleHRlbmRzIERlc3Ryb3lhYmxlPihwYXJlbnQ6IERlc3Ryb3lhYmxlLCBjaGlsZDogVCk6IFQge1xuICBpZiAoREVCVUcgJiYgaXNEZXN0cm95aW5nKHBhcmVudCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQXR0ZW1wdGVkIHRvIGFzc29jaWF0ZSBhIGRlc3Ryb3lhYmxlIGNoaWxkIHdpdGggYW4gb2JqZWN0IHRoYXQgaXMgYWxyZWFkeSBkZXN0cm95aW5nIG9yIGRlc3Ryb3llZCdcbiAgICApO1xuICB9XG5cbiAgbGV0IHBhcmVudE1ldGEgPSBnZXREZXN0cm95YWJsZU1ldGEocGFyZW50KTtcbiAgbGV0IGNoaWxkTWV0YSA9IGdldERlc3Ryb3lhYmxlTWV0YShjaGlsZCk7XG5cbiAgcGFyZW50TWV0YS5jaGlsZHJlbiA9IHB1c2gocGFyZW50TWV0YS5jaGlsZHJlbiwgY2hpbGQpO1xuICBjaGlsZE1ldGEucGFyZW50cyA9IHB1c2goY2hpbGRNZXRhLnBhcmVudHMsIHBhcmVudCk7XG5cbiAgcmV0dXJuIGNoaWxkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEZXN0cnVjdG9yPFQgZXh0ZW5kcyBEZXN0cm95YWJsZT4oXG4gIGRlc3Ryb3lhYmxlOiBULFxuICBkZXN0cnVjdG9yOiBEZXN0cnVjdG9yPFQ+LFxuICBlYWdlciA9IGZhbHNlXG4pOiBEZXN0cnVjdG9yPFQ+IHtcbiAgaWYgKERFQlVHICYmIGlzRGVzdHJveWluZyhkZXN0cm95YWJsZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQXR0ZW1wdGVkIHRvIHJlZ2lzdGVyIGEgZGVzdHJ1Y3RvciB3aXRoIGFuIG9iamVjdCB0aGF0IGlzIGFscmVhZHkgZGVzdHJveWluZyBvciBkZXN0cm95ZWQnXG4gICAgKTtcbiAgfVxuXG4gIGxldCBtZXRhID0gZ2V0RGVzdHJveWFibGVNZXRhKGRlc3Ryb3lhYmxlKTtcblxuICBsZXQgZGVzdHJ1Y3RvcnNLZXk6ICdlYWdlckRlc3RydWN0b3JzJyB8ICdkZXN0cnVjdG9ycycgPVxuICAgIGVhZ2VyID09PSB0cnVlID8gJ2VhZ2VyRGVzdHJ1Y3RvcnMnIDogJ2Rlc3RydWN0b3JzJztcblxuICBtZXRhW2Rlc3RydWN0b3JzS2V5XSA9IHB1c2gobWV0YVtkZXN0cnVjdG9yc0tleV0sIGRlc3RydWN0b3IpO1xuXG4gIHJldHVybiBkZXN0cnVjdG9yO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5yZWdpc3RlckRlc3RydWN0b3I8VCBleHRlbmRzIERlc3Ryb3lhYmxlPihcbiAgZGVzdHJveWFibGU6IFQsXG4gIGRlc3RydWN0b3I6IERlc3RydWN0b3I8VD4sXG4gIGVhZ2VyID0gZmFsc2Vcbik6IHZvaWQge1xuICBpZiAoREVCVUcgJiYgaXNEZXN0cm95aW5nKGRlc3Ryb3lhYmxlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdBdHRlbXB0ZWQgdG8gdW5yZWdpc3RlciBhIGRlc3RydWN0b3Igd2l0aCBhbiBvYmplY3QgdGhhdCBpcyBhbHJlYWR5IGRlc3Ryb3lpbmcgb3IgZGVzdHJveWVkJ1xuICAgICk7XG4gIH1cblxuICBsZXQgbWV0YSA9IGdldERlc3Ryb3lhYmxlTWV0YShkZXN0cm95YWJsZSk7XG5cbiAgbGV0IGRlc3RydWN0b3JzS2V5OiAnZWFnZXJEZXN0cnVjdG9ycycgfCAnZGVzdHJ1Y3RvcnMnID1cbiAgICBlYWdlciA9PT0gdHJ1ZSA/ICdlYWdlckRlc3RydWN0b3JzJyA6ICdkZXN0cnVjdG9ycyc7XG5cbiAgbWV0YVtkZXN0cnVjdG9yc0tleV0gPSByZW1vdmUoXG4gICAgbWV0YVtkZXN0cnVjdG9yc0tleV0sXG4gICAgZGVzdHJ1Y3RvcixcbiAgICBERUJVRyAmJiAnYXR0ZW1wdGVkIHRvIHJlbW92ZSBhIGRlc3RydWN0b3IgdGhhdCB3YXMgbm90IHJlZ2lzdGVyZWQgd2l0aCB0aGUgZGVzdHJveWFibGUnXG4gICk7XG59XG5cbi8vLy8vLy8vLy8vL1xuXG5leHBvcnQgZnVuY3Rpb24gZGVzdHJveShkZXN0cm95YWJsZTogRGVzdHJveWFibGUpIHtcbiAgbGV0IG1ldGEgPSBnZXREZXN0cm95YWJsZU1ldGEoZGVzdHJveWFibGUpO1xuXG4gIGlmIChtZXRhLnN0YXRlID49IERlc3Ryb3lpbmdTdGF0ZS5EZXN0cm95aW5nKSByZXR1cm47XG5cbiAgbGV0IHsgcGFyZW50cywgY2hpbGRyZW4sIGVhZ2VyRGVzdHJ1Y3RvcnMsIGRlc3RydWN0b3JzIH0gPSBtZXRhO1xuXG4gIG1ldGEuc3RhdGUgPSBEZXN0cm95aW5nU3RhdGUuRGVzdHJveWluZztcblxuICBpdGVyYXRlKGNoaWxkcmVuLCBkZXN0cm95KTtcbiAgaXRlcmF0ZShlYWdlckRlc3RydWN0b3JzLCAoZGVzdHJ1Y3RvcikgPT4gZGVzdHJ1Y3RvcihkZXN0cm95YWJsZSkpO1xuICBpdGVyYXRlKGRlc3RydWN0b3JzLCAoZGVzdHJ1Y3RvcikgPT4gc2NoZWR1bGVEZXN0cm95KGRlc3Ryb3lhYmxlLCBkZXN0cnVjdG9yKSk7XG5cbiAgc2NoZWR1bGVEZXN0cm95ZWQoKCkgPT4ge1xuICAgIGl0ZXJhdGUocGFyZW50cywgKHBhcmVudCkgPT4gcmVtb3ZlQ2hpbGRGcm9tUGFyZW50KGRlc3Ryb3lhYmxlLCBwYXJlbnQpKTtcblxuICAgIG1ldGEuc3RhdGUgPSBEZXN0cm95aW5nU3RhdGUuRGVzdHJveWVkO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlQ2hpbGRGcm9tUGFyZW50KGNoaWxkOiBEZXN0cm95YWJsZSwgcGFyZW50OiBEZXN0cm95YWJsZSkge1xuICBsZXQgcGFyZW50TWV0YSA9IGdldERlc3Ryb3lhYmxlTWV0YShwYXJlbnQpO1xuXG4gIGlmIChwYXJlbnRNZXRhLnN0YXRlID09PSBEZXN0cm95aW5nU3RhdGUuTGl2ZSkge1xuICAgIHBhcmVudE1ldGEuY2hpbGRyZW4gPSByZW1vdmUoXG4gICAgICBwYXJlbnRNZXRhLmNoaWxkcmVuLFxuICAgICAgY2hpbGQsXG4gICAgICBERUJVRyAmJlxuICAgICAgICBcImF0dGVtcHRlZCB0byByZW1vdmUgY2hpbGQgZnJvbSBwYXJlbnQsIGJ1dCB0aGUgcGFyZW50J3MgY2hpbGRyZW4gZGlkIG5vdCBjb250YWluIHRoZSBjaGlsZC4gVGhpcyBpcyBsaWtlbHkgYSBidWcgd2l0aCBkZXN0cnVjdG9ycy5cIlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlc3Ryb3lDaGlsZHJlbihkZXN0cm95YWJsZTogRGVzdHJveWFibGUpIHtcbiAgbGV0IHsgY2hpbGRyZW4gfSA9IGdldERlc3Ryb3lhYmxlTWV0YShkZXN0cm95YWJsZSk7XG5cbiAgaXRlcmF0ZShjaGlsZHJlbiwgZGVzdHJveSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfaGFzRGVzdHJveWFibGVDaGlsZHJlbihkZXN0cm95YWJsZTogRGVzdHJveWFibGUpIHtcbiAgbGV0IG1ldGEgPSBERVNUUk9ZQUJMRV9NRVRBLmdldChkZXN0cm95YWJsZSk7XG5cbiAgcmV0dXJuIG1ldGEgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogbWV0YS5jaGlsZHJlbiAhPT0gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRGVzdHJveWluZyhkZXN0cm95YWJsZTogRGVzdHJveWFibGUpIHtcbiAgbGV0IG1ldGEgPSBERVNUUk9ZQUJMRV9NRVRBLmdldChkZXN0cm95YWJsZSk7XG5cbiAgcmV0dXJuIG1ldGEgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogbWV0YS5zdGF0ZSA+PSBEZXN0cm95aW5nU3RhdGUuRGVzdHJveWluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRGVzdHJveWVkKGRlc3Ryb3lhYmxlOiBEZXN0cm95YWJsZSkge1xuICBsZXQgbWV0YSA9IERFU1RST1lBQkxFX01FVEEuZ2V0KGRlc3Ryb3lhYmxlKTtcblxuICByZXR1cm4gbWV0YSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBtZXRhLnN0YXRlID49IERlc3Ryb3lpbmdTdGF0ZS5EZXN0cm95ZWQ7XG59XG5cbi8vLy8vLy8vLy8vL1xuXG5leHBvcnQgbGV0IGVuYWJsZURlc3Ryb3lhYmxlVHJhY2tpbmc6IHVuZGVmaW5lZCB8ICgoKSA9PiB2b2lkKTtcbmV4cG9ydCBsZXQgYXNzZXJ0RGVzdHJveWFibGVzRGVzdHJveWVkOiB1bmRlZmluZWQgfCAoKCkgPT4gdm9pZCk7XG5cbmlmIChERUJVRykge1xuICBsZXQgaXNUZXN0aW5nID0gZmFsc2U7XG5cbiAgZW5hYmxlRGVzdHJveWFibGVUcmFja2luZyA9ICgpID0+IHtcbiAgICBpZiAoaXNUZXN0aW5nKSB7XG4gICAgICAvLyBSZXNldCBkZXN0cm95YWJsZSBtZXRhIGp1c3QgaW4gY2FzZSwgYmVmb3JlIHRocm93aW5nIHRoZSBlcnJvclxuICAgICAgREVTVFJPWUFCTEVfTUVUQSA9IG5ldyBXZWFrTWFwKCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdBdHRlbXB0ZWQgdG8gc3RhcnQgZGVzdHJveWFibGUgdGVzdGluZywgYnV0IHlvdSBkaWQgbm90IGVuZCB0aGUgcHJldmlvdXMgZGVzdHJveWFibGUgdGVzdC4gRGlkIHlvdSBmb3JnZXQgdG8gY2FsbCBgYXNzZXJ0RGVzdHJveWFibGVzRGVzdHJveWVkKClgJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpc1Rlc3RpbmcgPSB0cnVlO1xuICAgIERFU1RST1lBQkxFX01FVEEgPSBuZXcgTWFwKCk7XG4gIH07XG5cbiAgYXNzZXJ0RGVzdHJveWFibGVzRGVzdHJveWVkID0gKCkgPT4ge1xuICAgIGlmICghaXNUZXN0aW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdBdHRlbXB0ZWQgdG8gYXNzZXJ0IGRlc3Ryb3lhYmxlcyBkZXN0cm95ZWQsIGJ1dCB5b3UgZGlkIG5vdCBzdGFydCBhIGRlc3Ryb3lhYmxlIHRlc3QuIERpZCB5b3UgZm9yZ2V0IHRvIGNhbGwgYGVuYWJsZURlc3Ryb3lhYmxlVHJhY2tpbmcoKWAnXG4gICAgICApO1xuICAgIH1cblxuICAgIGlzVGVzdGluZyA9IGZhbHNlO1xuXG4gICAgbGV0IG1hcCA9IERFU1RST1lBQkxFX01FVEEgYXMgTWFwPERlc3Ryb3lhYmxlLCBEZXN0cm95YWJsZU1ldGE8RGVzdHJveWFibGU+PjtcbiAgICBERVNUUk9ZQUJMRV9NRVRBID0gbmV3IFdlYWtNYXAoKTtcblxuICAgIGxldCB1bmRlc3Ryb3llZDogb2JqZWN0W10gPSBbXTtcblxuICAgIG1hcC5mb3JFYWNoKChtZXRhKSA9PiB7XG4gICAgICBpZiAobWV0YS5zdGF0ZSAhPT0gRGVzdHJveWluZ1N0YXRlLkRlc3Ryb3llZCkge1xuICAgICAgICB1bmRlc3Ryb3llZC5wdXNoKG1ldGEuc291cmNlISk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAodW5kZXN0cm95ZWQubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IG9iamVjdHNUb1N0cmluZyA9IHVuZGVzdHJveWVkLm1hcChkZWJ1Z1RvU3RyaW5nISkuam9pbignXFxuICAgICcpO1xuICAgICAgbGV0IGVycm9yID0gbmV3IEVycm9yKFxuICAgICAgICBgU29tZSBkZXN0cm95YWJsZXMgd2VyZSBub3QgZGVzdHJveWVkIGR1cmluZyB0aGlzIHRlc3Q6XFxuICAgICR7b2JqZWN0c1RvU3RyaW5nfWBcbiAgICAgICkgYXMgVW5kZXN0cm95ZWREZXN0cm95YWJsZXNFcnJvcjtcblxuICAgICAgZXJyb3IuZGVzdHJveWFibGVzID0gdW5kZXN0cm95ZWQ7XG5cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJERUJVRyIsInNjaGVkdWxlRGVzdHJveSIsInNjaGVkdWxlRGVzdHJveWVkIiwiZW5hYmxlRGVzdHJveWFibGVUcmFja2luZyIsImFzc2VydERlc3Ryb3lhYmxlc0Rlc3Ryb3llZCIsImRlYnVnVG9TdHJpbmciXSwibWFwcGluZ3MiOiI7O0VBMEJBLElBQUksZ0JBQWdCLEdBRXFDLElBRnpELE9BRXlELEVBRnpEOztFQUlBLFNBQUEsSUFBQSxDQUFBLFVBQUEsRUFBQSxPQUFBLEVBQW9FO0VBQ2xFLE1BQUksVUFBVSxLQUFkLElBQUEsRUFBeUI7RUFDdkIsV0FBQSxPQUFB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
