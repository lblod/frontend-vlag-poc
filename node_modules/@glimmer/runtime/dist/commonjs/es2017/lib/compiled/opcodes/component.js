"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DidUpdateLayoutOpcode = exports.UpdateComponentOpcode = exports.ComponentElementOperations = void 0;

var _env = require("@glimmer/env");

var _reference = require("@glimmer/reference");

var _util = require("@glimmer/util");

var _vm2 = require("@glimmer/vm");

var _destroyable = require("@glimmer/destroyable");

var _manager = require("@glimmer/manager");

var _resolve = require("../../component/resolve");

var _interfaces = require("../../component/interfaces");

var _opcodes = require("../../opcodes");

var _classList = _interopRequireDefault(require("../../references/class-list"));

var _symbols = require("../../symbols");

var _arguments = require("../../vm/arguments");

var _dom = require("./dom");

var _curriedValue = require("../../curried-value");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_opcodes.APPEND_OPCODES.add(78
/* PushComponentDefinition */
, (vm, {
  op1: handle
}) => {
  let definition = vm[_symbols.CONSTANTS].getValue(handle);

  false && (0, _util.assert)(!!definition, `Missing component for ${handle}`);
  let {
    manager,
    capabilities
  } = definition;
  let instance = {
    definition,
    manager,
    capabilities,
    state: null,
    handle: null,
    table: null,
    lookup: null
  };
  vm.stack.push(instance);
});

_opcodes.APPEND_OPCODES.add(80
/* ResolveDynamicComponent */
, (vm, {
  op1: _isStrict
}) => {
  let stack = vm.stack;
  let component = (0, _reference.valueForRef)(stack.pop());
  let constants = vm[_symbols.CONSTANTS];
  let owner = vm.getOwner();
  let isStrict = constants.getValue(_isStrict);
  vm.loadValue(_vm2.$t1, null); // Clear the temp register

  let definition;

  if (typeof component === 'string') {
    if (_env.DEBUG && isStrict) {
      throw new Error(`Attempted to resolve a dynamic component with a string definition, \`${component}\` in a strict mode template. In strict mode, using strings to resolve component definitions is prohibited. You can instead import the component definition and use it directly.`);
    }

    let resolvedDefinition = (0, _resolve.resolveComponent)(vm.runtime.resolver, constants, component, owner);
    definition = resolvedDefinition;
  } else if ((0, _curriedValue.isCurriedValue)(component)) {
    definition = component;
  } else {
    definition = constants.component(component, owner);
  }

  stack.push(definition);
});

_opcodes.APPEND_OPCODES.add(81
/* ResolveCurriedComponent */
, vm => {
  let stack = vm.stack;
  let ref = stack.pop();
  let value = (0, _reference.valueForRef)(ref);
  let constants = vm[_symbols.CONSTANTS];
  let definition;

  if (_env.DEBUG && !(typeof value === 'function' || typeof value === 'object' && value !== null)) {
    throw new Error(`Expected a component definition, but received ${value}. You may have accidentally done <${ref.debugLabel}>, where "${ref.debugLabel}" was a string instead of a curried component definition. You must either use the component definition directly, or use the {{component}} helper to create a curried component definition when invoking dynamically.`);
  }

  if ((0, _curriedValue.isCurriedValue)(value)) {
    definition = value;
  } else {
    definition = constants.component(value, vm.getOwner(), true);

    if (_env.DEBUG && definition === null) {
      throw new Error(`Expected a dynamic component definition, but received an object or function that did not have a component manager associated with it. The dynamic invocation was \`<${ref.debugLabel}>\` or \`{{${ref.debugLabel}}}\`, and the incorrect definition is the value at the path \`${ref.debugLabel}\`, which was: ${(0, _util.debugToString)(value)}`);
    }
  }

  stack.push(definition);
});

_opcodes.APPEND_OPCODES.add(79
/* PushDynamicComponentInstance */
, vm => {
  let {
    stack
  } = vm;
  let definition = stack.pop();
  let capabilities, manager;

  if ((0, _curriedValue.isCurriedValue)(definition)) {
    manager = capabilities = null;
  } else {
    manager = definition.manager;
    capabilities = definition.capabilities;
  }

  stack.push({
    definition,
    capabilities,
    manager,
    state: null,
    handle: null,
    table: null
  });
});

_opcodes.APPEND_OPCODES.add(82
/* PushArgs */
, (vm, {
  op1: _names,
  op2: _blockNames,
  op3: flags
}) => {
  let stack = vm.stack;

  let names = vm[_symbols.CONSTANTS].getArray(_names);

  let positionalCount = flags >> 4;
  let atNames = flags & 0b1000;
  let blockNames = flags & 0b0111 ? vm[_symbols.CONSTANTS].getArray(_blockNames) : _util.EMPTY_STRING_ARRAY;

  vm[_symbols.ARGS].setup(stack, names, blockNames, positionalCount, !!atNames);

  stack.push(vm[_symbols.ARGS]);
});

_opcodes.APPEND_OPCODES.add(83
/* PushEmptyArgs */
, vm => {
  let {
    stack
  } = vm;
  stack.push(vm[_symbols.ARGS].empty(stack));
});

_opcodes.APPEND_OPCODES.add(86
/* CaptureArgs */
, vm => {
  let stack = vm.stack;
  let args = stack.pop();
  let capturedArgs = args.capture();
  stack.push(capturedArgs);
});

_opcodes.APPEND_OPCODES.add(85
/* PrepareArgs */
, (vm, {
  op1: _state
}) => {
  let stack = vm.stack;
  let instance = vm.fetchValue(_state);
  let args = stack.pop();
  let {
    definition
  } = instance;

  if ((0, _curriedValue.isCurriedType)(definition, 0
  /* Component */
  )) {
    false && (0, _util.assert)(!definition.manager, "If the component definition was curried, we don't yet have a manager");
    let constants = vm[_symbols.CONSTANTS];
    let {
      definition: resolvedDefinition,
      owner,
      resolved,
      positional,
      named
    } = (0, _curriedValue.resolveCurriedValue)(definition);

    if (resolved === true) {
      definition = resolvedDefinition;
    } else if (typeof resolvedDefinition === 'string') {
      let resolvedValue = vm.runtime.resolver.lookupComponent(resolvedDefinition, owner);
      definition = constants.resolvedComponent(resolvedValue, resolvedDefinition);
    } else {
      definition = constants.component(resolvedDefinition, owner);
    }

    if (named !== undefined) {
      args.named.merge((0, _util.assign)({}, ...named));
    }

    if (positional !== undefined) {
      args.realloc(positional.length);
      args.positional.prepend(positional);
    }

    let {
      manager
    } = definition;
    false && (0, _util.assert)(instance.manager === null, 'component instance manager should not be populated yet');
    false && (0, _util.assert)(instance.capabilities === null, 'component instance manager should not be populated yet');
    instance.definition = definition;
    instance.manager = manager;
    instance.capabilities = definition.capabilities; // Save off the owner that this component was curried with. Later on,
    // we'll fetch the value of this register and set it as the owner on the
    // new root scope.

    vm.loadValue(_vm2.$t1, owner);
  }

  let {
    manager,
    state
  } = definition;
  let capabilities = instance.capabilities;

  if (!(0, _manager.managerHasCapability)(manager, capabilities, 4
  /* PrepareArgs */
  )) {
    stack.push(args);
    return;
  }

  let blocks = args.blocks.values;
  let blockNames = args.blocks.names;
  let preparedArgs = manager.prepareArgs(state, args);

  if (preparedArgs) {
    args.clear();

    for (let i = 0; i < blocks.length; i++) {
      stack.push(blocks[i]);
    }

    let {
      positional,
      named
    } = preparedArgs;
    let positionalCount = positional.length;

    for (let i = 0; i < positionalCount; i++) {
      stack.push(positional[i]);
    }

    let names = Object.keys(named);

    for (let i = 0; i < names.length; i++) {
      stack.push(named[names[i]]);
    }

    args.setup(stack, names, blockNames, positionalCount, false);
  }

  stack.push(args);
});

_opcodes.APPEND_OPCODES.add(87
/* CreateComponent */
, (vm, {
  op1: flags,
  op2: _state
}) => {
  let instance = vm.fetchValue(_state);
  let {
    definition,
    manager,
    capabilities
  } = instance;

  if (!(0, _manager.managerHasCapability)(manager, capabilities, 512
  /* CreateInstance */
  )) {
    // TODO: Closure and Main components are always invoked dynamically, so this
    // opcode may run even if this capability is not enabled. In the future we
    // should handle this in a better way.
    return;
  }

  let dynamicScope = null;

  if ((0, _manager.managerHasCapability)(manager, capabilities, 64
  /* DynamicScope */
  )) {
    dynamicScope = vm.dynamicScope();
  }

  let hasDefaultBlock = flags & 1;
  let args = null;

  if ((0, _manager.managerHasCapability)(manager, capabilities, 8
  /* CreateArgs */
  )) {
    args = vm.stack.peek();
  }

  let self = null;

  if ((0, _manager.managerHasCapability)(manager, capabilities, 128
  /* CreateCaller */
  )) {
    self = vm.getSelf();
  }

  let state = manager.create(vm.getOwner(), definition.state, args, vm.env, dynamicScope, self, !!hasDefaultBlock); // We want to reuse the `state` POJO here, because we know that the opcodes
  // only transition at exactly one place.

  instance.state = state;

  if ((0, _manager.managerHasCapability)(manager, capabilities, 256
  /* UpdateHook */
  )) {
    vm.updateWith(new UpdateComponentOpcode(state, manager, dynamicScope));
  }
});

_opcodes.APPEND_OPCODES.add(88
/* RegisterComponentDestructor */
, (vm, {
  op1: _state
}) => {
  let {
    manager,
    state,
    capabilities
  } = vm.fetchValue(_state);
  let d = manager.getDestroyable(state);

  if (_env.DEBUG && !(0, _manager.managerHasCapability)(manager, capabilities, 2048
  /* WillDestroy */
  ) && d !== null && typeof 'willDestroy' in d) {
    throw new Error('BUG: Destructor has willDestroy, but the willDestroy capability was not enabled for this component. Pre-destruction hooks must be explicitly opted into');
  }

  if (d) vm.associateDestroyable(d);
});

_opcodes.APPEND_OPCODES.add(97
/* BeginComponentTransaction */
, (vm, {
  op1: _state
}) => {
  var _a;

  let name;

  if (_env.DEBUG) {
    let {
      definition,
      manager
    } = vm.fetchValue(_state);
    name = (_a = definition.resolvedName) !== null && _a !== void 0 ? _a : manager.getDebugName(definition.state);
  }

  vm.beginCacheGroup(name);
  vm.elements().pushSimpleBlock();
});

_opcodes.APPEND_OPCODES.add(89
/* PutComponentOperations */
, vm => {
  vm.loadValue(_vm2.$t0, new ComponentElementOperations());
});

_opcodes.APPEND_OPCODES.add(53
/* ComponentAttr */
, (vm, {
  op1: _name,
  op2: _trusting,
  op3: _namespace
}) => {
  let name = vm[_symbols.CONSTANTS].getValue(_name);

  let trusting = vm[_symbols.CONSTANTS].getValue(_trusting);

  let reference = vm.stack.pop();
  let namespace = _namespace ? vm[_symbols.CONSTANTS].getValue(_namespace) : null;
  vm.fetchValue(_vm2.$t0).setAttribute(name, reference, trusting, namespace);
});

_opcodes.APPEND_OPCODES.add(105
/* StaticComponentAttr */
, (vm, {
  op1: _name,
  op2: _value,
  op3: _namespace
}) => {
  let name = vm[_symbols.CONSTANTS].getValue(_name);

  let value = vm[_symbols.CONSTANTS].getValue(_value);

  let namespace = _namespace ? vm[_symbols.CONSTANTS].getValue(_namespace) : null;
  vm.fetchValue(_vm2.$t0).setStaticAttribute(name, value, namespace);
});

class ComponentElementOperations {
  constructor() {
    this.attributes = (0, _util.dict)();
    this.classes = [];
    this.modifiers = [];
  }

  setAttribute(name, value, trusting, namespace) {
    let deferred = {
      value,
      namespace,
      trusting
    };

    if (name === 'class') {
      this.classes.push(value);
    }

    this.attributes[name] = deferred;
  }

  setStaticAttribute(name, value, namespace) {
    let deferred = {
      value,
      namespace
    };

    if (name === 'class') {
      this.classes.push(value);
    }

    this.attributes[name] = deferred;
  }

  addModifier(modifier) {
    this.modifiers.push(modifier);
  }

  flush(vm) {
    let type;
    let attributes = this.attributes;

    for (let name in this.attributes) {
      if (name === 'type') {
        type = attributes[name];
        continue;
      }

      let attr = this.attributes[name];

      if (name === 'class') {
        setDeferredAttr(vm, 'class', mergeClasses(this.classes), attr.namespace, attr.trusting);
      } else {
        setDeferredAttr(vm, name, attr.value, attr.namespace, attr.trusting);
      }
    }

    if (type !== undefined) {
      setDeferredAttr(vm, 'type', type.value, type.namespace, type.trusting);
    }

    return this.modifiers;
  }

}

exports.ComponentElementOperations = ComponentElementOperations;

function mergeClasses(classes) {
  if (classes.length === 0) {
    return '';
  }

  if (classes.length === 1) {
    return classes[0];
  }

  if (allStringClasses(classes)) {
    return classes.join(' ');
  }

  return (0, _classList.default)(classes);
}

function allStringClasses(classes) {
  for (let i = 0; i < classes.length; i++) {
    if (typeof classes[i] !== 'string') {
      return false;
    }
  }

  return true;
}

function setDeferredAttr(vm, name, value, namespace, trusting = false) {
  if (typeof value === 'string') {
    vm.elements().setStaticAttribute(name, value, namespace);
  } else {
    let attribute = vm.elements().setDynamicAttribute(name, (0, _reference.valueForRef)(value), trusting, namespace);

    if (!(0, _reference.isConstRef)(value)) {
      vm.updateWith(new _dom.UpdateDynamicAttributeOpcode(value, attribute, vm.env));
    }
  }
}

_opcodes.APPEND_OPCODES.add(99
/* DidCreateElement */
, (vm, {
  op1: _state
}) => {
  let {
    definition,
    state
  } = vm.fetchValue(_state);
  let {
    manager
  } = definition;
  let operations = vm.fetchValue(_vm2.$t0);
  manager.didCreateElement(state, vm.elements().constructing, operations);
});

_opcodes.APPEND_OPCODES.add(90
/* GetComponentSelf */
, (vm, {
  op1: _state,
  op2: _names
}) => {
  var _a;

  let instance = vm.fetchValue(_state);
  let {
    definition,
    state
  } = instance;
  let {
    manager
  } = definition;
  let selfRef = manager.getSelf(state);

  if (vm.env.debugRenderTree !== undefined) {
    let instance = vm.fetchValue(_state);
    let {
      definition,
      manager
    } = instance;
    let args;

    if (vm.stack.peek() === vm[_symbols.ARGS]) {
      args = vm[_symbols.ARGS].capture();
    } else {
      let names = vm[_symbols.CONSTANTS].getArray(_names);

      vm[_symbols.ARGS].setup(vm.stack, names, [], 0, true);

      args = vm[_symbols.ARGS].capture();
    }

    let moduleName;
    let compilable = definition.compilable;

    if (compilable === null) {
      false && (0, _util.assert)((0, _manager.managerHasCapability)(manager, instance.capabilities, 1
      /* DynamicLayout */
      ), 'BUG: No template was found for this component, and the component did not have the dynamic layout capability');
      compilable = manager.getDynamicLayout(state, vm.runtime.resolver);

      if (compilable !== null) {
        moduleName = compilable.moduleName;
      } else {
        moduleName = '__default__.hbs';
      }
    } else {
      moduleName = compilable.moduleName;
    } // For tearing down the debugRenderTree


    vm.associateDestroyable(instance);

    if ((0, _interfaces.hasCustomDebugRenderTreeLifecycle)(manager)) {
      let nodes = manager.getDebugCustomRenderTree(instance.definition.state, instance.state, args, moduleName);
      nodes.forEach(node => {
        let {
          bucket
        } = node;
        vm.env.debugRenderTree.create(bucket, node);
        (0, _destroyable.registerDestructor)(instance, () => {
          var _a;

          (_a = vm.env.debugRenderTree) === null || _a === void 0 ? void 0 : _a.willDestroy(bucket);
        });
        vm.updateWith(new DebugRenderTreeUpdateOpcode(bucket));
      });
    } else {
      let name = (_a = definition.resolvedName) !== null && _a !== void 0 ? _a : manager.getDebugName(definition.state);
      vm.env.debugRenderTree.create(instance, {
        type: 'component',
        name,
        args,
        template: moduleName,
        instance: (0, _reference.valueForRef)(selfRef)
      });
      vm.associateDestroyable(instance);
      (0, _destroyable.registerDestructor)(instance, () => {
        var _a;

        (_a = vm.env.debugRenderTree) === null || _a === void 0 ? void 0 : _a.willDestroy(instance);
      });
      vm.updateWith(new DebugRenderTreeUpdateOpcode(instance));
    }
  }

  vm.stack.push(selfRef);
});

_opcodes.APPEND_OPCODES.add(91
/* GetComponentTagName */
, (vm, {
  op1: _state
}) => {
  let {
    definition,
    state
  } = vm.fetchValue(_state);
  let {
    manager
  } = definition;
  let tagName = manager.getTagName(state); // User provided value from JS, so we don't bother to encode

  vm.stack.push(tagName);
}); // Dynamic Invocation Only


_opcodes.APPEND_OPCODES.add(92
/* GetComponentLayout */
, (vm, {
  op1: _state
}) => {
  let instance = vm.fetchValue(_state);
  let {
    manager,
    definition
  } = instance;
  let {
    stack
  } = vm;
  let {
    compilable
  } = definition;

  if (compilable === null) {
    let {
      capabilities
    } = instance;
    false && (0, _util.assert)((0, _manager.managerHasCapability)(manager, capabilities, 1
    /* DynamicLayout */
    ), 'BUG: No template was found for this component, and the component did not have the dynamic layout capability');
    compilable = manager.getDynamicLayout(instance.state, vm.runtime.resolver);

    if (compilable === null) {
      if ((0, _manager.managerHasCapability)(manager, capabilities, 1024
      /* Wrapped */
      )) {
        compilable = (0, _util.unwrapTemplate)(vm[_symbols.CONSTANTS].defaultTemplate).asWrappedLayout();
      } else {
        compilable = (0, _util.unwrapTemplate)(vm[_symbols.CONSTANTS].defaultTemplate).asLayout();
      }
    }
  }

  let handle = compilable.compile(vm.context);
  stack.push(compilable.symbolTable);
  stack.push(handle);
});

_opcodes.APPEND_OPCODES.add(75
/* Main */
, (vm, {
  op1: register
}) => {
  let definition = vm.stack.pop();
  let invocation = vm.stack.pop();
  let {
    manager,
    capabilities
  } = definition;
  let state = {
    definition,
    manager,
    capabilities,
    state: null,
    handle: invocation.handle,
    table: invocation.symbolTable,
    lookup: null
  };
  vm.loadValue(register, state);
});

_opcodes.APPEND_OPCODES.add(95
/* PopulateLayout */
, (vm, {
  op1: _state
}) => {
  let {
    stack
  } = vm; // In DEBUG handles could be ErrHandle objects

  let handle = stack.pop();
  let table = stack.pop();
  let state = vm.fetchValue(_state);
  state.handle = handle;
  state.table = table;
});

_opcodes.APPEND_OPCODES.add(38
/* VirtualRootScope */
, (vm, {
  op1: _state
}) => {
  let {
    table,
    manager,
    capabilities,
    state
  } = vm.fetchValue(_state);
  let owner;

  if ((0, _manager.managerHasCapability)(manager, capabilities, 4096
  /* HasSubOwner */
  )) {
    owner = manager.getOwner(state);
    vm.loadValue(_vm2.$t1, null); // Clear the temp register
  } else {
    // Check the temp register to see if an owner was resolved from currying
    owner = vm.fetchValue(_vm2.$t1);

    if (owner === null) {
      // If an owner wasn't found, default to using the current owner. This
      // will happen for normal dynamic component invocation,
      // e.g. <SomeClassicEmberComponent/>
      owner = vm.getOwner();
    } else {
      // Else the owner was found, so clear the temp register. This will happen
      // if we are loading a curried component, e.g. <@someCurriedComponent/>
      vm.loadValue(_vm2.$t1, null);
    }
  }

  vm.pushRootScope(table.symbols.length + 1, owner);
});

_opcodes.APPEND_OPCODES.add(94
/* SetupForEval */
, (vm, {
  op1: _state
}) => {
  let state = vm.fetchValue(_state);

  if (state.table.hasEval) {
    let lookup = state.lookup = (0, _util.dict)();
    vm.scope().bindEvalScope(lookup);
  }
});

_opcodes.APPEND_OPCODES.add(17
/* SetNamedVariables */
, (vm, {
  op1: _state
}) => {
  let state = vm.fetchValue(_state);
  let scope = vm.scope();
  let args = vm.stack.peek();
  let callerNames = args.named.atNames;

  for (let i = callerNames.length - 1; i >= 0; i--) {
    let atName = callerNames[i];
    let symbol = state.table.symbols.indexOf(callerNames[i]);
    let value = args.named.get(atName, true);
    if (symbol !== -1) scope.bindSymbol(symbol + 1, value);
    if (state.lookup) state.lookup[atName] = value;
  }
});

function bindBlock(symbolName, blockName, state, blocks, vm) {
  let symbol = state.table.symbols.indexOf(symbolName);
  let block = blocks.get(blockName);
  if (symbol !== -1) vm.scope().bindBlock(symbol + 1, block);
  if (state.lookup) state.lookup[symbolName] = block;
}

_opcodes.APPEND_OPCODES.add(18
/* SetBlocks */
, (vm, {
  op1: _state
}) => {
  let state = vm.fetchValue(_state);
  let {
    blocks
  } = vm.stack.peek();

  for (let i = 0; i < blocks.names.length; i++) {
    bindBlock(blocks.symbolNames[i], blocks.names[i], state, blocks, vm);
  }
}); // Dynamic Invocation Only


_opcodes.APPEND_OPCODES.add(96
/* InvokeComponentLayout */
, (vm, {
  op1: _state
}) => {
  let state = vm.fetchValue(_state);
  vm.call(state.handle);
});

_opcodes.APPEND_OPCODES.add(100
/* DidRenderLayout */
, (vm, {
  op1: _state
}) => {
  let instance = vm.fetchValue(_state);
  let {
    manager,
    state,
    capabilities
  } = instance;
  let bounds = vm.elements().popBlock();

  if (vm.env.debugRenderTree !== undefined) {
    if ((0, _interfaces.hasCustomDebugRenderTreeLifecycle)(manager)) {
      let nodes = manager.getDebugCustomRenderTree(instance.definition.state, state, _arguments.EMPTY_ARGS);
      nodes.reverse().forEach(node => {
        let {
          bucket
        } = node;
        vm.env.debugRenderTree.didRender(bucket, bounds);
        vm.updateWith(new DebugRenderTreeDidRenderOpcode(bucket, bounds));
      });
    } else {
      vm.env.debugRenderTree.didRender(instance, bounds);
      vm.updateWith(new DebugRenderTreeDidRenderOpcode(instance, bounds));
    }
  }

  if ((0, _manager.managerHasCapability)(manager, capabilities, 512
  /* CreateInstance */
  )) {
    let mgr = manager;
    mgr.didRenderLayout(state, bounds);
    vm.env.didCreate(instance);
    vm.updateWith(new DidUpdateLayoutOpcode(instance, bounds));
  }
});

_opcodes.APPEND_OPCODES.add(98
/* CommitComponentTransaction */
, vm => {
  vm.commitCacheGroup();
});

class UpdateComponentOpcode {
  constructor(component, manager, dynamicScope) {
    this.component = component;
    this.manager = manager;
    this.dynamicScope = dynamicScope;
  }

  evaluate(_vm) {
    let {
      component,
      manager,
      dynamicScope
    } = this;
    manager.update(component, dynamicScope);
  }

}

exports.UpdateComponentOpcode = UpdateComponentOpcode;

class DidUpdateLayoutOpcode {
  constructor(component, bounds) {
    this.component = component;
    this.bounds = bounds;
  }

  evaluate(vm) {
    let {
      component,
      bounds
    } = this;
    let {
      manager,
      state
    } = component;
    manager.didUpdateLayout(state, bounds);
    vm.env.didUpdate(component);
  }

}

exports.DidUpdateLayoutOpcode = DidUpdateLayoutOpcode;

class DebugRenderTreeUpdateOpcode {
  constructor(bucket) {
    this.bucket = bucket;
  }

  evaluate(vm) {
    var _a;

    (_a = vm.env.debugRenderTree) === null || _a === void 0 ? void 0 : _a.update(this.bucket);
  }

}

class DebugRenderTreeDidRenderOpcode {
  constructor(bucket, bounds) {
    this.bucket = bucket;
    this.bounds = bounds;
  }

  evaluate(vm) {
    var _a;

    (_a = vm.env.debugRenderTree) === null || _a === void 0 ? void 0 : _a.didRender(this.bucket, this.bounds);
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVkL29wY29kZXMvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFVQTs7QUE2QkE7O0FBQ0E7O0FBU0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBVUE7O0FBQ0E7Ozs7QUEwQ0Esd0JBQUEsR0FBQSxDQUFrQjtBQUFBO0FBQWxCLEVBQStDLENBQUEsRUFBQSxFQUFLO0FBQUUsRUFBQSxHQUFHLEVBQUU7QUFBUCxDQUFMLEtBQXdCO0FBQ3JFLE1BQUksVUFBVSxHQUFHLEVBQUUsQ0FBRixrQkFBRSxDQUFGLENBQUEsUUFBQSxDQUFqQixNQUFpQixDQUFqQjs7QUFEcUUsV0FFckUsa0JBQU8sQ0FBQyxDQUFGLFVBQU4sRUFBcUIseUJBQXlCLE1BRnVCLEVBRXJFLENBRnFFO0FBSXJFLE1BQUk7QUFBQSxJQUFBLE9BQUE7QUFBVyxJQUFBO0FBQVgsTUFBSixVQUFBO0FBRUEsTUFBSSxRQUFRLEdBQTZCO0FBQUEsSUFBQSxVQUFBO0FBQUEsSUFBQSxPQUFBO0FBQUEsSUFBQSxZQUFBO0FBSXZDLElBQUEsS0FBSyxFQUprQyxJQUFBO0FBS3ZDLElBQUEsTUFBTSxFQUxpQyxJQUFBO0FBTXZDLElBQUEsS0FBSyxFQU5rQyxJQUFBO0FBT3ZDLElBQUEsTUFBTSxFQUFFO0FBUCtCLEdBQXpDO0FBVUEsRUFBQSxFQUFFLENBQUYsS0FBQSxDQUFBLElBQUEsQ0FBQSxRQUFBO0FBaEJGLENBQUE7O0FBbUJBLHdCQUFBLEdBQUEsQ0FBa0I7QUFBQTtBQUFsQixFQUErQyxDQUFBLEVBQUEsRUFBSztBQUFFLEVBQUEsR0FBRyxFQUFFO0FBQVAsQ0FBTCxLQUEyQjtBQUN4RSxNQUFJLEtBQUssR0FBRyxFQUFFLENBQWQsS0FBQTtBQUNBLE1BQUksU0FBUyxHQUNYLDRCQUFrQixLQUFLLENBRHpC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LEVBQUEsV0FBQSxDQUFBLE1BQUEsRUFBa0M7QUFBZCxTQUFBLE1BQUEsR0FBQSxNQUFBO0FBQWtCOztBQUV0QyxFQUFBLFFBQVEsQ0FBQSxFQUFBLEVBQWU7OztBQUNyQixLQUFBLEVBQUEsR0FBQSxFQUFFLENBQUYsR0FBQSxDQUFBLGVBQUEsTUFBQSxJQUFBLElBQXNCLEVBQUEsS0FBQSxLQUF0QixDQUFBLEdBQXNCLEtBQXRCLENBQUEsR0FBc0IsRUFBQSxDQUFBLE1BQUEsQ0FBUyxLQUEvQixNQUFzQixDQUF0QjtBQUNEOztBQUw4Qjs7QUFRakMsTUFBQSw4QkFBQSxDQUFvQztBQUNsQyxFQUFBLFdBQUEsQ0FBQSxNQUFBLEVBQUEsTUFBQSxFQUEwRDtBQUF0QyxTQUFBLE1BQUEsR0FBQSxNQUFBO0FBQXdCLFNBQUEsTUFBQSxHQUFBLE1BQUE7QUFBa0I7O0FBRTlELEVBQUEsUUFBUSxDQUFBLEVBQUEsRUFBZTs7O0FBQ3JCLEtBQUEsRUFBQSxHQUFBLEVBQUUsQ0FBRixHQUFBLENBQUEsZUFBQSxNQUFBLElBQUEsSUFBc0IsRUFBQSxLQUFBLEtBQXRCLENBQUEsR0FBc0IsS0FBdEIsQ0FBQSxHQUFzQixFQUFBLENBQUEsU0FBQSxDQUFZLEtBQVosTUFBQSxFQUF5QixLQUEvQyxNQUFzQixDQUF0QjtBQUNEOztBQUxpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGNoZWNrLFxuICBDaGVja0Z1bmN0aW9uLFxuICBDaGVja0hhbmRsZSxcbiAgQ2hlY2tJbnN0YW5jZW9mLFxuICBDaGVja0ludGVyZmFjZSxcbiAgQ2hlY2tQcm9ncmFtU3ltYm9sVGFibGUsXG4gIENoZWNrU3RyaW5nLFxuICBDaGVja09yLFxufSBmcm9tICdAZ2xpbW1lci9kZWJ1Zyc7XG5pbXBvcnQgeyBERUJVRyB9IGZyb20gJ0BnbGltbWVyL2Vudic7XG5pbXBvcnQge1xuICBCb3VuZHMsXG4gIENvbXBvbmVudERlZmluaXRpb24sXG4gIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eSxcbiAgQ29tcG9uZW50RGVmaW5pdGlvblN0YXRlLFxuICBDb21wb25lbnRJbnN0YW5jZVN0YXRlLFxuICBJbnRlcm5hbENvbXBvbmVudE1hbmFnZXIsXG4gIERpY3QsXG4gIER5bmFtaWNTY29wZSxcbiAgRWxlbWVudE9wZXJhdGlvbnMsXG4gIE9wLFxuICBPcHRpb24sXG4gIFByb2dyYW1TeW1ib2xUYWJsZSxcbiAgUmVjYXN0LFxuICBTY29wZVNsb3QsXG4gIFZNQXJndW1lbnRzLFxuICBXaXRoRHluYW1pY1RhZ05hbWUsXG4gIFdpdGhFbGVtZW50SG9vayxcbiAgV2l0aFVwZGF0ZUhvb2ssXG4gIENhcHR1cmVkQXJndW1lbnRzLFxuICBDb21waWxhYmxlUHJvZ3JhbSxcbiAgQ29tcG9uZW50SW5zdGFuY2UsXG4gIE1vZGlmaWVySW5zdGFuY2UsXG4gIENvbXBvbmVudEluc3RhbmNlV2l0aENyZWF0ZSxcbiAgT3duZXIsXG4gIEN1cnJpZWRUeXBlLFxuICBVcGRhdGluZ09wY29kZSxcbn0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBpc0NvbnN0UmVmLCBSZWZlcmVuY2UsIHZhbHVlRm9yUmVmIH0gZnJvbSAnQGdsaW1tZXIvcmVmZXJlbmNlJztcbmltcG9ydCB7XG4gIGFzc2VydCxcbiAgYXNzaWduLFxuICBkZWJ1Z1RvU3RyaW5nLFxuICBkaWN0LFxuICBFTVBUWV9TVFJJTkdfQVJSQVksXG4gIGV4cGVjdCxcbiAgdW53cmFwVGVtcGxhdGUsXG59IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgJHQwLCAkdDEgfSBmcm9tICdAZ2xpbW1lci92bSc7XG5pbXBvcnQgeyByZWdpc3RlckRlc3RydWN0b3IgfSBmcm9tICdAZ2xpbW1lci9kZXN0cm95YWJsZSc7XG5pbXBvcnQgeyBtYW5hZ2VySGFzQ2FwYWJpbGl0eSB9IGZyb20gJ0BnbGltbWVyL21hbmFnZXInO1xuaW1wb3J0IHsgcmVzb2x2ZUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudC9yZXNvbHZlJztcbmltcG9ydCB7IGhhc0N1c3RvbURlYnVnUmVuZGVyVHJlZUxpZmVjeWNsZSB9IGZyb20gJy4uLy4uL2NvbXBvbmVudC9pbnRlcmZhY2VzJztcbmltcG9ydCB7IEFQUEVORF9PUENPREVTIH0gZnJvbSAnLi4vLi4vb3Bjb2Rlcyc7XG5pbXBvcnQgY3JlYXRlQ2xhc3NMaXN0UmVmIGZyb20gJy4uLy4uL3JlZmVyZW5jZXMvY2xhc3MtbGlzdCc7XG5pbXBvcnQgeyBBUkdTLCBDT05TVEFOVFMgfSBmcm9tICcuLi8uLi9zeW1ib2xzJztcbmltcG9ydCB7IFVwZGF0aW5nVk0gfSBmcm9tICcuLi8uLi92bSc7XG5pbXBvcnQgeyBJbnRlcm5hbFZNIH0gZnJvbSAnLi4vLi4vdm0vYXBwZW5kJztcbmltcG9ydCB7IEJsb2NrQXJndW1lbnRzSW1wbCwgRU1QVFlfQVJHUywgVk1Bcmd1bWVudHNJbXBsIH0gZnJvbSAnLi4vLi4vdm0vYXJndW1lbnRzJztcbmltcG9ydCB7XG4gIENoZWNrQXJndW1lbnRzLFxuICBDaGVja0NvbXBvbmVudERlZmluaXRpb24sXG4gIENoZWNrQ29tcG9uZW50SW5zdGFuY2UsXG4gIENoZWNrRmluaXNoZWRDb21wb25lbnRJbnN0YW5jZSxcbiAgQ2hlY2tJbnZvY2F0aW9uLFxuICBDaGVja1JlZmVyZW5jZSxcbiAgQ2hlY2tDdXJyaWVkQ29tcG9uZW50RGVmaW5pdGlvbixcbn0gZnJvbSAnLi8tZGVidWctc3RyaXAnO1xuaW1wb3J0IHsgVXBkYXRlRHluYW1pY0F0dHJpYnV0ZU9wY29kZSB9IGZyb20gJy4vZG9tJztcbmltcG9ydCB7XG4gIEN1cnJpZWRWYWx1ZSxcbiAgaXNDdXJyaWVkVHlwZSxcbiAgaXNDdXJyaWVkVmFsdWUsXG4gIHJlc29sdmVDdXJyaWVkVmFsdWUsXG59IGZyb20gJy4uLy4uL2N1cnJpZWQtdmFsdWUnO1xuXG4vKipcbiAqIFRoZSBWTSBjcmVhdGVzIGEgbmV3IENvbXBvbmVudEluc3RhbmNlIGRhdGEgc3RydWN0dXJlIGZvciBldmVyeSBjb21wb25lbnRcbiAqIGludm9jYXRpb24gaXQgZW5jb3VudGVycy5cbiAqXG4gKiBTaW1pbGFyIHRvIGhvdyBhIENvbXBvbmVudERlZmluaXRpb24gY29udGFpbnMgc3RhdGUgYWJvdXQgYWxsIGNvbXBvbmVudHMgb2YgYVxuICogcGFydGljdWxhciB0eXBlLCBhIENvbXBvbmVudEluc3RhbmNlIGNvbnRhaW5zIHN0YXRlIHNwZWNpZmljIHRvIGEgcGFydGljdWxhclxuICogaW5zdGFuY2Ugb2YgYSBjb21wb25lbnQgdHlwZS4gSXQgYWxzbyBjb250YWlucyBhIHBvaW50ZXIgYmFjayB0byBpdHNcbiAqIGNvbXBvbmVudCB0eXBlJ3MgQ29tcG9uZW50RGVmaW5pdGlvbi5cbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIEluaXRpYWxDb21wb25lbnRJbnN0YW5jZSB7XG4gIGRlZmluaXRpb246IENvbXBvbmVudERlZmluaXRpb247XG4gIG1hbmFnZXI6IE9wdGlvbjxJbnRlcm5hbENvbXBvbmVudE1hbmFnZXI+O1xuICBjYXBhYmlsaXRpZXM6IE9wdGlvbjxJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHk+O1xuICBzdGF0ZTogbnVsbDtcbiAgaGFuZGxlOiBPcHRpb248bnVtYmVyPjtcbiAgdGFibGU6IE9wdGlvbjxQcm9ncmFtU3ltYm9sVGFibGU+O1xuICBsb29rdXA6IE9wdGlvbjxEaWN0PFNjb3BlU2xvdD4+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvcHVsYXRlZENvbXBvbmVudEluc3RhbmNlIHtcbiAgZGVmaW5pdGlvbjogQ29tcG9uZW50RGVmaW5pdGlvbjtcbiAgbWFuYWdlcjogSW50ZXJuYWxDb21wb25lbnRNYW5hZ2VyO1xuICBjYXBhYmlsaXRpZXM6IEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eTtcbiAgc3RhdGU6IG51bGw7XG4gIGhhbmRsZTogbnVtYmVyO1xuICB0YWJsZTogT3B0aW9uPFByb2dyYW1TeW1ib2xUYWJsZT47XG4gIGxvb2t1cDogT3B0aW9uPERpY3Q8U2NvcGVTbG90Pj47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFydGlhbENvbXBvbmVudERlZmluaXRpb24ge1xuICBzdGF0ZTogT3B0aW9uPENvbXBvbmVudERlZmluaXRpb25TdGF0ZT47XG4gIG1hbmFnZXI6IEludGVybmFsQ29tcG9uZW50TWFuYWdlcjtcbn1cblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlB1c2hDb21wb25lbnREZWZpbml0aW9uLCAodm0sIHsgb3AxOiBoYW5kbGUgfSkgPT4ge1xuICBsZXQgZGVmaW5pdGlvbiA9IHZtW0NPTlNUQU5UU10uZ2V0VmFsdWU8Q29tcG9uZW50RGVmaW5pdGlvbj4oaGFuZGxlKTtcbiAgYXNzZXJ0KCEhZGVmaW5pdGlvbiwgYE1pc3NpbmcgY29tcG9uZW50IGZvciAke2hhbmRsZX1gKTtcblxuICBsZXQgeyBtYW5hZ2VyLCBjYXBhYmlsaXRpZXMgfSA9IGRlZmluaXRpb247XG5cbiAgbGV0IGluc3RhbmNlOiBJbml0aWFsQ29tcG9uZW50SW5zdGFuY2UgPSB7XG4gICAgZGVmaW5pdGlvbixcbiAgICBtYW5hZ2VyLFxuICAgIGNhcGFiaWxpdGllcyxcbiAgICBzdGF0ZTogbnVsbCxcbiAgICBoYW5kbGU6IG51bGwsXG4gICAgdGFibGU6IG51bGwsXG4gICAgbG9va3VwOiBudWxsLFxuICB9O1xuXG4gIHZtLnN0YWNrLnB1c2goaW5zdGFuY2UpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5SZXNvbHZlRHluYW1pY0NvbXBvbmVudCwgKHZtLCB7IG9wMTogX2lzU3RyaWN0IH0pID0+IHtcbiAgbGV0IHN0YWNrID0gdm0uc3RhY2s7XG4gIGxldCBjb21wb25lbnQgPSBjaGVjayhcbiAgICB2YWx1ZUZvclJlZihjaGVjayhzdGFjay5wb3AoKSwgQ2hlY2tSZWZlcmVuY2UpKSxcbiAgICBDaGVja09yKENoZWNrU3RyaW5nLCBDaGVja0N1cnJpZWRDb21wb25lbnREZWZpbml0aW9uKVxuICApO1xuICBsZXQgY29uc3RhbnRzID0gdm1bQ09OU1RBTlRTXTtcbiAgbGV0IG93bmVyID0gdm0uZ2V0T3duZXIoKTtcbiAgbGV0IGlzU3RyaWN0ID0gY29uc3RhbnRzLmdldFZhbHVlPGJvb2xlYW4+KF9pc1N0cmljdCk7XG5cbiAgdm0ubG9hZFZhbHVlKCR0MSwgbnVsbCk7IC8vIENsZWFyIHRoZSB0ZW1wIHJlZ2lzdGVyXG5cbiAgbGV0IGRlZmluaXRpb246IENvbXBvbmVudERlZmluaXRpb24gfCBDdXJyaWVkVmFsdWU7XG5cbiAgaWYgKHR5cGVvZiBjb21wb25lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKERFQlVHICYmIGlzU3RyaWN0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBBdHRlbXB0ZWQgdG8gcmVzb2x2ZSBhIGR5bmFtaWMgY29tcG9uZW50IHdpdGggYSBzdHJpbmcgZGVmaW5pdGlvbiwgXFxgJHtjb21wb25lbnR9XFxgIGluIGEgc3RyaWN0IG1vZGUgdGVtcGxhdGUuIEluIHN0cmljdCBtb2RlLCB1c2luZyBzdHJpbmdzIHRvIHJlc29sdmUgY29tcG9uZW50IGRlZmluaXRpb25zIGlzIHByb2hpYml0ZWQuIFlvdSBjYW4gaW5zdGVhZCBpbXBvcnQgdGhlIGNvbXBvbmVudCBkZWZpbml0aW9uIGFuZCB1c2UgaXQgZGlyZWN0bHkuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBsZXQgcmVzb2x2ZWREZWZpbml0aW9uID0gcmVzb2x2ZUNvbXBvbmVudCh2bS5ydW50aW1lLnJlc29sdmVyLCBjb25zdGFudHMsIGNvbXBvbmVudCwgb3duZXIpO1xuXG4gICAgZGVmaW5pdGlvbiA9IGV4cGVjdChyZXNvbHZlZERlZmluaXRpb24sIGBDb3VsZCBub3QgZmluZCBhIGNvbXBvbmVudCBuYW1lZCBcIiR7Y29tcG9uZW50fVwiYCk7XG4gIH0gZWxzZSBpZiAoaXNDdXJyaWVkVmFsdWUoY29tcG9uZW50KSkge1xuICAgIGRlZmluaXRpb24gPSBjb21wb25lbnQ7XG4gIH0gZWxzZSB7XG4gICAgZGVmaW5pdGlvbiA9IGNvbnN0YW50cy5jb21wb25lbnQoY29tcG9uZW50LCBvd25lcik7XG4gIH1cblxuICBzdGFjay5wdXNoKGRlZmluaXRpb24pO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5SZXNvbHZlQ3VycmllZENvbXBvbmVudCwgKHZtKSA9PiB7XG4gIGxldCBzdGFjayA9IHZtLnN0YWNrO1xuICBsZXQgcmVmID0gY2hlY2soc3RhY2sucG9wKCksIENoZWNrUmVmZXJlbmNlKTtcbiAgbGV0IHZhbHVlID0gdmFsdWVGb3JSZWYocmVmKTtcbiAgbGV0IGNvbnN0YW50cyA9IHZtW0NPTlNUQU5UU107XG5cbiAgbGV0IGRlZmluaXRpb246IEN1cnJpZWRWYWx1ZSB8IENvbXBvbmVudERlZmluaXRpb24gfCBudWxsO1xuXG4gIGlmIChERUJVRyAmJiAhKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyB8fCAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYEV4cGVjdGVkIGEgY29tcG9uZW50IGRlZmluaXRpb24sIGJ1dCByZWNlaXZlZCAke3ZhbHVlfS4gWW91IG1heSBoYXZlIGFjY2lkZW50YWxseSBkb25lIDwke3JlZi5kZWJ1Z0xhYmVsfT4sIHdoZXJlIFwiJHtyZWYuZGVidWdMYWJlbH1cIiB3YXMgYSBzdHJpbmcgaW5zdGVhZCBvZiBhIGN1cnJpZWQgY29tcG9uZW50IGRlZmluaXRpb24uIFlvdSBtdXN0IGVpdGhlciB1c2UgdGhlIGNvbXBvbmVudCBkZWZpbml0aW9uIGRpcmVjdGx5LCBvciB1c2UgdGhlIHt7Y29tcG9uZW50fX0gaGVscGVyIHRvIGNyZWF0ZSBhIGN1cnJpZWQgY29tcG9uZW50IGRlZmluaXRpb24gd2hlbiBpbnZva2luZyBkeW5hbWljYWxseS5gXG4gICAgKTtcbiAgfVxuXG4gIGlmIChpc0N1cnJpZWRWYWx1ZSh2YWx1ZSkpIHtcbiAgICBkZWZpbml0aW9uID0gdmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgZGVmaW5pdGlvbiA9IGNvbnN0YW50cy5jb21wb25lbnQodmFsdWUgYXMgb2JqZWN0LCB2bS5nZXRPd25lcigpLCB0cnVlKTtcblxuICAgIGlmIChERUJVRyAmJiBkZWZpbml0aW9uID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBFeHBlY3RlZCBhIGR5bmFtaWMgY29tcG9uZW50IGRlZmluaXRpb24sIGJ1dCByZWNlaXZlZCBhbiBvYmplY3Qgb3IgZnVuY3Rpb24gdGhhdCBkaWQgbm90IGhhdmUgYSBjb21wb25lbnQgbWFuYWdlciBhc3NvY2lhdGVkIHdpdGggaXQuIFRoZSBkeW5hbWljIGludm9jYXRpb24gd2FzIFxcYDwke1xuICAgICAgICAgIHJlZi5kZWJ1Z0xhYmVsXG4gICAgICAgIH0+XFxgIG9yIFxcYHt7JHtcbiAgICAgICAgICByZWYuZGVidWdMYWJlbFxuICAgICAgICB9fX1cXGAsIGFuZCB0aGUgaW5jb3JyZWN0IGRlZmluaXRpb24gaXMgdGhlIHZhbHVlIGF0IHRoZSBwYXRoIFxcYCR7XG4gICAgICAgICAgcmVmLmRlYnVnTGFiZWxcbiAgICAgICAgfVxcYCwgd2hpY2ggd2FzOiAke2RlYnVnVG9TdHJpbmchKHZhbHVlKX1gXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHN0YWNrLnB1c2goZGVmaW5pdGlvbik7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlB1c2hEeW5hbWljQ29tcG9uZW50SW5zdGFuY2UsICh2bSkgPT4ge1xuICBsZXQgeyBzdGFjayB9ID0gdm07XG4gIGxldCBkZWZpbml0aW9uID0gc3RhY2sucG9wPENvbXBvbmVudERlZmluaXRpb24+KCk7XG5cbiAgbGV0IGNhcGFiaWxpdGllcywgbWFuYWdlcjtcblxuICBpZiAoaXNDdXJyaWVkVmFsdWUoZGVmaW5pdGlvbikpIHtcbiAgICBtYW5hZ2VyID0gY2FwYWJpbGl0aWVzID0gbnVsbDtcbiAgfSBlbHNlIHtcbiAgICBtYW5hZ2VyID0gZGVmaW5pdGlvbi5tYW5hZ2VyO1xuICAgIGNhcGFiaWxpdGllcyA9IGRlZmluaXRpb24uY2FwYWJpbGl0aWVzO1xuICB9XG5cbiAgc3RhY2sucHVzaCh7IGRlZmluaXRpb24sIGNhcGFiaWxpdGllcywgbWFuYWdlciwgc3RhdGU6IG51bGwsIGhhbmRsZTogbnVsbCwgdGFibGU6IG51bGwgfSk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlB1c2hBcmdzLCAodm0sIHsgb3AxOiBfbmFtZXMsIG9wMjogX2Jsb2NrTmFtZXMsIG9wMzogZmxhZ3MgfSkgPT4ge1xuICBsZXQgc3RhY2sgPSB2bS5zdGFjaztcbiAgbGV0IG5hbWVzID0gdm1bQ09OU1RBTlRTXS5nZXRBcnJheTxzdHJpbmc+KF9uYW1lcyk7XG5cbiAgbGV0IHBvc2l0aW9uYWxDb3VudCA9IGZsYWdzID4+IDQ7XG4gIGxldCBhdE5hbWVzID0gZmxhZ3MgJiAwYjEwMDA7XG4gIGxldCBibG9ja05hbWVzID1cbiAgICBmbGFncyAmIDBiMDExMSA/IHZtW0NPTlNUQU5UU10uZ2V0QXJyYXk8c3RyaW5nPihfYmxvY2tOYW1lcykgOiBFTVBUWV9TVFJJTkdfQVJSQVk7XG5cbiAgdm1bQVJHU10uc2V0dXAoc3RhY2ssIG5hbWVzLCBibG9ja05hbWVzLCBwb3NpdGlvbmFsQ291bnQsICEhYXROYW1lcyk7XG4gIHN0YWNrLnB1c2godm1bQVJHU10pO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5QdXNoRW1wdHlBcmdzLCAodm0pID0+IHtcbiAgbGV0IHsgc3RhY2sgfSA9IHZtO1xuXG4gIHN0YWNrLnB1c2godm1bQVJHU10uZW1wdHkoc3RhY2spKTtcbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuQ2FwdHVyZUFyZ3MsICh2bSkgPT4ge1xuICBsZXQgc3RhY2sgPSB2bS5zdGFjaztcblxuICBsZXQgYXJncyA9IGNoZWNrKHN0YWNrLnBvcCgpLCBDaGVja0luc3RhbmNlb2YoVk1Bcmd1bWVudHNJbXBsKSk7XG4gIGxldCBjYXB0dXJlZEFyZ3MgPSBhcmdzLmNhcHR1cmUoKTtcbiAgc3RhY2sucHVzaChjYXB0dXJlZEFyZ3MpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5QcmVwYXJlQXJncywgKHZtLCB7IG9wMTogX3N0YXRlIH0pID0+IHtcbiAgbGV0IHN0YWNrID0gdm0uc3RhY2s7XG4gIGxldCBpbnN0YW5jZSA9IHZtLmZldGNoVmFsdWU8Q29tcG9uZW50SW5zdGFuY2U+KF9zdGF0ZSk7XG4gIGxldCBhcmdzID0gY2hlY2soc3RhY2sucG9wKCksIENoZWNrSW5zdGFuY2VvZihWTUFyZ3VtZW50c0ltcGwpKTtcblxuICBsZXQgeyBkZWZpbml0aW9uIH0gPSBpbnN0YW5jZTtcblxuICBpZiAoaXNDdXJyaWVkVHlwZShkZWZpbml0aW9uLCBDdXJyaWVkVHlwZS5Db21wb25lbnQpKSB7XG4gICAgYXNzZXJ0KFxuICAgICAgIWRlZmluaXRpb24ubWFuYWdlcixcbiAgICAgIFwiSWYgdGhlIGNvbXBvbmVudCBkZWZpbml0aW9uIHdhcyBjdXJyaWVkLCB3ZSBkb24ndCB5ZXQgaGF2ZSBhIG1hbmFnZXJcIlxuICAgICk7XG5cbiAgICBsZXQgY29uc3RhbnRzID0gdm1bQ09OU1RBTlRTXTtcblxuICAgIGxldCB7XG4gICAgICBkZWZpbml0aW9uOiByZXNvbHZlZERlZmluaXRpb24sXG4gICAgICBvd25lcixcbiAgICAgIHJlc29sdmVkLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgIH0gPSByZXNvbHZlQ3VycmllZFZhbHVlKGRlZmluaXRpb24pO1xuXG4gICAgaWYgKHJlc29sdmVkID09PSB0cnVlKSB7XG4gICAgICBkZWZpbml0aW9uID0gcmVzb2x2ZWREZWZpbml0aW9uIGFzIENvbXBvbmVudERlZmluaXRpb247XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzb2x2ZWREZWZpbml0aW9uID09PSAnc3RyaW5nJykge1xuICAgICAgbGV0IHJlc29sdmVkVmFsdWUgPSB2bS5ydW50aW1lLnJlc29sdmVyLmxvb2t1cENvbXBvbmVudChyZXNvbHZlZERlZmluaXRpb24sIG93bmVyKTtcblxuICAgICAgZGVmaW5pdGlvbiA9IGNvbnN0YW50cy5yZXNvbHZlZENvbXBvbmVudChcbiAgICAgICAgZXhwZWN0KHJlc29sdmVkVmFsdWUsICdCVUc6IGV4cGVjdGVkIHJlc29sdmVkIGNvbXBvbmVudCcpLFxuICAgICAgICByZXNvbHZlZERlZmluaXRpb25cbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlZmluaXRpb24gPSBjb25zdGFudHMuY29tcG9uZW50KHJlc29sdmVkRGVmaW5pdGlvbiwgb3duZXIpO1xuICAgIH1cblxuICAgIGlmIChuYW1lZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBhcmdzLm5hbWVkLm1lcmdlKGFzc2lnbih7fSwgLi4ubmFtZWQpKTtcbiAgICB9XG5cbiAgICBpZiAocG9zaXRpb25hbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBhcmdzLnJlYWxsb2MocG9zaXRpb25hbC5sZW5ndGgpO1xuICAgICAgYXJncy5wb3NpdGlvbmFsLnByZXBlbmQocG9zaXRpb25hbCk7XG4gICAgfVxuXG4gICAgbGV0IHsgbWFuYWdlciB9ID0gZGVmaW5pdGlvbjtcblxuICAgIGFzc2VydChpbnN0YW5jZS5tYW5hZ2VyID09PSBudWxsLCAnY29tcG9uZW50IGluc3RhbmNlIG1hbmFnZXIgc2hvdWxkIG5vdCBiZSBwb3B1bGF0ZWQgeWV0Jyk7XG4gICAgYXNzZXJ0KFxuICAgICAgaW5zdGFuY2UuY2FwYWJpbGl0aWVzID09PSBudWxsLFxuICAgICAgJ2NvbXBvbmVudCBpbnN0YW5jZSBtYW5hZ2VyIHNob3VsZCBub3QgYmUgcG9wdWxhdGVkIHlldCdcbiAgICApO1xuXG4gICAgaW5zdGFuY2UuZGVmaW5pdGlvbiA9IGRlZmluaXRpb247XG4gICAgaW5zdGFuY2UubWFuYWdlciA9IG1hbmFnZXI7XG4gICAgaW5zdGFuY2UuY2FwYWJpbGl0aWVzID0gZGVmaW5pdGlvbi5jYXBhYmlsaXRpZXM7XG5cbiAgICAvLyBTYXZlIG9mZiB0aGUgb3duZXIgdGhhdCB0aGlzIGNvbXBvbmVudCB3YXMgY3VycmllZCB3aXRoLiBMYXRlciBvbixcbiAgICAvLyB3ZSdsbCBmZXRjaCB0aGUgdmFsdWUgb2YgdGhpcyByZWdpc3RlciBhbmQgc2V0IGl0IGFzIHRoZSBvd25lciBvbiB0aGVcbiAgICAvLyBuZXcgcm9vdCBzY29wZS5cbiAgICB2bS5sb2FkVmFsdWUoJHQxLCBvd25lcik7XG4gIH1cblxuICBsZXQgeyBtYW5hZ2VyLCBzdGF0ZSB9ID0gZGVmaW5pdGlvbjtcbiAgbGV0IGNhcGFiaWxpdGllcyA9IGluc3RhbmNlLmNhcGFiaWxpdGllcztcblxuICBpZiAoIW1hbmFnZXJIYXNDYXBhYmlsaXR5KG1hbmFnZXIsIGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LlByZXBhcmVBcmdzKSkge1xuICAgIHN0YWNrLnB1c2goYXJncyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IGJsb2NrcyA9IGFyZ3MuYmxvY2tzLnZhbHVlcztcbiAgbGV0IGJsb2NrTmFtZXMgPSBhcmdzLmJsb2Nrcy5uYW1lcztcbiAgbGV0IHByZXBhcmVkQXJncyA9IG1hbmFnZXIucHJlcGFyZUFyZ3Moc3RhdGUsIGFyZ3MpO1xuXG4gIGlmIChwcmVwYXJlZEFyZ3MpIHtcbiAgICBhcmdzLmNsZWFyKCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgICAgc3RhY2sucHVzaChibG9ja3NbaV0pO1xuICAgIH1cblxuICAgIGxldCB7IHBvc2l0aW9uYWwsIG5hbWVkIH0gPSBwcmVwYXJlZEFyZ3M7XG5cbiAgICBsZXQgcG9zaXRpb25hbENvdW50ID0gcG9zaXRpb25hbC5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvc2l0aW9uYWxDb3VudDsgaSsrKSB7XG4gICAgICBzdGFjay5wdXNoKHBvc2l0aW9uYWxbaV0pO1xuICAgIH1cblxuICAgIGxldCBuYW1lcyA9IE9iamVjdC5rZXlzKG5hbWVkKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHN0YWNrLnB1c2gobmFtZWRbbmFtZXNbaV1dKTtcbiAgICB9XG5cbiAgICBhcmdzLnNldHVwKHN0YWNrLCBuYW1lcywgYmxvY2tOYW1lcywgcG9zaXRpb25hbENvdW50LCBmYWxzZSk7XG4gIH1cblxuICBzdGFjay5wdXNoKGFyZ3MpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5DcmVhdGVDb21wb25lbnQsICh2bSwgeyBvcDE6IGZsYWdzLCBvcDI6IF9zdGF0ZSB9KSA9PiB7XG4gIGxldCBpbnN0YW5jZSA9IGNoZWNrKHZtLmZldGNoVmFsdWUoX3N0YXRlKSwgQ2hlY2tDb21wb25lbnRJbnN0YW5jZSk7XG4gIGxldCB7IGRlZmluaXRpb24sIG1hbmFnZXIsIGNhcGFiaWxpdGllcyB9ID0gaW5zdGFuY2U7XG5cbiAgaWYgKCFtYW5hZ2VySGFzQ2FwYWJpbGl0eShtYW5hZ2VyLCBjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5DcmVhdGVJbnN0YW5jZSkpIHtcbiAgICAvLyBUT0RPOiBDbG9zdXJlIGFuZCBNYWluIGNvbXBvbmVudHMgYXJlIGFsd2F5cyBpbnZva2VkIGR5bmFtaWNhbGx5LCBzbyB0aGlzXG4gICAgLy8gb3Bjb2RlIG1heSBydW4gZXZlbiBpZiB0aGlzIGNhcGFiaWxpdHkgaXMgbm90IGVuYWJsZWQuIEluIHRoZSBmdXR1cmUgd2VcbiAgICAvLyBzaG91bGQgaGFuZGxlIHRoaXMgaW4gYSBiZXR0ZXIgd2F5LlxuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBkeW5hbWljU2NvcGU6IE9wdGlvbjxEeW5hbWljU2NvcGU+ID0gbnVsbDtcbiAgaWYgKG1hbmFnZXJIYXNDYXBhYmlsaXR5KG1hbmFnZXIsIGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkR5bmFtaWNTY29wZSkpIHtcbiAgICBkeW5hbWljU2NvcGUgPSB2bS5keW5hbWljU2NvcGUoKTtcbiAgfVxuXG4gIGxldCBoYXNEZWZhdWx0QmxvY2sgPSBmbGFncyAmIDE7XG4gIGxldCBhcmdzOiBPcHRpb248Vk1Bcmd1bWVudHM+ID0gbnVsbDtcblxuICBpZiAobWFuYWdlckhhc0NhcGFiaWxpdHkobWFuYWdlciwgY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuQ3JlYXRlQXJncykpIHtcbiAgICBhcmdzID0gY2hlY2sodm0uc3RhY2sucGVlaygpLCBDaGVja0FyZ3VtZW50cyk7XG4gIH1cblxuICBsZXQgc2VsZjogT3B0aW9uPFJlZmVyZW5jZT4gPSBudWxsO1xuICBpZiAobWFuYWdlckhhc0NhcGFiaWxpdHkobWFuYWdlciwgY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuQ3JlYXRlQ2FsbGVyKSkge1xuICAgIHNlbGYgPSB2bS5nZXRTZWxmKCk7XG4gIH1cblxuICBsZXQgc3RhdGUgPSBtYW5hZ2VyLmNyZWF0ZShcbiAgICB2bS5nZXRPd25lcigpLFxuICAgIGRlZmluaXRpb24uc3RhdGUsXG4gICAgYXJncyxcbiAgICB2bS5lbnYsXG4gICAgZHluYW1pY1Njb3BlLFxuICAgIHNlbGYsXG4gICAgISFoYXNEZWZhdWx0QmxvY2tcbiAgKTtcblxuICAvLyBXZSB3YW50IHRvIHJldXNlIHRoZSBgc3RhdGVgIFBPSk8gaGVyZSwgYmVjYXVzZSB3ZSBrbm93IHRoYXQgdGhlIG9wY29kZXNcbiAgLy8gb25seSB0cmFuc2l0aW9uIGF0IGV4YWN0bHkgb25lIHBsYWNlLlxuICBpbnN0YW5jZS5zdGF0ZSA9IHN0YXRlO1xuXG4gIGlmIChtYW5hZ2VySGFzQ2FwYWJpbGl0eShtYW5hZ2VyLCBjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5VcGRhdGVIb29rKSkge1xuICAgIHZtLnVwZGF0ZVdpdGgobmV3IFVwZGF0ZUNvbXBvbmVudE9wY29kZShzdGF0ZSwgbWFuYWdlciwgZHluYW1pY1Njb3BlKSk7XG4gIH1cbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuUmVnaXN0ZXJDb21wb25lbnREZXN0cnVjdG9yLCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgeyBtYW5hZ2VyLCBzdGF0ZSwgY2FwYWJpbGl0aWVzIH0gPSBjaGVjayh2bS5mZXRjaFZhbHVlKF9zdGF0ZSksIENoZWNrQ29tcG9uZW50SW5zdGFuY2UpO1xuXG4gIGxldCBkID0gbWFuYWdlci5nZXREZXN0cm95YWJsZShzdGF0ZSk7XG5cbiAgaWYgKFxuICAgIERFQlVHICYmXG4gICAgIW1hbmFnZXJIYXNDYXBhYmlsaXR5KG1hbmFnZXIsIGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LldpbGxEZXN0cm95KSAmJlxuICAgIGQgIT09IG51bGwgJiZcbiAgICB0eXBlb2YgJ3dpbGxEZXN0cm95JyBpbiBkXG4gICkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdCVUc6IERlc3RydWN0b3IgaGFzIHdpbGxEZXN0cm95LCBidXQgdGhlIHdpbGxEZXN0cm95IGNhcGFiaWxpdHkgd2FzIG5vdCBlbmFibGVkIGZvciB0aGlzIGNvbXBvbmVudC4gUHJlLWRlc3RydWN0aW9uIGhvb2tzIG11c3QgYmUgZXhwbGljaXRseSBvcHRlZCBpbnRvJ1xuICAgICk7XG4gIH1cblxuICBpZiAoZCkgdm0uYXNzb2NpYXRlRGVzdHJveWFibGUoZCk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkJlZ2luQ29tcG9uZW50VHJhbnNhY3Rpb24sICh2bSwgeyBvcDE6IF9zdGF0ZSB9KSA9PiB7XG4gIGxldCBuYW1lO1xuXG4gIGlmIChERUJVRykge1xuICAgIGxldCB7IGRlZmluaXRpb24sIG1hbmFnZXIgfSA9IGNoZWNrKHZtLmZldGNoVmFsdWUoX3N0YXRlKSwgQ2hlY2tDb21wb25lbnRJbnN0YW5jZSk7XG5cbiAgICBuYW1lID0gZGVmaW5pdGlvbi5yZXNvbHZlZE5hbWUgPz8gbWFuYWdlci5nZXREZWJ1Z05hbWUoZGVmaW5pdGlvbi5zdGF0ZSk7XG4gIH1cblxuICB2bS5iZWdpbkNhY2hlR3JvdXAobmFtZSk7XG4gIHZtLmVsZW1lbnRzKCkucHVzaFNpbXBsZUJsb2NrKCk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlB1dENvbXBvbmVudE9wZXJhdGlvbnMsICh2bSkgPT4ge1xuICB2bS5sb2FkVmFsdWUoJHQwLCBuZXcgQ29tcG9uZW50RWxlbWVudE9wZXJhdGlvbnMoKSk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkNvbXBvbmVudEF0dHIsICh2bSwgeyBvcDE6IF9uYW1lLCBvcDI6IF90cnVzdGluZywgb3AzOiBfbmFtZXNwYWNlIH0pID0+IHtcbiAgbGV0IG5hbWUgPSB2bVtDT05TVEFOVFNdLmdldFZhbHVlPHN0cmluZz4oX25hbWUpO1xuICBsZXQgdHJ1c3RpbmcgPSB2bVtDT05TVEFOVFNdLmdldFZhbHVlPGJvb2xlYW4+KF90cnVzdGluZyk7XG4gIGxldCByZWZlcmVuY2UgPSBjaGVjayh2bS5zdGFjay5wb3AoKSwgQ2hlY2tSZWZlcmVuY2UpO1xuICBsZXQgbmFtZXNwYWNlID0gX25hbWVzcGFjZSA/IHZtW0NPTlNUQU5UU10uZ2V0VmFsdWU8c3RyaW5nPihfbmFtZXNwYWNlKSA6IG51bGw7XG5cbiAgY2hlY2sodm0uZmV0Y2hWYWx1ZSgkdDApLCBDaGVja0luc3RhbmNlb2YoQ29tcG9uZW50RWxlbWVudE9wZXJhdGlvbnMpKS5zZXRBdHRyaWJ1dGUoXG4gICAgbmFtZSxcbiAgICByZWZlcmVuY2UsXG4gICAgdHJ1c3RpbmcsXG4gICAgbmFtZXNwYWNlXG4gICk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlN0YXRpY0NvbXBvbmVudEF0dHIsICh2bSwgeyBvcDE6IF9uYW1lLCBvcDI6IF92YWx1ZSwgb3AzOiBfbmFtZXNwYWNlIH0pID0+IHtcbiAgbGV0IG5hbWUgPSB2bVtDT05TVEFOVFNdLmdldFZhbHVlPHN0cmluZz4oX25hbWUpO1xuICBsZXQgdmFsdWUgPSB2bVtDT05TVEFOVFNdLmdldFZhbHVlPHN0cmluZz4oX3ZhbHVlKTtcbiAgbGV0IG5hbWVzcGFjZSA9IF9uYW1lc3BhY2UgPyB2bVtDT05TVEFOVFNdLmdldFZhbHVlPHN0cmluZz4oX25hbWVzcGFjZSkgOiBudWxsO1xuXG4gIGNoZWNrKHZtLmZldGNoVmFsdWUoJHQwKSwgQ2hlY2tJbnN0YW5jZW9mKENvbXBvbmVudEVsZW1lbnRPcGVyYXRpb25zKSkuc2V0U3RhdGljQXR0cmlidXRlKFxuICAgIG5hbWUsXG4gICAgdmFsdWUsXG4gICAgbmFtZXNwYWNlXG4gICk7XG59KTtcblxudHlwZSBEZWZlcnJlZEF0dHJpYnV0ZSA9IHtcbiAgdmFsdWU6IHN0cmluZyB8IFJlZmVyZW5jZTx1bmtub3duPjtcbiAgbmFtZXNwYWNlOiBPcHRpb248c3RyaW5nPjtcbiAgdHJ1c3Rpbmc/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGNsYXNzIENvbXBvbmVudEVsZW1lbnRPcGVyYXRpb25zIGltcGxlbWVudHMgRWxlbWVudE9wZXJhdGlvbnMge1xuICBwcml2YXRlIGF0dHJpYnV0ZXMgPSBkaWN0PERlZmVycmVkQXR0cmlidXRlPigpO1xuICBwcml2YXRlIGNsYXNzZXM6IChzdHJpbmcgfCBSZWZlcmVuY2U8dW5rbm93bj4pW10gPSBbXTtcbiAgcHJpdmF0ZSBtb2RpZmllcnM6IE1vZGlmaWVySW5zdGFuY2VbXSA9IFtdO1xuXG4gIHNldEF0dHJpYnV0ZShcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgdmFsdWU6IFJlZmVyZW5jZTx1bmtub3duPixcbiAgICB0cnVzdGluZzogYm9vbGVhbixcbiAgICBuYW1lc3BhY2U6IE9wdGlvbjxzdHJpbmc+XG4gICkge1xuICAgIGxldCBkZWZlcnJlZCA9IHsgdmFsdWUsIG5hbWVzcGFjZSwgdHJ1c3RpbmcgfTtcblxuICAgIGlmIChuYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICB0aGlzLmNsYXNzZXMucHVzaCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5hdHRyaWJ1dGVzW25hbWVdID0gZGVmZXJyZWQ7XG4gIH1cblxuICBzZXRTdGF0aWNBdHRyaWJ1dGUobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBuYW1lc3BhY2U6IE9wdGlvbjxzdHJpbmc+KTogdm9pZCB7XG4gICAgbGV0IGRlZmVycmVkID0geyB2YWx1ZSwgbmFtZXNwYWNlIH07XG5cbiAgICBpZiAobmFtZSA9PT0gJ2NsYXNzJykge1xuICAgICAgdGhpcy5jbGFzc2VzLnB1c2godmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMuYXR0cmlidXRlc1tuYW1lXSA9IGRlZmVycmVkO1xuICB9XG5cbiAgYWRkTW9kaWZpZXIobW9kaWZpZXI6IE1vZGlmaWVySW5zdGFuY2UpOiB2b2lkIHtcbiAgICB0aGlzLm1vZGlmaWVycy5wdXNoKG1vZGlmaWVyKTtcbiAgfVxuXG4gIGZsdXNoKHZtOiBJbnRlcm5hbFZNKTogTW9kaWZpZXJJbnN0YW5jZVtdIHtcbiAgICBsZXQgdHlwZTogRGVmZXJyZWRBdHRyaWJ1dGUgfCB1bmRlZmluZWQ7XG4gICAgbGV0IGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7XG5cbiAgICBmb3IgKGxldCBuYW1lIGluIHRoaXMuYXR0cmlidXRlcykge1xuICAgICAgaWYgKG5hbWUgPT09ICd0eXBlJykge1xuICAgICAgICB0eXBlID0gYXR0cmlidXRlc1tuYW1lXTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGxldCBhdHRyID0gdGhpcy5hdHRyaWJ1dGVzW25hbWVdO1xuICAgICAgaWYgKG5hbWUgPT09ICdjbGFzcycpIHtcbiAgICAgICAgc2V0RGVmZXJyZWRBdHRyKHZtLCAnY2xhc3MnLCBtZXJnZUNsYXNzZXModGhpcy5jbGFzc2VzKSwgYXR0ci5uYW1lc3BhY2UsIGF0dHIudHJ1c3RpbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0RGVmZXJyZWRBdHRyKHZtLCBuYW1lLCBhdHRyLnZhbHVlLCBhdHRyLm5hbWVzcGFjZSwgYXR0ci50cnVzdGluZyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2V0RGVmZXJyZWRBdHRyKHZtLCAndHlwZScsIHR5cGUudmFsdWUsIHR5cGUubmFtZXNwYWNlLCB0eXBlLnRydXN0aW5nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5tb2RpZmllcnM7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWVyZ2VDbGFzc2VzKGNsYXNzZXM6IChzdHJpbmcgfCBSZWZlcmVuY2UpW10pOiBzdHJpbmcgfCBSZWZlcmVuY2U8dW5rbm93bj4ge1xuICBpZiAoY2xhc3Nlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cbiAgaWYgKGNsYXNzZXMubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGNsYXNzZXNbMF07XG4gIH1cbiAgaWYgKGFsbFN0cmluZ0NsYXNzZXMoY2xhc3NlcykpIHtcbiAgICByZXR1cm4gY2xhc3Nlcy5qb2luKCcgJyk7XG4gIH1cblxuICByZXR1cm4gY3JlYXRlQ2xhc3NMaXN0UmVmKGNsYXNzZXMgYXMgUmVmZXJlbmNlW10pO1xufVxuXG5mdW5jdGlvbiBhbGxTdHJpbmdDbGFzc2VzKGNsYXNzZXM6IChzdHJpbmcgfCBSZWZlcmVuY2U8dW5rbm93bj4pW10pOiBjbGFzc2VzIGlzIHN0cmluZ1tdIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHR5cGVvZiBjbGFzc2VzW2ldICE9PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gc2V0RGVmZXJyZWRBdHRyKFxuICB2bTogSW50ZXJuYWxWTSxcbiAgbmFtZTogc3RyaW5nLFxuICB2YWx1ZTogc3RyaW5nIHwgUmVmZXJlbmNlPHVua25vd24+LFxuICBuYW1lc3BhY2U6IE9wdGlvbjxzdHJpbmc+LFxuICB0cnVzdGluZyA9IGZhbHNlXG4pIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICB2bS5lbGVtZW50cygpLnNldFN0YXRpY0F0dHJpYnV0ZShuYW1lLCB2YWx1ZSwgbmFtZXNwYWNlKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgYXR0cmlidXRlID0gdm1cbiAgICAgIC5lbGVtZW50cygpXG4gICAgICAuc2V0RHluYW1pY0F0dHJpYnV0ZShuYW1lLCB2YWx1ZUZvclJlZih2YWx1ZSksIHRydXN0aW5nLCBuYW1lc3BhY2UpO1xuICAgIGlmICghaXNDb25zdFJlZih2YWx1ZSkpIHtcbiAgICAgIHZtLnVwZGF0ZVdpdGgobmV3IFVwZGF0ZUR5bmFtaWNBdHRyaWJ1dGVPcGNvZGUodmFsdWUsIGF0dHJpYnV0ZSwgdm0uZW52KSk7XG4gICAgfVxuICB9XG59XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5EaWRDcmVhdGVFbGVtZW50LCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgeyBkZWZpbml0aW9uLCBzdGF0ZSB9ID0gY2hlY2sodm0uZmV0Y2hWYWx1ZShfc3RhdGUpLCBDaGVja0NvbXBvbmVudEluc3RhbmNlKTtcbiAgbGV0IHsgbWFuYWdlciB9ID0gZGVmaW5pdGlvbjtcblxuICBsZXQgb3BlcmF0aW9ucyA9IGNoZWNrKHZtLmZldGNoVmFsdWUoJHQwKSwgQ2hlY2tJbnN0YW5jZW9mKENvbXBvbmVudEVsZW1lbnRPcGVyYXRpb25zKSk7XG5cbiAgKG1hbmFnZXIgYXMgV2l0aEVsZW1lbnRIb29rPHVua25vd24+KS5kaWRDcmVhdGVFbGVtZW50KFxuICAgIHN0YXRlLFxuICAgIGV4cGVjdCh2bS5lbGVtZW50cygpLmNvbnN0cnVjdGluZywgYEV4cGVjdGVkIGEgY29uc3RydWN0aW5nIGVsZW1lbnQgaW4gRGlkQ3JlYXRlT3Bjb2RlYCksXG4gICAgb3BlcmF0aW9uc1xuICApO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5HZXRDb21wb25lbnRTZWxmLCAodm0sIHsgb3AxOiBfc3RhdGUsIG9wMjogX25hbWVzIH0pID0+IHtcbiAgbGV0IGluc3RhbmNlID0gY2hlY2sodm0uZmV0Y2hWYWx1ZShfc3RhdGUpLCBDaGVja0NvbXBvbmVudEluc3RhbmNlKTtcbiAgbGV0IHsgZGVmaW5pdGlvbiwgc3RhdGUgfSA9IGluc3RhbmNlO1xuICBsZXQgeyBtYW5hZ2VyIH0gPSBkZWZpbml0aW9uO1xuICBsZXQgc2VsZlJlZiA9IG1hbmFnZXIuZ2V0U2VsZihzdGF0ZSk7XG5cbiAgaWYgKHZtLmVudi5kZWJ1Z1JlbmRlclRyZWUgIT09IHVuZGVmaW5lZCkge1xuICAgIGxldCBpbnN0YW5jZSA9IGNoZWNrKHZtLmZldGNoVmFsdWUoX3N0YXRlKSwgQ2hlY2tDb21wb25lbnRJbnN0YW5jZSk7XG4gICAgbGV0IHsgZGVmaW5pdGlvbiwgbWFuYWdlciB9ID0gaW5zdGFuY2U7XG5cbiAgICBsZXQgYXJnczogQ2FwdHVyZWRBcmd1bWVudHM7XG5cbiAgICBpZiAodm0uc3RhY2sucGVlaygpID09PSB2bVtBUkdTXSkge1xuICAgICAgYXJncyA9IHZtW0FSR1NdLmNhcHR1cmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG5hbWVzID0gdm1bQ09OU1RBTlRTXS5nZXRBcnJheTxzdHJpbmc+KF9uYW1lcyk7XG4gICAgICB2bVtBUkdTXS5zZXR1cCh2bS5zdGFjaywgbmFtZXMsIFtdLCAwLCB0cnVlKTtcbiAgICAgIGFyZ3MgPSB2bVtBUkdTXS5jYXB0dXJlKCk7XG4gICAgfVxuXG4gICAgbGV0IG1vZHVsZU5hbWU6IHN0cmluZztcbiAgICBsZXQgY29tcGlsYWJsZTogQ29tcGlsYWJsZVByb2dyYW0gfCBudWxsID0gZGVmaW5pdGlvbi5jb21waWxhYmxlO1xuXG4gICAgaWYgKGNvbXBpbGFibGUgPT09IG51bGwpIHtcbiAgICAgIGFzc2VydChcbiAgICAgICAgbWFuYWdlckhhc0NhcGFiaWxpdHkoXG4gICAgICAgICAgbWFuYWdlcixcbiAgICAgICAgICBpbnN0YW5jZS5jYXBhYmlsaXRpZXMsXG4gICAgICAgICAgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LkR5bmFtaWNMYXlvdXRcbiAgICAgICAgKSxcbiAgICAgICAgJ0JVRzogTm8gdGVtcGxhdGUgd2FzIGZvdW5kIGZvciB0aGlzIGNvbXBvbmVudCwgYW5kIHRoZSBjb21wb25lbnQgZGlkIG5vdCBoYXZlIHRoZSBkeW5hbWljIGxheW91dCBjYXBhYmlsaXR5J1xuICAgICAgKTtcblxuICAgICAgY29tcGlsYWJsZSA9IG1hbmFnZXIuZ2V0RHluYW1pY0xheW91dChzdGF0ZSwgdm0ucnVudGltZS5yZXNvbHZlcik7XG5cbiAgICAgIGlmIChjb21waWxhYmxlICE9PSBudWxsKSB7XG4gICAgICAgIG1vZHVsZU5hbWUgPSBjb21waWxhYmxlLm1vZHVsZU5hbWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtb2R1bGVOYW1lID0gJ19fZGVmYXVsdF9fLmhicyc7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG1vZHVsZU5hbWUgPSBjb21waWxhYmxlLm1vZHVsZU5hbWU7XG4gICAgfVxuXG4gICAgLy8gRm9yIHRlYXJpbmcgZG93biB0aGUgZGVidWdSZW5kZXJUcmVlXG4gICAgdm0uYXNzb2NpYXRlRGVzdHJveWFibGUoaW5zdGFuY2UpO1xuXG4gICAgaWYgKGhhc0N1c3RvbURlYnVnUmVuZGVyVHJlZUxpZmVjeWNsZShtYW5hZ2VyKSkge1xuICAgICAgbGV0IG5vZGVzID0gbWFuYWdlci5nZXREZWJ1Z0N1c3RvbVJlbmRlclRyZWUoXG4gICAgICAgIGluc3RhbmNlLmRlZmluaXRpb24uc3RhdGUsXG4gICAgICAgIGluc3RhbmNlLnN0YXRlLFxuICAgICAgICBhcmdzLFxuICAgICAgICBtb2R1bGVOYW1lXG4gICAgICApO1xuXG4gICAgICBub2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgIGxldCB7IGJ1Y2tldCB9ID0gbm9kZTtcbiAgICAgICAgdm0uZW52LmRlYnVnUmVuZGVyVHJlZSEuY3JlYXRlKGJ1Y2tldCwgbm9kZSk7XG5cbiAgICAgICAgcmVnaXN0ZXJEZXN0cnVjdG9yKGluc3RhbmNlLCAoKSA9PiB7XG4gICAgICAgICAgdm0uZW52LmRlYnVnUmVuZGVyVHJlZT8ud2lsbERlc3Ryb3koYnVja2V0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0udXBkYXRlV2l0aChuZXcgRGVidWdSZW5kZXJUcmVlVXBkYXRlT3Bjb2RlKGJ1Y2tldCkpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBuYW1lID0gZGVmaW5pdGlvbi5yZXNvbHZlZE5hbWUgPz8gbWFuYWdlci5nZXREZWJ1Z05hbWUoZGVmaW5pdGlvbi5zdGF0ZSk7XG5cbiAgICAgIHZtLmVudi5kZWJ1Z1JlbmRlclRyZWUuY3JlYXRlKGluc3RhbmNlLCB7XG4gICAgICAgIHR5cGU6ICdjb21wb25lbnQnLFxuICAgICAgICBuYW1lLFxuICAgICAgICBhcmdzLFxuICAgICAgICB0ZW1wbGF0ZTogbW9kdWxlTmFtZSxcbiAgICAgICAgaW5zdGFuY2U6IHZhbHVlRm9yUmVmKHNlbGZSZWYpLFxuICAgICAgfSk7XG5cbiAgICAgIHZtLmFzc29jaWF0ZURlc3Ryb3lhYmxlKGluc3RhbmNlKTtcblxuICAgICAgcmVnaXN0ZXJEZXN0cnVjdG9yKGluc3RhbmNlLCAoKSA9PiB7XG4gICAgICAgIHZtLmVudi5kZWJ1Z1JlbmRlclRyZWU/LndpbGxEZXN0cm95KGluc3RhbmNlKTtcbiAgICAgIH0pO1xuXG4gICAgICB2bS51cGRhdGVXaXRoKG5ldyBEZWJ1Z1JlbmRlclRyZWVVcGRhdGVPcGNvZGUoaW5zdGFuY2UpKTtcbiAgICB9XG4gIH1cblxuICB2bS5zdGFjay5wdXNoKHNlbGZSZWYpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5HZXRDb21wb25lbnRUYWdOYW1lLCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgeyBkZWZpbml0aW9uLCBzdGF0ZSB9ID0gY2hlY2sodm0uZmV0Y2hWYWx1ZShfc3RhdGUpLCBDaGVja0NvbXBvbmVudEluc3RhbmNlKTtcbiAgbGV0IHsgbWFuYWdlciB9ID0gZGVmaW5pdGlvbjtcblxuICBsZXQgdGFnTmFtZSA9IChtYW5hZ2VyIGFzIFJlY2FzdDxcbiAgICBJbnRlcm5hbENvbXBvbmVudE1hbmFnZXIsXG4gICAgV2l0aER5bmFtaWNUYWdOYW1lPHVua25vd24+XG4gID4pLmdldFRhZ05hbWUoc3RhdGUpO1xuXG4gIC8vIFVzZXIgcHJvdmlkZWQgdmFsdWUgZnJvbSBKUywgc28gd2UgZG9uJ3QgYm90aGVyIHRvIGVuY29kZVxuICB2bS5zdGFjay5wdXNoKHRhZ05hbWUpO1xufSk7XG5cbi8vIER5bmFtaWMgSW52b2NhdGlvbiBPbmx5XG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuR2V0Q29tcG9uZW50TGF5b3V0LCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgaW5zdGFuY2UgPSBjaGVjayh2bS5mZXRjaFZhbHVlKF9zdGF0ZSksIENoZWNrQ29tcG9uZW50SW5zdGFuY2UpO1xuXG4gIGxldCB7IG1hbmFnZXIsIGRlZmluaXRpb24gfSA9IGluc3RhbmNlO1xuICBsZXQgeyBzdGFjayB9ID0gdm07XG5cbiAgbGV0IHsgY29tcGlsYWJsZSB9ID0gZGVmaW5pdGlvbjtcblxuICBpZiAoY29tcGlsYWJsZSA9PT0gbnVsbCkge1xuICAgIGxldCB7IGNhcGFiaWxpdGllcyB9ID0gaW5zdGFuY2U7XG5cbiAgICBhc3NlcnQoXG4gICAgICBtYW5hZ2VySGFzQ2FwYWJpbGl0eShtYW5hZ2VyLCBjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5EeW5hbWljTGF5b3V0KSxcbiAgICAgICdCVUc6IE5vIHRlbXBsYXRlIHdhcyBmb3VuZCBmb3IgdGhpcyBjb21wb25lbnQsIGFuZCB0aGUgY29tcG9uZW50IGRpZCBub3QgaGF2ZSB0aGUgZHluYW1pYyBsYXlvdXQgY2FwYWJpbGl0eSdcbiAgICApO1xuXG4gICAgY29tcGlsYWJsZSA9IG1hbmFnZXIuZ2V0RHluYW1pY0xheW91dChpbnN0YW5jZS5zdGF0ZSwgdm0ucnVudGltZS5yZXNvbHZlcik7XG5cbiAgICBpZiAoY29tcGlsYWJsZSA9PT0gbnVsbCkge1xuICAgICAgaWYgKG1hbmFnZXJIYXNDYXBhYmlsaXR5KG1hbmFnZXIsIGNhcGFiaWxpdGllcywgSW50ZXJuYWxDb21wb25lbnRDYXBhYmlsaXR5LldyYXBwZWQpKSB7XG4gICAgICAgIGNvbXBpbGFibGUgPSB1bndyYXBUZW1wbGF0ZSh2bVtDT05TVEFOVFNdLmRlZmF1bHRUZW1wbGF0ZSkuYXNXcmFwcGVkTGF5b3V0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb21waWxhYmxlID0gdW53cmFwVGVtcGxhdGUodm1bQ09OU1RBTlRTXS5kZWZhdWx0VGVtcGxhdGUpLmFzTGF5b3V0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbGV0IGhhbmRsZSA9IGNvbXBpbGFibGUuY29tcGlsZSh2bS5jb250ZXh0KTtcblxuICBzdGFjay5wdXNoKGNvbXBpbGFibGUuc3ltYm9sVGFibGUpO1xuICBzdGFjay5wdXNoKGhhbmRsZSk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLk1haW4sICh2bSwgeyBvcDE6IHJlZ2lzdGVyIH0pID0+IHtcbiAgbGV0IGRlZmluaXRpb24gPSBjaGVjayh2bS5zdGFjay5wb3AoKSwgQ2hlY2tDb21wb25lbnREZWZpbml0aW9uKTtcbiAgbGV0IGludm9jYXRpb24gPSBjaGVjayh2bS5zdGFjay5wb3AoKSwgQ2hlY2tJbnZvY2F0aW9uKTtcblxuICBsZXQgeyBtYW5hZ2VyLCBjYXBhYmlsaXRpZXMgfSA9IGRlZmluaXRpb247XG5cbiAgbGV0IHN0YXRlOiBQb3B1bGF0ZWRDb21wb25lbnRJbnN0YW5jZSA9IHtcbiAgICBkZWZpbml0aW9uLFxuICAgIG1hbmFnZXIsXG4gICAgY2FwYWJpbGl0aWVzLFxuICAgIHN0YXRlOiBudWxsLFxuICAgIGhhbmRsZTogaW52b2NhdGlvbi5oYW5kbGUsXG4gICAgdGFibGU6IGludm9jYXRpb24uc3ltYm9sVGFibGUsXG4gICAgbG9va3VwOiBudWxsLFxuICB9O1xuXG4gIHZtLmxvYWRWYWx1ZShyZWdpc3Rlciwgc3RhdGUpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5Qb3B1bGF0ZUxheW91dCwgKHZtLCB7IG9wMTogX3N0YXRlIH0pID0+IHtcbiAgbGV0IHsgc3RhY2sgfSA9IHZtO1xuXG4gIC8vIEluIERFQlVHIGhhbmRsZXMgY291bGQgYmUgRXJySGFuZGxlIG9iamVjdHNcbiAgbGV0IGhhbmRsZSA9IGNoZWNrKHN0YWNrLnBvcCgpLCBDaGVja0hhbmRsZSk7XG4gIGxldCB0YWJsZSA9IGNoZWNrKHN0YWNrLnBvcCgpLCBDaGVja1Byb2dyYW1TeW1ib2xUYWJsZSk7XG5cbiAgbGV0IHN0YXRlID0gY2hlY2sodm0uZmV0Y2hWYWx1ZShfc3RhdGUpLCBDaGVja0NvbXBvbmVudEluc3RhbmNlKTtcblxuICBzdGF0ZS5oYW5kbGUgPSBoYW5kbGU7XG4gIHN0YXRlLnRhYmxlID0gdGFibGU7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlZpcnR1YWxSb290U2NvcGUsICh2bSwgeyBvcDE6IF9zdGF0ZSB9KSA9PiB7XG4gIGxldCB7IHRhYmxlLCBtYW5hZ2VyLCBjYXBhYmlsaXRpZXMsIHN0YXRlIH0gPSBjaGVjayhcbiAgICB2bS5mZXRjaFZhbHVlKF9zdGF0ZSksXG4gICAgQ2hlY2tGaW5pc2hlZENvbXBvbmVudEluc3RhbmNlXG4gICk7XG5cbiAgbGV0IG93bmVyO1xuXG4gIGlmIChtYW5hZ2VySGFzQ2FwYWJpbGl0eShtYW5hZ2VyLCBjYXBhYmlsaXRpZXMsIEludGVybmFsQ29tcG9uZW50Q2FwYWJpbGl0eS5IYXNTdWJPd25lcikpIHtcbiAgICBvd25lciA9IG1hbmFnZXIuZ2V0T3duZXIoc3RhdGUpO1xuICAgIHZtLmxvYWRWYWx1ZSgkdDEsIG51bGwpOyAvLyBDbGVhciB0aGUgdGVtcCByZWdpc3RlclxuICB9IGVsc2Uge1xuICAgIC8vIENoZWNrIHRoZSB0ZW1wIHJlZ2lzdGVyIHRvIHNlZSBpZiBhbiBvd25lciB3YXMgcmVzb2x2ZWQgZnJvbSBjdXJyeWluZ1xuICAgIG93bmVyID0gdm0uZmV0Y2hWYWx1ZTxPd25lciB8IG51bGw+KCR0MSk7XG5cbiAgICBpZiAob3duZXIgPT09IG51bGwpIHtcbiAgICAgIC8vIElmIGFuIG93bmVyIHdhc24ndCBmb3VuZCwgZGVmYXVsdCB0byB1c2luZyB0aGUgY3VycmVudCBvd25lci4gVGhpc1xuICAgICAgLy8gd2lsbCBoYXBwZW4gZm9yIG5vcm1hbCBkeW5hbWljIGNvbXBvbmVudCBpbnZvY2F0aW9uLFxuICAgICAgLy8gZS5nLiA8U29tZUNsYXNzaWNFbWJlckNvbXBvbmVudC8+XG4gICAgICBvd25lciA9IHZtLmdldE93bmVyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEVsc2UgdGhlIG93bmVyIHdhcyBmb3VuZCwgc28gY2xlYXIgdGhlIHRlbXAgcmVnaXN0ZXIuIFRoaXMgd2lsbCBoYXBwZW5cbiAgICAgIC8vIGlmIHdlIGFyZSBsb2FkaW5nIGEgY3VycmllZCBjb21wb25lbnQsIGUuZy4gPEBzb21lQ3VycmllZENvbXBvbmVudC8+XG4gICAgICB2bS5sb2FkVmFsdWUoJHQxLCBudWxsKTtcbiAgICB9XG4gIH1cblxuICB2bS5wdXNoUm9vdFNjb3BlKHRhYmxlLnN5bWJvbHMubGVuZ3RoICsgMSwgb3duZXIpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5TZXR1cEZvckV2YWwsICh2bSwgeyBvcDE6IF9zdGF0ZSB9KSA9PiB7XG4gIGxldCBzdGF0ZSA9IGNoZWNrKHZtLmZldGNoVmFsdWUoX3N0YXRlKSwgQ2hlY2tGaW5pc2hlZENvbXBvbmVudEluc3RhbmNlKTtcblxuICBpZiAoc3RhdGUudGFibGUuaGFzRXZhbCkge1xuICAgIGxldCBsb29rdXAgPSAoc3RhdGUubG9va3VwID0gZGljdDxTY29wZVNsb3Q+KCkpO1xuICAgIHZtLnNjb3BlKCkuYmluZEV2YWxTY29wZShsb29rdXApO1xuICB9XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlNldE5hbWVkVmFyaWFibGVzLCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgc3RhdGUgPSBjaGVjayh2bS5mZXRjaFZhbHVlKF9zdGF0ZSksIENoZWNrRmluaXNoZWRDb21wb25lbnRJbnN0YW5jZSk7XG4gIGxldCBzY29wZSA9IHZtLnNjb3BlKCk7XG5cbiAgbGV0IGFyZ3MgPSBjaGVjayh2bS5zdGFjay5wZWVrKCksIENoZWNrQXJndW1lbnRzKTtcbiAgbGV0IGNhbGxlck5hbWVzID0gYXJncy5uYW1lZC5hdE5hbWVzO1xuXG4gIGZvciAobGV0IGkgPSBjYWxsZXJOYW1lcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGxldCBhdE5hbWUgPSBjYWxsZXJOYW1lc1tpXTtcbiAgICBsZXQgc3ltYm9sID0gc3RhdGUudGFibGUuc3ltYm9scy5pbmRleE9mKGNhbGxlck5hbWVzW2ldKTtcbiAgICBsZXQgdmFsdWUgPSBhcmdzLm5hbWVkLmdldChhdE5hbWUsIHRydWUpO1xuXG4gICAgaWYgKHN5bWJvbCAhPT0gLTEpIHNjb3BlLmJpbmRTeW1ib2woc3ltYm9sICsgMSwgdmFsdWUpO1xuICAgIGlmIChzdGF0ZS5sb29rdXApIHN0YXRlLmxvb2t1cFthdE5hbWVdID0gdmFsdWU7XG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBiaW5kQmxvY2soXG4gIHN5bWJvbE5hbWU6IHN0cmluZyxcbiAgYmxvY2tOYW1lOiBzdHJpbmcsXG4gIHN0YXRlOiBDb21wb25lbnRJbnN0YW5jZSxcbiAgYmxvY2tzOiBCbG9ja0FyZ3VtZW50c0ltcGwsXG4gIHZtOiBJbnRlcm5hbFZNXG4pIHtcbiAgbGV0IHN5bWJvbCA9IHN0YXRlLnRhYmxlLnN5bWJvbHMuaW5kZXhPZihzeW1ib2xOYW1lKTtcbiAgbGV0IGJsb2NrID0gYmxvY2tzLmdldChibG9ja05hbWUpO1xuXG4gIGlmIChzeW1ib2wgIT09IC0xKSB2bS5zY29wZSgpLmJpbmRCbG9jayhzeW1ib2wgKyAxLCBibG9jayk7XG4gIGlmIChzdGF0ZS5sb29rdXApIHN0YXRlLmxvb2t1cFtzeW1ib2xOYW1lXSA9IGJsb2NrO1xufVxuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuU2V0QmxvY2tzLCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgc3RhdGUgPSBjaGVjayh2bS5mZXRjaFZhbHVlKF9zdGF0ZSksIENoZWNrRmluaXNoZWRDb21wb25lbnRJbnN0YW5jZSk7XG4gIGxldCB7IGJsb2NrcyB9ID0gY2hlY2sodm0uc3RhY2sucGVlaygpLCBDaGVja0FyZ3VtZW50cyk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3MubmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICBiaW5kQmxvY2soYmxvY2tzLnN5bWJvbE5hbWVzW2ldLCBibG9ja3MubmFtZXNbaV0sIHN0YXRlLCBibG9ja3MsIHZtKTtcbiAgfVxufSk7XG5cbi8vIER5bmFtaWMgSW52b2NhdGlvbiBPbmx5XG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuSW52b2tlQ29tcG9uZW50TGF5b3V0LCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgc3RhdGUgPSBjaGVjayh2bS5mZXRjaFZhbHVlKF9zdGF0ZSksIENoZWNrRmluaXNoZWRDb21wb25lbnRJbnN0YW5jZSk7XG5cbiAgdm0uY2FsbChzdGF0ZS5oYW5kbGUhKTtcbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuRGlkUmVuZGVyTGF5b3V0LCAodm0sIHsgb3AxOiBfc3RhdGUgfSkgPT4ge1xuICBsZXQgaW5zdGFuY2UgPSBjaGVjayh2bS5mZXRjaFZhbHVlKF9zdGF0ZSksIENoZWNrQ29tcG9uZW50SW5zdGFuY2UpO1xuICBsZXQgeyBtYW5hZ2VyLCBzdGF0ZSwgY2FwYWJpbGl0aWVzIH0gPSBpbnN0YW5jZTtcbiAgbGV0IGJvdW5kcyA9IHZtLmVsZW1lbnRzKCkucG9wQmxvY2soKTtcblxuICBpZiAodm0uZW52LmRlYnVnUmVuZGVyVHJlZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKGhhc0N1c3RvbURlYnVnUmVuZGVyVHJlZUxpZmVjeWNsZShtYW5hZ2VyKSkge1xuICAgICAgbGV0IG5vZGVzID0gbWFuYWdlci5nZXREZWJ1Z0N1c3RvbVJlbmRlclRyZWUoaW5zdGFuY2UuZGVmaW5pdGlvbi5zdGF0ZSwgc3RhdGUsIEVNUFRZX0FSR1MpO1xuXG4gICAgICBub2Rlcy5yZXZlcnNlKCkuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgICBsZXQgeyBidWNrZXQgfSA9IG5vZGU7XG5cbiAgICAgICAgdm0uZW52LmRlYnVnUmVuZGVyVHJlZSEuZGlkUmVuZGVyKGJ1Y2tldCwgYm91bmRzKTtcblxuICAgICAgICB2bS51cGRhdGVXaXRoKG5ldyBEZWJ1Z1JlbmRlclRyZWVEaWRSZW5kZXJPcGNvZGUoYnVja2V0LCBib3VuZHMpKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2bS5lbnYuZGVidWdSZW5kZXJUcmVlLmRpZFJlbmRlcihpbnN0YW5jZSwgYm91bmRzKTtcblxuICAgICAgdm0udXBkYXRlV2l0aChuZXcgRGVidWdSZW5kZXJUcmVlRGlkUmVuZGVyT3Bjb2RlKGluc3RhbmNlLCBib3VuZHMpKTtcbiAgICB9XG4gIH1cblxuICBpZiAobWFuYWdlckhhc0NhcGFiaWxpdHkobWFuYWdlciwgY2FwYWJpbGl0aWVzLCBJbnRlcm5hbENvbXBvbmVudENhcGFiaWxpdHkuQ3JlYXRlSW5zdGFuY2UpKSB7XG4gICAgbGV0IG1nciA9IGNoZWNrKG1hbmFnZXIsIENoZWNrSW50ZXJmYWNlKHsgZGlkUmVuZGVyTGF5b3V0OiBDaGVja0Z1bmN0aW9uIH0pKTtcbiAgICBtZ3IuZGlkUmVuZGVyTGF5b3V0KHN0YXRlLCBib3VuZHMpO1xuXG4gICAgdm0uZW52LmRpZENyZWF0ZShpbnN0YW5jZSBhcyBDb21wb25lbnRJbnN0YW5jZVdpdGhDcmVhdGUpO1xuICAgIHZtLnVwZGF0ZVdpdGgobmV3IERpZFVwZGF0ZUxheW91dE9wY29kZShpbnN0YW5jZSBhcyBDb21wb25lbnRJbnN0YW5jZVdpdGhDcmVhdGUsIGJvdW5kcykpO1xuICB9XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkNvbW1pdENvbXBvbmVudFRyYW5zYWN0aW9uLCAodm0pID0+IHtcbiAgdm0uY29tbWl0Q2FjaGVHcm91cCgpO1xufSk7XG5cbmV4cG9ydCBjbGFzcyBVcGRhdGVDb21wb25lbnRPcGNvZGUgaW1wbGVtZW50cyBVcGRhdGluZ09wY29kZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY29tcG9uZW50OiBDb21wb25lbnRJbnN0YW5jZVN0YXRlLFxuICAgIHByaXZhdGUgbWFuYWdlcjogV2l0aFVwZGF0ZUhvb2ssXG4gICAgcHJpdmF0ZSBkeW5hbWljU2NvcGU6IE9wdGlvbjxEeW5hbWljU2NvcGU+XG4gICkge31cblxuICBldmFsdWF0ZShfdm06IFVwZGF0aW5nVk0pIHtcbiAgICBsZXQgeyBjb21wb25lbnQsIG1hbmFnZXIsIGR5bmFtaWNTY29wZSB9ID0gdGhpcztcblxuICAgIG1hbmFnZXIudXBkYXRlKGNvbXBvbmVudCwgZHluYW1pY1Njb3BlKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGlkVXBkYXRlTGF5b3V0T3Bjb2RlIGltcGxlbWVudHMgVXBkYXRpbmdPcGNvZGUge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbXBvbmVudDogQ29tcG9uZW50SW5zdGFuY2VXaXRoQ3JlYXRlLCBwcml2YXRlIGJvdW5kczogQm91bmRzKSB7fVxuXG4gIGV2YWx1YXRlKHZtOiBVcGRhdGluZ1ZNKSB7XG4gICAgbGV0IHsgY29tcG9uZW50LCBib3VuZHMgfSA9IHRoaXM7XG4gICAgbGV0IHsgbWFuYWdlciwgc3RhdGUgfSA9IGNvbXBvbmVudDtcblxuICAgIG1hbmFnZXIuZGlkVXBkYXRlTGF5b3V0KHN0YXRlLCBib3VuZHMpO1xuXG4gICAgdm0uZW52LmRpZFVwZGF0ZShjb21wb25lbnQpO1xuICB9XG59XG5cbmNsYXNzIERlYnVnUmVuZGVyVHJlZVVwZGF0ZU9wY29kZSBpbXBsZW1lbnRzIFVwZGF0aW5nT3Bjb2RlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBidWNrZXQ6IG9iamVjdCkge31cblxuICBldmFsdWF0ZSh2bTogVXBkYXRpbmdWTSkge1xuICAgIHZtLmVudi5kZWJ1Z1JlbmRlclRyZWU/LnVwZGF0ZSh0aGlzLmJ1Y2tldCk7XG4gIH1cbn1cblxuY2xhc3MgRGVidWdSZW5kZXJUcmVlRGlkUmVuZGVyT3Bjb2RlIGltcGxlbWVudHMgVXBkYXRpbmdPcGNvZGUge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJ1Y2tldDogb2JqZWN0LCBwcml2YXRlIGJvdW5kczogQm91bmRzKSB7fVxuXG4gIGV2YWx1YXRlKHZtOiBVcGRhdGluZ1ZNKSB7XG4gICAgdm0uZW52LmRlYnVnUmVuZGVyVHJlZT8uZGlkUmVuZGVyKHRoaXMuYnVja2V0LCB0aGlzLmJvdW5kcyk7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=