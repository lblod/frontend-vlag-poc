"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serializeBuilder = serializeBuilder;

var _runtime = require("@glimmer/runtime");

const TEXT_NODE = 3;
const NEEDS_EXTRA_CLOSE = new WeakMap();

function currentNode(cursor) {
  let {
    element,
    nextSibling
  } = cursor;

  if (nextSibling === null) {
    return element.lastChild;
  } else {
    return nextSibling.previousSibling;
  }
}

class SerializeBuilder extends _runtime.NewElementBuilder {
  constructor() {
    super(...arguments);
    this.serializeBlockDepth = 0;
  }

  __openBlock() {
    let {
      tagName
    } = this.element;

    if (tagName !== 'TITLE' && tagName !== 'SCRIPT' && tagName !== 'STYLE') {
      let depth = this.serializeBlockDepth++;

      this.__appendComment(`%+b:${depth}%`);
    }

    super.__openBlock();
  }

  __closeBlock() {
    let {
      tagName
    } = this.element;

    super.__closeBlock();

    if (tagName !== 'TITLE' && tagName !== 'SCRIPT' && tagName !== 'STYLE') {
      let depth = --this.serializeBlockDepth;

      this.__appendComment(`%-b:${depth}%`);
    }
  }

  __appendHTML(html) {
    let {
      tagName
    } = this.element;

    if (tagName === 'TITLE' || tagName === 'SCRIPT' || tagName === 'STYLE') {
      return super.__appendHTML(html);
    } // Do we need to run the html tokenizer here?


    let first = this.__appendComment('%glmr%');

    if (tagName === 'TABLE') {
      let openIndex = html.indexOf('<');

      if (openIndex > -1) {
        let tr = html.slice(openIndex + 1, openIndex + 3);

        if (tr === 'tr') {
          html = `<tbody>${html}</tbody>`;
        }
      }
    }

    if (html === '') {
      this.__appendComment('% %');
    } else {
      super.__appendHTML(html);
    }

    let last = this.__appendComment('%glmr%');

    return new _runtime.ConcreteBounds(this.element, first, last);
  }

  __appendText(string) {
    let {
      tagName
    } = this.element;
    let current = currentNode(this);

    if (tagName === 'TITLE' || tagName === 'SCRIPT' || tagName === 'STYLE') {
      return super.__appendText(string);
    } else if (string === '') {
      return this.__appendComment('% %');
    } else if (current && current.nodeType === TEXT_NODE) {
      this.__appendComment('%|%');
    }

    return super.__appendText(string);
  }

  closeElement() {
    if (NEEDS_EXTRA_CLOSE.has(this.element)) {
      NEEDS_EXTRA_CLOSE.delete(this.element);
      super.closeElement();
    }

    return super.closeElement();
  }

  openElement(tag) {
    if (tag === 'tr') {
      if (this.element.tagName !== 'TBODY' && this.element.tagName !== 'THEAD' && this.element.tagName !== 'TFOOT') {
        this.openElement('tbody'); // This prevents the closeBlock comment from being re-parented
        // under the auto inserted tbody. Rehydration builder needs to
        // account for the insertion since it is injected here and not
        // really in the template.

        NEEDS_EXTRA_CLOSE.set(this.constructing, true);
        this.flushElement(null);
      }
    }

    return super.openElement(tag);
  }

  pushRemoteElement(element, cursorId, insertBefore = null) {
    let {
      dom
    } = this;
    let script = dom.createElement('script');
    script.setAttribute('glmr', cursorId);
    dom.insertBefore(element, script, insertBefore);
    return super.pushRemoteElement(element, cursorId, insertBefore);
  }

}

function serializeBuilder(env, cursor) {
  return SerializeBuilder.forInitialRender(env, cursor);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL25vZGUvbGliL3NlcmlhbGl6ZS1idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFRQTs7QUFJQSxNQUFNLFNBQVMsR0FBZixDQUFBO0FBRUEsTUFBTSxpQkFBaUIsR0FBRyxJQUExQixPQUEwQixFQUExQjs7QUFFQSxTQUFBLFdBQUEsQ0FBQSxNQUFBLEVBQzhFO0FBRTVFLE1BQUk7QUFBQSxJQUFBLE9BQUE7QUFBVyxJQUFBO0FBQVgsTUFBSixNQUFBOztBQUVBLE1BQUksV0FBVyxLQUFmLElBQUEsRUFBMEI7QUFDeEIsV0FBTyxPQUFPLENBQWQsU0FBQTtBQURGLEdBQUEsTUFFTztBQUNMLFdBQU8sV0FBVyxDQUFsQixlQUFBO0FBQ0Q7QUFDRjs7QUFFRCxNQUFBLGdCQUFBLFNBQUEsMEJBQUEsQ0FBZ0Q7QUFBaEQsRUFBQSxXQUFBLEdBQUE7O0FBQ1UsU0FBQSxtQkFBQSxHQUFBLENBQUE7QUEyR1Q7O0FBekdDLEVBQUEsV0FBVyxHQUFBO0FBQ1QsUUFBSTtBQUFFLE1BQUE7QUFBRixRQUFjLEtBQWxCLE9BQUE7O0FBRUEsUUFBSSxPQUFPLEtBQVAsT0FBQSxJQUF1QixPQUFPLEtBQTlCLFFBQUEsSUFBK0MsT0FBTyxLQUExRCxPQUFBLEVBQXdFO0FBQ3RFLFVBQUksS0FBSyxHQUFHLEtBQVosbUJBQVksRUFBWjs7QUFDQSxXQUFBLGVBQUEsQ0FBcUIsT0FBTyxLQUE1QixHQUFBO0FBQ0Q7O0FBRUQsVUFBQSxXQUFBO0FBQ0Q7O0FBRUQsRUFBQSxZQUFZLEdBQUE7QUFDVixRQUFJO0FBQUUsTUFBQTtBQUFGLFFBQWMsS0FBbEIsT0FBQTs7QUFFQSxVQUFBLFlBQUE7O0FBRUEsUUFBSSxPQUFPLEtBQVAsT0FBQSxJQUF1QixPQUFPLEtBQTlCLFFBQUEsSUFBK0MsT0FBTyxLQUExRCxPQUFBLEVBQXdFO0FBQ3RFLFVBQUksS0FBSyxHQUFHLEVBQUUsS0FBZCxtQkFBQTs7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T0FBQSxFQUFBLFFBQUEsRUFHZixZQUFBLEdBSGUsSUFBQSxFQUd1QjtBQUV0QyxRQUFJO0FBQUUsTUFBQTtBQUFGLFFBQUosSUFBQTtBQUNBLFFBQUksTUFBTSxHQUFHLEdBQUcsQ0FBSCxhQUFBLENBQWIsUUFBYSxDQUFiO0FBQ0EsSUFBQSxNQUFNLENBQU4sWUFBQSxDQUFBLE1BQUEsRUFBQSxRQUFBO0FBQ0EsSUFBQSxHQUFHLENBQUgsWUFBQSxDQUFBLE9BQUEsRUFBQSxNQUFBLEVBQUEsWUFBQTtBQUNBLFdBQU8sTUFBQSxpQkFBQSxDQUFBLE9BQUEsRUFBQSxRQUFBLEVBQVAsWUFBTyxDQUFQO0FBQ0Q7O0FBM0c2Qzs7QUE4RzFDLFNBQUEsZ0JBQUEsQ0FBQSxHQUFBLEVBQUEsTUFBQSxFQUUrRDtBQUVuRSxTQUFPLGdCQUFnQixDQUFoQixnQkFBQSxDQUFBLEdBQUEsRUFBUCxNQUFPLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtcbiAgQm91bmRzLFxuICBFbnZpcm9ubWVudCxcbiAgT3B0aW9uLFxuICBFbGVtZW50QnVpbGRlcixcbiAgTWF5YmUsXG4gIE1vZGlmaWVySW5zdGFuY2UsXG59IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgQ29uY3JldGVCb3VuZHMsIE5ld0VsZW1lbnRCdWlsZGVyIH0gZnJvbSAnQGdsaW1tZXIvcnVudGltZSc7XG5pbXBvcnQgeyBSZW1vdGVMaXZlQmxvY2sgfSBmcm9tICdAZ2xpbW1lci9ydW50aW1lJztcbmltcG9ydCB0eXBlIHsgU2ltcGxlRWxlbWVudCwgU2ltcGxlTm9kZSwgU2ltcGxlVGV4dCB9IGZyb20gJ0BzaW1wbGUtZG9tL2ludGVyZmFjZSc7XG5cbmNvbnN0IFRFWFRfTk9ERSA9IDM7XG5cbmNvbnN0IE5FRURTX0VYVFJBX0NMT1NFID0gbmV3IFdlYWtNYXA8U2ltcGxlTm9kZT4oKTtcblxuZnVuY3Rpb24gY3VycmVudE5vZGUoXG4gIGN1cnNvcjogRWxlbWVudEJ1aWxkZXIgfCB7IGVsZW1lbnQ6IFNpbXBsZUVsZW1lbnQ7IG5leHRTaWJsaW5nOiBTaW1wbGVOb2RlIH1cbik6IE9wdGlvbjxTaW1wbGVOb2RlPiB7XG4gIGxldCB7IGVsZW1lbnQsIG5leHRTaWJsaW5nIH0gPSBjdXJzb3I7XG5cbiAgaWYgKG5leHRTaWJsaW5nID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubGFzdENoaWxkO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXh0U2libGluZy5wcmV2aW91c1NpYmxpbmc7XG4gIH1cbn1cblxuY2xhc3MgU2VyaWFsaXplQnVpbGRlciBleHRlbmRzIE5ld0VsZW1lbnRCdWlsZGVyIGltcGxlbWVudHMgRWxlbWVudEJ1aWxkZXIge1xuICBwcml2YXRlIHNlcmlhbGl6ZUJsb2NrRGVwdGggPSAwO1xuXG4gIF9fb3BlbkJsb2NrKCk6IHZvaWQge1xuICAgIGxldCB7IHRhZ05hbWUgfSA9IHRoaXMuZWxlbWVudDtcblxuICAgIGlmICh0YWdOYW1lICE9PSAnVElUTEUnICYmIHRhZ05hbWUgIT09ICdTQ1JJUFQnICYmIHRhZ05hbWUgIT09ICdTVFlMRScpIHtcbiAgICAgIGxldCBkZXB0aCA9IHRoaXMuc2VyaWFsaXplQmxvY2tEZXB0aCsrO1xuICAgICAgdGhpcy5fX2FwcGVuZENvbW1lbnQoYCUrYjoke2RlcHRofSVgKTtcbiAgICB9XG5cbiAgICBzdXBlci5fX29wZW5CbG9jaygpO1xuICB9XG5cbiAgX19jbG9zZUJsb2NrKCk6IHZvaWQge1xuICAgIGxldCB7IHRhZ05hbWUgfSA9IHRoaXMuZWxlbWVudDtcblxuICAgIHN1cGVyLl9fY2xvc2VCbG9jaygpO1xuXG4gICAgaWYgKHRhZ05hbWUgIT09ICdUSVRMRScgJiYgdGFnTmFtZSAhPT0gJ1NDUklQVCcgJiYgdGFnTmFtZSAhPT0gJ1NUWUxFJykge1xuICAgICAgbGV0IGRlcHRoID0gLS10aGlzLnNlcmlhbGl6ZUJsb2NrRGVwdGg7XG4gICAgICB0aGlzLl9fYXBwZW5kQ29tbWVudChgJS1iOiR7ZGVwdGh9JWApO1xuICAgIH1cbiAgfVxuXG4gIF9fYXBwZW5kSFRNTChodG1sOiBzdHJpbmcpOiBCb3VuZHMge1xuICAgIGxldCB7IHRhZ05hbWUgfSA9IHRoaXMuZWxlbWVudDtcblxuICAgIGlmICh0YWdOYW1lID09PSAnVElUTEUnIHx8IHRhZ05hbWUgPT09ICdTQ1JJUFQnIHx8IHRhZ05hbWUgPT09ICdTVFlMRScpIHtcbiAgICAgIHJldHVybiBzdXBlci5fX2FwcGVuZEhUTUwoaHRtbCk7XG4gICAgfVxuXG4gICAgLy8gRG8gd2UgbmVlZCB0byBydW4gdGhlIGh0bWwgdG9rZW5pemVyIGhlcmU/XG4gICAgbGV0IGZpcnN0ID0gdGhpcy5fX2FwcGVuZENvbW1lbnQoJyVnbG1yJScpO1xuICAgIGlmICh0YWdOYW1lID09PSAnVEFCTEUnKSB7XG4gICAgICBsZXQgb3BlbkluZGV4ID0gaHRtbC5pbmRleE9mKCc8Jyk7XG4gICAgICBpZiAob3BlbkluZGV4ID4gLTEpIHtcbiAgICAgICAgbGV0IHRyID0gaHRtbC5zbGljZShvcGVuSW5kZXggKyAxLCBvcGVuSW5kZXggKyAzKTtcbiAgICAgICAgaWYgKHRyID09PSAndHInKSB7XG4gICAgICAgICAgaHRtbCA9IGA8dGJvZHk+JHtodG1sfTwvdGJvZHk+YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaHRtbCA9PT0gJycpIHtcbiAgICAgIHRoaXMuX19hcHBlbmRDb21tZW50KCclICUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3VwZXIuX19hcHBlbmRIVE1MKGh0bWwpO1xuICAgIH1cblxuICAgIGxldCBsYXN0ID0gdGhpcy5fX2FwcGVuZENvbW1lbnQoJyVnbG1yJScpO1xuICAgIHJldHVybiBuZXcgQ29uY3JldGVCb3VuZHModGhpcy5lbGVtZW50LCBmaXJzdCwgbGFzdCk7XG4gIH1cblxuICBfX2FwcGVuZFRleHQoc3RyaW5nOiBzdHJpbmcpOiBTaW1wbGVUZXh0IHtcbiAgICBsZXQgeyB0YWdOYW1lIH0gPSB0aGlzLmVsZW1lbnQ7XG4gICAgbGV0IGN1cnJlbnQgPSBjdXJyZW50Tm9kZSh0aGlzKTtcblxuICAgIGlmICh0YWdOYW1lID09PSAnVElUTEUnIHx8IHRhZ05hbWUgPT09ICdTQ1JJUFQnIHx8IHRhZ05hbWUgPT09ICdTVFlMRScpIHtcbiAgICAgIHJldHVybiBzdXBlci5fX2FwcGVuZFRleHQoc3RyaW5nKTtcbiAgICB9IGVsc2UgaWYgKHN0cmluZyA9PT0gJycpIHtcbiAgICAgIHJldHVybiAodGhpcy5fX2FwcGVuZENvbW1lbnQoJyUgJScpIGFzIGFueSkgYXMgU2ltcGxlVGV4dDtcbiAgICB9IGVsc2UgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5ub2RlVHlwZSA9PT0gVEVYVF9OT0RFKSB7XG4gICAgICB0aGlzLl9fYXBwZW5kQ29tbWVudCgnJXwlJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1cGVyLl9fYXBwZW5kVGV4dChzdHJpbmcpO1xuICB9XG5cbiAgY2xvc2VFbGVtZW50KCk6IE9wdGlvbjxNb2RpZmllckluc3RhbmNlW10+IHtcbiAgICBpZiAoTkVFRFNfRVhUUkFfQ0xPU0UuaGFzKHRoaXMuZWxlbWVudCkpIHtcbiAgICAgIE5FRURTX0VYVFJBX0NMT1NFLmRlbGV0ZSh0aGlzLmVsZW1lbnQpO1xuICAgICAgc3VwZXIuY2xvc2VFbGVtZW50KCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1cGVyLmNsb3NlRWxlbWVudCgpO1xuICB9XG5cbiAgb3BlbkVsZW1lbnQodGFnOiBzdHJpbmcpIHtcbiAgICBpZiAodGFnID09PSAndHInKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuZWxlbWVudC50YWdOYW1lICE9PSAnVEJPRFknICYmXG4gICAgICAgIHRoaXMuZWxlbWVudC50YWdOYW1lICE9PSAnVEhFQUQnICYmXG4gICAgICAgIHRoaXMuZWxlbWVudC50YWdOYW1lICE9PSAnVEZPT1QnXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5vcGVuRWxlbWVudCgndGJvZHknKTtcbiAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0aGUgY2xvc2VCbG9jayBjb21tZW50IGZyb20gYmVpbmcgcmUtcGFyZW50ZWRcbiAgICAgICAgLy8gdW5kZXIgdGhlIGF1dG8gaW5zZXJ0ZWQgdGJvZHkuIFJlaHlkcmF0aW9uIGJ1aWxkZXIgbmVlZHMgdG9cbiAgICAgICAgLy8gYWNjb3VudCBmb3IgdGhlIGluc2VydGlvbiBzaW5jZSBpdCBpcyBpbmplY3RlZCBoZXJlIGFuZCBub3RcbiAgICAgICAgLy8gcmVhbGx5IGluIHRoZSB0ZW1wbGF0ZS5cbiAgICAgICAgTkVFRFNfRVhUUkFfQ0xPU0Uuc2V0KHRoaXMuY29uc3RydWN0aW5nISwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZmx1c2hFbGVtZW50KG51bGwpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzdXBlci5vcGVuRWxlbWVudCh0YWcpO1xuICB9XG5cbiAgcHVzaFJlbW90ZUVsZW1lbnQoXG4gICAgZWxlbWVudDogU2ltcGxlRWxlbWVudCxcbiAgICBjdXJzb3JJZDogc3RyaW5nLFxuICAgIGluc2VydEJlZm9yZTogTWF5YmU8U2ltcGxlTm9kZT4gPSBudWxsXG4gICk6IE9wdGlvbjxSZW1vdGVMaXZlQmxvY2s+IHtcbiAgICBsZXQgeyBkb20gfSA9IHRoaXM7XG4gICAgbGV0IHNjcmlwdCA9IGRvbS5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCdnbG1yJywgY3Vyc29ySWQpO1xuICAgIGRvbS5pbnNlcnRCZWZvcmUoZWxlbWVudCwgc2NyaXB0LCBpbnNlcnRCZWZvcmUpO1xuICAgIHJldHVybiBzdXBlci5wdXNoUmVtb3RlRWxlbWVudChlbGVtZW50LCBjdXJzb3JJZCwgaW5zZXJ0QmVmb3JlKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplQnVpbGRlcihcbiAgZW52OiBFbnZpcm9ubWVudCxcbiAgY3Vyc29yOiB7IGVsZW1lbnQ6IFNpbXBsZUVsZW1lbnQ7IG5leHRTaWJsaW5nOiBPcHRpb248U2ltcGxlTm9kZT4gfVxuKTogRWxlbWVudEJ1aWxkZXIge1xuICByZXR1cm4gU2VyaWFsaXplQnVpbGRlci5mb3JJbml0aWFsUmVuZGVyKGVudiwgY3Vyc29yKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=