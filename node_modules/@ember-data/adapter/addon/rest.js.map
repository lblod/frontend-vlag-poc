{"version":3,"file":"rest.js","sources":["../src/rest.ts"],"sourcesContent":["/**\n  @module @ember-data/adapter/rest\n*/\nimport { getOwner } from '@ember/application';\nimport { assert, warn } from '@ember/debug';\nimport { computed } from '@ember/object';\nimport { join } from '@ember/runloop';\n\nimport { DEBUG } from '@ember-data/env';\nimport type { Snapshot, SnapshotRecordArray } from '@ember-data/legacy-compat/-private';\nimport type Store from '@ember-data/store';\nimport type ShimModelClass from '@ember-data/store/-private/legacy-model-support/shim-model-class';\nimport type { AdapterPayload } from '@ember-data/types/q/minimum-adapter-interface';\n\nimport { determineBodyPromise, fetch, parseResponseHeaders, serializeIntoHash, serializeQueryParams } from './-private';\nimport type { FastBoot } from './-private/fastboot-interface';\nimport AdapterError, {\n  AbortError,\n  ConflictError,\n  ForbiddenError,\n  InvalidError,\n  NotFoundError,\n  ServerError,\n  TimeoutError,\n  UnauthorizedError,\n} from './error';\nimport Adapter, { BuildURLMixin } from './index';\n\ntype Payload = Error | Record<string, unknown> | unknown[] | string | undefined;\n\ntype QueryState = {\n  include?: unknown;\n  since?: unknown;\n};\n\nexport interface FetchRequestInit extends RequestInit {\n  url: string;\n  method: string;\n  type: string;\n  contentType?: any;\n  body?: any;\n  data?: any;\n  cache?: any;\n  headers?: any;\n}\n\nexport interface JQueryRequestInit extends JQueryAjaxSettings {\n  url: string;\n  method: string;\n  type: string;\n}\n\nexport type RequestData = {\n  url: string;\n  method: string;\n  [key: string]: any;\n};\n\ntype ResponseData = {\n  status: number;\n  textStatus: string;\n  headers: Record<string, any>;\n  errorThrown?: any;\n};\n\ndeclare const jQuery: JQueryStatic | undefined;\n\n/**\n * <blockquote style=\"margin: 1em; padding: .1em 1em .1em 1em; border-left: solid 1em #E34C32; background: #e0e0e0;\">\n  <p>\n    ⚠️ <strong>This is LEGACY documentation</strong> for a feature that is no longer encouraged to be used.\n    If starting a new app or thinking of implementing a new adapter, consider writing a\n    <a href=\"/ember-data/release/classes/%3CInterface%3E%20Handler\">Handler</a> instead to be used with the <a href=\"https://github.com/emberjs/data/tree/main/packages/request#readme\">RequestManager</a>\n  </p>\n  </blockquote>\n\n  The REST adapter allows your store to communicate with an HTTP server by\n  transmitting JSON via XHR.\n\n  This adapter is designed around the idea that the JSON exchanged with\n  the server should be conventional. It builds URLs in a manner that follows\n  the structure of most common REST-style web services.\n\n  ## Success and failure\n\n  The REST adapter will consider a success any response with a status code\n  of the 2xx family (\"Success\"), as well as 304 (\"Not Modified\"). Any other\n  status code will be considered a failure.\n\n  On success, the request promise will be resolved with the full response\n  payload.\n\n  Failed responses with status code 422 (\"Unprocessable Entity\") will be\n  considered \"invalid\". The response will be discarded, except for the\n  `errors` key. The request promise will be rejected with a `InvalidError`.\n  This error object will encapsulate the saved `errors` value.\n\n  Any other status codes will be treated as an \"adapter error\". The request\n  promise will be rejected, similarly to the \"invalid\" case, but with\n  an instance of `AdapterError` instead.\n\n  ## JSON Structure\n\n  The REST adapter expects the JSON returned from your server to follow\n  these conventions.\n\n  ### Object Root\n\n  The JSON payload should be an object that contains the record inside a\n  root property. For example, in response to a `GET` request for\n  `/posts/1`, the JSON should look like this:\n\n  ```js\n  {\n    \"posts\": {\n      \"id\": 1,\n      \"title\": \"I'm Running to Reform the W3C's Tag\",\n      \"author\": \"Yehuda Katz\"\n    }\n  }\n  ```\n\n  Similarly, in response to a `GET` request for `/posts`, the JSON should\n  look like this:\n\n  ```js\n  {\n    \"posts\": [\n      {\n        \"id\": 1,\n        \"title\": \"I'm Running to Reform the W3C's Tag\",\n        \"author\": \"Yehuda Katz\"\n      },\n      {\n        \"id\": 2,\n        \"title\": \"Rails is omakase\",\n        \"author\": \"D2H\"\n      }\n    ]\n  }\n  ```\n\n  Note that the object root can be pluralized for both a single-object response\n  and an array response: the REST adapter is not strict on this. Further, if the\n  HTTP server responds to a `GET` request to `/posts/1` (e.g. the response to a\n  `findRecord` query) with more than one object in the array, Ember Data will\n  only display the object with the matching ID.\n\n  ### Conventional Names\n\n  Attribute names in your JSON payload should be the camelCased versions of\n  the attributes in your Ember.js models.\n\n  For example, if you have a `Person` model:\n\n  ```app/models/person.js\n  import Model, { attr } from '@ember-data/model';\n\n  export default Model.extend({\n    firstName: attr('string'),\n    lastName: attr('string'),\n    occupation: attr('string')\n  });\n  ```\n\n  The JSON returned should look like this:\n\n  ```js\n  {\n    \"people\": {\n      \"id\": 5,\n      \"firstName\": \"Zaphod\",\n      \"lastName\": \"Beeblebrox\",\n      \"occupation\": \"President\"\n    }\n  }\n  ```\n\n  #### Relationships\n\n  Relationships are usually represented by ids to the record in the\n  relationship. The related records can then be sideloaded in the\n  response under a key for the type.\n\n  ```js\n  {\n    \"posts\": {\n      \"id\": 5,\n      \"title\": \"I'm Running to Reform the W3C's Tag\",\n      \"author\": \"Yehuda Katz\",\n      \"comments\": [1, 2]\n    },\n    \"comments\": [{\n      \"id\": 1,\n      \"author\": \"User 1\",\n      \"message\": \"First!\",\n    }, {\n      \"id\": 2,\n      \"author\": \"User 2\",\n      \"message\": \"Good Luck!\",\n    }]\n  }\n  ```\n\n  If the records in the relationship are not known when the response\n  is serialized it's also possible to represent the relationship as a\n  URL using the `links` key in the response. Ember Data will fetch\n  this URL to resolve the relationship when it is accessed for the\n  first time.\n\n  ```js\n  {\n    \"posts\": {\n      \"id\": 5,\n      \"title\": \"I'm Running to Reform the W3C's Tag\",\n      \"author\": \"Yehuda Katz\",\n      \"links\": {\n        \"comments\": \"/posts/5/comments\"\n      }\n    }\n  }\n  ```\n\n  ### Errors\n\n  If a response is considered a failure, the JSON payload is expected to include\n  a top-level key `errors`, detailing any specific issues. For example:\n\n  ```js\n  {\n    \"errors\": {\n      \"msg\": \"Something went wrong\"\n    }\n  }\n  ```\n\n  This adapter does not make any assumptions as to the format of the `errors`\n  object. It will simply be passed along as is, wrapped in an instance\n  of `InvalidError` or `AdapterError`. The serializer can interpret it\n  afterwards.\n\n  ## Customization\n\n  ### Endpoint path customization\n\n  Endpoint paths can be prefixed with a `namespace` by setting the namespace\n  property on the adapter:\n\n  ```app/adapters/application.js\n  import RESTAdapter from '@ember-data/adapter/rest';\n\n  export default class ApplicationAdapter extends RESTAdapter {\n    namespace = 'api/1';\n  }\n  ```\n  Requests for the `Person` model would now target `/api/1/people/1`.\n\n  ### Host customization\n\n  An adapter can target other hosts by setting the `host` property.\n\n  ```app/adapters/application.js\n  import RESTAdapter from '@ember-data/adapter/rest';\n\n  export default class ApplicationAdapter extends RESTAdapter {\n    host = 'https://api.example.com';\n  }\n  ```\n\n  ### Headers customization\n\n  Some APIs require HTTP headers, e.g. to provide an API key. Arbitrary\n  headers can be set as key/value pairs on the `RESTAdapter`'s `headers`\n  object and Ember Data will send them along with each ajax request.\n\n\n  ```app/adapters/application.js\n  import RESTAdapter from '@ember-data/adapter/rest';\n  import { computed } from '@ember/object';\n\n  export default class ApplicationAdapter extends RESTAdapter {\n    headers: computed(function() {\n      return {\n        'API_KEY': 'secret key',\n        'ANOTHER_HEADER': 'Some header value'\n      };\n    }\n  }\n  ```\n\n  `headers` can also be used as a computed property to support dynamic\n  headers. In the example below, the `session` object has been\n  injected into an adapter by Ember's container.\n\n  ```app/adapters/application.js\n  import RESTAdapter from '@ember-data/adapter/rest';\n  import { computed } from '@ember/object';\n\n  export default class ApplicationAdapter extends RESTAdapter {\n    headers: computed('session.authToken', function() {\n      return {\n        'API_KEY': this.session.authToken,\n        'ANOTHER_HEADER': 'Some header value'\n      };\n    })\n  }\n  ```\n\n  In some cases, your dynamic headers may require data from some\n  object outside of Ember's observer system (for example\n  `document.cookie`). You can use the\n  [volatile](/api/classes/Ember.ComputedProperty.html?anchor=volatile)\n  function to set the property into a non-cached mode causing the headers to\n  be recomputed with every request.\n\n  ```app/adapters/application.js\n  import RESTAdapter from '@ember-data/adapter/rest';\n  import { computed } from '@ember/object';\n\n  export default class ApplicationAdapter extends RESTAdapter {\n    headers: computed(function() {\n      return {\n        'API_KEY': document.cookie.match(/apiKey\\=([^;]*)/)['1'],\n        'ANOTHER_HEADER': 'Some header value'\n      };\n    }).volatile()\n  }\n  ```\n\n  @class RESTAdapter\n  @main @ember-data/adapter/rest\n  @public\n  @constructor\n  @extends Adapter\n  @uses BuildURLMixin\n*/\nclass RESTAdapter extends Adapter.extend(BuildURLMixin) {\n  declare _fastboot: FastBoot;\n  declare host: string | null;\n  declare namespace: string | null;\n\n  /**\n    This property allows ajax to still be used instead when `false`.\n\n    @property useFetch\n    @type {Boolean}\n    @default true\n    @public\n  */\n  useFetch = true;\n\n  _defaultContentType = 'application/json; charset=utf-8';\n\n  @computed()\n  get fastboot() {\n    // Avoid computed property override deprecation in fastboot as suggested by:\n    // https://deprecations.emberjs.com/v3.x/#toc_computed-property-override\n    let fastboot = this._fastboot;\n    if (fastboot) {\n      return fastboot;\n    }\n    return (this._fastboot = (getOwner(this) as any).lookup('service:fastboot'));\n  }\n\n  set fastboot(value: FastBoot) {\n    this._fastboot = value;\n  }\n\n  /**\n    By default, the RESTAdapter will send the query params sorted alphabetically to the\n    server.\n\n    For example:\n\n    ```js\n    store.query('posts', { sort: 'price', category: 'pets' });\n    ```\n\n    will generate a requests like this `/posts?category=pets&sort=price`, even if the\n    parameters were specified in a different order.\n\n    That way the generated URL will be deterministic and that simplifies caching mechanisms\n    in the backend.\n\n    Setting `sortQueryParams` to a falsey value will respect the original order.\n\n    In case you want to sort the query parameters with a different criteria, set\n    `sortQueryParams` to your custom sort function.\n\n    ```app/adapters/application.js\n    import RESTAdapter from '@ember-data/adapter/rest';\n\n    export default class ApplicationAdapter extends RESTAdapter {\n      sortQueryParams(params) {\n        let sortedKeys = Object.keys(params).sort().reverse();\n        let len = sortedKeys.length, newParams = {};\n\n        for (let i = 0; i < len; i++) {\n          newParams[sortedKeys[i]] = params[sortedKeys[i]];\n        }\n\n        return newParams;\n      }\n    }\n    ```\n\n    @method sortQueryParams\n    @param {Object} obj\n    @return {Object}\n    @public\n  */\n  sortQueryParams(obj): Record<string, unknown> {\n    let keys = Object.keys(obj);\n    let len = keys.length;\n    if (len < 2) {\n      return obj;\n    }\n    let newQueryParams = {};\n    let sortedKeys = keys.sort();\n\n    for (let i = 0; i < len; i++) {\n      newQueryParams[sortedKeys[i]] = obj[sortedKeys[i]];\n    }\n    return newQueryParams;\n  }\n\n  /**\n    By default the RESTAdapter will send each find request coming from a `store.find`\n    or from accessing a relationship separately to the server. If your server supports passing\n    ids as a query string, you can set coalesceFindRequests to true to coalesce all find requests\n    within a single runloop.\n\n    For example, if you have an initial payload of:\n\n    ```javascript\n    {\n      post: {\n        id: 1,\n        comments: [1, 2]\n      }\n    }\n    ```\n\n    By default calling `post.comments` will trigger the following requests(assuming the\n    comments haven't been loaded before):\n\n    ```\n    GET /comments/1\n    GET /comments/2\n    ```\n\n    If you set coalesceFindRequests to `true` it will instead trigger the following request:\n\n    ```\n    GET /comments?ids[]=1&ids[]=2\n    ```\n\n    Setting coalesceFindRequests to `true` also works for `store.find` requests and `belongsTo`\n    relationships accessed within the same runloop. If you set `coalesceFindRequests: true`\n\n    ```javascript\n    store.findRecord('comment', 1);\n    store.findRecord('comment', 2);\n    ```\n\n    will also send a request to: `GET /comments?ids[]=1&ids[]=2`\n\n    Note: Requests coalescing rely on URL building strategy. So if you override `buildURL` in your app\n    `groupRecordsForFindMany` more likely should be overridden as well in order for coalescing to work.\n\n    @property coalesceFindRequests\n    @public\n    @type {boolean}\n  */\n  get coalesceFindRequests() {\n    let coalesceFindRequests = this._coalesceFindRequests;\n    if (typeof coalesceFindRequests === 'boolean') {\n      return coalesceFindRequests;\n    }\n    return (this._coalesceFindRequests = false);\n  }\n\n  set coalesceFindRequests(value: boolean) {\n    this._coalesceFindRequests = value;\n  }\n\n  /**\n    Endpoint paths can be prefixed with a `namespace` by setting the namespace\n    property on the adapter:\n\n    ```app/adapters/application.js\n    import RESTAdapter from '@ember-data/adapter/rest';\n\n    export default class ApplicationAdapter extends RESTAdapter {\n      namespace = 'api/1';\n    }\n    ```\n\n    Requests for the `Post` model would now target `/api/1/post/`.\n\n    @property namespace\n    @public\n    @type {String}\n  */\n\n  /**\n    An adapter can target other hosts by setting the `host` property.\n\n    ```app/adapters/application.js\n    import RESTAdapter from '@ember-data/adapter/rest';\n\n    export default class ApplicationAdapter extends RESTAdapter {\n      host = 'https://api.example.com';\n    }\n    ```\n\n    Requests for the `Post` model would now target `https://api.example.com/post/`.\n\n    @property host\n    @public\n    @type {String}\n  */\n\n  /**\n    Some APIs require HTTP headers, e.g. to provide an API\n    key. Arbitrary headers can be set as key/value pairs on the\n    `RESTAdapter`'s `headers` object and Ember Data will send them\n    along with each ajax request. For dynamic headers see [headers\n    customization](/ember-data/release/classes/RESTAdapter).\n\n    ```app/adapters/application.js\n    import RESTAdapter from '@ember-data/adapter/rest';\n    import { computed } from '@ember/object';\n\n    export default class ApplicationAdapter extends RESTAdapter {\n      headers: computed(function() {\n        return {\n          'API_KEY': 'secret key',\n          'ANOTHER_HEADER': 'Some header value'\n        };\n      })\n    }\n    ```\n\n    @property headers\n    @public\n    @type {Object}\n   */\n  declare headers: Record<string, unknown> | undefined;\n\n  /**\n    Called by the store in order to fetch the JSON for a given\n    type and ID.\n\n    The `findRecord` method makes an Ajax request to a URL computed by\n    `buildURL`, and returns a promise for the resulting payload.\n\n    This method performs an HTTP `GET` request with the id provided as part of the query string.\n\n    @since 1.13.0\n    @method findRecord\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {String} id\n    @param {Snapshot} snapshot\n    @return {Promise} promise\n  */\n  findRecord(store: Store, type: ShimModelClass, id: string, snapshot: Snapshot): Promise<AdapterPayload> {\n    let url = this.buildURL(type.modelName, id, snapshot, 'findRecord');\n    let query: QueryState = this.buildQuery(snapshot);\n\n    return this.ajax(url, 'GET', { data: query });\n  }\n\n  /**\n    Called by the store in order to fetch a JSON array for all\n    of the records for a given type.\n\n    The `findAll` method makes an Ajax (HTTP GET) request to a URL computed by `buildURL`, and returns a\n    promise for the resulting payload.\n\n    @method findAll\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {undefined} neverSet a value is never provided to this argument\n    @param {SnapshotRecordArray} snapshotRecordArray\n    @return {Promise} promise\n  */\n  findAll(\n    store: Store,\n    type: ShimModelClass,\n    sinceToken,\n    snapshotRecordArray: SnapshotRecordArray\n  ): Promise<AdapterPayload> {\n    let query: QueryState = this.buildQuery(snapshotRecordArray);\n    let url = this.buildURL(type.modelName, null, snapshotRecordArray, 'findAll');\n\n    if (sinceToken) {\n      query.since = sinceToken;\n    }\n\n    return this.ajax(url, 'GET', { data: query });\n  }\n\n  /**\n    Called by the store in order to fetch a JSON array for\n    the records that match a particular query.\n\n    The `query` method makes an Ajax (HTTP GET) request to a URL\n    computed by `buildURL`, and returns a promise for the resulting\n    payload.\n\n    The `query` argument is a simple JavaScript object that will be passed directly\n    to the server as parameters.\n\n    @method query\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {Object} query\n    @param {Collection} recordArray\n    @param {Object} adapterOptions\n    @return {Promise} promise\n  */\n  query(store: Store, type: ShimModelClass, query): Promise<AdapterPayload> {\n    let url = this.buildURL(type.modelName, null, null, 'query', query);\n\n    if (this.sortQueryParams) {\n      query = this.sortQueryParams(query);\n    }\n\n    return this.ajax(url, 'GET', { data: query });\n  }\n\n  /**\n    Called by the store in order to fetch a JSON object for\n    the record that matches a particular query.\n\n    The `queryRecord` method makes an Ajax (HTTP GET) request to a URL\n    computed by `buildURL`, and returns a promise for the resulting\n    payload.\n\n    The `query` argument is a simple JavaScript object that will be passed directly\n    to the server as parameters.\n\n    @since 1.13.0\n    @method queryRecord\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {Object} query\n    @param {Object} adapterOptions\n    @return {Promise} promise\n  */\n  queryRecord(\n    store: Store,\n    type: ShimModelClass,\n    query: Record<string, unknown>,\n    adapterOptions: Record<string, unknown>\n  ): Promise<AdapterPayload> {\n    let url = this.buildURL(type.modelName, null, null, 'queryRecord', query);\n\n    if (this.sortQueryParams) {\n      query = this.sortQueryParams(query);\n    }\n\n    return this.ajax(url, 'GET', { data: query });\n  }\n\n  /**\n    Called by the store in order to fetch several records together if `coalesceFindRequests` is true\n\n    For example, if the original payload looks like:\n\n    ```js\n    {\n      \"id\": 1,\n      \"title\": \"Rails is omakase\",\n      \"comments\": [ 1, 2, 3 ]\n    }\n    ```\n\n    The IDs will be passed as a URL-encoded Array of IDs, in this form:\n\n    ```\n    ids[]=1&ids[]=2&ids[]=3\n    ```\n\n    Many servers, such as Rails and PHP, will automatically convert this URL-encoded array\n    into an Array for you on the server-side. If you want to encode the\n    IDs, differently, just override this (one-line) method.\n\n    The `findMany` method makes an Ajax (HTTP GET) request to a URL computed by `buildURL`, and returns a\n    promise for the resulting payload.\n\n    @method findMany\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {Array} ids\n    @param {Array} snapshots\n    @return {Promise} promise\n  */\n  findMany(store: Store, type: ShimModelClass, ids: string[], snapshots: Snapshot[]): Promise<AdapterPayload> {\n    let url = this.buildURL(type.modelName, ids, snapshots, 'findMany');\n    return this.ajax(url, 'GET', { data: { ids: ids } });\n  }\n\n  /**\n    Called by the store in order to fetch a JSON array for\n    the unloaded records in a has-many relationship that were originally\n    specified as a URL (inside of `links`).\n\n    For example, if your original payload looks like this:\n\n    ```js\n    {\n      \"post\": {\n        \"id\": 1,\n        \"title\": \"Rails is omakase\",\n        \"links\": { \"comments\": \"/posts/1/comments\" }\n      }\n    }\n    ```\n\n    This method will be called with the parent record and `/posts/1/comments`.\n\n    The `findHasMany` method will make an Ajax (HTTP GET) request to the originally specified URL.\n\n    The format of your `links` value will influence the final request URL via the `urlPrefix` method:\n\n    * Links beginning with `//`, `http://`, `https://`, will be used as is, with no further manipulation.\n\n    * Links beginning with a single `/` will have the current adapter's `host` value prepended to it.\n\n    * Links with no beginning `/` will have a parentURL prepended to it, via the current adapter's `buildURL`.\n\n    @method findHasMany\n    @public\n    @param {Store} store\n    @param {Snapshot} snapshot\n    @param {String} url\n    @param {Object} relationship meta object describing the relationship\n    @return {Promise} promise\n  */\n  findHasMany(\n    store: Store,\n    snapshot: Snapshot,\n    url: string,\n    relationship: Record<string, unknown>\n  ): Promise<AdapterPayload> {\n    let id = snapshot.id;\n    let type = snapshot.modelName;\n\n    assert(\n      `Attempted to fetch the hasMany relationship for ${type}, but the record has no id`,\n      typeof id === 'string' && id.length > 0\n    );\n    url = this.urlPrefix(url, this.buildURL(type, id, snapshot, 'findHasMany'));\n\n    return this.ajax(url, 'GET');\n  }\n\n  /**\n    Called by the store in order to fetch the JSON for the unloaded record in a\n    belongs-to relationship that was originally specified as a URL (inside of\n    `links`).\n\n    For example, if your original payload looks like this:\n\n    ```js\n    {\n      \"person\": {\n        \"id\": 1,\n        \"name\": \"Tom Dale\",\n        \"links\": { \"group\": \"/people/1/group\" }\n      }\n    }\n    ```\n\n    This method will be called with the parent record and `/people/1/group`.\n\n    The `findBelongsTo` method will make an Ajax (HTTP GET) request to the originally specified URL.\n\n    The format of your `links` value will influence the final request URL via the `urlPrefix` method:\n\n    * Links beginning with `//`, `http://`, `https://`, will be used as is, with no further manipulation.\n\n    * Links beginning with a single `/` will have the current adapter's `host` value prepended to it.\n\n    * Links with no beginning `/` will have a parentURL prepended to it, via the current adapter's `buildURL`.\n\n    @method findBelongsTo\n    @public\n    @param {Store} store\n    @param {Snapshot} snapshot\n    @param {String} url\n    @param {Object} relationship meta object describing the relationship\n    @return {Promise} promise\n  */\n  findBelongsTo(store: Store, snapshot: Snapshot, url: string, relationship): Promise<AdapterPayload> {\n    let id = snapshot.id;\n    let type = snapshot.modelName;\n\n    assert(\n      `Attempted to fetch the belongsTo relationship for ${type}, but the record has no id`,\n      typeof id === 'string' && id.length > 0\n    );\n    url = this.urlPrefix(url, this.buildURL(type, id, snapshot, 'findBelongsTo'));\n    return this.ajax(url, 'GET');\n  }\n\n  /**\n    Called by the store when a newly created record is\n    saved via the `save` method on a model record instance.\n\n    The `createRecord` method serializes the record and makes an Ajax (HTTP POST) request\n    to a URL computed by `buildURL`.\n\n    See `serialize` for information on how to customize the serialized form\n    of a record.\n\n    @method createRecord\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {Snapshot} snapshot\n    @return {Promise} promise\n  */\n  createRecord(store: Store, type: ShimModelClass, snapshot: Snapshot): Promise<AdapterPayload> {\n    let url = this.buildURL(type.modelName, null, snapshot, 'createRecord');\n\n    const data = serializeIntoHash(store, type, snapshot);\n\n    return this.ajax(url, 'POST', { data });\n  }\n\n  /**\n    Called by the store when an existing record is saved\n    via the `save` method on a model record instance.\n\n    The `updateRecord` method serializes the record and makes an Ajax (HTTP PUT) request\n    to a URL computed by `buildURL`.\n\n    See `serialize` for information on how to customize the serialized form\n    of a record.\n\n    @method updateRecord\n    @public\n    @param {Store} store\n    @param {Model} schema\n    @param {Snapshot} snapshot\n    @return {Promise} promise\n  */\n  updateRecord(store: Store, schema: ShimModelClass, snapshot: Snapshot): Promise<AdapterPayload> {\n    const data = serializeIntoHash(store, schema, snapshot, {});\n    const type = snapshot.modelName;\n    const id = snapshot.id;\n    assert(`Attempted to update the ${type} record, but the record has no id`, typeof id === 'string' && id.length > 0);\n    let url = this.buildURL(type, id, snapshot, 'updateRecord');\n\n    return this.ajax(url, 'PUT', { data });\n  }\n\n  /**\n    Called by the store when a record is deleted.\n\n    The `deleteRecord` method  makes an Ajax (HTTP DELETE) request to a URL computed by `buildURL`.\n\n    @method deleteRecord\n    @public\n    @param {Store} store\n    @param {Model} type\n    @param {Snapshot} snapshot\n    @return {Promise} promise\n  */\n  deleteRecord(store: Store, schema: ShimModelClass, snapshot: Snapshot): Promise<AdapterPayload> {\n    const type = snapshot.modelName;\n    const id = snapshot.id;\n    assert(`Attempted to delete the ${type} record, but the record has no id`, typeof id === 'string' && id.length > 0);\n\n    return this.ajax(this.buildURL(type, id, snapshot, 'deleteRecord'), 'DELETE');\n  }\n\n  _stripIDFromURL(store: Store, snapshot: Snapshot): string {\n    const type = snapshot.modelName;\n    const id = snapshot.id;\n    assert(\n      `Attempted to strip the url from the ${type} record for coalescing, but the record has no id`,\n      typeof id === 'string' && id.length > 0\n    );\n\n    let url = this.buildURL(type, id, snapshot);\n\n    let expandedURL = url.split('/');\n    // Case when the url is of the format ...something/:id\n    // We are decodeURIComponent-ing the lastSegment because if it represents\n    // the id, it has been encodeURIComponent-ified within `buildURL`. If we\n    // don't do this, then records with id having special characters are not\n    // coalesced correctly (see GH #4190 for the reported bug)\n    let lastSegment: string = expandedURL[expandedURL.length - 1];\n    if (decodeURIComponent(lastSegment) === id) {\n      expandedURL[expandedURL.length - 1] = '';\n    } else if (id && endsWith(lastSegment, '?id=' + id)) {\n      //Case when the url is of the format ...something?id=:id\n      expandedURL[expandedURL.length - 1] = lastSegment.substring(0, lastSegment.length - id.length - 1);\n    }\n\n    return expandedURL.join('/');\n  }\n\n  // http://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers\n  maxURLLength = 2048;\n\n  /**\n    Organize records into groups, each of which is to be passed to separate\n    calls to `findMany`.\n\n    This implementation groups together records that have the same base URL but\n    differing ids. For example `/comments/1` and `/comments/2` will be grouped together\n    because we know findMany can coalesce them together as `/comments?ids[]=1&ids[]=2`\n\n    It also supports urls where ids are passed as a query param, such as `/comments?id=1`\n    but not those where there is more than 1 query param such as `/comments?id=2&name=David`\n    Currently only the query param of `id` is supported. If you need to support others, please\n    override this or the `_stripIDFromURL` method.\n\n    It does not group records that have differing base urls, such as for example: `/posts/1/comments/2`\n    and `/posts/2/comments/3`\n\n    @method groupRecordsForFindMany\n    @public\n    @param {Store} store\n    @param {Array} snapshots\n    @return {Array}  an array of arrays of records, each of which is to be\n                      loaded separately by `findMany`.\n  */\n  groupRecordsForFindMany(store: Store, snapshots: Snapshot[]): Snapshot[][] {\n    let groups = new Map();\n    let adapter = this;\n    let maxURLLength = this.maxURLLength;\n\n    snapshots.forEach((snapshot) => {\n      let baseUrl = adapter._stripIDFromURL(store, snapshot);\n      if (!groups.has(baseUrl)) {\n        groups.set(baseUrl, []);\n      }\n\n      groups.get(baseUrl).push(snapshot);\n    });\n\n    function splitGroupToFitInUrl(group, maxURLLength, paramNameLength) {\n      let idsSize = 0;\n      let baseUrl = adapter._stripIDFromURL(store, group[0]);\n      let splitGroups: Snapshot[][] = [[]];\n\n      group.forEach((snapshot) => {\n        let additionalLength = encodeURIComponent(snapshot.id).length + paramNameLength;\n        if (baseUrl.length + idsSize + additionalLength >= maxURLLength) {\n          idsSize = 0;\n          splitGroups.push([]);\n        }\n\n        idsSize += additionalLength;\n\n        let lastGroupIndex = splitGroups.length - 1;\n        splitGroups[lastGroupIndex].push(snapshot);\n      });\n\n      return splitGroups;\n    }\n\n    let groupsArray: Snapshot[][] = [];\n    groups.forEach((group, key) => {\n      let paramNameLength = '&ids%5B%5D='.length;\n      let splitGroups = splitGroupToFitInUrl(group, maxURLLength, paramNameLength);\n\n      splitGroups.forEach((splitGroup) => groupsArray.push(splitGroup));\n    });\n\n    return groupsArray;\n  }\n\n  /**\n    Takes an ajax response, and returns the json payload or an error.\n\n    By default this hook just returns the json payload passed to it.\n    You might want to override it in two cases:\n\n    1. Your API might return useful results in the response headers.\n    Response headers are passed in as the second argument.\n\n    2. Your API might return errors as successful responses with status code\n    200 and an Errors text or object. You can return a `InvalidError` or a\n    `AdapterError` (or a sub class) from this hook and it will automatically\n    reject the promise and put your record into the invalid or error state.\n\n    Returning a `InvalidError` from this method will cause the\n    record to transition into the `invalid` state and make the\n    `errors` object available on the record. When returning an\n    `InvalidError` the store will attempt to normalize the error data\n    returned from the server using the serializer's `extractErrors`\n    method.\n\n    @since 1.13.0\n    @method handleResponse\n    @public\n    @param  {Number} status\n    @param  {Object} headers\n    @param  {Object} payload\n    @param  {Object} requestData - the original request information\n    @return {Object | AdapterError} response\n  */\n  handleResponse(\n    status: number,\n    headers: Record<string, unknown>,\n    payload: Payload,\n    requestData: RequestData\n  ): Payload | AdapterError {\n    if (this.isSuccess(status, headers, payload)) {\n      return payload;\n    } else if (this.isInvalid(status, headers, payload)) {\n      return new InvalidError(typeof payload === 'object' && 'errors' in payload ? payload.errors : undefined);\n    }\n\n    let errors = this.normalizeErrorResponse(status, headers, payload);\n    let detailedMessage = this.generatedDetailedMessage(status, headers, payload, requestData);\n\n    switch (status) {\n      case 401:\n        return new UnauthorizedError(errors, detailedMessage);\n      case 403:\n        return new ForbiddenError(errors, detailedMessage);\n      case 404:\n        return new NotFoundError(errors, detailedMessage);\n      case 409:\n        return new ConflictError(errors, detailedMessage);\n      default:\n        if (status >= 500) {\n          return new ServerError(errors, detailedMessage);\n        }\n    }\n\n    return new AdapterError(errors, detailedMessage);\n  }\n\n  /**\n    Default `handleResponse` implementation uses this hook to decide if the\n    response is a success.\n\n    @since 1.13.0\n    @method isSuccess\n    @public\n    @param  {Number} status\n    @param  {Object} headers\n    @param  {Object} payload\n    @return {Boolean}\n  */\n  isSuccess(status: number, _headers: Record<string, unknown>, _payload: Payload): boolean {\n    return (status >= 200 && status < 300) || status === 304;\n  }\n\n  /**\n    Default `handleResponse` implementation uses this hook to decide if the\n    response is an invalid error.\n\n    @since 1.13.0\n    @method isInvalid\n    @public\n    @param  {Number} status\n    @param  {Object} headers\n    @param  {Object} payload\n    @return {Boolean}\n  */\n  isInvalid(status: number, _headers: Record<string, unknown>, _payload: Payload): boolean {\n    return status === 422;\n  }\n\n  /**\n    Takes a URL, an HTTP method and a hash of data, and makes an\n    HTTP request.\n\n    When the server responds with a payload, Ember Data will call into `extractSingle`\n    or `extractArray` (depending on whether the original query was for one record or\n    many records).\n\n    By default, `ajax` method has the following behavior:\n\n    * It sets the response `dataType` to `\"json\"`\n    * If the HTTP method is not `\"GET\"`, it sets the `Content-Type` to be\n      `application/json; charset=utf-8`\n    * If the HTTP method is not `\"GET\"`, it stringifies the data passed in. The\n      data is the serialized record in the case of a save.\n    * Registers success and failure handlers.\n\n    @method ajax\n    @private\n    @param {String} url\n    @param {String} type The request type GET, POST, PUT, DELETE etc.\n    @param {Object} options\n    @return {Promise} promise\n  */\n  async ajax(url: string, type: string, options: JQueryAjaxSettings | RequestInit = {}): Promise<AdapterPayload> {\n    let adapter = this;\n\n    let requestData: RequestData = {\n      url: url,\n      method: type,\n    };\n\n    if (this.useFetch) {\n      let hash: FetchRequestInit = adapter.ajaxOptions(url, type, options);\n      let response = await this._fetchRequest(hash);\n      let payload = await determineBodyPromise(response, requestData);\n\n      if (response.ok && !(payload instanceof Error)) {\n        return fetchSuccessHandler(adapter, payload, response, requestData);\n      } else {\n        throw fetchErrorHandler(adapter, payload, response, null, requestData);\n      }\n    } else {\n      let hash: JQueryRequestInit = adapter.ajaxOptions(url, type, options);\n\n      return new Promise(function (resolve, reject) {\n        hash.success = function (payload, textStatus, jqXHR) {\n          let response = ajaxSuccessHandler(adapter, payload, jqXHR, requestData);\n          join(null, resolve, response);\n        };\n\n        hash.error = function (jqXHR, textStatus, errorThrown) {\n          let error = ajaxErrorHandler(adapter, jqXHR, errorThrown, requestData);\n          join(null, reject, error);\n        };\n\n        adapter._ajax(hash);\n      });\n    }\n  }\n\n  /**\n    @method _ajaxRequest\n    @private\n    @param {Object} options jQuery ajax options to be used for the ajax request\n  */\n  _ajaxRequest(options: JQueryRequestInit): void {\n    // TODO add assertion that jquery is there rather then equality check\n    typeof jQuery !== 'undefined' && jQuery.ajax(options);\n  }\n\n  _fetchRequest(options: FetchRequestInit): Promise<Response> {\n    let fetchFunction = fetch();\n\n    return fetchFunction(options.url, options);\n  }\n\n  _ajax(options: FetchRequestInit | JQueryRequestInit): void {\n    if (this.useFetch) {\n      this._fetchRequest(options as FetchRequestInit);\n    } else {\n      this._ajaxRequest(options as JQueryRequestInit);\n    }\n  }\n\n  /**\n    @method ajaxOptions\n    @private\n    @param {String} url\n    @param {String} type The request type GET, POST, PUT, DELETE etc.\n    @param {Object} options\n    @return {Object}\n  */\n  ajaxOptions(\n    url: string,\n    method: string,\n    options: JQueryAjaxSettings | RequestInit\n  ): JQueryRequestInit | FetchRequestInit {\n    let reqOptions: JQueryRequestInit | FetchRequestInit = Object.assign(\n      {\n        url,\n        method,\n        type: method,\n      },\n      options\n    );\n\n    if (this.headers !== undefined) {\n      reqOptions.headers = { ...this.headers, ...reqOptions.headers };\n    } else if (!options.headers) {\n      reqOptions.headers = {};\n    }\n\n    let contentType = reqOptions.contentType || this._defaultContentType;\n\n    if (this.useFetch) {\n      if (reqOptions.data && reqOptions.type !== 'GET' && reqOptions.headers) {\n        if (!reqOptions.headers['Content-Type'] && !reqOptions.headers['content-type']) {\n          reqOptions.headers['content-type'] = contentType;\n        }\n      }\n      reqOptions = fetchOptions(reqOptions, this);\n    } else {\n      // GET requests without a body should not have a content-type header\n      // and may be unexpected by a server\n      if (reqOptions.data && reqOptions.type !== 'GET') {\n        reqOptions = { ...reqOptions, contentType };\n      }\n      reqOptions = ajaxOptions(reqOptions, this);\n    }\n\n    reqOptions.url = this._ajaxURL(reqOptions.url);\n\n    return reqOptions;\n  }\n\n  _ajaxURL(url: string): string {\n    if (this.fastboot?.isFastBoot) {\n      let httpRegex = /^https?:\\/\\//;\n      let protocolRelativeRegex = /^\\/\\//;\n      let protocol = this.fastboot.request.protocol;\n      let host = this.fastboot.request.host;\n\n      if (protocolRelativeRegex.test(url)) {\n        return `${protocol}${url}`;\n      } else if (!httpRegex.test(url)) {\n        try {\n          return `${protocol}//${host}${url}`;\n        } catch (fbError) {\n          throw new Error(\n            'You are using Ember Data with no host defined in your adapter. This will attempt to use the host of the FastBoot request, which is not configured for the current host of this request. Please set the hostWhitelist property for in your environment.js. FastBoot Error: ' +\n              (fbError as Error).message\n          );\n        }\n      }\n    }\n\n    return url;\n  }\n\n  /**\n    @method parseErrorResponse\n    @private\n    @param {String} responseText\n    @return {Object}\n  */\n  parseErrorResponse(responseText: string): Record<string, unknown> | string {\n    let json: string = responseText;\n\n    try {\n      json = JSON.parse(responseText);\n    } catch (e) {\n      // ignored\n    }\n\n    return json;\n  }\n\n  /**\n    @method normalizeErrorResponse\n    @private\n    @param  {Number} status\n    @param  {Object} headers\n    @param  {Object} payload\n    @return {Array} errors payload\n  */\n  normalizeErrorResponse(\n    status: number,\n    _headers: Record<string, unknown>,\n    payload: Payload\n  ): Record<string, unknown>[] {\n    if (payload && typeof payload === 'object' && 'errors' in payload && Array.isArray(payload.errors)) {\n      return payload.errors;\n    } else {\n      return [\n        {\n          status: `${status}`, // Set to a string per the JSON API spec: https://jsonapi.org/format/#errors\n          title: 'The backend responded with an error',\n          // Detail is intended to be a string, but backends be non-compliant.\n          // stringifying gives the user a more friendly error in this situation, whereas\n          // they'd instead receive [object Object].\n          // JSON.stringify will convert *anything* to a string without erroring.\n          detail: typeof payload === 'string' ? payload : JSON.stringify(payload),\n        },\n      ];\n    }\n  }\n\n  /**\n    Generates a detailed (\"friendly\") error message, with plenty\n    of information for debugging (good luck!)\n\n    @method generatedDetailedMessage\n    @private\n    @param  {Number} status\n    @param  {Object} headers\n    @param  {Object} payload\n    @param  {Object} requestData\n    @return {String} detailed error message\n  */\n  generatedDetailedMessage(status: number, headers, payload: Payload, requestData: RequestData): string {\n    let shortenedPayload;\n    let payloadContentType = headers['content-type'] || 'Empty Content-Type';\n\n    if (payloadContentType === 'text/html' && typeof payload === 'string' && payload.length > 250) {\n      shortenedPayload = '[Omitted Lengthy HTML]';\n    } else {\n      shortenedPayload = payload;\n    }\n\n    let requestDescription = requestData.method + ' ' + requestData.url;\n    let payloadDescription = 'Payload (' + payloadContentType + ')';\n\n    return [\n      'Ember Data Request ' + requestDescription + ' returned a ' + status,\n      payloadDescription,\n      shortenedPayload,\n    ].join('\\n');\n  }\n\n  /**\n    Used by `findAll` and `findRecord` to build the query's `data` hash\n    supplied to the ajax method.\n\n    @method buildQuery\n    @since 2.5.0\n    @public\n    @param  {Snapshot} snapshot\n    @return {Object}\n  */\n  buildQuery(snapshot: Snapshot | SnapshotRecordArray): QueryState {\n    let query: QueryState = {};\n\n    if (snapshot) {\n      let { include } = snapshot;\n\n      if (include) {\n        query.include = include;\n      }\n    }\n\n    return query;\n  }\n}\n\nfunction ajaxSuccess(\n  adapter: RESTAdapter,\n  payload: Payload,\n  requestData: RequestData,\n  responseData: ResponseData\n): Promise<AdapterPayload> {\n  let response;\n  try {\n    response = adapter.handleResponse(responseData.status, responseData.headers, payload, requestData);\n  } catch (error) {\n    return Promise.reject(error);\n  }\n\n  if (response && response.isAdapterError) {\n    return Promise.reject(response);\n  } else {\n    return response;\n  }\n}\n\nfunction ajaxError(\n  adapter: RESTAdapter,\n  payload: Payload,\n  requestData: RequestData,\n  responseData: ResponseData\n): Error | TimeoutError | AbortError | Record<string, unknown> {\n  let error;\n\n  if (responseData.errorThrown instanceof Error && payload !== '') {\n    error = responseData.errorThrown;\n  } else if (responseData.textStatus === 'timeout') {\n    error = new TimeoutError();\n  } else if (responseData.textStatus === 'abort' || responseData.status === 0) {\n    error = handleAbort(requestData, responseData);\n  } else {\n    try {\n      error = adapter.handleResponse(\n        responseData.status,\n        responseData.headers,\n        payload || responseData.errorThrown,\n        requestData\n      );\n    } catch (e) {\n      error = e;\n    }\n  }\n\n  return error;\n}\n\n// Adapter abort error to include any relevent info, e.g. request/response:\nfunction handleAbort(requestData: RequestData, responseData: ResponseData): AbortError {\n  let { method, url, errorThrown } = requestData;\n  let { status } = responseData;\n  let msg = `Request failed: ${method} ${url} ${errorThrown || ''}`;\n  let errors = [{ title: 'Adapter Error', detail: msg.trim(), status }];\n  return new AbortError(errors);\n}\n\n//From http://stackoverflow.com/questions/280634/endswith-in-javascript\nfunction endsWith(string: string, suffix: string): boolean {\n  if (typeof String.prototype.endsWith !== 'function') {\n    return string.indexOf(suffix, string.length - suffix.length) !== -1;\n  } else {\n    return string.endsWith(suffix);\n  }\n}\n\nfunction fetchSuccessHandler(\n  adapter: RESTAdapter,\n  payload: Payload,\n  response: Response,\n  requestData: RequestData\n): Promise<AdapterPayload> {\n  let responseData = fetchResponseData(response);\n  return ajaxSuccess(adapter, payload, requestData, responseData);\n}\n\nfunction fetchErrorHandler(\n  adapter: RESTAdapter,\n  payload: Payload,\n  response: Response,\n  errorThrown,\n  requestData: RequestData\n) {\n  let responseData = fetchResponseData(response);\n\n  if (responseData.status === 200 && payload instanceof Error) {\n    responseData.errorThrown = payload;\n    payload = responseData.errorThrown.payload;\n  } else {\n    responseData.errorThrown = errorThrown;\n    if (typeof payload === 'string') {\n      payload = adapter.parseErrorResponse(payload);\n    }\n  }\n  return ajaxError(adapter, payload, requestData, responseData);\n}\n\nfunction ajaxSuccessHandler(\n  adapter: RESTAdapter,\n  payload: Payload,\n  jqXHR: JQuery.jqXHR,\n  requestData: RequestData\n): Promise<AdapterPayload> {\n  let responseData = ajaxResponseData(jqXHR);\n  return ajaxSuccess(adapter, payload, requestData, responseData);\n}\n\nfunction ajaxErrorHandler(adapter: RESTAdapter, jqXHR: JQuery.jqXHR, errorThrown: string, requestData: RequestData) {\n  let responseData = ajaxResponseData(jqXHR);\n  responseData.errorThrown = errorThrown;\n  let payload = adapter.parseErrorResponse(jqXHR.responseText);\n\n  if (DEBUG) {\n    let message = `The server returned an empty string for ${requestData.method} ${requestData.url}, which cannot be parsed into a valid JSON. Return either null or {}.`;\n    let validJSONString = !(responseData.textStatus === 'parsererror' && payload === '');\n    warn(message, validJSONString, {\n      id: 'ds.adapter.returned-empty-string-as-JSON',\n    });\n  }\n\n  return ajaxError(adapter, payload, requestData, responseData);\n}\n\nfunction fetchResponseData(response: Response): ResponseData {\n  return {\n    status: response.status,\n    textStatus: response.statusText,\n    headers: headersToObject(response.headers),\n  };\n}\n\nfunction ajaxResponseData(jqXHR: JQuery.jqXHR): ResponseData {\n  return {\n    status: jqXHR.status,\n    textStatus: jqXHR.statusText,\n    headers: parseResponseHeaders(jqXHR.getAllResponseHeaders()),\n  };\n}\n\nfunction headersToObject(headers: Headers): Record<string, unknown> {\n  let headersObject = {};\n\n  if (headers) {\n    headers.forEach((value, key) => (headersObject[key] = value));\n  }\n\n  return headersObject;\n}\n\n/**\n * Helper function that translates the options passed to `jQuery.ajax` into a format that `fetch` expects.\n *\n * @method fetchOptions\n * @for @ember-data/adapter/rest\n * @param {Object} _options\n * @param {Adapter} adapter\n * @private\n * @returns {Object}\n */\nexport function fetchOptions(\n  options: JQueryRequestInit & Partial<FetchRequestInit>,\n  adapter: RESTAdapter\n): FetchRequestInit {\n  options.credentials = options.credentials || 'same-origin';\n\n  if (options.data) {\n    // GET and HEAD requests can't have a `body`\n    if (options.method === 'GET' || options.method === 'HEAD') {\n      // If no options are passed, Ember Data sets `data` to an empty object, which we test for.\n      if (Object.keys(options.data).length && options.url) {\n        // Test if there are already query params in the url (mimics jQuey.ajax).\n        const queryParamDelimiter = options.url.indexOf('?') > -1 ? '&' : '?';\n        options.url += `${queryParamDelimiter}${serializeQueryParams(options.data)}`;\n      }\n    } else {\n      // NOTE: a request's body cannot be an object, so we stringify it if it is.\n      // JSON.stringify removes keys with values of `undefined` (mimics jQuery.ajax).\n      // If the data is not a POJO (it's a String, FormData, etc), we just set it.\n      // If the data is a string, we assume it's a stringified object.\n\n      /* We check for Objects this way because we want the logic inside the consequent to run\n       * if `options.data` is a POJO, not if it is a data structure whose `typeof` returns \"object\"\n       * when it's not (Array, FormData, etc). The reason we don't use `options.data.constructor`\n       * to check is in case `data` is an object with no prototype (e.g. created with null).\n       */\n      if (Object.prototype.toString.call(options.data) === '[object Object]') {\n        options.body = JSON.stringify(options.data);\n      } else {\n        options.body = options.data;\n      }\n    }\n  }\n\n  return options;\n}\n\nfunction ajaxOptions(options: JQueryRequestInit, adapter: RESTAdapter): JQueryRequestInit {\n  options.dataType = 'json';\n  options.context = adapter;\n\n  if (options.data && options.type !== 'GET') {\n    options.data = JSON.stringify(options.data);\n  }\n\n  options.beforeSend = function (xhr) {\n    if (options.headers) {\n      Object.keys(options.headers).forEach((key) => {\n        let headerValue = options.headers && options.headers[key];\n        const isString = (value: unknown): value is string => typeof value === 'string';\n        if (isString(headerValue)) {\n          xhr.setRequestHeader(key, headerValue);\n        }\n      });\n    }\n  };\n\n  return options;\n}\n\nexport default RESTAdapter;\n"],"names":["RESTAdapter","_dec","computed","_class","Adapter","extend","BuildURLMixin","constructor","args","useFetch","_defaultContentType","maxURLLength","fastboot","_fastboot","getOwner","lookup","value","sortQueryParams","obj","keys","Object","len","length","newQueryParams","sortedKeys","sort","i","coalesceFindRequests","_coalesceFindRequests","findRecord","store","type","id","snapshot","url","buildURL","modelName","query","buildQuery","ajax","data","findAll","sinceToken","snapshotRecordArray","since","queryRecord","adapterOptions","findMany","ids","snapshots","findHasMany","relationship","assert","urlPrefix","findBelongsTo","createRecord","serializeIntoHash","updateRecord","schema","deleteRecord","_stripIDFromURL","expandedURL","split","lastSegment","decodeURIComponent","endsWith","substring","join","groupRecordsForFindMany","groups","Map","adapter","forEach","baseUrl","has","set","get","push","splitGroupToFitInUrl","group","paramNameLength","idsSize","splitGroups","additionalLength","encodeURIComponent","lastGroupIndex","groupsArray","key","splitGroup","handleResponse","status","headers","payload","requestData","isSuccess","isInvalid","InvalidError","errors","undefined","normalizeErrorResponse","detailedMessage","generatedDetailedMessage","UnauthorizedError","ForbiddenError","NotFoundError","ConflictError","ServerError","AdapterError","_headers","_payload","options","method","hash","ajaxOptions","response","_fetchRequest","determineBodyPromise","ok","Error","fetchSuccessHandler","fetchErrorHandler","Promise","resolve","reject","success","textStatus","jqXHR","ajaxSuccessHandler","error","errorThrown","ajaxErrorHandler","_ajax","_ajaxRequest","jQuery","fetchFunction","fetch","reqOptions","assign","contentType","fetchOptions","_ajaxURL","isFastBoot","httpRegex","protocolRelativeRegex","protocol","request","host","test","fbError","message","parseErrorResponse","responseText","json","JSON","parse","e","Array","isArray","title","detail","stringify","shortenedPayload","payloadContentType","requestDescription","payloadDescription","include","_applyDecoratedDescriptor","prototype","getOwnPropertyDescriptor","ajaxSuccess","responseData","isAdapterError","ajaxError","TimeoutError","handleAbort","msg","trim","AbortError","string","suffix","String","indexOf","fetchResponseData","ajaxResponseData","macroCondition","getOwnConfig","env","DEBUG","validJSONString","warn","statusText","headersToObject","parseResponseHeaders","getAllResponseHeaders","headersObject","credentials","queryParamDelimiter","serializeQueryParams","toString","call","body","dataType","context","beforeSend","xhr","headerValue","isString","setRequestHeader"],"mappings":";;;;;;;;;;;AAmEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5QA,IA6QMA,WAAW,IAAAC,IAAA,GAiBdC,QAAQ,EAAE,GAAAC,MAAA,GAjBb,MAAMH,WAAW,SAASI,OAAO,CAACC,MAAM,CAACC,aAAa,CAAC,CAAC;AAAAC,EAAAA,WAAAA,CAAA,GAAAC,IAAA,EAAA;AAAA,IAAA,KAAA,CAAA,GAAAA,IAAA,CAAA,CAAA;AAKtD;AACF;AACA;AACA;AACA;AACA;AACA;IANE,IAQAC,CAAAA,QAAQ,GAAG,IAAI,CAAA;IAAA,IAEfC,CAAAA,mBAAmB,GAAG,iCAAiC,CAAA;AAkjBvD;IAAA,IACAC,CAAAA,YAAY,GAAG,IAAI,CAAA;AAAA,GAAA;EAjjBnB,IACIC,QAAQA,GAAG;AACb;AACA;AACA,IAAA,IAAIA,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAA;AAC7B,IAAA,IAAID,QAAQ,EAAE;AACZ,MAAA,OAAOA,QAAQ,CAAA;AACjB,KAAA;AACA,IAAA,OAAQ,IAAI,CAACC,SAAS,GAAIC,QAAQ,CAAC,IAAI,CAAC,CAASC,MAAM,CAAC,kBAAkB,CAAC,CAAA;AAC7E,GAAA;EAEA,IAAIH,QAAQA,CAACI,KAAe,EAAE;IAC5B,IAAI,CAACH,SAAS,GAAGG,KAAK,CAAA;AACxB,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAYEC,eAAeA,CAACC,GAAG,EAA2B;AAC5C,IAAA,IAAIC,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACD,GAAG,CAAC,CAAA;AAC3B,IAAA,IAAIG,GAAG,GAAGF,IAAI,CAACG,MAAM,CAAA;IACrB,IAAID,GAAG,GAAG,CAAC,EAAE;AACX,MAAA,OAAOH,GAAG,CAAA;AACZ,KAAA;IACA,IAAIK,cAAc,GAAG,EAAE,CAAA;AACvB,IAAA,IAAIC,UAAU,GAAGL,IAAI,CAACM,IAAI,EAAE,CAAA;IAE5B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,GAAG,EAAEK,CAAC,EAAE,EAAE;AAC5BH,MAAAA,cAAc,CAACC,UAAU,CAACE,CAAC,CAAC,CAAC,GAAGR,GAAG,CAACM,UAAU,CAACE,CAAC,CAAC,CAAC,CAAA;AACpD,KAAA;AACA,IAAA,OAAOH,cAAc,CAAA;AACvB,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAYE,IAAII,oBAAoBA,GAAG;AACzB,IAAA,IAAIA,oBAAoB,GAAG,IAAI,CAACC,qBAAqB,CAAA;AACrD,IAAA,IAAI,OAAOD,oBAAoB,KAAK,SAAS,EAAE;AAC7C,MAAA,OAAOA,oBAAoB,CAAA;AAC7B,KAAA;AACA,IAAA,OAAQ,IAAI,CAACC,qBAAqB,GAAG,KAAK,CAAA;AAC5C,GAAA;EAEA,IAAID,oBAAoBA,CAACX,KAAc,EAAE;IACvC,IAAI,CAACY,qBAAqB,GAAGZ,KAAK,CAAA;AACpC,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAME;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAME;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAME;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAIEa,UAAUA,CAACC,KAAY,EAAEC,IAAoB,EAAEC,EAAU,EAAEC,QAAk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"}