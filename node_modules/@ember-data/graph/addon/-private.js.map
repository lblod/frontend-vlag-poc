{"version":3,"file":"-private.js","sources":["../src/-private/coerce-id.ts","../src/-private/graph/-utils.ts","../src/-private/graph/-state.ts","../src/-private/relationships/state/belongs-to.ts","../src/-private/relationships/state/has-many.ts","../src/-private/debug/assert-polymorphic-type.js","../src/-private/graph/-edge-definition.ts","../src/-private/graph/operations/replace-related-records.ts","../src/-private/graph/operations/add-to-related-records.ts","../src/-private/graph/operations/merge-identifier.ts","../src/-private/graph/operations/remove-from-related-records.ts","../src/-private/graph/operations/replace-related-record.ts","../src/-private/normalize-link.ts","../src/-private/graph/operations/update-relationship.ts","../src/-private/graph/graph.ts","../src/-private/graph/index.ts"],"sourcesContent":["import { DEBUG } from '@ember-data/env';\n\n// Used by the store to normalize IDs entering the store.  Despite the fact\n// that developers may provide IDs as numbers (e.g., `store.findRecord('person', 1)`),\n// it is important that internally we use strings, since IDs may be serialized\n// and lose type information.  For example, Ember's router may put a record's\n// ID into the URL, and if we later try to deserialize that URL and find the\n// corresponding record, we will not know if it is a string or a number.\ntype Coercable = string | number | boolean | null | undefined | symbol;\n\nexport function coerceId(id: Coercable): string | null {\n  if (id === null || id === undefined || id === '') {\n    return null;\n  }\n  if (typeof id === 'string') {\n    return id;\n  }\n  if (typeof id === 'symbol') {\n    return id.toString();\n  }\n  return '' + id;\n}\n\nexport function ensureStringId(id: Coercable): string {\n  let normalized: string | null = null;\n  if (typeof id === 'string') {\n    normalized = id.length > 0 ? id : null;\n  } else if (typeof id === 'number' && !isNaN(id)) {\n    normalized = '' + id;\n  }\n\n  if (DEBUG) {\n    if (normalized === null) {\n      throw new Error(`Expected id to be a string or number, received ${String(id)}`);\n    }\n  }\n\n  return normalized!;\n}\n","import { assert, inspect, warn } from '@ember/debug';\n\nimport { LOG_GRAPH } from '@ember-data/debugging';\nimport type { Store } from '@ember-data/store/-private';\nimport { peekCache } from '@ember-data/store/-private';\nimport type { CacheStoreWrapper } from '@ember-data/types/q/cache-store-wrapper';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport { coerceId } from '../coerce-id';\nimport type BelongsToRelationship from '../relationships/state/belongs-to';\nimport type ManyRelationship from '../relationships/state/has-many';\nimport type { UpdateRelationshipOperation } from './-operations';\nimport type { Graph, ImplicitRelationship } from './graph';\n\nexport function getStore(wrapper: CacheStoreWrapper | { _store: Store }): Store {\n  assert(`expected a private _store property`, '_store' in wrapper);\n  return wrapper._store;\n}\n\nexport function expandingGet<T>(cache: Record<string, Record<string, T>>, key1: string, key2: string): T | undefined {\n  let mainCache = (cache[key1] = cache[key1] || Object.create(null));\n  return mainCache[key2];\n}\n\nexport function expandingSet<T>(cache: Record<string, Record<string, T>>, key1: string, key2: string, value: T): void {\n  let mainCache = (cache[key1] = cache[key1] || Object.create(null));\n  mainCache[key2] = value;\n}\n\nexport function assertValidRelationshipPayload(graph: Graph, op: UpdateRelationshipOperation) {\n  const relationship = graph.get(op.record, op.field);\n  assert(`Cannot update an implicit relationship`, isHasMany(relationship) || isBelongsTo(relationship));\n  const payload = op.value;\n  const { definition, identifier, state } = relationship;\n  const { type } = identifier;\n  const { field } = op;\n  const { isAsync, kind } = definition;\n\n  if (payload.links) {\n    warn(\n      `You pushed a record of type '${type}' with a relationship '${field}' configured as 'async: false'. You've included a link but no primary data, this may be an error in your payload. EmberData will treat this relationship as known-to-be-empty.`,\n      isAsync || !!payload.data || state.hasReceivedData,\n      {\n        id: 'ds.store.push-link-for-sync-relationship',\n      }\n    );\n  } else if (payload.data) {\n    if (kind === 'belongsTo') {\n      assert(\n        `A ${type} record was pushed into the store with the value of ${field} being ${inspect(\n          payload.data\n        )}, but ${field} is a belongsTo relationship so the value must not be an array. You should probably check your data payload or serializer.`,\n        !Array.isArray(payload.data)\n      );\n      assertRelationshipData(getStore(graph.store), identifier, payload.data, definition);\n    } else if (kind === 'hasMany') {\n      assert(\n        `A ${type} record was pushed into the store with the value of ${field} being '${inspect(\n          payload.data\n        )}', but ${field} is a hasMany relationship so the value must be an array. You should probably check your data payload or serializer.`,\n        Array.isArray(payload.data)\n      );\n      if (Array.isArray(payload.data)) {\n        for (let i = 0; i < payload.data.length; i++) {\n          assertRelationshipData(getStore(graph.store), identifier, payload.data[i], definition);\n        }\n      }\n    }\n  }\n}\n\nexport function isNew(identifier: StableRecordIdentifier): boolean {\n  if (!identifier.id) {\n    return true;\n  }\n  const cache = peekCache(identifier);\n  return Boolean(cache?.isNew(identifier));\n}\n\nexport function isBelongsTo(\n  relationship: ManyRelationship | ImplicitRelationship | BelongsToRelationship\n): relationship is BelongsToRelationship {\n  return relationship.definition.kind === 'belongsTo';\n}\n\nexport function isImplicit(\n  relationship: ManyRelationship | ImplicitRelationship | BelongsToRelationship\n): relationship is ImplicitRelationship {\n  return relationship.definition.isImplicit;\n}\n\nexport function isHasMany(\n  relationship: ManyRelationship | ImplicitRelationship | BelongsToRelationship\n): relationship is ManyRelationship {\n  return relationship.definition.kind === 'hasMany';\n}\n\nexport function forAllRelatedIdentifiers(\n  rel: BelongsToRelationship | ManyRelationship | ImplicitRelationship,\n  cb: (identifier: StableRecordIdentifier) => void\n): void {\n  if (isBelongsTo(rel)) {\n    if (rel.remoteState) {\n      cb(rel.remoteState);\n    }\n    if (rel.localState && rel.localState !== rel.remoteState) {\n      cb(rel.localState);\n    }\n  } else if (isHasMany(rel)) {\n    // ensure we don't walk anything twice if an entry is\n    // in both localMembers and remoteMembers\n    let seen = new Set();\n\n    for (let i = 0; i < rel.localState.length; i++) {\n      const inverseIdentifier = rel.localState[i];\n      if (!seen.has(inverseIdentifier)) {\n        seen.add(inverseIdentifier);\n        cb(inverseIdentifier);\n      }\n    }\n\n    for (let i = 0; i < rel.remoteState.length; i++) {\n      const inverseIdentifier = rel.remoteState[i];\n      if (!seen.has(inverseIdentifier)) {\n        seen.add(inverseIdentifier);\n        cb(inverseIdentifier);\n      }\n    }\n  } else {\n    let seen = new Set();\n    rel.localMembers.forEach((inverseIdentifier) => {\n      if (!seen.has(inverseIdentifier)) {\n        seen.add(inverseIdentifier);\n        cb(inverseIdentifier);\n      }\n    });\n    rel.remoteMembers.forEach((inverseIdentifier) => {\n      if (!seen.has(inverseIdentifier)) {\n        seen.add(inverseIdentifier);\n        cb(inverseIdentifier);\n      }\n    });\n  }\n}\n\n/*\n  Removes the given identifier from BOTH remote AND local state.\n\n  This method is useful when either a deletion or a rollback on a new record\n  needs to entirely purge itself from an inverse relationship.\n  */\nexport function removeIdentifierCompletelyFromRelationship(\n  graph: Graph,\n  relationship: ManyRelationship | ImplicitRelationship | BelongsToRelationship,\n  value: StableRecordIdentifier,\n  silenceNotifications?: boolean\n): void {\n  if (isBelongsTo(relationship)) {\n    if (relationship.remoteState === value) {\n      relationship.remoteState = null;\n    }\n\n    if (relationship.localState === value) {\n      relationship.localState = null;\n      // This allows dematerialized inverses to be rematerialized\n      // we shouldn't be notifying here though, figure out where\n      // a notification was missed elsewhere.\n      if (!silenceNotifications) {\n        notifyChange(graph, relationship.identifier, relationship.definition.key);\n      }\n    }\n  } else if (isHasMany(relationship)) {\n    relationship.remoteMembers.delete(value);\n    relationship.localMembers.delete(value);\n\n    const canonicalIndex = relationship.remoteState.indexOf(value);\n    if (canonicalIndex !== -1) {\n      relationship.remoteState.splice(canonicalIndex, 1);\n    }\n\n    const currentIndex = relationship.localState.indexOf(value);\n    if (currentIndex !== -1) {\n      relationship.localState.splice(currentIndex, 1);\n      // This allows dematerialized inverses to be rematerialized\n      // we shouldn't be notifying here though, figure out where\n      // a notification was missed elsewhere.\n      if (!silenceNotifications) {\n        notifyChange(graph, relationship.identifier, relationship.definition.key);\n      }\n    }\n  } else {\n    relationship.remoteMembers.delete(value);\n    relationship.localMembers.delete(value);\n  }\n}\n\n// TODO add silencing at the graph level\nexport function notifyChange(graph: Graph, identifier: StableRecordIdentifier, key: string) {\n  if (identifier === graph._removing) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`Graph: ignoring relationship change for removed identifier ${String(identifier)} ${key}`);\n    }\n    return;\n  }\n  if (LOG_GRAPH) {\n    // eslint-disable-next-line no-console\n    console.log(`Graph: notifying relationship change for ${String(identifier)} ${key}`);\n  }\n\n  graph.store.notifyChange(identifier, 'relationships', key);\n}\n\nexport function assertRelationshipData(store, identifier, data, meta) {\n  assert(\n    `A ${identifier.type} record was pushed into the store with the value of ${meta.key} being '${JSON.stringify(\n      data\n    )}', but ${\n      meta.key\n    } is a belongsTo relationship so the value must not be an array. You should probably check your data payload or serializer.`,\n    !Array.isArray(data)\n  );\n  assert(\n    `Encountered a relationship identifier without a type for the ${meta.kind} relationship '${meta.key}' on <${\n      identifier.type\n    }:${identifier.id}>, expected an identifier with type '${meta.type}' but found\\n\\n'${JSON.stringify(\n      data,\n      null,\n      2\n    )}'\\n\\nPlease check your serializer and make sure it is serializing the relationship payload into a JSON API format.`,\n    data === null || (typeof data.type === 'string' && data.type.length)\n  );\n  assert(\n    `Encountered a relationship identifier without an id for the ${meta.kind} relationship '${meta.key}' on <${\n      identifier.type\n    }:${identifier.id}>, expected an identifier but found\\n\\n'${JSON.stringify(\n      data,\n      null,\n      2\n    )}'\\n\\nPlease check your serializer and make sure it is serializing the relationship payload into a JSON API format.`,\n    data === null || !!coerceId(data.id)\n  );\n  if (data?.type === meta.type) {\n    assert(\n      `Missing Schema: Encountered a relationship identifier { type: '${data.type}', id: '${data.id}' } for the '${identifier.type}.${meta.key}' ${meta.kind} relationship on <${identifier.type}:${identifier.id}>, but no schema exists for that type.`,\n      store.getSchemaDefinitionService().doesTypeExist(data.type)\n    );\n  } else {\n    assert(\n      `Missing Schema: Encountered a relationship identifier with type '${data.type}' for the ${meta.kind} relationship '${meta.key}' on <${identifier.type}:${identifier.id}>, Expected an identifier with type '${meta.type}'. No schema was found for '${data.type}'.`,\n      data === null || !data.type || store.getSchemaDefinitionService().doesTypeExist(data.type)\n    );\n  }\n}\n","export interface RelationshipState {\n  /*\n      This flag indicates whether we should consider the content\n       of this relationship \"known\".\n\n      If we have no relationship knowledge, and the relationship\n       is `async`, we will attempt to fetch the relationship on\n       access if it is also stale.\n\n     Snapshot uses this to tell the difference between unknown\n      (`undefined`) or empty (`null`). The reason for this is that\n      we wouldn't want to serialize  unknown relationships as `null`\n      as that might overwrite remote state.\n\n      All relationships for a newly created (`store.createRecord()`) are\n       considered known (`hasReceivedData === true`).\n\n      true when\n        => we receive a push with either new data or explicit empty (`[]` or `null`)\n        => the relationship is a belongsTo and we have received data from\n             the other side.\n\n      false when\n        => we have received no signal about what data belongs in this relationship\n        => the relationship is a hasMany and we have only received data from\n            the other side.\n     */\n  hasReceivedData: boolean;\n  /*\n      Flag that indicates whether an empty relationship is explicitly empty\n        (signaled by push giving us an empty array or null relationship)\n        e.g. an API response has told us that this relationship is empty.\n\n      Thus far, it does not appear that we actually need this flag; however,\n        @runspired has found it invaluable when debugging relationship tests\n        to determine whether (and why if so) we are in an incorrect state.\n\n      true when\n        => we receive a push with explicit empty (`[]` or `null`)\n        => we have received no signal about what data belongs in this relationship\n        => on initial create (as no signal is known yet)\n\n      false at all other times\n     */\n\n  isEmpty: boolean;\n  /*\n       This flag indicates whether we should\n        re-fetch the relationship the next time\n        it is accessed.\n\n        The difference between this flag and `shouldForceReload`\n        is in how we treat the presence of partially missing data:\n          - for a forced reload, we will reload the link or EVERY record\n          - for a stale reload, we will reload the link (if present) else only MISSING records\n\n        Ideally these flags could be merged, but because we don't give the\n        request layer the option of deciding how to resolve the data being queried\n        we are forced to differentiate for now.\n\n        It is also possible for a relationship to remain stale after a forced reload; however,\n        in this case `state.hasFailedLoadAttempt` ought to be `true`.\n\n      false when\n        => cache.isNew(identifier) on initial setup\n        => a previously triggered request has resolved\n        => we get relationship data via push\n\n      true when\n        => !cache.isNew(identifier) on initial setup\n        => an inverse has been unloaded\n        => we get a new link for the relationship\n\n      TODO @runspired unskip the acceptance tests and fix these flags\n     */\n  isStale: boolean;\n\n  hasFailedLoadAttempt: boolean;\n  /*\n     This flag forces fetch. `true` for a single request once `reload()`\n       has been called `false` at all other times.\n    */\n  shouldForceReload: boolean;\n  /*\n     This flag indicates whether we should\n      **partially** re-fetch the relationship the\n      next time it is accessed.\n\n    false when\n      => initial setup\n      => a previously triggered request has resolved\n\n    true when\n      => an inverse has been unloaded\n    */\n  hasDematerializedInverse: boolean;\n\n  // TODO do we want this anymore? Seems somewhat useful\n  //   especially if we rename to `hasUpdatedLink`\n  //   which would tell us slightly more about why the\n  //   relationship is stale\n  // updatedLink: boolean;\n}\n\nexport function createState(): RelationshipState {\n  return {\n    hasReceivedData: false,\n    isEmpty: true,\n    isStale: false,\n    hasFailedLoadAttempt: false,\n    shouldForceReload: false,\n    hasDematerializedInverse: false,\n  };\n}\n","import type { Links, Meta, PaginationLinks, SingleResourceRelationship } from '@ember-data/types/q/ember-data-json-api';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport type { UpgradedMeta } from '../../graph/-edge-definition';\nimport type { RelationshipState } from '../../graph/-state';\nimport { createState } from '../../graph/-state';\n\nexport default class BelongsToRelationship {\n  declare definition: UpgradedMeta;\n  declare identifier: StableRecordIdentifier;\n  declare _state: RelationshipState | null;\n  declare transactionRef: number;\n\n  declare localState: StableRecordIdentifier | null;\n  declare remoteState: StableRecordIdentifier | null;\n  declare meta: Meta | null;\n  declare links: Links | PaginationLinks | null;\n\n  constructor(definition: UpgradedMeta, identifier: StableRecordIdentifier) {\n    this.definition = definition;\n    this.identifier = identifier;\n    this._state = null;\n    this.transactionRef = 0;\n\n    this.meta = null;\n    this.links = null;\n\n    this.localState = null;\n    this.remoteState = null;\n  }\n\n  get state(): RelationshipState {\n    let { _state } = this;\n    if (!_state) {\n      _state = this._state = createState();\n    }\n    return _state;\n  }\n\n  getData(): SingleResourceRelationship {\n    let data;\n    let payload: any = {};\n    if (this.localState) {\n      data = this.localState;\n    }\n    if (this.localState === null && this.state.hasReceivedData) {\n      data = null;\n    }\n    if (this.links) {\n      payload.links = this.links;\n    }\n    if (data !== undefined) {\n      payload.data = data;\n    }\n    if (this.meta) {\n      payload.meta = this.meta;\n    }\n\n    return payload;\n  }\n}\n","import type {\n  CollectionResourceRelationship,\n  Links,\n  Meta,\n  PaginationLinks,\n} from '@ember-data/types/q/ember-data-json-api';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport type { UpgradedMeta } from '../../graph/-edge-definition';\nimport type { RelationshipState } from '../../graph/-state';\nimport { createState } from '../../graph/-state';\n\nexport default class ManyRelationship {\n  declare definition: UpgradedMeta;\n  declare identifier: StableRecordIdentifier;\n  declare _state: RelationshipState | null;\n  declare transactionRef: number;\n\n  declare localMembers: Set<StableRecordIdentifier>;\n  declare remoteMembers: Set<StableRecordIdentifier>;\n  declare meta: Meta | null;\n  declare links: Links | PaginationLinks | null;\n\n  declare remoteState: StableRecordIdentifier[];\n  declare localState: StableRecordIdentifier[];\n\n  constructor(definition: UpgradedMeta, identifier: StableRecordIdentifier) {\n    this.definition = definition;\n    this.identifier = identifier;\n    this._state = null;\n    this.transactionRef = 0;\n\n    this.localMembers = new Set<StableRecordIdentifier>();\n    this.remoteMembers = new Set<StableRecordIdentifier>();\n\n    this.meta = null;\n    this.links = null;\n\n    // persisted state\n    this.remoteState = [];\n    // local client state\n    this.localState = [];\n  }\n\n  get state(): RelationshipState {\n    let { _state } = this;\n    if (!_state) {\n      _state = this._state = createState();\n    }\n    return _state;\n  }\n\n  getData(): CollectionResourceRelationship {\n    let payload: any = {};\n    if (this.state.hasReceivedData) {\n      payload.data = this.localState.slice();\n    }\n    if (this.links) {\n      payload.links = this.links;\n    }\n    if (this.meta) {\n      payload.meta = this.meta;\n    }\n\n    return payload;\n  }\n}\n","import { assert } from '@ember/debug';\nimport { DEBUG } from '@ember-data/env';\n\n/*\n  Assert that `addedRecord` has a valid type so it can be added to the\n  relationship of the `record`.\n\n  The assert basically checks if the `addedRecord` can be added to the\n  relationship (specified via `relationshipMeta`) of the `record`.\n\n  This utility should only be used internally, as both record parameters must\n  be stable record identifiers and the `relationshipMeta` needs to be the meta\n  information about the relationship, retrieved via\n  `record.relationshipFor(key)`.\n*/\nlet assertPolymorphicType;\nlet assertInheritedSchema;\n\nif (DEBUG) {\n  function validateSchema(definition, meta) {\n    const errors = new Map();\n\n    if (definition.inverseKey !== meta.name) {\n      errors.set('name', ` <---- should be '${definition.inverseKey}'`);\n    }\n    if (definition.inverseType !== meta.type) {\n      errors.set('type', ` <---- should be '${definition.inverseType}'`);\n    }\n    if (definition.inverseKind !== meta.kind) {\n      errors.set('type', ` <---- should be '${definition.inverseKind}'`);\n    }\n    if (definition.inverseIsAsync !== meta.options.async) {\n      errors.set('async', ` <---- should be ${definition.inverseIsAsync}`);\n    }\n    if (definition.inverseIsPolymorphic && definition.inverseIsPolymorphic !== meta.options.polymorphic) {\n      errors.set('polymorphic', ` <---- should be ${definition.inverseIsPolymorphic}`);\n    }\n    if (definition.key !== meta.options.inverse) {\n      errors.set('inverse', ` <---- should be '${definition.key}'`);\n    }\n    if (definition.type !== meta.options.as) {\n      errors.set('as', ` <---- should be '${definition.type}'`);\n    }\n\n    return errors;\n  }\n\n  function expectedSchema(definition) {\n    return printSchema({\n      name: definition.inverseKey,\n      type: definition.inverseType,\n      kind: definition.inverseKind,\n      options: {\n        as: definition.type,\n        async: definition.inverseIsAsync,\n        polymorphic: definition.inverseIsPolymorphic || false,\n        inverse: definition.key\n      }\n    });\n  }\n\n  function printSchema(config, errors) {\n    return `\n\n\\`\\`\\`\n{\n  ${config.name}: {\n    name: '${config.name}',${errors?.get('name') || ''}\n    type: '${config.type}',${errors?.get('type') || ''}\n    kind: '${config.kind}',${errors?.get('kind') || ''}\n    options: {\n      as: '${config.options.as}',${errors?.get('as') || ''}\n      async: ${config.options.async},${errors?.get('async') || ''}\n      polymorphic: ${config.options.polymorphic},${errors?.get('polymorphic') || ''}\n      inverse: '${config.options.inverse}'${errors?.get('inverse') || ''}\n    }\n  }\n}\n\\`\\`\\`\n\n`\n  }\n\n  function metaFrom(definition) {\n    return {\n      name: definition.key,\n      type: definition.type,\n      kind: definition.kind,\n      options: {\n        async: definition.isAsync,\n        polymorphic: definition.isPolymorphic,\n        inverse: definition.inverseKey\n      }\n    };\n  }\n  function inverseMetaFrom(definition) {\n    return {\n      name: definition.inverseKey,\n      type: definition.inverseType,\n      kind: definition.inverseKind,\n      options: {\n        as: definition.isPolymorphic ? definition.type : undefined,\n        async: definition.inverseIsAsync,\n        polymorphic: definition.inverseIsPolymorphic,\n        inverse: definition.key\n      }\n    };\n  }\n  function inverseDefinition(definition) {\n    return {\n      key: definition.inverseKey,\n      type: definition.inverseType,\n      kind: definition.inverseKind,\n      isAsync: definition.inverseIsAsync,\n      isPolymorphic: true,\n      inverseKey: definition.key,\n      inverseType: definition.type,\n      inverseKind: definition.kind,\n      inverseIsAsync: definition.isAsync,\n      inverseIsPolymorphic: definition.isPolymorphic\n    };\n  }\n  function definitionWithPolymorphic(definition) {\n    return Object.assign({}, definition, { inverseIsPolymorphic: true });\n  }\n\n  assertInheritedSchema = function assertInheritedSchema(definition, type) {\n    let meta1 = metaFrom(definition);\n    let meta2 = inverseMetaFrom(definition);\n    let errors1 = validateSchema(inverseDefinition(definition), meta1);\n    let errors2 = validateSchema(definitionWithPolymorphic(definition), meta2);\n\n    if (errors2.size === 0 && errors1.size > 0) {\n      throw new Error(`The schema for the relationship '${type}.${definition.key}' is not configured to satisfy '${definition.inverseType}' and thus cannot utilize the '${definition.inverseType}.${definition.key}' relationship to connect with '${definition.type}.${definition.inverseKey}'\\n\\nIf using this relationship in a polymorphic manner is desired, the relationships schema definition for '${type}' should include:${printSchema(meta1, errors1)}`);\n\n    } else if (errors1.size > 0) {\n      throw new Error(`The schema for the relationship '${type}.${definition.key}' is not configured to satisfy '${definition.inverseType}' and thus cannot utilize the '${definition.inverseType}.${definition.key}' relationship to connect with '${definition.type}.${definition.inverseKey}'\\n\\nIf using this relationship in a polymorphic manner is desired, the relationships schema definition for '${type}' should include:${printSchema(meta1, errors1)} and the relationships schema definition for '${definition.type}' should include:${printSchema(meta2, errors2)}`);\n\n    } else if (errors2.size > 0) {\n      throw new Error(`The schema for the relationship '${type}.${definition.key}' satisfies '${definition.inverseType}' but cannot utilize the '${definition.inverseType}.${definition.key}' relationship to connect with '${definition.type}.${definition.inverseKey}' because that relationship is not polymorphic.\\n\\nIf using this relationship in a polymorphic manner is desired, the relationships schema definition for '${definition.type}' should include:${printSchema(meta2, errors2)}`);\n\n    }\n  }\n\n  assertPolymorphicType = function assertPolymorphicType(parentIdentifier, parentDefinition, addedIdentifier, store) {\n    if (parentDefinition.inverseIsImplicit) {\n      return;\n    }\n    if (parentDefinition.isPolymorphic) {\n      let meta = store.getSchemaDefinitionService().relationshipsDefinitionFor(addedIdentifier)[\n        parentDefinition.inverseKey\n      ];\n      assert(`No '${parentDefinition.inverseKey}' field exists on '${addedIdentifier.type}'. To use this type in the polymorphic relationship '${parentDefinition.inverseType}.${parentDefinition.key}' the relationships schema definition for ${addedIdentifier.type} should include:${expectedSchema(parentDefinition)}`, meta);\n      assert(\n        `You should not specify both options.as and options.inverse as null on ${addedIdentifier.type}.${parentDefinition.inverseKey}, as if there is no inverse field there is no abstract type to conform to. You may have intended for this relationship to be polymorphic, or you may have mistakenly set inverse to null.`,\n        !(meta.options.inverse === null && meta?.options.as?.length > 0)\n      );\n      let errors = validateSchema(parentDefinition, meta);\n      assert(\n        `The schema for the relationship '${parentDefinition.inverseKey}' on '${addedIdentifier.type}' type does not correctly implement '${parentDefinition.type}' and thus cannot be assigned to the '${parentDefinition.key}' relationship in '${parentIdentifier.type}'. If using this record in this polymorphic relationship is desired, correct the errors in the schema shown below:${printSchema(meta, errors)}`,\n        errors.size === 0,\n      );\n    } else if (addedIdentifier.type !== parentDefinition.type) {\n      // if we are not polymorphic\n      // then the addedIdentifier.type must be the same as the parentDefinition.type\n      let meta = store.getSchemaDefinitionService().relationshipsDefinitionFor(addedIdentifier)[\n        parentDefinition.inverseKey\n      ];\n      if (meta?.options.as === parentDefinition.type) {\n        // inverse is likely polymorphic but missing the polymorphic flag\n        let meta = store.getSchemaDefinitionService().relationshipsDefinitionFor({ type: parentDefinition.inverseType })[\n          parentDefinition.key\n        ];\n        let errors = validateSchema(definitionWithPolymorphic(inverseDefinition(parentDefinition)), meta);\n        assert(`The '<${addedIdentifier.type}>.${parentDefinition.inverseKey}' relationship cannot be used polymorphically because '<${parentDefinition.inverseType}>.${parentDefinition.key} is not a polymorphic relationship. To use this relationship in a polymorphic manner, fix the following schema issues on the relationships schema for '${parentDefinition.inverseType}':${printSchema(meta, errors)}`);\n      } else {\n        assert(`The '${addedIdentifier.type}' type does not implement '${parentDefinition.type}' and thus cannot be assigned to the '${parentDefinition.key}' relationship in '${parentIdentifier.type}'. If this relationship should be polymorphic, mark ${parentDefinition.inverseType}.${parentDefinition.key} as \\`polymorphic: true\\` and ${addedIdentifier.type}.${parentDefinition.inverseKey} as implementing it via \\`as: '${parentDefinition.type}'\\`.`);\n      }\n    }\n  };\n}\n\nexport { assertPolymorphicType, assertInheritedSchema };\n","import { assert } from '@ember/debug';\n\nimport { DEBUG } from '@ember-data/env';\nimport type Store from '@ember-data/store';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\nimport type { RelationshipSchema } from '@ember-data/types/q/record-data-schemas';\n\nimport { assertInheritedSchema } from '../debug/assert-polymorphic-type';\nimport { expandingGet, expandingSet, getStore } from './-utils';\nimport type { Graph } from './graph';\n\nexport type EdgeCache = Record<string, Record<string, EdgeDefinition | null>>;\n\n/**\n *\n * Given RHS (Right Hand Side)\n *\n * ```ts\n * class User extends Model {\n *   @hasMany('animal', { async: false, inverse: 'owner' }) pets;\n * }\n * ```\n *\n * Given LHS (Left Hand Side)\n *\n * ```ts\n * class Animal extends Model {\n *  @belongsTo('user', { async: false, inverse: 'pets' }) owner;\n * }\n * ```\n *\n * The UpgradedMeta for the RHS would be:\n *\n * ```ts\n * {\n *   kind: 'hasMany',\n *   key: 'pets',\n *   type: 'animal',\n *   isAsync: false,\n *   isImplicit: false,\n *   isCollection: true,\n *   isPolymorphic: false,\n *   inverseKind: 'belongsTo',\n *   inverseKey: 'owner',\n *   inverseType: 'user',\n *   inverseIsAsync: false,\n *   inverseIsImplicit: false,\n *   inverseIsCollection: false,\n *   inverseIsPolymorphic: false,\n * }\n *\n * The UpgradeMeta for the LHS would be:\n *\n * ```ts\n * {\n *   kind: 'belongsTo',\n *   key: 'owner',\n *   type: 'user',\n *   isAsync: false,\n *   isImplicit: false,\n *   isCollection: false,\n *   isPolymorphic: false,\n *   inverseKind: 'hasMany',\n *   inverseKey: 'pets',\n *   inverseType: 'animal',\n *   inverseIsAsync: false,\n *   inverseIsImplicit: false,\n *   inverseIsCollection: true,\n *   inverseIsPolymorphic: false,\n * }\n * ```\n *\n *\n * @class UpgradedMeta\n * @internal\n */\nexport interface UpgradedMeta {\n  kind: 'hasMany' | 'belongsTo' | 'implicit';\n  /**\n   * The field name on `this` record\n   *\n   * @internal\n   */\n  key: string;\n  /**\n   * The `type` of the related record\n   *\n   * @internal\n   */\n  type: string;\n  isAsync: boolean;\n  isImplicit: boolean;\n  isCollection: boolean;\n  isPolymorphic: boolean;\n\n  inverseKind: 'hasMany' | 'belongsTo' | 'implicit';\n  /**\n   * The field name on the opposing record\n   * @internal\n   */\n  inverseKey: string;\n  /**\n   * The `type` of `this` record\n   * @internal\n   */\n  inverseType: string;\n  inverseIsAsync: boolean;\n  inverseIsImplicit: boolean;\n  inverseIsCollection: boolean;\n  inverseIsPolymorphic: boolean;\n}\n\nexport interface EdgeDefinition {\n  lhs_key: string;\n  lhs_modelNames: string[];\n  lhs_baseModelName: string;\n  lhs_relationshipName: string;\n  lhs_definition: UpgradedMeta;\n  lhs_isPolymorphic: boolean;\n\n  rhs_key: string;\n  rhs_modelNames: string[];\n  rhs_baseModelName: string;\n  rhs_relationshipName: string;\n  rhs_definition: UpgradedMeta | null;\n  rhs_isPolymorphic: boolean;\n\n  hasInverse: boolean;\n\n  /**\n   * Whether this relationship points back at the same type.\n   *\n   * If the relationship is polymorphic, this will be true if\n   * it points back at the same abstract type.\n   *\n   * @internal\n   */\n  isSelfReferential: boolean;\n\n  /**\n   * If this is a reflexive relationship, this is true\n   * if the relationship also points back at the same\n   * field.\n   *\n   * @internal\n   */\n  isReflexive: boolean;\n}\n\nconst BOOL_LATER = null as unknown as boolean;\nconst STR_LATER = '';\nconst IMPLICIT_KEY_RAND = Date.now();\n\nfunction implicitKeyFor(type: string, key: string): string {\n  return `implicit-${type}:${key}${IMPLICIT_KEY_RAND}`;\n}\n\nfunction syncMeta(definition: UpgradedMeta, inverseDefinition: UpgradedMeta) {\n  definition.inverseKind = inverseDefinition.kind;\n  definition.inverseKey = inverseDefinition.key;\n  definition.inverseType = inverseDefinition.type;\n  definition.inverseIsAsync = inverseDefinition.isAsync;\n  definition.inverseIsCollection = inverseDefinition.isCollection;\n  definition.inverseIsPolymorphic = inverseDefinition.isPolymorphic;\n  definition.inverseIsImplicit = inverseDefinition.isImplicit;\n}\n\nfunction upgradeMeta(meta: RelationshipSchema): UpgradedMeta {\n  let niceMeta: UpgradedMeta = {} as UpgradedMeta;\n  let options = meta.options;\n  niceMeta.kind = meta.kind;\n  niceMeta.key = meta.name;\n  niceMeta.type = meta.type;\n  assert(`Expected relationship definition to specify async`, typeof options?.async === 'boolean');\n  niceMeta.isAsync = options.async;\n  niceMeta.isImplicit = false;\n  niceMeta.isCollection = meta.kind === 'hasMany';\n  niceMeta.isPolymorphic = options && !!options.polymorphic;\n\n  niceMeta.inverseKey = (options && options.inverse) || STR_LATER;\n  niceMeta.inverseType = STR_LATER;\n  niceMeta.inverseIsAsync = BOOL_LATER;\n  niceMeta.inverseIsImplicit = (options && options.inverse === null) || BOOL_LATER;\n  niceMeta.inverseIsCollection = BOOL_LATER;\n\n  return niceMeta;\n}\n\nfunction assertConfiguration(info: EdgeDefinition, type: string, key: string) {\n  if (DEBUG) {\n    let isSelfReferential = info.isSelfReferential;\n\n    if (isSelfReferential) {\n      return true;\n    }\n\n    let isRHS =\n      key === info.rhs_relationshipName &&\n      (type === info.rhs_baseModelName || // base or non-polymorphic\n        // if the other side is polymorphic then we need to scan our modelNames\n        (info.lhs_isPolymorphic && info.rhs_modelNames.indexOf(type) !== -1)); // polymorphic\n    let isLHS =\n      key === info.lhs_relationshipName &&\n      (type === info.lhs_baseModelName || // base or non-polymorphic\n        // if the other side is polymorphic then we need to scan our modelNames\n        (info.rhs_isPolymorphic && info.lhs_modelNames.indexOf(type) !== -1)); // polymorphic;\n\n    if (!isRHS && !isLHS) {\n      /*\n        this occurs when we are likely polymorphic but not configured to be polymorphic\n        most often due to extending a class that has a relationship definition on it.\n\n        e.g.\n\n        ```ts\n        class Pet extends Model {\n          @belongsTo('human', { async: false, inverse: 'pet' }) owner;\n        }\n        class Human extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner' }) pet;\n        }\n        class Farmer extends Human {}\n        ```\n\n        In the above case, the following would trigger this error:\n\n        ```ts\n        let pet = store.createRecord('pet');\n        let farmer = store.createRecord('farmer');\n        farmer.pet = pet; // error\n        ```\n\n        The correct way to fix this is to specify the polymorphic option on Pet\n        and to specify the abstract type 'human' on the Human base class.\n\n        ```ts\n        class Pet extends Model {\n          @belongsTo('human', { async: false, inverse: 'pet', polymorphic: true }) owner;\n        }\n        class Human extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner', as: 'human' }) pet;\n        }\n        class Farmer extends Human {}\n        ```\n\n        Alternatively both Human and Farmer could declare the relationship, because relationship\n        definitions are \"structural\".\n\n        ```ts\n        class Pet extends Model {\n          @belongsTo('human', { async: false, inverse: 'pet', polymorphic: true }) owner;\n        }\n        class Human extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner', as: 'human' }) pet;\n        }\n        class Farmer extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner', as: 'human' }) pet;\n        }\n        ```\n\n       */\n      if (key === info.lhs_relationshipName && info.lhs_modelNames.indexOf(type) !== -1) {\n        // parentIdentifier, parentDefinition, addedIdentifier, store\n        assertInheritedSchema(info.lhs_definition, type);\n      } else if (key === info.rhs_relationshipName && info.rhs_modelNames.indexOf(type) !== -1) {\n        assertInheritedSchema(info.lhs_definition, type);\n      }\n      // OPEN AN ISSUE :: we would like to improve our errors but need to understand what corner case got us here\n      throw new Error(\n        `PLEASE OPEN AN ISSUE :: Found a relationship that is neither the LHS nor RHS of the same edge. This is not supported. Please report this to the EmberData team.`\n      );\n    }\n\n    if (isRHS && isLHS) {\n      // not sure how we get here but it's probably the result of some form of inheritance\n      // without having specified polymorphism correctly leading to it not being self-referential\n      // OPEN AN ISSUE :: we would like to improve our errors but need to understand what corner case got us here\n      throw new Error(\n        `PLEASE OPEN AN ISSUE :: Found a relationship that is both the LHS and RHS of the same edge but is not self-referential. This is not supported. Please report this to the EmberData team.`\n      );\n    }\n  }\n}\n\nexport function isLHS(info: EdgeDefinition, type: string, key: string): boolean {\n  let isSelfReferential = info.isSelfReferential;\n  let isRelationship = key === info.lhs_relationshipName;\n\n  if (DEBUG) {\n    assertConfiguration(info, type, key);\n  }\n\n  if (isRelationship === true) {\n    return (\n      isSelfReferential === true || // itself\n      type === info.lhs_baseModelName || // base or non-polymorphic\n      // if the other side is polymorphic then we need to scan our modelNames\n      (info.rhs_isPolymorphic && info.lhs_modelNames.indexOf(type) !== -1) // polymorphic\n    );\n  }\n\n  return false;\n}\n\nexport function isRHS(info: EdgeDefinition, type: string, key: string): boolean {\n  let isSelfReferential = info.isSelfReferential;\n  let isRelationship = key === info.rhs_relationshipName;\n\n  if (DEBUG) {\n    assertConfiguration(info, type, key);\n  }\n\n  if (isRelationship === true) {\n    return (\n      isSelfReferential === true || // itself\n      type === info.rhs_baseModelName || // base or non-polymorphic\n      // if the other side is polymorphic then we need to scan our modelNames\n      (info.lhs_isPolymorphic && info.rhs_modelNames.indexOf(type) !== -1) // polymorphic\n    );\n  }\n\n  return false;\n}\n\nexport function upgradeDefinition(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  propertyName: string,\n  isImplicit: boolean = false\n): EdgeDefinition | null {\n  const cache = graph._definitionCache;\n  const storeWrapper = graph.store;\n  const polymorphicLookup = graph._potentialPolymorphicTypes;\n\n  const { type } = identifier;\n  let cached = expandingGet<EdgeDefinition | null>(cache, type, propertyName);\n\n  // CASE: We have a cached resolution (null if no relationship exists)\n  if (cached !== undefined) {\n    return cached;\n  }\n\n  assert(\n    `Expected to find relationship definition in the cache for the implicit relationship ${propertyName}`,\n    !isImplicit\n  );\n\n  let relationships = storeWrapper.getSchemaDefinitionService().relationshipsDefinitionFor(identifier);\n  assert(`Expected to have a relationship definition for ${type} but none was found.`, relationships);\n  let meta = relationships[propertyName];\n\n  if (!meta) {\n    // TODO potentially we should just be permissive here since this is an implicit relationship\n    // and not require the lookup table to be populated\n    if (polymorphicLookup[type]) {\n      const altTypes = Object.keys(polymorphicLookup[type] as {});\n      for (let i = 0; i < altTypes.length; i++) {\n        let cached = expandingGet<EdgeDefinition | null>(cache, altTypes[i], propertyName);\n        if (cached) {\n          expandingSet<EdgeDefinition | null>(cache, type, propertyName, cached);\n          cached.rhs_modelNames.push(type);\n          return cached;\n        }\n      }\n    }\n\n    // CASE: We don't have a relationship at all\n    // we should only hit this in prod\n    assert(`Expected a relationship schema for '${type}.${propertyName}', but no relationship schema was found.`, meta);\n\n    cache[type]![propertyName] = null;\n    return null;\n  }\n  const definition = upgradeMeta(meta);\n\n  let inverseDefinition;\n  let inverseKey;\n  const inverseType = definition.type;\n\n  // CASE: Inverse is explicitly null\n  if (definition.inverseKey === null) {\n    // TODO probably dont need this assertion if polymorphic\n    assert(`Expected the inverse model to exist`, getStore(storeWrapper).modelFor(inverseType));\n    inverseDefinition = null;\n  } else {\n    inverseKey = inverseForRelationship(getStore(storeWrapper), identifier, propertyName);\n\n    // CASE: If we are polymorphic, and we declared an inverse that is non-null\n    // we must assume that the lack of inverseKey means that there is no\n    // concrete type as the baseType, so we must construct and artificial\n    // placeholder\n    if (!inverseKey && definition.isPolymorphic && definition.inverseKey) {\n      inverseDefinition = {\n        kind: 'belongsTo', // this must be updated when we find the first belongsTo or hasMany definition that matches\n        key: definition.inverseKey,\n        type: type,\n        isAsync: false, // this must be updated when we find the first belongsTo or hasMany definition that matches\n        isImplicit: false,\n        isCollection: false, // this must be updated when we find the first belongsTo or hasMany definition that matches\n        isPolymorphic: false,\n        isInitialized: false, // tracks whether we have seen the other side at least once\n      };\n\n      // CASE: Inverse resolves to null\n    } else if (!inverseKey) {\n      inverseDefinition = null;\n    } else {\n      // CASE: We have an explicit inverse or were able to resolve one\n      let inverseDefinitions = storeWrapper\n        .getSchemaDefinitionService()\n        .relationshipsDefinitionFor({ type: inverseType });\n      assert(`Expected to have a relationship definition for ${inverseType} but none was found.`, inverseDefinitions);\n      let meta = inverseDefinitions[inverseKey];\n      assert(\n        `Expected a relationship schema for '${inverseType}.${inverseKey}' to match the inverse of '${type}.${propertyName}', but no relationship schema was found.`,\n        meta\n      );\n\n      inverseDefinition = upgradeMeta(meta);\n    }\n  }\n\n  // CASE: We have no inverse\n  if (!inverseDefinition) {\n    // polish off meta\n    inverseKey = implicitKeyFor(type, propertyName);\n    inverseDefinition = {\n      kind: 'implicit',\n      key: inverseKey,\n      type: type,\n      isAsync: false,\n      isImplicit: true,\n      isCollection: true, // with implicits any number of records could point at us\n      isPolymorphic: false,\n    };\n\n    syncMeta(definition, inverseDefinition);\n    syncMeta(inverseDefinition, definition);\n\n    const info = {\n      lhs_key: `${type}:${propertyName}`,\n      lhs_modelNames: [type],\n      lhs_baseModelName: type,\n      lhs_relationshipName: propertyName,\n      lhs_definition: definition,\n      lhs_isPolymorphic: definition.isPolymorphic,\n\n      rhs_key: inverseDefinition.key,\n      rhs_modelNames: [inverseType],\n      rhs_baseModelName: inverseType,\n      rhs_relationshipName: inverseDefinition.key,\n      rhs_definition: inverseDefinition,\n      rhs_isPolymorphic: false,\n\n      hasInverse: false,\n      isSelfReferential: type === inverseType, // this could be wrong if we are self-referential but also polymorphic\n      isReflexive: false, // we can't be reflexive if we don't define an inverse\n    };\n\n    expandingSet<EdgeDefinition | null>(cache, inverseType, inverseKey, info);\n    expandingSet<EdgeDefinition | null>(cache, type, propertyName, info);\n    return info;\n  }\n\n  // CASE: We do have an inverse\n  const baseType = inverseDefinition.type;\n\n  // TODO we want to assert this but this breaks all of our shoddily written tests\n  /*\n    if (DEBUG) {\n      let inverseDoubleCheck = inverseMeta.type.inverseFor(inverseRelationshipName, store);\n\n      assert(`The ${inverseBaseModelName}:${inverseRelationshipName} relationship declares 'inverse: null', but it was resolved as the inverse for ${baseModelName}:${relationshipName}.`, inverseDoubleCheck);\n    }\n  */\n  // CASE: We may have already discovered the inverse for the baseModelName\n  // CASE: We have already discovered the inverse\n  cached = expandingGet(cache, baseType, propertyName) || expandingGet(cache, inverseType, inverseKey);\n\n  if (cached) {\n    // TODO this assert can be removed if the above assert is enabled\n    assert(\n      `The ${inverseType}:${inverseKey} relationship declares 'inverse: null', but it was resolved as the inverse for ${type}:${propertyName}.`,\n      cached.hasInverse !== false\n    );\n\n    let isLHS = cached.lhs_baseModelName === baseType;\n    let modelNames = isLHS ? cached.lhs_modelNames : cached.rhs_modelNames;\n    // make this lookup easier in the future by caching the key\n    modelNames.push(type);\n    expandingSet<EdgeDefinition | null>(cache, type, propertyName, cached);\n\n    return cached;\n  }\n\n  // this is our first time so polish off the metas\n  syncMeta(definition, inverseDefinition);\n  syncMeta(inverseDefinition, definition);\n\n  const lhs_modelNames = [type];\n  if (type !== baseType) {\n    lhs_modelNames.push(baseType);\n  }\n  const isSelfReferential = baseType === inverseType;\n  const info = {\n    lhs_key: `${baseType}:${propertyName}`,\n    lhs_modelNames,\n    lhs_baseModelName: baseType,\n    lhs_relationshipName: propertyName,\n    lhs_definition: definition,\n    lhs_isPolymorphic: definition.isPolymorphic,\n\n    rhs_key: `${inverseType}:${inverseKey}`,\n    rhs_modelNames: [inverseType],\n    rhs_baseModelName: inverseType,\n    rhs_relationshipName: inverseKey,\n    rhs_definition: inverseDefinition,\n    rhs_isPolymorphic: inverseDefinition.isPolymorphic,\n    hasInverse: true,\n    isSelfReferential,\n    isReflexive: isSelfReferential && propertyName === inverseKey,\n  };\n\n  // Create entries for the baseModelName as well as modelName to speed up\n  //  inverse lookups\n  expandingSet<EdgeDefinition | null>(cache, baseType, propertyName, info);\n  expandingSet<EdgeDefinition | null>(cache, type, propertyName, info);\n\n  // Greedily populate the inverse\n  expandingSet<EdgeDefinition | null>(cache, inverseType, inverseKey, info);\n\n  return info;\n}\n\nfunction inverseForRelationship(store: Store, identifier: StableRecordIdentifier | { type: string }, key: string) {\n  const definition = store.getSchemaDefinitionService().relationshipsDefinitionFor(identifier)[key];\n  if (!definition) {\n    return null;\n  }\n\n  assert(\n    `Expected the relationship defintion to specify the inverse type or null.`,\n    definition.options?.inverse === null ||\n      (typeof definition.options?.inverse === 'string' && definition.options.inverse.length > 0)\n  );\n  return definition.options.inverse;\n}\n","import { assert } from '@ember/debug';\n\nimport { DEBUG } from '@ember-data/env';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport { assertPolymorphicType } from '../../debug/assert-polymorphic-type';\nimport type ManyRelationship from '../../relationships/state/has-many';\nimport type { ReplaceRelatedRecordsOperation } from '../-operations';\nimport { isBelongsTo, isHasMany, isNew, notifyChange } from '../-utils';\nimport type { Graph } from '../graph';\n\n/*\n    case many:1\n    ========\n    In a bi-directional graph with Many:1 edges, adding a value\n    results in up-to 3 discrete value transitions, while removing\n    a value is only 2 transitions.\n\n    For adding C to A\n    If: A <<-> B, C <->> D is the initial state,\n    and: B <->> A <<-> C, D is the final state\n\n    then we would undergo the following transitions.\n\n    add C to A\n    remove C from D\n    add A to C\n\n    For removing B from A\n    If: A <<-> B, C <->> D is the initial state,\n    and: A, B, C <->> D is the final state\n\n    then we would undergo the following transitions.\n\n    remove B from A\n    remove A from B\n\n    case many:many\n    ===========\n    In a bi-directional graph with Many:Many edges, adding or\n    removing a value requires only 2 value transitions.\n\n    For Adding\n    If: A<<->>B, C<<->>D is the initial state (double arrows representing the many side)\n    And: D<<->>C<<->>A<<->>B is the final state\n\n    Then we would undergo two transitions.\n\n    add C to A.\n    add A to C\n\n    For Removing\n    If: A<<->>B, C<<->>D is the initial state (double arrows representing the many side)\n    And: A, B, C<<->>D is the final state\n\n    Then we would undergo two transitions.\n\n    remove B from A\n    remove A from B\n\n    case many:?\n    ========\n    In a uni-directional graph with Many:? edges (modeled in EmberData with `inverse:null`) with\n    artificial (implicit) inverses, replacing a value results in 2 discrete value transitions.\n    This is because a Many:? relationship is effectively Many:Many.\n  */\nexport default function replaceRelatedRecords(graph: Graph, op: ReplaceRelatedRecordsOperation, isRemote: boolean) {\n  if (isRemote) {\n    replaceRelatedRecordsRemote(graph, op, isRemote);\n  } else {\n    replaceRelatedRecordsLocal(graph, op, isRemote);\n  }\n}\n\nfunction replaceRelatedRecordsLocal(graph: Graph, op: ReplaceRelatedRecordsOperation, isRemote: boolean) {\n  const identifiers = op.value;\n  const relationship = graph.get(op.record, op.field);\n  assert(`expected hasMany relationship`, isHasMany(relationship));\n  relationship.state.hasReceivedData = true;\n\n  // cache existing state\n  const { localState, localMembers, definition } = relationship;\n  const newValues = new Set(identifiers);\n  const identifiersLength = identifiers.length;\n  const newState = new Array(newValues.size);\n  const newMembership = new Set<StableRecordIdentifier>();\n\n  // wipe existing state\n  relationship.localMembers = newMembership;\n  relationship.localState = newState;\n\n  const { type } = relationship.definition;\n\n  let changed = false;\n\n  const currentLength = localState.length;\n  const iterationLength = currentLength > identifiersLength ? currentLength : identifiersLength;\n  const equalLength = currentLength === identifiersLength;\n\n  for (let i = 0, j = 0; i < iterationLength; i++) {\n    let adv = false;\n    if (i < identifiersLength) {\n      const identifier = identifiers[i];\n      // skip processing if we encounter a duplicate identifier in the array\n      if (!newMembership.has(identifier)) {\n        if (type !== identifier.type) {\n          if (DEBUG) {\n            assertPolymorphicType(relationship.identifier, relationship.definition, identifier, graph.store);\n          }\n          graph.registerPolymorphicType(type, identifier.type);\n        }\n        newState[j] = identifier;\n        adv = true;\n        newMembership.add(identifier);\n\n        if (!localMembers.has(identifier)) {\n          changed = true;\n          addToInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n        }\n      }\n    }\n    if (i < currentLength) {\n      const identifier = localState[i];\n\n      // detect reordering\n      if (!newMembership.has(identifier)) {\n        if (equalLength && newState[i] !== identifier) {\n          changed = true;\n        }\n\n        if (!newValues.has(identifier)) {\n          changed = true;\n          removeFromInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n        }\n      }\n    }\n    if (adv) {\n      j++;\n    }\n  }\n\n  if (changed) {\n    notifyChange(graph, relationship.identifier, relationship.definition.key);\n  }\n}\n\nfunction replaceRelatedRecordsRemote(graph: Graph, op: ReplaceRelatedRecordsOperation, isRemote: boolean) {\n  const identifiers = op.value;\n  const relationship = graph.get(op.record, op.field);\n\n  assert(\n    `You can only '${op.op}' on a hasMany relationship. ${op.record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isHasMany(relationship)\n  );\n  if (isRemote) {\n    graph._addToTransaction(relationship);\n  }\n  relationship.state.hasReceivedData = true;\n\n  // cache existing state\n  const { remoteState, remoteMembers, definition } = relationship;\n  const newValues = new Set(identifiers);\n  const identifiersLength = identifiers.length;\n  const newState = new Array(newValues.size);\n  const newMembership = new Set<StableRecordIdentifier>();\n\n  // wipe existing state\n  relationship.remoteMembers = newMembership;\n  relationship.remoteState = newState;\n\n  const { type } = relationship.definition;\n\n  let changed = false;\n\n  const canonicalLength = remoteState.length;\n  const iterationLength = canonicalLength > identifiersLength ? canonicalLength : identifiersLength;\n  const equalLength = canonicalLength === identifiersLength;\n\n  for (let i = 0, j = 0; i < iterationLength; i++) {\n    let adv = false;\n    if (i < identifiersLength) {\n      const identifier = identifiers[i];\n      if (!newMembership.has(identifier)) {\n        if (type !== identifier.type) {\n          if (DEBUG) {\n            assertPolymorphicType(relationship.identifier, relationship.definition, identifier, graph.store);\n          }\n          graph.registerPolymorphicType(type, identifier.type);\n        }\n        newState[j] = identifier;\n        newMembership.add(identifier);\n        adv = true;\n\n        if (!remoteMembers.has(identifier)) {\n          changed = true;\n          addToInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n        }\n      }\n    }\n    if (i < canonicalLength) {\n      const identifier = remoteState[i];\n\n      if (!newMembership.has(identifier)) {\n        // detect reordering\n        if (equalLength && newState[j] !== identifier) {\n          changed = true;\n        }\n\n        if (!newValues.has(identifier)) {\n          changed = true;\n          removeFromInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n        }\n      }\n    }\n    if (adv) {\n      j++;\n    }\n  }\n\n  if (changed) {\n    flushCanonical(graph, relationship);\n    /*\n    replaceRelatedRecordsLocal(\n      graph,\n      {\n        op: op.op,\n        record: op.record,\n        field: op.field,\n        value: remoteState,\n      },\n      false\n    );*/\n  } else {\n    // preserve legacy behavior we want to change but requires some sort\n    // of deprecation.\n    flushCanonical(graph, relationship);\n  }\n}\n\nexport function addToInverse(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  key: string,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  const relationship = graph.get(identifier, key);\n  const { type } = relationship.definition;\n\n  if (type !== value.type) {\n    if (DEBUG) {\n      assertPolymorphicType(relationship.identifier, relationship.definition, value, graph.store);\n    }\n    graph.registerPolymorphicType(type, value.type);\n  }\n\n  if (isBelongsTo(relationship)) {\n    relationship.state.hasReceivedData = true;\n    relationship.state.isEmpty = false;\n\n    if (isRemote) {\n      graph._addToTransaction(relationship);\n      if (relationship.remoteState !== null) {\n        removeFromInverse(graph, relationship.remoteState, relationship.definition.inverseKey, identifier, isRemote);\n      }\n      relationship.remoteState = value;\n    }\n\n    if (relationship.localState !== value) {\n      if (!isRemote && relationship.localState) {\n        removeFromInverse(graph, relationship.localState, relationship.definition.inverseKey, identifier, isRemote);\n      }\n      relationship.localState = value;\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  } else if (isHasMany(relationship)) {\n    if (isRemote) {\n      if (!relationship.remoteMembers.has(value)) {\n        graph._addToTransaction(relationship);\n        relationship.remoteState.push(value);\n        relationship.remoteMembers.add(value);\n        relationship.state.hasReceivedData = true;\n        flushCanonical(graph, relationship);\n      }\n    } else {\n      if (!relationship.localMembers.has(value)) {\n        relationship.localState.push(value);\n        relationship.localMembers.add(value);\n        relationship.state.hasReceivedData = true;\n        notifyChange(graph, relationship.identifier, relationship.definition.key);\n      }\n    }\n  } else {\n    if (isRemote) {\n      if (!relationship.remoteMembers.has(value)) {\n        relationship.remoteMembers.add(value);\n        relationship.localMembers.add(value);\n      }\n    } else {\n      if (!relationship.localMembers.has(value)) {\n        relationship.localMembers.add(value);\n      }\n    }\n  }\n}\n\nexport function notifyInverseOfPotentialMaterialization(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  key: string,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  const relationship = graph.get(identifier, key);\n  if (isHasMany(relationship) && isRemote && relationship.remoteMembers.has(value)) {\n    notifyChange(graph, relationship.identifier, relationship.definition.key);\n  }\n}\n\nexport function removeFromInverse(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  key: string,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  const relationship = graph.get(identifier, key);\n\n  if (isBelongsTo(relationship)) {\n    relationship.state.isEmpty = true;\n    if (isRemote) {\n      graph._addToTransaction(relationship);\n      relationship.remoteState = null;\n    }\n    if (relationship.localState === value) {\n      relationship.localState = null;\n\n      notifyChange(graph, identifier, key);\n    }\n  } else if (isHasMany(relationship)) {\n    if (isRemote) {\n      graph._addToTransaction(relationship);\n      let index = relationship.remoteState.indexOf(value);\n      if (index !== -1) {\n        relationship.remoteMembers.delete(value);\n        relationship.remoteState.splice(index, 1);\n      }\n    }\n    let index = relationship.localState.indexOf(value);\n    if (index !== -1) {\n      relationship.localMembers.delete(value);\n      relationship.localState.splice(index, 1);\n    }\n    notifyChange(graph, relationship.identifier, relationship.definition.key);\n  } else {\n    if (isRemote) {\n      relationship.remoteMembers.delete(value);\n      relationship.localMembers.delete(value);\n    } else {\n      if (value && relationship.localMembers.has(value)) {\n        relationship.localMembers.delete(value);\n      }\n    }\n  }\n}\n\nexport function syncRemoteToLocal(graph: Graph, rel: ManyRelationship) {\n  let toSet = rel.remoteState;\n  let newIdentifiers = rel.localState.filter((identifier) => isNew(identifier) && toSet.indexOf(identifier) === -1);\n  let existingState = rel.localState;\n  rel.localState = toSet.concat(newIdentifiers);\n\n  let localMembers = (rel.localMembers = new Set<StableRecordIdentifier>());\n  rel.remoteMembers.forEach((v) => localMembers.add(v));\n  for (let i = 0; i < newIdentifiers.length; i++) {\n    localMembers.add(newIdentifiers[i]);\n  }\n\n  // TODO always notifying fails only one test and we should probably do away with it\n  if (existingState.length !== rel.localState.length) {\n    notifyChange(graph, rel.identifier, rel.definition.key);\n  } else {\n    for (let i = 0; i < existingState.length; i++) {\n      if (existingState[i] !== rel.localState[i]) {\n        notifyChange(graph, rel.identifier, rel.definition.key);\n        break;\n      }\n    }\n  }\n}\n\nfunction flushCanonical(graph: Graph, rel: ManyRelationship) {\n  graph._scheduleLocalSync(rel);\n}\n","import { assert } from '@ember/debug';\n\nimport { DEBUG } from '@ember-data/env';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport { assertPolymorphicType } from '../../debug/assert-polymorphic-type';\nimport type ManyRelationship from '../../relationships/state/has-many';\nimport type { AddToRelatedRecordsOperation } from '../-operations';\nimport { isHasMany, notifyChange } from '../-utils';\nimport type { Graph } from '../graph';\nimport { addToInverse } from './replace-related-records';\n\nexport default function addToRelatedRecords(graph: Graph, op: AddToRelatedRecordsOperation, isRemote: boolean) {\n  const { record, value, index } = op;\n  const relationship = graph.get(record, op.field);\n  assert(\n    `You can only '${op.op}' on a hasMany relationship. ${record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isHasMany(relationship)\n  );\n  if (Array.isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      addRelatedRecord(graph, relationship, record, value[i], index !== undefined ? index + i : index, isRemote);\n    }\n  } else {\n    addRelatedRecord(graph, relationship, record, value, index, isRemote);\n  }\n\n  notifyChange(graph, relationship.identifier, relationship.definition.key);\n}\n\nfunction addRelatedRecord(\n  graph: Graph,\n  relationship: ManyRelationship,\n  record: StableRecordIdentifier,\n  value: StableRecordIdentifier,\n  index: number | undefined,\n  isRemote: boolean\n) {\n  assert(`expected an identifier to add to the relationship`, value);\n  const { localMembers, localState } = relationship;\n\n  if (localMembers.has(value)) {\n    return;\n  }\n\n  const { type } = relationship.definition;\n  if (type !== value.type) {\n    if (DEBUG) {\n      assertPolymorphicType(record, relationship.definition, value, graph.store);\n    }\n    graph.registerPolymorphicType(value.type, type);\n  }\n\n  relationship.state.hasReceivedData = true;\n  localMembers.add(value);\n  if (index === undefined) {\n    localState.push(value);\n  } else {\n    localState.splice(index, 0, value);\n  }\n\n  addToInverse(graph, value, relationship.definition.inverseKey, record, isRemote);\n}\n","import type { MergeOperation } from '@ember-data/types/q/cache';\n\nimport type BelongsToRelationship from '../../relationships/state/belongs-to';\nimport type ManyRelationship from '../../relationships/state/has-many';\nimport { forAllRelatedIdentifiers, isBelongsTo, isHasMany, notifyChange } from '../-utils';\nimport type { Graph, ImplicitRelationship, RelationshipEdge } from '../graph';\n\nexport function mergeIdentifier(graph: Graph, op: MergeOperation, relationships: Record<string, RelationshipEdge>) {\n  Object.keys(relationships).forEach((key) => {\n    const rel = relationships[key];\n    if (!rel) {\n      return;\n    }\n    mergeIdentifierForRelationship(graph, op, rel);\n  });\n}\n\nfunction mergeIdentifierForRelationship(graph: Graph, op: MergeOperation, rel: RelationshipEdge): void {\n  rel.identifier = op.value;\n  forAllRelatedIdentifiers(rel, (identifier) => {\n    const inverse = graph.get(identifier, rel.definition.inverseKey);\n    mergeInRelationship(graph, inverse, op);\n  });\n}\n\nfunction mergeInRelationship(graph: Graph, rel: RelationshipEdge, op: MergeOperation): void {\n  if (isBelongsTo(rel)) {\n    mergeBelongsTo(graph, rel, op);\n  } else if (isHasMany(rel)) {\n    mergeHasMany(graph, rel, op);\n  } else {\n    mergeImplicit(graph, rel, op);\n  }\n}\n\nfunction mergeBelongsTo(graph: Graph, rel: BelongsToRelationship, op: MergeOperation): void {\n  if (rel.remoteState === op.record) {\n    rel.remoteState = op.value;\n  }\n  if (rel.localState === op.record) {\n    rel.localState = op.record;\n    notifyChange(graph, rel.identifier, rel.definition.key);\n  }\n}\n\nfunction mergeHasMany(graph: Graph, rel: ManyRelationship, op: MergeOperation): void {\n  if (rel.remoteMembers.has(op.record)) {\n    rel.remoteMembers.delete(op.record);\n    rel.remoteMembers.add(op.value);\n    const index = rel.remoteState.indexOf(op.record);\n    rel.remoteState.splice(index, 1, op.value);\n  }\n  if (rel.localMembers.has(op.record)) {\n    rel.localMembers.delete(op.record);\n    rel.localMembers.add(op.value);\n    const index = rel.localState.indexOf(op.record);\n    rel.localState.splice(index, 1, op.value);\n    notifyChange(graph, rel.identifier, rel.definition.key);\n  }\n}\n\nfunction mergeImplicit(graph: Graph, rel: ImplicitRelationship, op: MergeOperation): void {\n  if (rel.remoteMembers.has(op.record)) {\n    rel.remoteMembers.delete(op.record);\n    rel.remoteMembers.add(op.value);\n  }\n  if (rel.localMembers.has(op.record)) {\n    rel.localMembers.delete(op.record);\n    rel.localMembers.add(op.value);\n  }\n}\n","import { assert } from '@ember/debug';\n\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport type ManyRelationship from '../../relationships/state/has-many';\nimport type { RemoveFromRelatedRecordsOperation } from '../-operations';\nimport { isHasMany, notifyChange } from '../-utils';\nimport type { Graph } from '../graph';\nimport { removeFromInverse } from './replace-related-records';\n\nexport default function removeFromRelatedRecords(\n  graph: Graph,\n  op: RemoveFromRelatedRecordsOperation,\n  isRemote: boolean\n) {\n  const { record, value } = op;\n  const relationship = graph.get(record, op.field);\n  assert(\n    `You can only '${op.op}' on a hasMany relationship. ${record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isHasMany(relationship)\n  );\n  if (Array.isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      removeRelatedRecord(graph, relationship, record, value[i], isRemote);\n    }\n  } else {\n    removeRelatedRecord(graph, relationship, record, value, isRemote);\n  }\n  notifyChange(graph, relationship.identifier, relationship.definition.key);\n}\n\nfunction removeRelatedRecord(\n  graph: Graph,\n  relationship: ManyRelationship,\n  record: StableRecordIdentifier,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  assert(`expected an identifier to add to the relationship`, value);\n  const { localMembers, localState } = relationship;\n\n  if (!localMembers.has(value)) {\n    return;\n  }\n\n  localMembers.delete(value);\n  let index = localState.indexOf(value);\n\n  assert(`expected localMembers and localState to be in sync`, index !== -1);\n  localState.splice(index, 1);\n\n  removeFromInverse(graph, value, relationship.definition.inverseKey, record, isRemote);\n}\n","import { assert } from '@ember/debug';\n\nimport { DEBUG } from '@ember-data/env';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport { assertPolymorphicType } from '../../debug/assert-polymorphic-type';\nimport type { ReplaceRelatedRecordOperation } from '../-operations';\nimport { isBelongsTo, isNew, notifyChange } from '../-utils';\nimport type { Graph } from '../graph';\nimport { addToInverse, notifyInverseOfPotentialMaterialization, removeFromInverse } from './replace-related-records';\n\nexport default function replaceRelatedRecord(graph: Graph, op: ReplaceRelatedRecordOperation, isRemote = false) {\n  const relationship = graph.get(op.record, op.field);\n  assert(\n    `You can only '${op.op}' on a belongsTo relationship. ${op.record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isBelongsTo(relationship)\n  );\n  if (isRemote) {\n    graph._addToTransaction(relationship);\n  }\n  const { definition, state } = relationship;\n  const prop = isRemote ? 'remoteState' : 'localState';\n  const existingState: StableRecordIdentifier | null = relationship[prop];\n\n  /*\n    case 1:1\n    ========\n    In a bi-directional graph with 1:1 edges, replacing a value\n    results in up-to 4 discrete value transitions.\n\n    If: A <-> B, C <-> D is the initial state,\n    and: A <-> C, B, D is the final state\n\n    then we would undergo the following 4 transitions.\n\n    remove A from B\n    add C to A\n    remove C from D\n    add A to C\n\n    case 1:many\n    ===========\n    In a bi-directional graph with 1:Many edges, replacing a value\n    results in up-to 3 discrete value transitions.\n\n    If: A<->>B<<->D, C<<->D is the initial state (double arrows representing the many side)\n    And: A<->>C<<->D, B<<->D is the final state\n\n    Then we would undergo three transitions.\n\n    remove A from B\n    add C to A.\n    add A to C\n\n    case 1:?\n    ========\n    In a uni-directional graph with 1:? edges (modeled in EmberData with `inverse:null`) with\n    artificial (implicit) inverses, replacing a value results in up-to 3 discrete value transitions.\n    This is because a 1:? relationship is effectively 1:many.\n\n    If: A->B, C->B is the initial state\n    And: A->C, C->B is the final state\n\n    Then we would undergo three transitions.\n\n    Remove A from B\n    Add C to A\n    Add A to C\n  */\n\n  // nothing for us to do\n  if (op.value === existingState) {\n    // if we were empty before but now know we are empty this needs to be true\n    state.hasReceivedData = true;\n    // if this is a remote update we still sync\n    if (isRemote) {\n      const { localState } = relationship;\n      // don't sync if localState is a new record and our remoteState is null\n      if (localState && isNew(localState) && !existingState) {\n        return;\n      }\n      if (existingState && localState === existingState) {\n        notifyInverseOfPotentialMaterialization(graph, existingState, definition.inverseKey, op.record, isRemote);\n      } else {\n        relationship.localState = existingState;\n\n        notifyChange(graph, relationship.identifier, relationship.definition.key);\n      }\n    }\n    return;\n  }\n\n  // remove this value from the inverse if required\n  if (existingState) {\n    removeFromInverse(graph, existingState, definition.inverseKey, op.record, isRemote);\n  }\n\n  // update value to the new value\n  relationship[prop] = op.value;\n  state.hasReceivedData = true;\n  state.isEmpty = op.value === null;\n  state.isStale = false;\n  state.hasFailedLoadAttempt = false;\n\n  if (op.value) {\n    if (definition.type !== op.value.type) {\n      // assert(\n      //   `The '<${definition.inverseType}>.${op.field}' relationship expects only '${definition.type}' records since it is not polymorphic. Received a Record of type '${op.value.type}'`,\n      //   definition.isPolymorphic\n      // );\n\n      // TODO this should now handle the deprecation warning if isPolymorphic is not set\n      // but the record does turn out to be polymorphic\n      // this should still assert if the user is relying on legacy inheritance/mixins to\n      // provide polymorphic behavior and has not yet added the polymorphic flags\n      if (DEBUG) {\n        assertPolymorphicType(relationship.identifier, definition, op.value, graph.store);\n      }\n\n      graph.registerPolymorphicType(definition.type, op.value.type);\n    }\n    addToInverse(graph, op.value, definition.inverseKey, op.record, isRemote);\n  }\n\n  if (isRemote) {\n    const { localState, remoteState } = relationship;\n    if (localState && isNew(localState) && !remoteState) {\n      return;\n    }\n    if (localState !== remoteState) {\n      relationship.localState = remoteState;\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  } else {\n    notifyChange(graph, relationship.identifier, relationship.definition.key);\n  }\n}\n","import type { Link, LinkObject } from '@ember-data/types/q/ember-data-json-api';\n\n/*\n  This method normalizes a link to an \"links object\". If the passed link is\n  already an object it's returned without any modifications.\n\n  See http://jsonapi.org/format/#document-links for more information.\n*/\nexport default function _normalizeLink(link: Link): LinkObject | null {\n  switch (typeof link) {\n    case 'object':\n      return link;\n    case 'string':\n      return { href: link };\n  }\n}\n","import { assert, warn } from '@ember/debug';\n\nimport type { ExistingResourceIdentifierObject } from '@ember-data/types/q/ember-data-json-api';\n\nimport _normalizeLink from '../../normalize-link';\nimport type { UpdateRelationshipOperation } from '../-operations';\nimport { isBelongsTo, isHasMany, notifyChange } from '../-utils';\nimport type { Graph } from '../graph';\n\n/*\n    Updates the \"canonical\" or \"remote\" state of a relationship, replacing any existing\n    state and blowing away any local changes (excepting new records).\n*/\nexport default function updateRelationshipOperation(graph: Graph, op: UpdateRelationshipOperation) {\n  const relationship = graph.get(op.record, op.field);\n  assert(`Cannot update an implicit relationship`, isHasMany(relationship) || isBelongsTo(relationship));\n  const { definition, state, identifier } = relationship;\n  const { isCollection } = definition;\n\n  const payload = op.value;\n\n  let hasRelationshipDataProperty: boolean = false;\n  let hasUpdatedLink: boolean = false;\n\n  if (payload.meta) {\n    relationship.meta = payload.meta;\n  }\n\n  if (payload.data !== undefined) {\n    hasRelationshipDataProperty = true;\n    if (isCollection) {\n      // TODO deprecate this case. We\n      // have tests saying we support it.\n      if (payload.data === null) {\n        payload.data = [];\n      }\n      assert(`Expected an array`, Array.isArray(payload.data));\n      const cache = graph.store.identifierCache;\n      // TODO may not need to cast to stable identifiers here since update likely does this too\n      graph.update(\n        {\n          op: 'replaceRelatedRecords',\n          record: identifier,\n          field: op.field,\n          value: payload.data.map((i) => cache.getOrCreateRecordIdentifier(i)),\n        },\n        true\n      );\n    } else {\n      // TODO may not need to cast to stable identifiers here since update likely does this too\n      graph.update(\n        {\n          op: 'replaceRelatedRecord',\n          record: identifier,\n          field: op.field,\n          value: payload.data\n            ? graph.store.identifierCache.getOrCreateRecordIdentifier(payload.data as ExistingResourceIdentifierObject)\n            : null,\n        },\n        true\n      );\n    }\n  } else if (definition.isAsync === false && !state.hasReceivedData) {\n    hasRelationshipDataProperty = true;\n\n    if (isCollection) {\n      graph.update(\n        {\n          op: 'replaceRelatedRecords',\n          record: identifier,\n          field: op.field,\n          value: [],\n        },\n        true\n      );\n    } else {\n      graph.update(\n        {\n          op: 'replaceRelatedRecord',\n          record: identifier,\n          field: op.field,\n          value: null,\n        },\n        true\n      );\n    }\n  }\n\n  if (payload.links) {\n    let originalLinks = relationship.links;\n    relationship.links = payload.links;\n    if (payload.links.related) {\n      let relatedLink = _normalizeLink(payload.links.related);\n      let currentLink = originalLinks && originalLinks.related ? _normalizeLink(originalLinks.related) : null;\n      let currentLinkHref = currentLink ? currentLink.href : null;\n\n      if (relatedLink && relatedLink.href && relatedLink.href !== currentLinkHref) {\n        warn(\n          `You pushed a record of type '${identifier.type}' with a relationship '${definition.key}' configured as 'async: false'. You've included a link but no primary data, this may be an error in your payload. EmberData will treat this relationship as known-to-be-empty.`,\n          definition.isAsync || state.hasReceivedData,\n          {\n            id: 'ds.store.push-link-for-sync-relationship',\n          }\n        );\n        assert(\n          `You have pushed a record of type '${identifier.type}' with '${definition.key}' as a link, but the value of that link is not a string.`,\n          typeof relatedLink.href === 'string' || relatedLink.href === null\n        );\n        hasUpdatedLink = true;\n      }\n    }\n  }\n\n  /*\n       Data being pushed into the relationship might contain only data or links,\n       or a combination of both.\n\n       IF contains only data\n       IF contains both links and data\n        state.isEmpty -> true if is empty array (has-many) or is null (belongs-to)\n        state.hasReceivedData -> true\n        hasDematerializedInverse -> false\n        state.isStale -> false\n        allInverseRecordsAreLoaded -> run-check-to-determine\n\n       IF contains only links\n        state.isStale -> true\n       */\n  relationship.state.hasFailedLoadAttempt = false;\n  if (hasRelationshipDataProperty) {\n    let relationshipIsEmpty = payload.data === null || (Array.isArray(payload.data) && payload.data.length === 0);\n\n    // we don't need to notify here as the update op we pushed in above will notify once\n    // membership is in the correct state.\n    relationship.state.hasReceivedData = true;\n    relationship.state.isStale = false;\n    relationship.state.hasDematerializedInverse = false;\n    relationship.state.isEmpty = relationshipIsEmpty;\n  } else if (hasUpdatedLink) {\n    // only notify stale if we have not previously received membership data.\n    // within this same transaction\n    // this prevents refetching when only one side of the relationship in the\n    // payload contains the info while the other side contains just a link\n    // this only works when the side with just a link is a belongsTo, as we\n    // don't know if a hasMany has full information or not.\n    // see #7049 for context.\n    if (isCollection || !relationship.state.hasReceivedData || relationship.transactionRef === 0) {\n      relationship.state.isStale = true;\n\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    } else {\n      relationship.state.isStale = false;\n    }\n  }\n}\n","import { assert } from '@ember/debug';\n\nimport { LOG_GRAPH } from '@ember-data/debugging';\nimport { DEBUG } from '@ember-data/env';\nimport { MergeOperation } from '@ember-data/types/q/cache';\nimport type { CacheStoreWrapper } from '@ember-data/types/q/cache-store-wrapper';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport BelongsToRelationship from '../relationships/state/belongs-to';\nimport ManyRelationship from '../relationships/state/has-many';\nimport type { EdgeCache, UpgradedMeta } from './-edge-definition';\nimport { isLHS, upgradeDefinition } from './-edge-definition';\nimport type {\n  DeleteRecordOperation,\n  LocalRelationshipOperation,\n  RemoteRelationshipOperation,\n  UnknownOperation,\n} from './-operations';\nimport {\n  assertValidRelationshipPayload,\n  forAllRelatedIdentifiers,\n  getStore,\n  isBelongsTo,\n  isHasMany,\n  isImplicit,\n  isNew,\n  notifyChange,\n  removeIdentifierCompletelyFromRelationship,\n} from './-utils';\nimport addToRelatedRecords from './operations/add-to-related-records';\nimport { mergeIdentifier } from './operations/merge-identifier';\nimport removeFromRelatedRecords from './operations/remove-from-related-records';\nimport replaceRelatedRecord from './operations/replace-related-record';\nimport replaceRelatedRecords, { syncRemoteToLocal } from './operations/replace-related-records';\nimport updateRelationshipOperation from './operations/update-relationship';\n\nexport interface ImplicitRelationship {\n  definition: UpgradedMeta;\n  identifier: StableRecordIdentifier;\n  localMembers: Set<StableRecordIdentifier>;\n  remoteMembers: Set<StableRecordIdentifier>;\n}\n\nexport type RelationshipEdge = ImplicitRelationship | ManyRelationship | BelongsToRelationship;\n\nexport const Graphs = new Map<CacheStoreWrapper, Graph>();\n\n/*\n * Graph acts as the cache for relationship data. It allows for\n * us to ask about and update relationships for a given Identifier\n * without requiring other objects for that Identifier to be\n * instantiated (such as `RecordData` or a `Record`)\n *\n * This also allows for us to make more substantive changes to relationships\n * with increasingly minor alterations to other portions of the internals\n * over time.\n *\n * The graph is made up of nodes and edges. Each unique identifier gets\n * its own node, which is a dictionary with a list of that node's edges\n * (or connections) to other nodes. In `Model` terms, a node represents a\n * record instance, with each key (an edge) in the dictionary correlating\n * to either a `hasMany` or `belongsTo` field on that record instance.\n *\n * The value for each key, or `edge` is the identifier(s) the node relates\n * to in the graph from that key.\n */\nexport class Graph {\n  declare _definitionCache: EdgeCache;\n  declare _potentialPolymorphicTypes: Record<string, Record<string, boolean>>;\n  declare identifiers: Map<StableRecordIdentifier, Record<string, RelationshipEdge>>;\n  declare store: CacheStoreWrapper;\n  declare isDestroyed: boolean;\n  declare _willSyncRemote: boolean;\n  declare _willSyncLocal: boolean;\n  declare _pushedUpdates: {\n    belongsTo: RemoteRelationshipOperation[];\n    hasMany: RemoteRelationshipOperation[];\n    deletions: DeleteRecordOperation[];\n  };\n  declare _updatedRelationships: Set<ManyRelationship>;\n  declare _transaction: Set<ManyRelationship | BelongsToRelationship> | null;\n  declare _removing: StableRecordIdentifier | null;\n\n  constructor(store: CacheStoreWrapper) {\n    this._definitionCache = Object.create(null) as EdgeCache;\n    this._potentialPolymorphicTypes = Object.create(null) as Record<string, Record<string, boolean>>;\n    this.identifiers = new Map();\n    this.store = store;\n    this.isDestroyed = false;\n    this._willSyncRemote = false;\n    this._willSyncLocal = false;\n    this._pushedUpdates = { belongsTo: [], hasMany: [], deletions: [] };\n    this._updatedRelationships = new Set();\n    this._transaction = null;\n    this._removing = null;\n  }\n\n  has(identifier: StableRecordIdentifier, propertyName: string): boolean {\n    let relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      return false;\n    }\n    return relationships[propertyName] !== undefined;\n  }\n\n  get(identifier: StableRecordIdentifier, propertyName: string): RelationshipEdge {\n    assert(`expected propertyName`, propertyName);\n    let relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      relationships = Object.create(null) as Record<string, RelationshipEdge>;\n      this.identifiers.set(identifier, relationships);\n    }\n\n    let relationship = relationships[propertyName];\n    if (!relationship) {\n      const info = upgradeDefinition(this, identifier, propertyName);\n      assert(`Could not determine relationship information for ${identifier.type}.${propertyName}`, info !== null);\n\n      if (info.rhs_definition?.kind === 'implicit') {\n        // we should possibly also do this\n        // but it would result in being extremely permissive for other relationships by accident\n        // this.registerPolymorphicType(info.rhs_baseModelName, identifier.type);\n      }\n\n      const meta = isLHS(info, identifier.type, propertyName) ? info.lhs_definition : info.rhs_definition!;\n\n      if (meta.kind !== 'implicit') {\n        const Klass = meta.kind === 'hasMany' ? ManyRelationship : BelongsToRelationship;\n        relationship = relationships[propertyName] = new Klass(meta, identifier);\n      } else {\n        relationship = relationships[propertyName] = {\n          definition: meta,\n          identifier,\n          localMembers: new Set(),\n          remoteMembers: new Set(),\n        };\n      }\n    }\n\n    return relationship;\n  }\n\n  /*\n   * Allows for the graph to dynamically discover polymorphic connections\n   * without needing to walk prototype chains.\n   *\n   * Used by edges when an added `type` does not match the expected `type`\n   * for that edge.\n   *\n   * Currently we assert before calling this. For a public API we will want\n   * to call out to the schema manager to ask if we should consider these\n   * types as equivalent for a given relationship.\n   */\n  registerPolymorphicType(type1: string, type2: string): void {\n    const typeCache = this._potentialPolymorphicTypes;\n    let t1 = typeCache[type1];\n    if (!t1) {\n      t1 = typeCache[type1] = Object.create(null) as Record<string, boolean>;\n    }\n    t1[type2] = true;\n\n    let t2 = typeCache[type2];\n    if (!t2) {\n      t2 = typeCache[type2] = Object.create(null) as Record<string, boolean>;\n    }\n    t2[type1] = true;\n  }\n\n  /*\n   TODO move this comment somewhere else\n   implicit relationships are relationships which have not been declared but the inverse side exists on\n   another record somewhere\n\n   For example if there was:\n\n   ```app/models/comment.js\n   import Model, { attr } from '@ember-data/model';\n\n   export default class Comment extends Model {\n     @attr text;\n   }\n   ```\n\n   and there is also:\n\n   ```app/models/post.js\n   import Model, { attr, hasMany } from '@ember-data/model';\n\n   export default class Post extends Model {\n     @attr title;\n     @hasMany('comment', { async: true, inverse: null }) comments;\n   }\n   ```\n\n   Then we would have a implicit 'post' relationship for the comment record in order\n   to be do things like remove the comment from the post if the comment were to be deleted.\n  */\n\n  isReleasable(identifier: StableRecordIdentifier): boolean {\n    const relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      if (LOG_GRAPH) {\n        // eslint-disable-next-line no-console\n        console.log(`graph: RELEASABLE ${String(identifier)}`);\n      }\n      return true;\n    }\n    const keys = Object.keys(relationships);\n    for (let i = 0; i < keys.length; i++) {\n      const relationship: RelationshipEdge = relationships[keys[i]];\n      // account for previously unloaded relationships\n      // typically from a prior deletion of a record that pointed to this one implicitly\n      if (relationship === undefined) {\n        continue;\n      }\n      assert(`Expected a relationship`, relationship);\n      if (relationship.definition.inverseIsAsync) {\n        if (LOG_GRAPH) {\n          // eslint-disable-next-line no-console\n          console.log(`graph: <<NOT>> RELEASABLE ${String(identifier)}`);\n        }\n        return false;\n      }\n    }\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: RELEASABLE ${String(identifier)}`);\n    }\n    return true;\n  }\n\n  unload(identifier: StableRecordIdentifier, silenceNotifications?: boolean) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: unload ${String(identifier)}`);\n    }\n    const relationships = this.identifiers.get(identifier);\n\n    if (relationships) {\n      // cleans up the graph but retains some nodes\n      // to allow for rematerialization\n      Object.keys(relationships).forEach((key) => {\n        let rel = relationships[key]!;\n        if (!rel) {\n          return;\n        }\n        destroyRelationship(this, rel, silenceNotifications);\n        if (isImplicit(rel)) {\n          // @ts-expect-error\n          relationships[key] = undefined;\n        }\n      });\n    }\n  }\n\n  remove(identifier: StableRecordIdentifier) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: remove ${String(identifier)}`);\n    }\n    assert(`Cannot remove ${String(identifier)} while still removing ${String(this._removing)}`, !this._removing);\n    this._removing = identifier;\n    this.unload(identifier);\n    this.identifiers.delete(identifier);\n    this._removing = null;\n  }\n\n  /*\n   * Remote state changes\n   */\n  push(op: RemoteRelationshipOperation) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: push ${String(op.record)}`, op);\n    }\n    if (op.op === 'deleteRecord') {\n      this._pushedUpdates.deletions.push(op);\n    } else if (op.op === 'replaceRelatedRecord') {\n      this._pushedUpdates.belongsTo.push(op);\n    } else {\n      const relationship = this.get(op.record, op.field);\n      assert(`Cannot push a remote update for an implicit relationship`, !isImplicit(relationship));\n      this._pushedUpdates[relationship.definition.kind as 'belongsTo' | 'hasMany'].push(op);\n    }\n    if (!this._willSyncRemote) {\n      this._willSyncRemote = true;\n      getStore(this.store)._schedule('coalesce', () => this._flushRemoteQueue());\n    }\n  }\n\n  /*\n   * Local state changes\n   */\n  update(op: RemoteRelationshipOperation | MergeOperation, isRemote: true): void;\n  update(op: LocalRelationshipOperation, isRemote?: false): void;\n  update(\n    op: MergeOperation | LocalRelationshipOperation | RemoteRelationshipOperation | UnknownOperation,\n    isRemote: boolean = false\n  ): void {\n    assert(\n      `Cannot update an implicit relationship`,\n      op.op === 'deleteRecord' || op.op === 'mergeIdentifiers' || !isImplicit(this.get(op.record, op.field))\n    );\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: update (${isRemote ? 'remote' : 'local'}) ${String(op.record)}`, op);\n    }\n\n    switch (op.op) {\n      case 'mergeIdentifiers': {\n        const relationships = this.identifiers.get(op.record);\n        if (relationships) {\n          mergeIdentifier(this, op, relationships);\n        }\n        break;\n      }\n      case 'updateRelationship':\n        assert(`Can only perform the operation updateRelationship on remote state`, isRemote);\n        if (DEBUG) {\n          // in debug, assert payload validity eagerly\n          // TODO add deprecations/assertion here for duplicates\n          assertValidRelationshipPayload(this, op);\n        }\n        updateRelationshipOperation(this, op);\n        break;\n      case 'deleteRecord': {\n        assert(`Can only perform the operation deleteRelationship on remote state`, isRemote);\n        const identifier = op.record;\n        const relationships = this.identifiers.get(identifier);\n\n        if (relationships) {\n          Object.keys(relationships).forEach((key) => {\n            const rel = relationships[key];\n            if (!rel) {\n              return;\n            }\n            // works together with the has check\n            // @ts-expect-error\n            relationships[key] = undefined;\n            removeCompletelyFromInverse(this, rel);\n          });\n          this.identifiers.delete(identifier);\n        }\n        break;\n      }\n      case 'replaceRelatedRecord':\n        replaceRelatedRecord(this, op, isRemote);\n        break;\n      case 'addToRelatedRecords':\n        addToRelatedRecords(this, op, isRemote);\n        break;\n      case 'removeFromRelatedRecords':\n        removeFromRelatedRecords(this, op, isRemote);\n        break;\n      case 'replaceRelatedRecords':\n        replaceRelatedRecords(this, op, isRemote);\n        break;\n      default:\n        assert(`No local relationship update operation exists for '${op.op}'`);\n    }\n  }\n\n  _scheduleLocalSync(relationship: ManyRelationship) {\n    this._updatedRelationships.add(relationship);\n    if (!this._willSyncLocal) {\n      this._willSyncLocal = true;\n      getStore(this.store)._schedule('sync', () => this._flushLocalQueue());\n    }\n  }\n\n  _flushRemoteQueue() {\n    if (!this._willSyncRemote) {\n      return;\n    }\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.groupCollapsed(`Graph: Initialized Transaction`);\n    }\n    this._transaction = new Set();\n    this._willSyncRemote = false;\n    const { deletions, hasMany, belongsTo } = this._pushedUpdates;\n    this._pushedUpdates.deletions = [];\n    this._pushedUpdates.hasMany = [];\n    this._pushedUpdates.belongsTo = [];\n\n    for (let i = 0; i < deletions.length; i++) {\n      this.update(deletions[i], true);\n    }\n\n    for (let i = 0; i < hasMany.length; i++) {\n      this.update(hasMany[i], true);\n    }\n\n    for (let i = 0; i < belongsTo.length; i++) {\n      this.update(belongsTo[i], true);\n    }\n    this._finalize();\n  }\n\n  _addToTransaction(relationship: ManyRelationship | BelongsToRelationship) {\n    assert(`expected a transaction`, this._transaction !== null);\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`Graph: ${String(relationship.identifier)} ${relationship.definition.key} added to transaction`);\n    }\n    relationship.transactionRef++;\n    this._transaction.add(relationship);\n  }\n\n  _finalize() {\n    if (this._transaction) {\n      this._transaction.forEach((v) => (v.transactionRef = 0));\n      this._transaction = null;\n      if (LOG_GRAPH) {\n        // eslint-disable-next-line no-console\n        console.log(`Graph: transaction finalized`);\n        // eslint-disable-next-line no-console\n        console.groupEnd();\n      }\n    }\n  }\n\n  _flushLocalQueue() {\n    if (!this._willSyncLocal) {\n      return;\n    }\n    this._willSyncLocal = false;\n    let updated = this._updatedRelationships;\n    this._updatedRelationships = new Set();\n    updated.forEach((rel) => syncRemoteToLocal(this, rel));\n  }\n\n  destroy() {\n    Graphs.delete(this.store);\n\n    if (DEBUG) {\n      Graphs.delete(getStore(this.store) as unknown as CacheStoreWrapper);\n      if (Graphs.size) {\n        Graphs.forEach((_, key) => {\n          assert(\n            `Memory Leak Detected, likely the test or app instance previous to this was not torn down properly`,\n            // @ts-expect-error\n            !key.isDestroyed && !key.isDestroying\n          );\n        });\n      }\n    }\n\n    this.identifiers.clear();\n    this.store = null as unknown as CacheStoreWrapper;\n    this.isDestroyed = true;\n  }\n}\n\n// Handle dematerialization for relationship `rel`.  In all cases, notify the\n// relationship of the dematerialization: this is done so the relationship can\n// notify its inverse which needs to update state\n//\n// If the inverse is sync, unloading this record is treated as a client-side\n// delete, so we remove the inverse records from this relationship to\n// disconnect the graph.  Because it's not async, we don't need to keep around\n// the identifier as an id-wrapper for references\nfunction destroyRelationship(graph: Graph, rel: RelationshipEdge, silenceNotifications?: boolean) {\n  if (isImplicit(rel)) {\n    if (graph.isReleasable(rel.identifier)) {\n      removeCompletelyFromInverse(graph, rel);\n    }\n    return;\n  }\n\n  const { identifier } = rel;\n  const { inverseKey } = rel.definition;\n\n  if (!rel.definition.inverseIsImplicit) {\n    forAllRelatedIdentifiers(rel, (inverseIdentifer: StableRecordIdentifier) =>\n      notifyInverseOfDematerialization(graph, inverseIdentifer, inverseKey, identifier, silenceNotifications)\n    );\n  }\n\n  if (!rel.definition.inverseIsImplicit && !rel.definition.inverseIsAsync) {\n    rel.state.isStale = true;\n    clearRelationship(rel);\n\n    // necessary to clear relationships in the ui from dematerialized records\n    // hasMany is managed by Model which calls `retreiveLatest` after\n    // dematerializing the resource-cache instance.\n    // but sync belongsTo requires this since they don't have a proxy to update.\n    // so we have to notify so it will \"update\" to null.\n    // we should discuss whether we still care about this, probably fine to just\n    // leave the ui relationship populated since the record is destroyed and\n    // internally we've fully cleaned up.\n    if (!rel.definition.isAsync && !silenceNotifications) {\n      notifyChange(graph, rel.identifier, rel.definition.key);\n    }\n  }\n}\n\nfunction notifyInverseOfDematerialization(\n  graph: Graph,\n  inverseIdentifier: StableRecordIdentifier,\n  inverseKey: string,\n  identifier: StableRecordIdentifier,\n  silenceNotifications?: boolean\n) {\n  if (!graph.has(inverseIdentifier, inverseKey)) {\n    return;\n  }\n\n  let relationship = graph.get(inverseIdentifier, inverseKey);\n  assert(`expected no implicit`, !isImplicit(relationship));\n\n  // For remote members, it is possible that inverseRecordData has already been associated to\n  // to another record. For such cases, do not dematerialize the inverseRecordData\n  if (!isBelongsTo(relationship) || !relationship.localState || identifier === relationship.localState) {\n    removeDematerializedInverse(\n      graph,\n      relationship as BelongsToRelationship | ManyRelationship,\n      identifier,\n      silenceNotifications\n    );\n  }\n}\n\nfunction clearRelationship(relationship: ManyRelationship | BelongsToRelationship) {\n  if (isBelongsTo(relationship)) {\n    relationship.localState = null;\n    relationship.remoteState = null;\n    relationship.state.hasReceivedData = false;\n    relationship.state.isEmpty = true;\n  } else {\n    relationship.localMembers.clear();\n    relationship.remoteMembers.clear();\n    relationship.localState = [];\n    relationship.remoteState = [];\n  }\n}\n\nfunction removeDematerializedInverse(\n  graph: Graph,\n  relationship: ManyRelationship | BelongsToRelationship,\n  inverseIdentifier: StableRecordIdentifier,\n  silenceNotifications?: boolean\n) {\n  if (isBelongsTo(relationship)) {\n    const inverseIdentifier = relationship.localState;\n    if (!relationship.definition.isAsync || (inverseIdentifier && isNew(inverseIdentifier))) {\n      // unloading inverse of a sync relationship is treated as a client-side\n      // delete, so actually remove the models don't merely invalidate the cp\n      // cache.\n      // if the record being unloaded only exists on the client, we similarly\n      // treat it as a client side delete\n      if (relationship.localState === inverseIdentifier && inverseIdentifier !== null) {\n        relationship.localState = null;\n      }\n\n      if (relationship.remoteState === inverseIdentifier && inverseIdentifier !== null) {\n        relationship.remoteState = null;\n        relationship.state.hasReceivedData = true;\n        relationship.state.isEmpty = true;\n        if (relationship.localState && !isNew(relationship.localState)) {\n          relationship.localState = null;\n        }\n      }\n    } else {\n      relationship.state.hasDematerializedInverse = true;\n    }\n\n    if (!silenceNotifications) {\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  } else {\n    if (!relationship.definition.isAsync || (inverseIdentifier && isNew(inverseIdentifier))) {\n      // unloading inverse of a sync relationship is treated as a client-side\n      // delete, so actually remove the models don't merely invalidate the cp\n      // cache.\n      // if the record being unloaded only exists on the client, we similarly\n      // treat it as a client side delete\n      removeIdentifierCompletelyFromRelationship(graph, relationship, inverseIdentifier);\n    } else {\n      relationship.state.hasDematerializedInverse = true;\n    }\n\n    if (!silenceNotifications) {\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  }\n}\n\nfunction removeCompletelyFromInverse(\n  graph: Graph,\n  relationship: ImplicitRelationship | ManyRelationship | BelongsToRelationship\n) {\n  const { identifier } = relationship;\n  const { inverseKey } = relationship.definition;\n\n  forAllRelatedIdentifiers(relationship, (inverseIdentifier: StableRecordIdentifier) => {\n    if (graph.has(inverseIdentifier, inverseKey)) {\n      removeIdentifierCompletelyFromRelationship(graph, graph.get(inverseIdentifier, inverseKey), identifier);\n    }\n  });\n\n  if (isBelongsTo(relationship)) {\n    if (!relationship.definition.isAsync) {\n      clearRelationship(relationship);\n    }\n\n    relationship.localState = null;\n  } else if (isHasMany(relationship)) {\n    if (!relationship.definition.isAsync) {\n      clearRelationship(relationship);\n\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  } else {\n    relationship.remoteMembers.clear();\n    relationship.localMembers.clear();\n  }\n}\n","import { DEBUG } from '@ember-data/env';\nimport type Store from '@ember-data/store';\nimport type { CacheStoreWrapper } from '@ember-data/types/q/cache-store-wrapper';\nimport type { StableRecordIdentifier } from '@ember-data/types/q/identifier';\n\nimport type { UpgradedMeta } from './-edge-definition';\nimport { getStore } from './-utils';\nimport { Graph, Graphs } from './graph';\n\nexport interface ImplicitRelationship {\n  definition: UpgradedMeta;\n  identifier: StableRecordIdentifier;\n  localMembers: Set<StableRecordIdentifier>;\n  remoteMembers: Set<StableRecordIdentifier>;\n}\n\nfunction isStore(maybeStore: unknown): maybeStore is Store {\n  return (maybeStore as Store)._instanceCache !== undefined;\n}\n\nfunction getWrapper(store: CacheStoreWrapper | Store): CacheStoreWrapper {\n  return isStore(store) ? store._instanceCache._storeWrapper : store;\n}\n\nexport function peekGraph(store: CacheStoreWrapper | Store): Graph | undefined {\n  return Graphs.get(getWrapper(store));\n}\nexport type peekGraph = typeof peekGraph;\n\nexport function graphFor(store: CacheStoreWrapper | Store): Graph {\n  const wrapper = getWrapper(store);\n  let graph = Graphs.get(wrapper);\n\n  if (!graph) {\n    graph = new Graph(wrapper);\n    Graphs.set(wrapper, graph);\n\n    // in DEBUG we attach the graph to the main store for improved debuggability\n    if (DEBUG) {\n      if (getStore(wrapper).isDestroying) {\n        throw new Error(`Memory Leak Detected During Teardown`);\n      }\n      Graphs.set(getStore(wrapper) as unknown as CacheStoreWrapper, graph);\n    }\n  }\n  return graph;\n}\n"],"names":["coerceId","id","undefined","toString","getStore","wrapper","assert","_store","expandingGet","cache","key1","key2","mainCache","Object","create","expandingSet","value","assertValidRelationshipPayload","graph","op","relationship","get","record","field","isHasMany","isBelongsTo","payload","definition","identifier","state","type","isAsync","kind","links","warn","data","hasReceivedData","inspect","Array","isArray","assertRelationshipData","store","i","length","isNew","peekCache","Boolean","isImplicit","forAllRelatedIdentifiers","rel","cb","remoteState","localState","seen","Set","inverseIdentifier","has","add","localMembers","forEach","remoteMembers","removeIdentifierCompletelyFromRelationship","silenceNotifications","notifyChange","key","delete","canonicalIndex","indexOf","splice","currentIndex","_removing","macroCondition","getOwnConfig","debug","LOG_GRAPH","console","log","String","meta","JSON","stringify","getSchemaDefinitionService","doesTypeExist","createState","isEmpty","isStale","hasFailedLoadAttempt","shouldForceReload","hasDematerializedInverse","BelongsToRelationship","constructor","_state","transactionRef","getData","ManyRelationship","slice","assertPolymorphicType","assertInheritedSchema","env","DEBUG","validateSchema","errors","Map","inverseKey","name","set","inverseType","inverseKind","inverseIsAsync","options","async","inverseIsPolymorphic","polymorphic","inverse","as","expectedSchema","printSchema","config","metaFrom","isPolymorphic","inverseMetaFrom","inverseDefinition","definitionWithPolymorphic","assign","meta1","meta2","errors1","errors2","size","Error","parentIdentifier","parentDefinition","addedIdentifier","inverseIsImplicit","relationshipsDefinitionFor","BOOL_LATER","STR_LATER","IMPLICIT_KEY_RAND","Date","now","implicitKeyFor","syncMeta","inverseIsCollection","isCollection","upgradeMeta","niceMeta","assertConfiguration","info","isSelfReferential","isRHS","rhs_relationshipName","rhs_baseModelName","lhs_isPolymorphic","rhs_modelNames","isLHS","lhs_relationshipName","lhs_baseModelName","rhs_isPolymorphic","lhs_modelNames","lhs_definition","isRelationship","upgradeDefinition","propertyName","_definitionCache","storeWrapper","polymorphicLookup","_potentialPolymorphicTypes","cached","relationships","altTypes","keys","push","modelFor","inverseForRelationship","isInitialized","inverseDefinitions","lhs_key","rhs_key","rhs_definition","hasInverse","isReflexive","baseType","modelNames","replaceRelatedRecords","isRemote","replaceRelatedRecordsRemote","replaceRelatedRecordsLocal","identifiers","newValues","identifiersLength","newState","newMembership","changed","currentLength","iterationLength","equalLength","j","adv","registerPolymorphicType","addToInverse","removeFromInverse","_addToTransaction","canonicalLength","flushCanonical","notifyInverseOfPotentialMaterialization","index","syncRemoteToLocal","toSet","newIdentifiers","filter","existingState","concat","v","_scheduleLocalSync","addToRelatedRecords","addRelatedRecord","mergeIdentifier","mergeIdentifierForRelationship","mergeInRelationship","mergeBelongsTo","mergeHasMany","mergeImplicit","removeFromRelatedRecords","removeRelatedRecord","replaceRelatedRecord","prop","_normalizeLink","link","href","updateRelationshipOperation","hasRelationshipDataProperty","hasUpdatedLink","identifierCache","update","map","getOrCreateRecordIdentifier","originalLinks","related","relatedLink","currentLink","currentLinkHref","relationshipIsEmpty","Graphs","Graph","isDestroyed","_willSyncRemote","_willSyncLocal","_pushedUpdates","belongsTo","hasMany","deletions","_updatedRelationships","_transaction","Klass","type1","type2","typeCache","t1","t2","isReleasable","unload","destroyRelationship","remove","_schedule","_flushRemoteQueue","removeCompletelyFromInverse","_flushLocalQueue","groupCollapsed","_finalize","groupEnd","updated","destroy","_","isDestroying","clear","inverseIdentifer","notifyInverseOfDematerialization","clearRelationship","removeDematerializedInverse","isStore","maybeStore","_instanceCache","getWrapper","_storeWrapper","peekGraph","graphFor"],"mappings":"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"}