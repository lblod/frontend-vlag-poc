{"version":3,"file":"fetch.js","sources":["../src/fetch.ts"],"sourcesContent":["/**\n * A basic Fetch Handler which converts a request into a\n * `fetch` call presuming the response to be `json`.\n *\n * ```ts\n * import Fetch from '@ember-data/request/fetch';\n *\n * manager.use([Fetch]);\n * ```\n *\n * @module @ember-data/request/fetch\n * @main @ember-data/request/fetch\n */\n\nimport type { Context } from './-private/context';\n\nconst _fetch: typeof fetch =\n  typeof fetch !== 'undefined'\n    ? fetch\n    : typeof FastBoot !== 'undefined'\n    ? (FastBoot.require('node-fetch') as typeof fetch)\n    : ((() => {\n        throw new Error('No Fetch Implementation Found');\n      }) as typeof fetch);\n/**\n * A basic handler which converts a request into a\n * `fetch` call presuming the response to be `json`.\n *\n * ```ts\n * import Fetch from '@ember-data/request/fetch';\n *\n * manager.use([Fetch]);\n * ```\n *\n * @class Fetch\n * @public\n */\nconst Fetch = {\n  async request(context: Context) {\n    const response = await _fetch(context.request.url!, context.request);\n    context.setResponse(response);\n\n    // if we are an error, we will want to throw\n    if (!response.ok || response.status >= 400) {\n      const text = await response.text();\n      let errorPayload: object | undefined;\n      try {\n        errorPayload = JSON.parse(text) as object;\n      } catch {\n        // void;\n      }\n      const error: Error & { content: object | undefined } = new Error(\n        `[${response.status}] ${response.statusText} - ${response.url}`\n      ) as Error & { content: object | undefined };\n      error.content = errorPayload;\n      throw error;\n    } else {\n      return response.json();\n    }\n  },\n};\n\nexport default Fetch;\n"],"names":["_fetch","fetch","FastBoot","require","Error","Fetch","request","context","response","url","setResponse","ok","status","text","errorPayload","JSON","parse","error","statusText","content","json"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA,MAAMA,MAAoB,GACxB,OAAOC,KAAK,KAAK,WAAW,GACxBA,KAAK,GACL,OAAOC,QAAQ,KAAK,WAAW,GAC9BA,QAAQ,CAACC,OAAO,CAAC,YAAY,CAAC,GAC7B,MAAM;AACN,EAAA,MAAM,IAAIC,KAAK,CAAC,+BAA+B,CAAC,CAAA;AAClD,CAAmB,CAAA;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,KAAK,GAAG;EACZ,MAAMC,OAAOA,CAACC,OAAgB,EAAE;AAC9B,IAAA,MAAMC,QAAQ,GAAG,MAAMR,MAAM,CAACO,OAAO,CAACD,OAAO,CAACG,GAAG,EAAGF,OAAO,CAACD,OAAO,CAAC,CAAA;AACpEC,IAAAA,OAAO,CAACG,WAAW,CAACF,QAAQ,CAAC,CAAA;;AAE7B;IACA,IAAI,CAACA,QAAQ,CAACG,EAAE,IAAIH,QAAQ,CAACI,MAAM,IAAI,GAAG,EAAE;AAC1C,MAAA,MAAMC,IAAI,GAAG,MAAML,QAAQ,CAACK,IAAI,EAAE,CAAA;AAClC,MAAA,IAAIC,YAAgC,CAAA;MACpC,IAAI;AACFA,QAAAA,YAAY,GAAGC,IAAI,CAACC,KAAK,CAACH,IAAI,CAAW,CAAA;AAC3C,OAAC,CAAC,MAAM;AACN;AAAA,OAAA;AAEF,MAAA,MAAMI,KAA8C,GAAG,IAAIb,KAAK,CAC7D,CAAA,CAAA,EAAGI,QAAQ,CAACI,MAAO,CAAIJ,EAAAA,EAAAA,QAAQ,CAACU,UAAW,CAAA,GAAA,EAAKV,QAAQ,CAACC,GAAI,EAChE,CAA4C,CAAA;MAC5CQ,KAAK,CAACE,OAAO,GAAGL,YAAY,CAAA;AAC5B,MAAA,MAAMG,KAAK,CAAA;AACb,KAAC,MAAM;AACL,MAAA,OAAOT,QAAQ,CAACY,IAAI,EAAE,CAAA;AACxB,KAAA;AACF,GAAA;AACF;;;;"}