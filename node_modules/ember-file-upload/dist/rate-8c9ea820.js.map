{"version":3,"file":"rate-8c9ea820.js","sources":["../src/system/http-request.ts","../src/interfaces.ts","../src/system/upload.ts","../src/system/upload-file-reader.ts","../src/system/rate.ts"],"sourcesContent":["import { bind } from '@ember/runloop';\nimport RSVP from 'rsvp';\nimport type { HTTPRequestOptions } from '../interfaces.ts';\n\nfunction parseHeaders(headerString: string) {\n  return headerString\n    .split(/\\n|\\r/)\n    .filter((str) => str !== '')\n    .reduce((headers: Headers, headerString: string) => {\n      const parts = headerString.split(/^([0-9A-Za-z_-]*:)/);\n      if (parts.length > 0 && parts[1] && parts[2]) {\n        headers.append(parts[1].slice(0, -1), parts[2].trim());\n      }\n      return headers;\n    }, new Headers());\n}\n\nfunction parseResponse(request: XMLHttpRequest): Response {\n  const body = request.response === '' ? null : request.response;\n  if (request.status >= 200 && request.status < 600) {\n    return new Response(body, {\n      status: request.status,\n      statusText: request.statusText,\n      headers: parseHeaders(request.getAllResponseHeaders()),\n    });\n  } else {\n    return Response.error();\n  }\n}\n\nexport default class HTTPRequest {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  onloadstart: (event?: ProgressEvent<EventTarget>) => void | undefined;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  onprogress: (event?: ProgressEvent<EventTarget>) => void | undefined;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  onloadend: (event?: ProgressEvent<EventTarget>) => void | undefined;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  ontimeout: (event?: ProgressEvent<EventTarget>) => void | undefined;\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  onabort: (event?: ProgressEvent<EventTarget>) => void | undefined;\n\n  request;\n  resolve;\n  reject;\n  promise: RSVP.Promise<Response>;\n\n  constructor(options: HTTPRequestOptions = {}) {\n    const { resolve, reject, promise } = RSVP.defer(\n      `ember-file-upload: ${options.label}`,\n    );\n    this.resolve = resolve;\n    this.reject = reject;\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    this.promise = promise;\n    this.request = new XMLHttpRequest();\n\n    this.request.withCredentials = options.withCredentials ?? false;\n\n    let aborted: RSVP.Deferred<string>;\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    promise.cancel = () => {\n      if (aborted == null) {\n        aborted = RSVP.defer(`ember-file-upload: Abort ${options.label}`);\n        this.request.abort();\n      }\n      return aborted.promise;\n    };\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    promise.then = function (...args) {\n      const newPromise = RSVP.Promise.prototype.then.apply(this, args);\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      newPromise.cancel = promise.cancel;\n      newPromise.then = promise.then;\n      return newPromise;\n    };\n    this.request.onabort = bind(this, function () {\n      this.onabort?.();\n      aborted.resolve();\n    });\n\n    this.request.onloadstart = bind(this, function (evt) {\n      this.onloadstart?.(evt);\n    });\n    this.request.onprogress = bind(this, function (evt) {\n      this.onprogress?.(evt);\n    });\n    this.request.onloadend = bind(this, function (evt) {\n      this.onloadend?.(evt);\n    });\n\n    if (this.request.upload) {\n      this.request.upload.onloadstart = this.request.onloadstart;\n      this.request.upload.onprogress = this.request.onprogress;\n      this.request.upload.onloadend = this.request.onloadend;\n    }\n\n    this.request.onload = bind(this, function () {\n      const response = parseResponse(this.request);\n      if (Math.floor(response.status / 200) === 1) {\n        resolve(response);\n      } else {\n        reject(response);\n      }\n    });\n\n    this.request.onerror = bind(this, function () {\n      reject(parseResponse(this.request));\n    });\n\n    Object.defineProperty(this, 'timeout', {\n      get() {\n        return this.request.timeout;\n      },\n      set(timeout) {\n        this.request.timeout = timeout;\n      },\n      enumerable: true,\n      configurable: false,\n    });\n\n    this.request.ontimeout = bind(this, function () {\n      this.ontimeout?.();\n      reject(parseResponse(this.request));\n    });\n  }\n\n  send(body: Parameters<XMLHttpRequest['send']>[0]) {\n    this.request.send(body);\n    return this.promise;\n  }\n\n  open(\n    method: string,\n    url: string | URL,\n    _async: boolean,\n    usename?: string,\n    password?: string,\n  ) {\n    this.request.open(method, url, true, usename, password);\n  }\n\n  setRequestHeader(name: string, value: string) {\n    this.request.setRequestHeader(name, value);\n  }\n}\n","import type { UploadFile } from './upload-file.ts';\nimport type { Queue } from './queue.ts';\nimport type FileQueueService from './services/file-queue.ts';\nimport type DataTransferWrapper from './system/data-transfer-wrapper.ts';\n\nexport interface FileQueueSignature {\n  Args: {\n    Positional: never[];\n    Named: {\n      name?: string;\n      onFileAdded?: (file: UploadFile) => void;\n      onFileRemoved?: (file: UploadFile) => void;\n      onUploadStarted?: (file: UploadFile) => void;\n      onUploadSucceeded?: (file: UploadFile, response: Response) => void;\n      onUploadFailed?: (file: UploadFile, response: Response) => void;\n    };\n  };\n  Return: Queue;\n}\n\nexport interface SelectFileSignature {\n  Element: HTMLInputElement;\n  Args: {\n    Positional: [];\n    Named: {\n      filter?: (file: File, files: File[], index: number) => boolean;\n      onFilesSelected?: (files: UploadFile[]) => void;\n    };\n  };\n}\n\ndeclare module '@ember/service' {\n  interface Registry {\n    'file-queue': FileQueueService;\n  }\n}\n\nexport interface QueueListener {\n  onFileAdded?(file: UploadFile): void;\n  onFileRemoved?(file: UploadFile): void;\n  onUploadStarted?(file: UploadFile): void;\n  onUploadSucceeded?(file: UploadFile, response: Response): void;\n  onUploadFailed?(file: UploadFile, response: Response): void;\n}\n\nexport type QueueName = string | symbol;\n\n/**\n * Possible file states.\n *\n * @remarks\n *\n * Here is the statechart describing the flow of state:\n *\n * ```\n *       .------.     .---------.     .--------.\n *   o--| queued |-->| uploading |-->| uploaded |\n *       `------`     `---------`     `--------`\n *          ^              |    .-------.\n *          |              |`->| aborted |\n *          |              |    `-------`\n *          |  .------.    |    .---------.\n *          `-| failed |<-` `->| timed_out |-.\n *          |  `------`         `---------`  |\n *          `-------------------------------`\n * ```\n */\nexport enum FileState {\n  Queued = 'queued',\n  Uploading = 'uploading',\n  TimedOut = 'timed_out',\n  Aborted = 'aborted',\n  Uploaded = 'uploaded',\n  Failed = 'failed',\n}\n\nexport enum FileSource {\n  /**\n   * the file is created using the native file picker\n   */\n  Browse = 'browse',\n\n  /**\n   * the file was created using drag and drop from their desktop\n   */\n  DragAndDrop = 'drag-and-drop',\n\n  /**\n   * the file was created by dragging the file from another webpage\n   */\n  Web = 'web',\n\n  /**\n   * the file is created from a data URL using the `fromDataURL`\n   * method for files. This usually means that the file was created\n   * manually by the developer on behalf of the user\n   */\n  DataUrl = 'data-url',\n\n  /**\n   * the file is created from a blob using the `fromBlob`\n   * method for files. This usually means that the file was created\n   * manually by the developer\n   */\n  Blob = 'blob',\n}\n\nexport interface FileDropzoneSignature {\n  Element: HTMLElement;\n  Args: {\n    queue?: Queue;\n\n    /**\n     * Whether users can upload content from websites by dragging images from\n     * another webpage and dropping it into your app. The default is `false`\n     * to prevent cross-site scripting issues.\n     *\n     * @defaulValue false\n     * */\n    allowUploadsFromWebsites?: boolean;\n\n    /**\n     * This is the type of cursor that should\n     * be shown when a drag event happens.\n     *\n     * Corresponds to `DataTransfer.dropEffect`.\n     * (https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/dropEffect)\n     *\n     * @defaultValue 'copy'\n     */\n    cursor?: 'link' | 'none' | 'copy' | 'move';\n\n    /**\n     * Whether to add multiple files to the queue at once.\n     *\n     * If set to false only one file will be added when dropping mulitple files.\n     *\n     * @defaultValue true\n     */\n    multiple?: boolean;\n\n    // actions\n    filter?: (file: File, files: File[], index: number) => boolean;\n\n    /**\n     * Called when files have entered the dropzone.\n     */\n    onDragEnter?: (files: File[], dataTransfer: DataTransferWrapper) => void;\n\n    /**\n     * Called when files have left the dropzone.\n     */\n    onDragLeave?: (files: File[], dataTransfer: DataTransferWrapper) => void;\n\n    /**\n     * Called when file have been dropped on the dropzone.\n     */\n    onDrop?: (files: UploadFile[], dataTransfer: DataTransferWrapper) => void;\n  };\n  Blocks: {\n    default: [dropzone: { supported: boolean; active: boolean }, queue: Queue];\n  };\n}\n\nexport interface FileUploadDragEvent extends DragEvent {\n  dataTransfer: DataTransfer;\n  source?: 'os' | 'web';\n  itemDetails?: DataTransferItem[] | { kind: string; type: string }[];\n}\n\nexport interface UploadOptions {\n  url?: string;\n  method?: string;\n  accepts?: string[];\n  headers?: Record<string, string>;\n  fileKey?: string;\n  contentType?: string;\n  data?: Record<string, string | File>;\n  withCredentials?: boolean;\n  timeout?: number;\n}\n\nexport interface HTTPRequestOptions {\n  label?: string;\n  withCredentials?: boolean;\n  timeout?: number;\n}\n\nexport interface HTTPRequestResponse {\n  status: number;\n  body: string | Document | HTMLElement[] | null | undefined;\n  headers: Record<string, string>;\n}\n\nexport interface DragListenerModifierSignature {\n  Args: {\n    Named: DragListenerHandlers;\n  };\n}\n\ntype DragListenerHandler = (event: FileUploadDragEvent) => void;\n\nexport interface DragListenerHandlers {\n  dragenter?: DragListenerHandler;\n  dragleave?: DragListenerHandler;\n  dragover?: DragListenerHandler;\n  drop?: DragListenerHandler;\n}\n\nexport interface DragEventListener {\n  element: Element;\n  handlers: DragListenerHandlers;\n}\n\nexport interface QueuedDragEvent {\n  eventName: 'dragenter' | 'dragleave' | 'dragover' | 'drop';\n  listener: DragEventListener;\n  event: FileUploadDragEvent;\n}\n\nexport interface SyntheticDragEvent {\n  source: FileUploadDragEvent['source'];\n  dataTransfer: DataTransfer | null;\n  itemDetails: Array<{\n    kind: string;\n    type: string;\n  }>;\n}\n","import { assert } from '@ember/debug';\nimport HTTPRequest from './http-request.ts';\nimport RSVP from 'rsvp';\nimport { waitForPromise } from '@ember/test-waiters';\nimport type { UploadFile } from '../upload-file.ts';\nimport { FileState, type UploadOptions } from '../interfaces.ts';\n\nfunction clone(object: object | undefined) {\n  return object ? { ...object } : {};\n}\n\nfunction normalizeOptions(\n  file: UploadFile,\n  url: string | object | undefined,\n  options?: UploadOptions,\n) {\n  if (typeof url === 'object') {\n    options = url;\n    url = undefined;\n  }\n\n  options = clone(options);\n\n  options.url = options.url || url;\n  options.method = options.method || 'POST';\n  options.accepts = options.accepts || ['application/json', 'text/javascript'];\n  if (!Object.prototype.hasOwnProperty.call(options, 'contentType')) {\n    options.contentType = file.type;\n  }\n  options.headers = clone(options.headers);\n  options.data = clone(options.data);\n  options.fileKey = options.fileKey || 'file';\n\n  if (options.headers['Accept'] == null) {\n    if (!Array.isArray(options.accepts)) {\n      options.accepts = [options.accepts];\n    }\n    options.headers['Accept'] = options.accepts.join(',');\n  }\n\n  // Set Content-Type in the data payload\n  // instead of the headers, since the header\n  // for Content-Type will always be multipart/form-data\n  if (options.contentType) {\n    options.data['Content-Type'] = options.contentType;\n  }\n\n  options.data[options.fileKey] = file.file;\n\n  options.withCredentials = options.withCredentials || false;\n\n  return options;\n}\n\nfunction updateRate(file: UploadFile) {\n  const updatedTime = new Date().getTime();\n\n  // If there's a previous recording, we can calculate a rate from that\n  if (file.timestampWhenProgressLastUpdated) {\n    const timeElapsedSinceLastUpdate =\n      updatedTime - file.timestampWhenProgressLastUpdated;\n\n    const bytesTransferredSinceLastUpdate =\n      file.loaded - file.bytesWhenProgressLastUpdated;\n\n    // Divide by elapsed time to get bytes per millisecond\n    const rate = bytesTransferredSinceLastUpdate / timeElapsedSinceLastUpdate;\n\n    file.rates = [...file.rates, rate];\n  }\n\n  // Finally set current state to be picked up by next invocation\n  file.bytesWhenProgressLastUpdated = file.loaded;\n  file.timestampWhenProgressLastUpdated = updatedTime;\n}\n\nexport function onloadstart(\n  file: UploadFile,\n  event?: ProgressEvent<EventTarget>,\n) {\n  if (!event) return;\n  if (!event.lengthComputable || event.total === 0) return;\n\n  file.loaded = event.loaded;\n  // It occurs that the event.total is not always correct.\n  // For this reason we should hold the max file size.\n  // The correct should be returned while progress\n  file.size = Math.max(file.size, event.total);\n  file.progress = (file.loaded / file.size) * 100;\n\n  updateRate(file);\n}\n\nexport function onprogress(\n  file: UploadFile,\n  event?: ProgressEvent<EventTarget>,\n) {\n  if (!event) return;\n  // We need to check also for isUploadComplete, because the browsers brings sometimes the onprogress after onloadend event\n  if (!event.lengthComputable || event.total === 0 || file.isUploadComplete)\n    return;\n\n  file.size = event.total;\n\n  // When the progress is completed there is possible that we get the `Content-Length` response header of the upload endpoint as loaded / total.\n  // There is possible that `Content-Length` is lower or higher than the already loaded bytes.\n  // if there is lower, we want to keep the higher loaded value, otherwise the progress percentage will be decreased\n  // When the event.loaded is higher than the start file.size, we use the file.size, otherwise it can occur that progress for the file is higher than 100%\n  let loaded = event.loaded;\n  if (loaded > file.size) {\n    loaded = file.size;\n  }\n  file.loaded = Math.max(loaded, file.loaded);\n  file.progress = (file.loaded / file.size) * 100;\n\n  updateRate(file);\n}\n\nexport function onloadend(\n  file: UploadFile,\n  event?: ProgressEvent<EventTarget>,\n) {\n  if (!event) return;\n  if (!event.lengthComputable || event.total === 0) return;\n\n  file.loaded = file.size;\n  file.progress = (file.loaded / file.size) * 100;\n  file.isUploadComplete = true;\n}\n\nexport function upload(\n  file: UploadFile,\n  url: string | object,\n  opts: UploadOptions | undefined,\n  uploadFn: (request: HTTPRequest, options: UploadOptions) => Promise<Response>,\n) {\n  if (['queued', 'failed', 'timed_out', 'aborted'].indexOf(file.state) === -1) {\n    assert(\n      `The file ${file.id} is in the state \"${file.state}\" and cannot be requeued.`,\n    );\n  }\n\n  const options = normalizeOptions(file, url, opts);\n\n  const request = new HTTPRequest({\n    withCredentials: options.withCredentials,\n    label: `${options.method} ${file.name} to ${options.url}`,\n  });\n\n  request.open(options.method ?? 'POST', options.url ?? '', true, '', '');\n\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  Object.keys(options.headers).forEach(function (key) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    request.setRequestHeader(key, options.headers[key]);\n  });\n\n  if (options.timeout) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    request.timeout = options.timeout;\n  }\n\n  request.onloadstart = (event) => onloadstart(file, event);\n  request.onprogress = (event) => onprogress(file, event);\n  request.onloadend = (event) => onloadend(file, event);\n\n  request.ontimeout = () => {\n    file.state = FileState.TimedOut;\n    file.queue?.flush();\n  };\n  request.onabort = () => {\n    file.state = FileState.Aborted;\n    file.queue?.flush();\n  };\n  file.state = FileState.Uploading;\n\n  return waitForPromise(\n    uploadFn(request, options)\n      .then(function (response) {\n        file.state = FileState.Uploaded;\n        file.queue?.uploadSucceeded(file, response);\n        return response;\n      })\n      .catch(function (response) {\n        file.state = FileState.Failed;\n        file.queue?.uploadFailed(file, response);\n        return RSVP.reject(response);\n      })\n      .finally(() => file.queue?.flush()),\n  );\n}\n","import RSVP from 'rsvp';\n\n/**\n  Provides a promise-aware interface for reading files.\n\n  ```js\n  import { UploadFile, UploadFileReader } from 'ember-file-upload';\n\n  let reader = new UploadFileReader();\n  let file = File.fromDataURL('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAACNJREFUCB1jYICC6dOn/4exwTRMAEYzwBnoOmASMBpuDLIAAIVVFiE0cg0oAAAAAElFTkSuQmCC');\n\n  reader.readAsDataURL(file.blob).then((url) => {\n    return url;\n  }, function (err) {\n    console.error(err);\n  });\n  ```\n\n  Promises can be aborted, which will cancel the file upload:\n\n  ```js\n  let promise = reader.readAsDataURL(file.blob);\n  promise.then((url) => {\n    return url;\n  }, (err) => {\n    console.error(err);\n  });\n\n  promise.abort().then(() => {\n    console.error('cancelled reading file');\n  });\n  ```\n\n  @class UploadFileReader\n  @constructor\n  @param [options] An object with a label to use to mark the promise.\n */\nexport default class UploadFileReader {\n  label;\n  reader;\n\n  constructor(options: { label: string } = { label: '' }) {\n    this.label = options.label;\n    this.reader = new FileReader();\n  }\n\n  /**\n    Reads the file and returns a promise that will\n    return the blob as ArrayBuffer.\n\n    @method readAsArrayBuffer\n    @return {Promise} A promise that will return the file as an ArrayBuffer\n   */\n  readAsArrayBuffer(blob: Blob) {\n    this.reader.readAsArrayBuffer(blob);\n    return this.cancellablePromise;\n  }\n\n  /**\n    Reads the file and returns a promise that will\n    return the blob as data URL.\n\n    This is useful for reading images to display\n    as a preview in the browser.\n\n    @method readAsDataURL\n    @return {Promise} A promise that will return the file as a data URL\n   */\n  readAsDataURL(blob: Blob) {\n    this.reader.readAsDataURL(blob);\n    return this.cancellablePromise;\n  }\n\n  /**\n    Reads the file and returns a promise that will\n    return the blob as binary string.\n\n    This is useful for reading images or files that\n    are not plain text.\n\n    @method readAsBinaryString\n    @return {Promise} A promise that will return the file as a binary string\n   */\n  readAsBinaryString(blob: Blob) {\n    this.reader.readAsBinaryString(blob);\n    return this.cancellablePromise;\n  }\n\n  /**\n    Reads the file and returns a promise that will\n    return the blob as text.\n\n    This is useful for reading plain text files.\n\n    @method readAsText\n    @return {Promise} A promise that will return the file as text\n   */\n  readAsText(blob: Blob) {\n    this.reader.readAsText(blob);\n    return this.cancellablePromise;\n  }\n\n  get cancellablePromise() {\n    const { promise, resolve, reject } = RSVP.defer(\n      `ember-file-upload: ${this.label}`,\n    );\n\n    const cancellable = promise.then(\n      () => {\n        return this.reader.result;\n      },\n      () => {\n        return RSVP.reject(this.reader.error);\n      },\n      `ember-file-upload: Unpack ${this.label}`,\n    );\n\n    let abort: RSVP.Deferred<string> | undefined;\n\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    cancellable.cancel = () => {\n      if (abort == null) {\n        abort = RSVP.defer(`ember-file-upload: Abort ${this.label}`);\n        this.reader.abort();\n      }\n      return abort.promise;\n    };\n\n    this.reader.onload = resolve;\n    this.reader.onerror = reject;\n    this.reader.onabort = () => {\n      abort?.resolve();\n    };\n\n    return cancellable;\n  }\n}\n","// Calculate from the last x rate recordings\nconst CALCULATE_FROM_LAST = 30;\n\n// Weigh recent rates more highly\nconst THRESHOLDS = [\n  { threshold: 10, proportion: 3 },\n  { threshold: 20, proportion: 2 },\n  { threshold: 30, proportion: 1 },\n];\nconst DEFAULT_PROPORTION = 1;\n\nexport function estimatedRate(allRates: number[]): number {\n  if (!allRates.length) return 0;\n\n  const rates = allRates.slice(CALCULATE_FROM_LAST * -1).reverse();\n  const weights = generateWeights(rates.length);\n\n  // Multiply each rate by its respective weight for a weighted average\n  return rates.reduce((acc, rate, index) => {\n    const weight = weights[index] as number;\n    return acc + rate * weight;\n  }, 0);\n}\n\nexport function generateWeights(totalRates: number): number[] {\n  // Generate an array the same length as totalRates filled with proportioanl weights\n  const proportions = Array.from({ length: totalRates }).map((_, index) => {\n    return proportionForPosition(index + 1);\n  });\n\n  const proportionTotal = proportions.reduce((acc, value) => acc + value, 0);\n  // Convert proportional weights to real weights by division\n  const realWeights = proportions.map(\n    (proportion) => proportion / proportionTotal,\n  );\n\n  return realWeights;\n}\n\nexport function proportionForPosition(position: number) {\n  for (const { threshold, proportion } of THRESHOLDS) {\n    if (position <= threshold) return proportion;\n  }\n  return DEFAULT_PROPORTION;\n}\n"],"names":["parseHeaders","headerString","split","filter","str","reduce","headers","parts","length","append","slice","trim","Headers","parseResponse","request","body","response","status","Response","statusText","getAllResponseHeaders","error","HTTPRequest","constructor","options","_defineProperty","resolve","reject","promise","RSVP","defer","label","XMLHttpRequest","withCredentials","aborted","cancel","abort","then","args","newPromise","Promise","prototype","apply","onabort","bind","onloadstart","evt","onprogress","onloadend","upload","onload","Math","floor","onerror","Object","defineProperty","get","timeout","set","enumerable","configurable","ontimeout","send","open","method","url","_async","usename","password","setRequestHeader","name","value","FileState","FileSource","clone","object","normalizeOptions","file","undefined","accepts","hasOwnProperty","call","contentType","type","data","fileKey","Array","isArray","join","updateRate","updatedTime","Date","getTime","timestampWhenProgressLastUpdated","timeElapsedSinceLastUpdate","bytesTransferredSinceLastUpdate","loaded","bytesWhenProgressLastUpdated","rate","rates","event","lengthComputable","total","size","max","progress","isUploadComplete","opts","uploadFn","indexOf","state","assert","id","keys","forEach","key","TimedOut","queue","flush","Aborted","Uploading","waitForPromise","Uploaded","uploadSucceeded","catch","Failed","uploadFailed","finally","UploadFileReader","reader","FileReader","readAsArrayBuffer","blob","cancellablePromise","readAsDataURL","readAsBinaryString","readAsText","cancellable","result","CALCULATE_FROM_LAST","THRESHOLDS","threshold","proportion","DEFAULT_PROPORTION","estimatedRate","allRates","reverse","weights","generateWeights","acc","index","weight","totalRates","proportions","from","map","_","proportionForPosition","proportionTotal","realWeights","position"],"mappings":"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"}