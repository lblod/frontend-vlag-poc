{"version":3,"file":"index.js","sources":["../src/mirage/utils.ts","../src/mirage/upload-handler.ts"],"sourcesContent":["import RSVP from 'rsvp';\nimport UploadFileReader from '../system/upload-file-reader.ts';\nimport { assert } from '@ember/debug';\n\ninterface AdditionalMetadata {\n  hasAdditionalMetadata?: boolean;\n  duration?: number;\n  animated?: boolean;\n  width?: number;\n  height?: number;\n}\n\ninterface ImageResult {\n  hasAdditionalMetadata: boolean;\n  img?: HTMLImageElement;\n}\n\ninterface VideoResult {\n  hasAdditionalMetadata: boolean;\n  video?: HTMLVideoElement;\n}\n\ninterface AudioResult {\n  hasAdditionalMetadata: boolean;\n  audio?: HTMLAudioElement;\n}\n\ninterface FileMetadata extends AdditionalMetadata {\n  name: string;\n  size: number;\n  type: string;\n  extension?: string;\n  url: string;\n}\n\nexport function extractFormData(formData: FormData) {\n  let data = {};\n  let file: { key: string; value: File } | null = null;\n\n  for (const [key, value] of formData.entries()) {\n    if (value instanceof File) {\n      file = { key, value };\n      continue;\n    }\n    data = { ...data, [key]: value };\n  }\n\n  assert('Failed find a file in request body', file?.key && file?.value);\n\n  return { file, data };\n}\n\nconst pipelines = {\n  async gif(file: File): Promise<AdditionalMetadata> {\n    const buffer = (await new UploadFileReader().readAsArrayBuffer(\n      file,\n    )) as ArrayBuffer;\n    const data = new Uint8Array(buffer);\n    let duration = 0;\n    for (let i = 0; i < data.length; i++) {\n      const byte4 = data[i + 4];\n      const byte5 = data[i + 5];\n\n      // Find a Graphic Control Extension hex(21F904__ ____ __00)\n      if (\n        data[i] === 0x21 &&\n        data[i + 1] === 0xf9 &&\n        data[i + 2] === 0x04 &&\n        byte4 !== undefined &&\n        byte5 !== undefined &&\n        data[i + 7] === 0x00\n      ) {\n        // Swap 5th and 6th bytes to get the delay per frame\n        const delay = (byte5 << 8) | (byte4 & 0xff);\n\n        // Should be aware browsers have a minimum frame delay\n        // e.g. 6ms for IE, 2ms modern browsers (50fps)\n        duration += delay < 2 ? 10 : delay;\n      }\n    }\n\n    return {\n      hasAdditionalMetadata: true,\n      duration: duration / 1000,\n      animated: duration > 0,\n    };\n  },\n\n  image(_file: File, metadata: FileMetadata): RSVP.Promise<AdditionalMetadata> {\n    return new RSVP.Promise(function (resolve: (result: ImageResult) => void) {\n      const img = new Image();\n      img.onload = () => resolve({ hasAdditionalMetadata: true, img });\n      img.onerror = () => resolve({ hasAdditionalMetadata: false });\n      img.src = metadata.url;\n    }).then(function ({ hasAdditionalMetadata, img }) {\n      return {\n        hasAdditionalMetadata,\n        width: img?.naturalWidth,\n        height: img?.naturalHeight,\n      };\n    });\n  },\n\n  video(_file: File, metadata: FileMetadata): RSVP.Promise<AdditionalMetadata> {\n    const videoEl = document.createElement('video');\n    return new RSVP.Promise(function (resolve: (result: VideoResult) => void) {\n      videoEl.addEventListener('loadeddata', () =>\n        resolve({ hasAdditionalMetadata: true, video: videoEl }),\n      );\n      videoEl.onerror = () => resolve({ hasAdditionalMetadata: false });\n      videoEl.src = metadata.url;\n      document.body.appendChild(videoEl);\n      videoEl.load();\n    })\n      .then(function ({ hasAdditionalMetadata, video }) {\n        return {\n          hasAdditionalMetadata,\n          duration: video?.duration,\n          width: video?.videoWidth,\n          height: video?.videoHeight,\n        };\n      })\n      .finally(function () {\n        document.body.removeChild(videoEl);\n      });\n  },\n\n  audio(_file: File, metadata: FileMetadata): RSVP.Promise<AdditionalMetadata> {\n    const audioEl = document.createElement('audio');\n    return new RSVP.Promise(function (resolve: (result: AudioResult) => void) {\n      audioEl.addEventListener('loadeddata', () =>\n        resolve({ hasAdditionalMetadata: true, audio: audioEl }),\n      );\n      audioEl.onerror = () => resolve({ hasAdditionalMetadata: false });\n      audioEl.src = metadata.url;\n      document.body.appendChild(audioEl);\n      audioEl.load();\n    })\n      .then(function ({ hasAdditionalMetadata, audio }) {\n        return {\n          hasAdditionalMetadata,\n          duration: audio?.duration,\n        };\n      })\n      .finally(function () {\n        document.body.removeChild(audioEl);\n      });\n  },\n};\n\nexport async function extractFileMetadata(file: File) {\n  const url = (await new UploadFileReader().readAsDataURL(file)) as string;\n\n  const metadata: FileMetadata = {\n    name: file.name,\n    size: file.size,\n    type: file.type,\n    extension: (file.name.match(/\\.(.*)$/) ?? [])[1],\n    url,\n  };\n\n  const metadataPipelines = [];\n\n  if (metadata.type === 'image/gif') {\n    metadataPipelines.push(pipelines.gif(file));\n  }\n  if (metadata.type.match(/^image\\//)) {\n    metadataPipelines.push(pipelines.image(file, metadata));\n  }\n  if (metadata.type.match(/^video\\//)) {\n    metadataPipelines.push(pipelines.video(file, metadata));\n  }\n  if (metadata.type.match(/^audio\\//)) {\n    metadataPipelines.push(pipelines.audio(file, metadata));\n  }\n\n  const additionalMetadata = await RSVP.all(metadataPipelines);\n\n  additionalMetadata.forEach(function (data) {\n    Object.assign(metadata, data);\n  });\n\n  // Collapse state of `hasAdditionalMetadata` from multiple pipelines\n  // Should be `true` if at least one pipeline succeeded\n  metadata.hasAdditionalMetadata = additionalMetadata.some(\n    (data) => data.hasAdditionalMetadata,\n  );\n\n  return metadata;\n}\n","import RSVP from 'rsvp';\nimport { extractFormData, extractFileMetadata } from './utils.ts';\nimport {\n  macroCondition,\n  dependencySatisfies,\n  importSync,\n} from '@embroider/macros';\n\nconst NETWORK = {\n  wired: 50000, // 500 Mb/s\n  wifi: 15000, // 15 Mb/s\n  dsl: 1000, // 1 Mb/s\n  '4g': 3000, // 4 Mb/s\n  '3g': 250, // 250 kb/s\n  '2g': 50, // 50 kb/s\n  gprs: 20, // 20 kb/s\n  offline: 0,\n};\n\ninterface FakeRequest {\n  requestBody: FormData | object; // Replaced with an object by this handler\n  upload: {\n    onloadstart: (event: ProgressEvent<EventTarget>) => void;\n    onprogress: (event: ProgressEvent<EventTarget>) => void;\n    onloadend: (event: ProgressEvent<EventTarget>) => void;\n  };\n}\n\nexport function uploadHandler(\n  fn: (this: void, db: unknown, request: FakeRequest) => void,\n  options = { network: null, timeout: null },\n) {\n  if (\n    macroCondition(\n      dependencySatisfies('miragejs', '*') &&\n        dependencySatisfies('ember-cli-mirage', '*'),\n    )\n  ) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const { Response } = importSync('miragejs') as { Response: any };\n    return function (db: unknown, request: FakeRequest) {\n      let speed = Infinity;\n\n      if (options.network && NETWORK[options.network]) {\n        speed = NETWORK[options.network] * 1024;\n      }\n\n      const { file, data } = extractFormData(request.requestBody as FormData);\n      let loaded = 0;\n      const total = file.value.size;\n\n      return new RSVP.Promise((resolve) => {\n        const start = new Date().getTime();\n\n        request.upload.onloadstart(\n          new ProgressEvent('loadstart', {\n            lengthComputable: true,\n            total,\n            loaded: Math.min(loaded, total),\n          }),\n        );\n\n        const upload = async () => {\n          const timedOut =\n            options.timeout && new Date().getTime() - start > options.timeout;\n          if (timedOut || loaded >= total) {\n            request.upload.onloadend(\n              new ProgressEvent('loadend', {\n                lengthComputable: true,\n                // For the loadend event the `total` value may be sourced from the `Content-Length` response header of the upload endpoint.\n                // In which case it may represent the size of the response rather than the number of uploaded bytes.\n                // So we set it to an arbitrary value to make sure this doesn't influence file upload and queue progress stats.\n                // See: https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent/total\n                total: 300,\n                loaded: Math.min(loaded, total),\n              }),\n            );\n\n            const metadata = await extractFileMetadata(file.value);\n            request.requestBody = { [file.key]: metadata, ...data };\n\n            if (timedOut) {\n              resolve(new Response(408));\n              return;\n            }\n\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            resolve(fn.call(this, db, request));\n          } else {\n            request.upload.onprogress(\n              new ProgressEvent('progress', {\n                lengthComputable: true,\n                total,\n                loaded,\n              }),\n            );\n\n            loaded += speed / 20;\n            setTimeout(upload, 50);\n          }\n        };\n        upload();\n      });\n    };\n  } else {\n    throw new Error(\n      'You must add ember-cli-mirage and miragejs to your app to use this helper.',\n    );\n  }\n}\n"],"names":["extractFormData","formData","data","file","key","value","entries","File","assert","pipelines","gif","buffer","UploadFileReader","readAsArrayBuffer","Uint8Array","duration","i","length","byte4","byte5","undefined","delay","hasAdditionalMetadata","animated","image","_file","metadata","RSVP","Promise","resolve","img","Image","onload","onerror","src","url","then","width","naturalWidth","height","naturalHeight","video","videoEl","document","createElement","addEventListener","body","appendChild","load","videoWidth","videoHeight","finally","removeChild","audio","audioEl","extractFileMetadata","readAsDataURL","name","size","type","extension","match","metadataPipelines","push","additionalMetadata","all","forEach","Object","assign","some","NETWORK","wired","wifi","dsl","gprs","offline","uploadHandler","fn","options","network","timeout","macroCondition","dependencySatisfies","Response","importSync","db","request","speed","Infinity","requestBody","loaded","total","start","Date","getTime","upload","onloadstart","ProgressEvent","lengthComputable","Math","min","timedOut","onloadend","call","onprogress","setTimeout","Error"],"mappings":"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"}